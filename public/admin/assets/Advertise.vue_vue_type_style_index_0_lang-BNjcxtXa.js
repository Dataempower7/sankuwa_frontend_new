import{d as ke,r as g,c as ee,y as Te,Y as Fe,f as _,g as B,h as P,i as l,k as te,l as V,aY as Pe,m as v,z as w,F as oe,p as Le,n as Re,t as $,Q as ae,aV as Ue,P as N,ak as Se}from"./index-B52YIGC0.js";import{a as Ee}from"./groupon-BtcEMuW-.js";import{r as Ae}from"./export-Ds6vL4MA.js";import{a as qe}from"./format-BxqOrW-w.js";const Be={class:"header"},$e={class:"header-title"},ze={class:"tabs-row"},Ie=["onClick"],Oe={class:"content"},Ve={class:"poster-img-container"},Ne={class:"poster-info"},De={class:"poster-actions"},He={class:"poster-paths"},We={class:"poster-item",style:{"border-bottom":"1px solid #e9ecf0"}},Ye={style:{"max-width":"300px",padding:"5px 10px"}},Qe={key:0,class:"poster-item"},je={style:{"max-width":"300px",padding:"5px 10px"}},Ze=ke({inheritAttrs:!1,__name:"Advertise",props:{item:{type:Object,default:()=>({})}},emits:["callBack"],setup(ne,{emit:Me}){const se=ne,z=g(!1),E=g(!1),L=g(!1),b=g(!1),T=g([]),R=g([]),c=g({}),le=g([{name:"H5/公众号",value:1},{name:"小程序",value:2}]),F=g(1),D=ee(()=>F.value===1?c.value.shortLink:c.value.wechatShortLink),H=ee(()=>c.value.originalLink),W=async(o,t="#000",s="#FFF")=>{const C=o;let p={margin:2,width:300,color:{dark:t,light:s}};return await(await Se(()=>import("./browser-D6eOinvE.js").then(y=>y.b),[])).default.toDataURL(C,p)},Y=async()=>{const o=c.value.promotionPicUrl,t=F.value===1?c.value.shortLink:c.value.miniCode,s=await ue(o,t);T.value[0]=s.small,R.value[0]=s.main},re=async()=>{b.value=!0;try{c.value=await Ee({grouponPromotionId:se.item.grouponPromotionId}),c.value.shortLink=qe({path:c.value.shortLink}),Y()}catch(o){N.error(o.message)}finally{b.value=!1}};Te(()=>{T.value.length&&(T.value.forEach(o=>{URL.revokeObjectURL(o)}),T.value=[]),R.value.length&&(R.value.forEach(o=>{URL.revokeObjectURL(o)}),R.value=[])});const ie=()=>{E.value=!0,L.value=!0},ce=()=>{L.value=!1},de=async o=>await(await fetch(o)).blob(),ue=async(o,t)=>{try{const s=new Image;s.crossOrigin="anonymous",await new Promise((U,S)=>{s.onload=U,s.onerror=S,s.src=o});const C=750,p=50,u=210,y=130,x=C-2*p,h=60,k=300,r=130,M=x/s.width,A=s.height*M,f=document.createElement("canvas"),e=f.getContext("2d");if(!e)throw new Error("无法获取canvas上下文");const X=h+A+k;f.width=C,f.height=u+X+y;const I=e.createLinearGradient(0,0,0,f.height);I.addColorStop(0,"#F2F2F6"),I.addColorStop(1,"#E6E6EE"),e.fillStyle=I,e.fillRect(0,0,f.width,f.height),e.fillStyle="#333",e.font="30px Arial",e.textAlign="center",e.fillText("拼团",f.width/2,u/2+20);const a=p,n=u,d=x,m=X,fe=20,ge=0,we=20;e.save(),e.shadowColor="rgba(0, 0, 0, 0.1)",e.shadowBlur=fe,e.shadowOffsetX=ge,e.shadowOffsetY=we;const i=30;e.beginPath(),e.moveTo(a+i,n),e.lineTo(a+d-i,n),e.quadraticCurveTo(a+d,n,a+d,n+i),e.lineTo(a+d,n+m-i),e.quadraticCurveTo(a+d,n+m,a+d-i,n+m),e.lineTo(a+i,n+m),e.quadraticCurveTo(a,n+m,a,n+m-i),e.lineTo(a,n+i),e.quadraticCurveTo(a,n,a+i,n),e.closePath(),e.fillStyle="#FFFFFF",e.fill(),e.restore(),e.save(),e.beginPath(),e.moveTo(a+i,n),e.lineTo(a+d-i,n),e.quadraticCurveTo(a+d,n,a+d,n+i),e.lineTo(a+d,n+m-i),e.quadraticCurveTo(a+d,n+m,a+d-i,n+m),e.lineTo(a+i,n+m),e.quadraticCurveTo(a,n+m,a,n+m-i),e.lineTo(a,n+i),e.quadraticCurveTo(a,n,a+i,n),e.closePath(),e.clip(),e.fillStyle="#FFFFFF",e.fillRect(a,n,d,h),e.drawImage(s,a,n+h,d,A),e.fillStyle="#FFFFFF",e.fillRect(a,n+h+A,d,k),e.restore();const O=n+h+A,Ce=t.startsWith("data:")?t:await W(t,"#333","#ffffff00"),q=new Image;await new Promise((U,S)=>{q.onload=U,q.onerror=S,q.src=Ce});const G=a+30,ye=O+k-r-10;e.fillStyle="#333",e.font="30px Arial",e.textAlign="left",e.fillText(c.value.promotionName,G,ye);const _e=O+k-30;e.fillStyle="#888",e.font="22px Arial",e.textAlign="left",e.fillText(c.value.promotionDateTime,G,_e);const J=a+d-r-20,K=O+k-r-50;return e.drawImage(q,J,K,r,r),e.fillStyle="#666",e.font="16px Arial",e.textAlign="right",e.fillText("长按识别查看",J+r-18,K+r+20),new Promise(U=>{let S=window.URL||window.webkitURL;f.toBlob(async Z=>{if(Z){const be=S.createObjectURL(Z),xe=await me(f);U({main:be,small:xe})}},"image/png")})}catch(s){return console.error("生产海报失败:",s),Promise.reject(s)}},me=o=>new Promise(t=>{const C=467/o.width,p=o.height*C,u=document.createElement("canvas");u.width=467,u.height=p;const y=u.getContext("2d");if(!y)throw new Error("无法获取canvas上下文");y.drawImage(o,0,0,o.width,o.height,0,0,467,p),u.toBlob(x=>{if(x){const h=URL.createObjectURL(x);t(h)}},"image/png")}),Q=async(o,t)=>{const s=document.createElement("a");s.href=o,s.download=t,document.body.appendChild(s),s.click(),s.remove()},ve=async()=>{try{b.value=!0;const o=R.value[0];Q(o,`${c.value.promotionName}海报.png`)}catch(o){console.error("下载失败:",o)}finally{b.value=!1}},pe=async()=>{try{if(b.value=!0,F.value===1){const o=await W(c.value.shortLink),t=await de(o);Ae(t,`${c.value.promotionName}H5/公众号二维码`,".png")}else Q(c.value.miniCode,`${c.value.promotionName}小程序二维码.png`)}catch(o){console.error("下载失败:",o)}finally{b.value=!1}},j=o=>{if(navigator.clipboard)navigator.clipboard.writeText(o).then(()=>{N.success("复制成功")}).catch(t=>{console.error("复制失败:",t)});else{const t=document.createElement("textarea");t.value=o,document.body.appendChild(t),t.select();try{document.execCommand("copy")&&N.success("复制成功")}catch(s){console.error("复制失败:",s)}document.body.removeChild(t)}},he=o=>{F.value=o,Y()};return Fe(E,o=>{o&&re()}),(o,t)=>{const s=_("el-col"),C=_("el-image"),p=_("el-button"),u=_("el-tooltip"),y=_("el-row"),x=_("a-spin"),h=_("el-image-viewer"),k=_("el-dialog");return P(),B(oe,null,[l("div",{class:"btn",onClick:ie},[Pe(o.$slots,"default")]),E.value?(P(),te(k,Ue({key:0,class:"sign-dialog","append-to-body":!0,"show-close":!1,modelValue:L.value,"onUpdate:modelValue":t[5]||(t[5]=r=>L.value=r),width:"900",top:"12vh"},o.$attrs,{onClose:ce,onClosed:t[6]||(t[6]=r=>E.value=!1)}),{header:v(()=>[l("div",Be,[l("div",$e,$(o.$attrs.title||"推广"),1),l("div",{class:"header-close",onClick:t[0]||(t[0]=r=>L.value=!1)},[...t[7]||(t[7]=[l("i",{class:"iconfont-admin icon-cha1"},null,-1)])])])]),default:v(()=>[w(x,{spinning:b.value,style:{width:"100%",height:"100%"}},{default:v(()=>[w(y,{class:"orfanize-content"},{default:v(()=>[w(s,{span:4},{default:v(()=>[l("div",ze,[(P(!0),B(oe,null,Le(le.value,r=>(P(),B("div",{class:Re(["tabs",{active:r.value===F.value}]),onClick:M=>he(r.value)},$(r.name),11,Ie))),256))])]),_:1}),w(s,{span:20},{default:v(()=>[l("div",Oe,[l("div",Ve,[w(C,{class:"poster-img",src:T.value[0],fit:"cover"},null,8,["src"]),l("div",{class:"poster-enlarge",onClick:t[1]||(t[1]=r=>z.value=!0)},[...t[8]||(t[8]=[l("svg",{width:"1em",height:"1em",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},[l("g",{fill:"none","fill-rule":"evenodd"},[l("path",{d:"M0 0h16v16H0z"}),l("path",{d:"M7.333 2a5.333 5.333 0 014.109 8.734l2.578 2.58-.707.706-2.579-2.578A5.333 5.333 0 117.333 2zm0 1a4.333 4.333 0 100 8.667 4.333 4.333 0 000-8.667zm.5 2v1.833h1.834v1H7.833v1.834h-1V7.833H5v-1h1.833V5h1z",fill:"currentColor"})])],-1)])])]),l("div",Ne,[t[13]||(t[13]=l("div",{class:"poster-title",style:{"margin-top":"0"}},"素材下载",-1)),l("div",De,[w(p,{bg:"",class:"buttonColor mr10",size:"large",text:"",type:"primary",onClick:ve},{default:v(()=>[...t[9]||(t[9]=[ae("下载海报",-1)])]),_:1}),w(p,{bg:"",class:"buttonColor mr10",size:"large",text:"",type:"primary",onClick:pe},{default:v(()=>[...t[10]||(t[10]=[ae("下载二维码",-1)])]),_:1})]),t[14]||(t[14]=l("div",{class:"poster-title"},"路径复制",-1)),l("div",He,[l("div",We,[t[11]||(t[11]=l("span",{class:"poster-item-text"},"适用于微信内会话/朋友圈等场景",-1)),w(u,{class:"box-item",effect:"light",placement:"bottom","show-after":300},{content:v(()=>[l("div",Ye,$(D.value),1)]),default:v(()=>[l("a",{class:"btn-link",onClick:t[2]||(t[2]=r=>j(D.value))},"复制短链接")]),_:1})]),F.value===1?(P(),B("div",Qe,[t[12]||(t[12]=l("span",{class:"poster-item-text"},"适用于微信内会话/朋友圈等场景",-1)),w(u,{class:"box-item",effect:"light",placement:"bottom","show-after":300},{content:v(()=>[l("div",je,$(H.value),1)]),default:v(()=>[l("a",{class:"btn-link",onClick:t[3]||(t[3]=r=>j(H.value))},"复制原链接")]),_:1})])):V("",!0)])])])]),_:1})]),_:1})]),_:1},8,["spinning"]),z.value?(P(),te(h,{key:0,"url-list":T.value,"initial-index":0,"show-progress":"",onClose:t[4]||(t[4]=r=>z.value=!1)},null,8,["url-list"])):V("",!0)]),_:1},16,["modelValue"])):V("",!0)],64)}}});export{Ze as _};

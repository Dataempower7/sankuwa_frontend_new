import{B as P}from"./BusinessData-C9u0MQN0.js";import{P as z}from"./PopSelect.vue_vue_type_style_index_0_scoped_5832cf6b_lang-Bx-dDInM.js";import{d as ge,r as g,c as xe,o as ye,S as he,e as x,f as v,g as u,z as s,j as L,k as y,l as o,F as T,m as S,L as w,h as l,i as N,eI as we,t as ae,al as se,s as Ne,_ as Ce}from"./index-BLXOA87U.js";import{d as Le}from"./vuedraggable.umd-OAFqtEpj.js";import"./index-DpgvsnVO.js";import{i as Te}from"./format-DdZABYp4.js";import{_ as oe}from"./PriceInput.vue_vue_type_script_setup_true_lang-Dp3Vzeak.js";import{_ as Se}from"./DialogForm.vue_vue_type_script_setup_true_lang-6GHo9HCV.js";import{M as de}from"./index-B16C4gX_.js";import"./currencyManagement-ZKRxsK3T.js";import"./version-hjn5tnxG.js";const Ue={class:"attr-form"},Pe={class:"attr-list other-attr"},$e={class:"attr-warp attr-normal-box"},Ae={class:"title-box flex align-center"},Be={class:"tit-value"},Ie=["onClick"],Ee={class:"attr-normal-value"},je={class:"attr-warp-title"},De={class:"attr-list"},Fe={class:"attr-warp"},ze=["onClick"],Oe={class:"attr-warp-title"},qe={class:"flex align-center"},He={style:{width:"300px"}},Re={class:"attr-warp-box"},Me={class:"draggable-item"},Ge={class:"attr-row"},Je={style:{width:"250px"}},Ke=["onClick"],Qe={key:1,class:"upload-img-wrap"},We={class:"pic-select-con"},Xe={key:0,class:"pic-select"},Ye={class:"pic-select-img"},Ze=["src"],et=["onClick"],tt={key:1,class:"extra mt10",style:{"text-align":"center"}},lt={class:"attr-warp-title"},at={class:"red"},st={class:"flex flex-align-center"},ot={class:"attr-list other-attr"},dt={class:"attr-warp-title mb10"},it=["onClick"],rt={class:"title flex"},ut={class:"value"},nt={class:"attr-extra-value"},mt={style:{width:"180px"}},ct=["onClick"],pt={class:"attr-warp-title"},vt={class:"lyecs-form-table"},ft={class:"flex flex-align-center flex-justify-center"},bt={style:{"padding-top":"20px"}},kt={class:"dialog-footer"},Vt=ge({__name:"Attr",props:{attrList:{type:Object,default:{normal:[],spe:[],extra:[]}},productList:{type:[Object,Array],default:[]},attrChanged:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},action:{type:String,default:"add"},attrTplList:{type:Array}},emits:["update:productList","update:attrList","update:attrChanged","update:skuErrorText"],setup(n,{expose:ie,emit:re}){const $=g(!1),I=n,K=g(),O=g(""),q=g(""),H=re,E={normal:0,spe:1,extra:2},j=g(null),k=g({}),p=g(I.attrList),f=g(I.productList),ue=(a,e)=>{const d=a.find(b=>b.attrName===e);return d?d.attrValue:""},R=xe(()=>{let a=0;for(let e in f.value)a+=Number(f.value[e].skuStock);return a});g(!1);const V=g({name:"",type:""});let Q=!1;ye(()=>{H("update:productList",f),H("update:attrList",p)});const ne=(a,e,d)=>{const b=a.field.split(".")[1];let r=Number(f.value[b].skuStock);if(f.value[b].skuStock=r,isNaN(r)){d(new Error("请输入数字"));return}else if(r==null||r==null||Number.isNaN(r)){d(new Error("请输入商品库存"));return}else if(I.action!="add"&&r<0){d(new Error("库存不能是负数"));return}else if(Number.isInteger(r))d();else{d(new Error("商品库存必须是整数"));return}},me=(a,e,d)=>{const b=a.field.split(".")[1];if(Number(f.value[b].skuPrice))d();else{d(new Error("请输入商品一口价"));return}},ce=async()=>{await K.value.validate()},M=a=>{f.value=F()},W=(a,e)=>{p.value[a][e].attrList.push({attrValue:"",attrType:E[a],attrName:p.value[a][e].attrName})},X=(a,e,d)=>{p.value[a][e].attrList.splice(d,1),f.value=F()},G=(a,e)=>{p.value[a].splice(e,1),f.value=F()},Y=(a,e)=>{$.value=!0,q.value=e,V.value.name="",V.value.type=a},pe=a=>{p.value[a].push({attrName:"",attrList:[{attrType:E[a],attrName:"",attrValue:""}]})},ve=(a,e)=>{p.value[e.type][e.index].attrList[e.idx].attrPic=a[0].picUrl,p.value[e.type][e.index].attrList[e.idx].attrPicThumb=a[0].picThumb},fe=(a,e,d)=>{p.value[a][e].attrList[d].attrPic="",p.value[a][e].attrList[d].attrPicThumb=""},be=()=>{de.confirm({title:"导入模板会清空并重置已设置的属性、规格、规格库存等设置，确认导入吗？",async onOk(){Ne({url:"product/productAttributesTpl/detail?id="+j.value,method:"get"}).then(a=>{let e=a.tplData;for(let d in e){p.value[d]=[];for(let b in e[d])p.value[d].push({attrName:e[d][b].attrName,attrList:[{attrValue:"",attrType:E[d],attrName:e[d][b].attrName}]})}})}})},D=()=>{let a=1;for(let e in f.value)k.value.skuStock&&(f.value[e].skuStock=k.value.skuStock),k.value.skuSn&&(f.value[e].skuSn=k.value.skuSn+"-"+a),k.value.skuTsn&&(f.value[e].skuTsn=k.value.skuTsn+"-"+a),k.value.skuPrice&&(f.value[e].skuPrice=k.value.skuPrice),a++},Z=g(),ke=a=>{a.validate(e=>{if(e){if(p.value[V.value.type].find(b=>b.attrName===V.value.name)){de.error({title:"属性名称“"+V.value.name+"”已存在"});return}p.value[V.value.type].push({attrName:V.value.name,attrList:[{attrType:E[V.value.type],attrName:V.value.name,attrValue:""}]}),$.value=!1,q.value=""}})},J=g([]),F=()=>{if(p.value.spe.length==0)return[];let a=ee(p.value.spe),e=[];for(let d in a){e[d]={attrNames:[],attrValues:[],attrs:[]};let b=[];for(let m in a[d])e[d].attrs[m]={attrName:a[d][m].attrName,attrValue:a[d][m].attrValue},b.push(a[d][m].attrName+":"+a[d][m].attrValue),e[d].attrNames.push(a[d][m].attrName),e[d].attrValues.push(a[d][m].attrValue),e[d].skuStock=e[d].skuStock;e[d].skuValue=b.join("|");const r=f.value.find(m=>e[d].skuValue==m.skuValue);r&&(e[d].skuStock=r.skuStock,e[d].skuSn=r.skuSn,e[d].skuTsn=r.skuTsn,e[d].skuPrice=r.skuPrice)}return f.value=e,e};he(()=>p.value,(a,e)=>{Q==!0&&H("update:attrChanged",!0),J.value=F(),Q=!0},{deep:!0,immediate:!0});function ee(a){const e=[];if(a.length===0)return O.value="",e.push([]),e;a.map(r=>{r.attrList.length>0&&r.attrList.map(m=>{m.attrName=r.attrName})});const d=a[0],b=a.slice(1);for(let r=0;r<d.attrList.length;r++){const m=[d.attrList[r]],_=ee(b);for(let U=0;U<_.length;U++)e.push([...m,..._[U]])}return e}return ie({skuErrorText:O,validateProductSku:ce}),(a,e)=>{const d=x("el-option"),b=x("el-select"),r=x("el-space"),m=x("el-button"),_=x("el-form-item"),U=x("el-icon"),te=x("el-tooltip"),A=x("el-table-column"),B=x("TigInput"),Ve=x("el-table"),le=x("el-form"),_e=x("el-dialog");return u(),v("div",Ue,[s(_,{label:"属性模板",prop:"type",class:"inner-item"},{default:o(()=>[s(r,null,{default:o(()=>[s(b,{modelValue:j.value,"onUpdate:modelValue":e[0]||(e[0]=t=>j.value=t),placeholder:"请选择",clearable:"",disabled:n.disabled,style:{width:"200px"}},{default:o(()=>[(u(!0),v(T,null,S(I.attrTplList,t=>(u(),L(d,{label:t.tplName,key:t.tplId,value:t.tplId},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),s(m,{disabled:!j.value,onClick:be,style:{"margin-left":"10px"}},{default:o(()=>e[14]||(e[14]=[w("确认导入",-1)])),_:1,__:[14]},8,["disabled"])]),_:1}),s(_,{prop:"brandLogo",label:"商品属性"},{default:o(()=>[l("div",Pe,[(u(!0),v(T,null,S(p.value.normal,(t,c)=>(u(),v("div",$e,[l("div",Ae,[e[16]||(e[16]=l("div",{class:"label"},"属性名：",-1)),l("div",Be,[s(P,{modelValue:t.attrName,"onUpdate:modelValue":i=>t.attrName=i,width:"300px",disabled:n.disabled,dataType:8},null,8,["modelValue","onUpdate:modelValue","disabled"]),n.disabled?y("",!0):(u(),v("div",{key:0,class:"btn-remove3",onClick:i=>G("normal",c)},e[15]||(e[15]=[l("i",{class:"iconfont icon-cha1"},null,-1)]),8,Ie))])]),l("div",Ee,[(u(!0),v(T,null,S(t.attrList,(i,C)=>(u(),L(r,{class:"attr-row"},{default:o(()=>[s(P,{modelValue:i.attrValue,"onUpdate:modelValue":h=>i.attrValue=h,width:"260px",disabled:n.disabled,dataType:8},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1024))),256))])]))),256)),l("div",je,[s(m,{disabled:n.disabled,onClick:e[1]||(e[1]=t=>Y("normal","添加商品属性"))},{default:o(()=>e[17]||(e[17]=[l("i",{class:"btn-ico"},"+",-1),w("添加商品属性",-1)])),_:1,__:[17]},8,["disabled"])])])]),_:1}),s(_,{label:"商品规格"},{default:o(()=>[l("div",De,[(u(!0),v(T,null,S(p.value.spe,(t,c)=>(u(),v("div",Fe,[n.disabled?y("",!0):(u(),v("div",{key:0,class:"btn-remove",onClick:i=>G("spe",c)},e[18]||(e[18]=[l("i",{class:"iconfont icon-cha1"},null,-1)]),8,ze)),l("div",Oe,[l("div",qe,[e[19]||(e[19]=l("div",{class:"label"},"规格名：",-1)),l("div",He,[s(P,{modelValue:t.attrName,"onUpdate:modelValue":i=>t.attrName=i,disabled:n.disabled,dataType:8,placeholder:"请输入规格项，如颜色、尺码、大小",onBlur:M},null,8,["modelValue","onUpdate:modelValue","disabled"])])])]),l("div",Re,[s(N(Le),{class:"attr-row-box","item-key":"deagIndex",list:t.attrList,"ghost-class":"sortable-ghost","chosen-class":"toolChosenClass",animation:"300",onStart:e[2]||(e[2]=()=>{}),onEnd:M,group:{name:"advanced",pull:!1,put:!0}},{item:o(({element:i,index:C})=>[l("div",Me,[l("div",Ge,[l("div",Je,[s(P,{modelValue:i.attrValue,"onUpdate:modelValue":h=>i.attrValue=h,disabled:n.disabled,dataType:8,placeholder:"请输入规格值，如：白色",onBlur:M,"suffix-icon":N(we)},null,8,["modelValue","onUpdate:modelValue","disabled","suffix-icon"])]),t.attrList.length>1&&!n.disabled?(u(),v("div",{key:0,class:"btn-remove2",onClick:h=>X("spe",c,C)},e[20]||(e[20]=[l("i",{class:"iconfont icon-cha1"},null,-1)]),8,Ke)):y("",!0),c<1?(u(),v("div",Qe,[e[21]||(e[21]=l("div",{class:"arrow"},null,-1)),l("div",We,[n.disabled?y("",!0):(u(),v("div",Xe,[s(N(Se),{type:"gallery",onOkCallback:ve,data:{type:"spe",index:c,idx:C}},{default:o(()=>[l("div",Ye,[i.attrPicThumb?(u(),v("img",{key:0,src:N(Te)(i.attrPicThumb)},null,8,Ze)):y("",!0)])]),_:2},1032,["data"]),i.attrPicThumb?(u(),v("i",{key:0,onClick:h=>fe("spe",c,C),class:"pic-select-del iconfont icon-cha"},null,8,et)):y("",!0)]))])])):y("",!0)]),C===t.attrList.length-1?(u(),L(m,{key:0,disabled:n.disabled,onClick:h=>W("spe",c),link:"",type:"primary",class:"ml10",style:{"margin-top":"8px"}},{default:o(()=>e[22]||(e[22]=[l("i",{class:"btn-ico"},"+",-1),w("增加规格值",-1)])),_:2,__:[22]},1032,["disabled","onClick"])):y("",!0)])]),_:2},1032,["list"])]),c<1?(u(),v("div",tt," 仅支持为第一组规格设置规格图片，买家选择不同规格会看到对应规格图片，建议尺寸：800 x 800像素 ")):y("",!0)]))),256)),l("div",lt,[s(m,{disabled:n.disabled,onClick:e[3]||(e[3]=t=>pe("spe"))},{default:o(()=>e[23]||(e[23]=[l("i",{class:"btn-ico"},"+",-1),w("添加商品规格",-1)])),_:1,__:[23]},8,["disabled"])])]),l("div",at,ae(O.value),1)]),_:1}),s(_,{label:""},{label:o(()=>[s(te,{class:"box-item",effect:"light",placement:"bottom","show-after":"300"},{content:o(()=>e[24]||(e[24]=[l("div",{style:{width:"300px",padding:"5px 10px"}}," 附加规格不仅是商品的详细描述，还能为用户提供额外的服务保障，如保修、 安装或技术支持等，这些服务可能涉及附加服务费。通过清晰地列出这些附加规格， 您可以帮助用户更好地理解商品的价值，并做出更明智的购买决策，从而提升用户体验和销售转化率。 ",-1)])),default:o(()=>[l("div",st,[e[25]||(e[25]=l("div",null,"附加规格",-1)),s(U,{style:{"margin-left":"5px"},size:"14",color:"#999"},{default:o(()=>[s(N(se))]),_:1})])]),_:1})]),default:o(()=>[l("div",ot,[(u(!0),v(T,null,S(p.value.extra,(t,c)=>(u(),v("div",dt,[l("div",{class:"btn-remove5",onClick:i=>G("extra",c)},e[26]||(e[26]=[l("i",{class:"iconfont icon-cha1"},null,-1)]),8,it),l("div",null,[l("div",rt,[e[27]||(e[27]=l("div",{class:"label"},"附加规格名：",-1)),l("div",ut,[s(P,{modelValue:t.attrName,"onUpdate:modelValue":i=>t.attrName=i,width:"260px",disabled:n.disabled,dataType:8},null,8,["modelValue","onUpdate:modelValue","disabled"])])]),l("div",nt,[(u(!0),v(T,null,S(t.attrList,(i,C)=>(u(),L(r,{class:"attr-row mb10",size:16},{default:o(()=>[l("div",mt,[s(P,{modelValue:i.attrValue,"onUpdate:modelValue":h=>i.attrValue=h,disabled:n.disabled,dataType:8},null,8,["modelValue","onUpdate:modelValue","disabled"])]),s(r,{size:0},{default:o(()=>[e[28]||(e[28]=w(" 附加金额： ",-1)),s(oe,{disabled:n.disabled,modelValue:i.attrPrice,"onUpdate:modelValue":h=>i.attrPrice=h,width:"150px"},null,8,["disabled","modelValue","onUpdate:modelValue"])]),_:2,__:[28]},1024),t.attrList.length>1&&!n.disabled?(u(),v("div",{key:0,class:"btn-remove4",onClick:h=>X("extra",c,C)},e[29]||(e[29]=[l("i",{class:"iconfont icon-cha1"},null,-1)]),8,ct)):y("",!0)]),_:2},1024))),256))])]),s(r,{class:"attr-row mt10",style:{"margin-left":"85px"}},{default:o(()=>[s(m,{disabled:n.disabled,onClick:i=>W("extra",c)},{default:o(()=>e[30]||(e[30]=[l("i",{class:"btn-ico"},"+",-1),w("增加新属性",-1)])),_:2,__:[30]},1032,["disabled","onClick"])]),_:2},1024)]))),256)),l("div",pt,[s(m,{disabled:n.disabled,onClick:e[4]||(e[4]=t=>Y("extra","添加商品附加规格"))},{default:o(()=>e[31]||(e[31]=[l("i",{class:"btn-ico"},"+",-1),w("添加商品附加规格",-1)])),_:1,__:[31]},8,["disabled"])])])]),_:1}),s(le,{ref_key:"productFormRef",ref:K,model:f.value,"label-width":"100px",name:"form_in_modal"},{default:o(()=>[J.value.length>0?(u(),L(_,{key:0,label:"规格明细",prop:"productList"},{default:o(()=>[l("div",vt,[s(Ve,{data:f.value,style:{width:"100%"}},{default:o(()=>[(u(!0),v(T,null,S(J.value[0].attrs,t=>(u(),L(A,{prop:"attrs",label:t.attrName,align:"center"},{default:o(({row:c,$index:i})=>[w(ae(ue(c.attrs,t.attrName)),1)]),_:2},1032,["label"]))),256)),s(A,{prop:"skuPrice",label:"一口价",width:"150",fixed:"right"},{header:o(()=>[s(te,{effect:"light",placement:"top"},{content:o(()=>e[32]||(e[32]=[l("div",{style:{width:"100px",padding:"5px 10px"}},"一口价会覆盖除属性价格外的所有价格，慎重设置",-1)])),default:o(()=>[s(N(z),{isDirect:!0,isHover:!1,max:100,type:"decimal","org-value":k.value.skuPrice,"onUpdate:orgValue":e[5]||(e[5]=t=>k.value.skuPrice=t),onCallback:D,label:"一口价"},{default:o(()=>[l("div",ft,[e[33]||(e[33]=l("em",{class:"red"},"*",-1)),e[34]||(e[34]=l("div",null,"一口价",-1)),s(U,{style:{"margin-left":"5px"},size:"14",color:"#999"},{default:o(()=>[s(N(se))]),_:1})])]),_:1},8,["org-value"])]),_:1})]),default:o(({row:t,$index:c})=>[s(_,{label:"",prop:`productList.${c}.skuPrice`,rules:[{required:!0,validator:me}]},{default:o(()=>[s(oe,{modelValue:t.skuPrice,"onUpdate:modelValue":i=>t.skuPrice=i,disabled:n.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop","rules"])]),_:1}),s(A,{prop:"skuStock",label:"库存",width:"150",fixed:"right"},{header:o(()=>[s(N(z),{isDirect:!0,isHover:!1,max:100,"org-value":k.value.skuStock,"onUpdate:orgValue":e[6]||(e[6]=t=>k.value.skuStock=t),onCallback:D,label:"库存"},{default:o(()=>e[35]||(e[35]=[l("div",{class:"flex flex-align-center flex-justify-center"},[l("em",{class:"red"},"*"),w(" 库存")],-1)])),_:1,__:[35]},8,["org-value"])]),default:o(({row:t,$index:c})=>[s(_,{label:"",prop:`productList.${c}.skuStock`,rules:[{required:!0,validator:ne}]},{default:o(()=>[s(B,{type:"integer",modelValue:t.skuStock,"onUpdate:modelValue":i=>t.skuStock=i,disabled:n.disabled,min:0},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop","rules"])]),_:1}),s(A,{prop:"skuSn",label:"商品编码",width:"150",fixed:"right"},{header:o(()=>[s(N(z),{isDirect:!0,isHover:!1,max:100,"org-value":k.value.skuSn,"onUpdate:orgValue":e[7]||(e[7]=t=>k.value.skuSn=t),onCallback:D,label:"商品编码"},{default:o(()=>e[36]||(e[36]=[l("div",{class:"flex flex-align-center flex-justify-center"},"商品编码",-1)])),_:1,__:[36]},8,["org-value"])]),default:o(({row:t,$index:c})=>[s(B,{modelValue:t.skuSn,"onUpdate:modelValue":i=>t.skuSn=i,disabled:n.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1}),s(A,{prop:"skuTsn",label:"商品条形码",width:"150",fixed:"right"},{header:o(()=>[s(N(z),{isDirect:!0,isHover:!1,max:100,"org-value":k.value.skuTsn,"onUpdate:orgValue":e[8]||(e[8]=t=>k.value.skuTsn=t),onCallback:D,label:"商品条形码"},{default:o(()=>e[37]||(e[37]=[l("div",{class:"flex flex-align-center flex-justify-center"},"商品条形码",-1)])),_:1,__:[37]},8,["org-value"])]),default:o(({row:t,$index:c})=>[s(B,{modelValue:t.skuTsn,"onUpdate:modelValue":i=>t.skuTsn=i,disabled:n.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1})]),_:1},8,["data"])])]),_:1})):y("",!0)]),_:1},8,["model"]),R.value?(u(),L(_,{key:0,label:"库存",prop:"totalStock"},{default:o(()=>[s(B,{classType:"tig-form-input",type:"integer",modelValue:R.value,"onUpdate:modelValue":e[9]||(e[9]=t=>R.value=t),placeholder:"请输入商品库存",disabled:f.value.length>0},null,8,["modelValue","disabled"])]),_:1})):y("",!0),s(_e,{modelValue:$.value,"onUpdate:modelValue":e[13]||(e[13]=t=>$.value=t),title:q.value,width:"450"},{footer:o(()=>[l("div",kt,[s(m,{onClick:e[11]||(e[11]=t=>$.value=!1)},{default:o(()=>e[39]||(e[39]=[w("关闭",-1)])),_:1,__:[39]}),s(m,{type:"primary",onClick:e[12]||(e[12]=t=>ke(Z.value))},{default:o(()=>e[40]||(e[40]=[w(" 确定 ",-1)])),_:1,__:[40]})])]),default:o(()=>[l("div",bt,[s(le,{ref_key:"formRef",ref:Z,"label-width":"auto",model:V.value},{default:o(()=>[s(_,{prop:"name",label:"属性名称"},{default:o(()=>[s(B,{width:"100%",modelValue:V.value.name,"onUpdate:modelValue":e[10]||(e[10]=t=>V.value.name=t)},null,8,["modelValue"]),e[38]||(e[38]=l("div",{class:"extra"},"提示：添加新的商品规格属性类型，会清空规格库存中的所有设置",-1))]),_:1,__:[38]})]),_:1},8,["model"])])]),_:1},8,["modelValue","title"])])}}}),Ut=Ce(Vt,[["__scopeId","data-v-2f62f17c"]]);export{Ut as default};

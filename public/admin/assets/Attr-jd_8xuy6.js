import{B as oe}from"./BusinessImg-B_fZOjqm.js";import{B as D}from"./BusinessData-Dbgv1FCM.js";import{P as S}from"./PopSelect.vue_vue_type_style_index_0_scoped_5832cf6b_lang-CRFq-JzZ.js";import{d as de,aq as F,r as N,ar as ne,o as pe,Y as M,f as V,g as y,h as v,k as C,l as b,z as u,m as i,i as r,F as H,p as q,j as g,f7 as ce,n as me,ae as fe,Q as L,t as O,_ as ve}from"./index-B52YIGC0.js";import{d as ke}from"./vuedraggable.umd-BauR0rTv.js";import"./index-KjhYqCTY.js";import{i as G}from"./format-BxqOrW-w.js";import{_ as ye}from"./PriceInput.vue_vue_type_script_setup_true_lang-DpJJvzpB.js";import{_ as be}from"./DialogForm.vue_vue_type_script_setup_true_lang-CT6mpwCc.js";import"./currencyManagement-DNysi_dA.js";/* empty css                                                                    */import"./index-C9ZdVeVx.js";const ge={class:"attr-form"},Ve={class:"attr-list"},he={class:"attr-warp"},Pe=["onClick"],xe={class:"attr-warp-title"},Te={class:"flex align-center"},_e={style:{width:"300px"}},Se={class:"attr-warp-box"},Le={class:"draggable-item"},Ne={class:"attr-row"},Ce={style:{width:"250px"}},Ue=["onClick"],we={key:1,class:"upload-img-wrap"},Ee={class:"pic-select-con"},$e={key:0,class:"pic-select"},Be={class:"pic-select-img"},We=["src"],Ae=["onClick"],Ie={key:1,class:"pic-select"},je={class:"pic-select-img"},De=["src"],Fe={key:1,class:"extra mt10",style:{"text-align":"center"}},Me={class:"attr-warp-title"},He={class:"red"},qe={class:"lyecs-form-table"},Oe={class:"flex flex-align-center flex-justify-center"},Ge={key:0,class:"red"},ze=de({__name:"Attr",props:F({attrList:{type:Array,default:[]},productList:{type:[Object,Array],default:[]},attrChanged:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},action:{type:String,default:"add"},skuType:{type:Number,default:1},productSnGenerateType:{type:Number,default:1}},{skuErrorText:{default:""},skuErrorTextModifiers:{}}),emits:F(["update:productList","update:attrList","update:attrChanged"],["update:skuErrorText"]),setup(m,{expose:z,emit:J}){const x=m,A=N(),E=ne(m,"skuErrorText"),$=J,p=N({}),k=N(x.attrList),d=N(x.productList),R=(l,e)=>{const t=l.find(n=>n.attrName===e);return t?t.attrValue:""};let I=!1;pe(()=>{$("update:productList",d),$("update:attrList",k)});const Q=(l,e,t)=>{const n=l.field.split(".")[1];let s=Number(d.value[n].skuStock);if(d.value[n].skuStock=s,isNaN(s)){t(new Error("请输入数字")),d.value[n].skuStock=0;return}else if(s==null||s==null||Number.isNaN(s)){t(new Error("请输入商品库存"));return}else if(x.action!="add"&&s<0){t(new Error("库存不能是负数"));return}else if(Number.isInteger(s))t();else{t(new Error("商品库存必须是整数"));return}},Y=(l,e,t)=>{const n=l.field.split(".")[1];if(Number(d.value[n].supplyPrice))t();else{t(new Error("请输入商品供货价")),d.value[n].supplyPrice=0;return}},K=(l,e,t)=>{const n=l.field.split(".")[1];if(Number(d.value[n].supplyPriceLimitVal))t();else{t(new Error("请输入商品限购金额")),d.value[n].supplyPriceLimitVal=0;return}},X=(l,e,t)=>{const n=l.field.split(".")[1];let s=Number(d.value[n].skuSn),c=JSON.parse(JSON.stringify(d.value));c.splice(n,1);let h=c==null?void 0:c.findIndex(P=>P.skuSn==s);if(x.productSnGenerateType==2)if(s)if(h!=-1){t(new Error("商品编码需要时唯一值"));return}else t();else{t(new Error("请输入商品编码"));return}else t()},Z=async()=>{await A.value.validate()},B=l=>{d.value=U()},ee=l=>{k.value[l].attrs.push({attrValue:"",attrType:1,attrName:k.value[l].attrName})},te=(l,e)=>{k.value[l].attrs.splice(e,1),d.value=U()},le=l=>{k.value.splice(l,1),d.value=U()},ae=()=>{k.value.push({attrName:"",attrs:[{attrType:1,attrName:"",attrValue:""}]})},se=(l,e)=>{k.value[e.index].attrs[e.idx].attrPic=l[0].picUrl,k.value[e.index].attrs[e.idx].attrPicThumb=l[0].picThumb},ie=(l,e)=>{k.value[l].attrs[e].attrPic="",k.value[l].attrs[e].attrPicThumb=""},T=()=>{let l=1;for(let e in d.value)p.value.skuStock&&(d.value[e].skuStock=p.value.skuStock),p.value.skuWeight&&(d.value[e].skuWeight=p.value.skuWeight),p.value.supplyPriceLimitType&&(d.value[e].supplyPriceLimitType=p.value.supplyPriceLimitType),p.value.skuSn&&(d.value[e].skuSn=p.value.skuSn+"-"+l),p.value.skuTsn&&(d.value[e].skuTsn=p.value.skuTsn+"-"+l),p.value.supplyPrice&&(d.value[e].supplyPrice=p.value.supplyPrice),p.value.supplyPriceLimitVal&&(d.value[e].supplyPriceLimitVal=p.value.supplyPriceLimitVal),l++},W=N([]),U=()=>{if(k.value.length==0)return[];let l=j(k.value),e=[];for(let t in l){e[t]={attrs:[]};let n=[];for(let c in l[t])e[t].attrs[c]={attrName:l[t][c].attrName,attrValue:l[t][c].attrValue},n.push(l[t][c].attrName+":"+l[t][c].attrValue),e[t].skuStock=e[t].skuStock||"",e[t].skuWeight=e[t].skuWeight||"",e[t].supplyPriceLimitVal=e[t].supplyPriceLimitVal||"",e[t].supplyPrice=e[t].supplyPrice||"",e[t].supplyPriceLimitType=e[t].supplyPriceLimitType||1;e[t].skuValue=n.join("|");const s=d.value.find(c=>e[t].skuValue==c.skuAttrVal||e[t].skuValue==(c==null?void 0:c.skuValue));s&&(e[t].skuStock=s.skuStock,e[t].skuWeight=s.skuWeight,e[t].supplyPriceLimitType=s.supplyPriceLimitType,e[t].skuSn=s.skuSn,e[t].skuTsn=s.skuTsn,e[t].supplyPrice=s.supplyPrice,e[t].supplyPriceLimitVal=s.supplyPriceLimitVal)}return d.value=e,e};M(()=>k.value,(l,e)=>{I==!0&&$("update:attrChanged",!0),W.value=U(),I=!0},{deep:!0,immediate:!0}),M(()=>x.skuType,(l,e)=>{l==1&&x.action=="add"&&(d.value=[{supplyPriceLimitType:1}]),l==1&&(k.value.length=0)},{deep:!0,immediate:!0});function j(l){const e=[];if(l.length===0)return E.value="",e.push([]),e;l.map(s=>{s.attrs.length>0&&s.attrs.map(c=>{c.attrName=s.attrName})});const t=l[0],n=l.slice(1);for(let s=0;s<t.attrs.length;s++){const c=[t.attrs[s]],h=j(n);for(let P=0;P<h.length;P++)e.push([...c,...h[P]])}return e}return z({skuErrorText:E,validateProductSku:Z}),(l,e)=>{const t=V("el-button"),n=V("el-form-item"),s=V("el-table-column"),c=V("TigInput"),h=V("el-option"),P=V("el-select"),ue=V("el-table"),re=V("el-form");return v(),y("div",ge,[m.skuType===2?(v(),C(n,{key:0,label:"商品规格"},{default:i(()=>[r("div",Ve,[(v(!0),y(H,null,q(k.value,(a,f)=>(v(),y("div",he,[m.disabled?b("",!0):(v(),y("div",{key:0,class:"btn-remove",onClick:o=>le(f)},[...e[8]||(e[8]=[r("i",{class:"iconfont icon-cha1"},null,-1)])],8,Pe)),r("div",xe,[r("div",Te,[e[9]||(e[9]=r("div",{class:"label"},"规格名：",-1)),r("div",_e,[u(D,{modelValue:a.attrName,"onUpdate:modelValue":o=>a.attrName=o,disabled:m.disabled,dataType:8,placeholder:"请输入规格项，如颜色、尺码、大小",onBlur:B},null,8,["modelValue","onUpdate:modelValue","disabled"])])])]),r("div",Se,[u(g(ke),{class:"attr-row-box","item-key":"deagIndex",list:a.attrs,"ghost-class":"sortable-ghost","chosen-class":"toolChosenClass",animation:"300",onStart:e[0]||(e[0]=()=>{}),onEnd:B,group:{name:"advanced",pull:!1,put:!0}},{item:i(({element:o,index:w})=>[r("div",Le,[r("div",Ne,[r("div",Ce,[u(D,{modelValue:o.attrValue,"onUpdate:modelValue":_=>o.attrValue=_,disabled:m.disabled,dataType:8,placeholder:"请输入规格值，如：白色",onBlur:B,"suffix-icon":g(ce)},null,8,["modelValue","onUpdate:modelValue","disabled","suffix-icon"])]),a.attrs.length>1&&!m.disabled?(v(),y("div",{key:0,class:"btn-remove2",onClick:_=>te(f,w)},[...e[10]||(e[10]=[r("i",{class:"iconfont icon-cha1"},null,-1)])],8,Ue)):b("",!0),f<1?(v(),y("div",we,[e[11]||(e[11]=r("div",{class:"arrow"},null,-1)),r("div",Ee,[m.disabled?(v(),y("div",Ie,[r("div",je,[o.attrPicThumb?(v(),y("img",{key:0,src:g(G)(o.attrPicThumb)},null,8,De)):b("",!0)])])):(v(),y("div",$e,[u(g(be),{type:"gallery",onOkCallback:se,data:{index:f,idx:w}},{default:i(()=>[r("div",Be,[o.attrPicThumb?(v(),C(oe,{key:0,modelValue:o.attrPic,"onUpdate:modelValue":_=>o.attrPic=_,picThumb:o.attrPicThumb,dataId:o.attrPicId,dataType:8},{default:i(()=>[r("img",{src:g(G)(o.attrPicThumb)},null,8,We)]),_:2},1032,["modelValue","onUpdate:modelValue","picThumb","dataId"])):b("",!0)])]),_:2},1032,["data"]),o.attrPicThumb?(v(),y("i",{key:0,onClick:_=>ie(f,w),class:me(["pic-select-del iconfont icon-cha",{left:g(fe)()}])},null,10,Ae)):b("",!0)]))])])):b("",!0)]),w===a.attrs.length-1?(v(),C(t,{key:0,disabled:m.disabled,onClick:_=>ee(f),link:"",type:"primary",class:"ml10",style:{"margin-top":"8px"}},{default:i(()=>[...e[12]||(e[12]=[r("i",{class:"btn-ico"},"+",-1),L("增加规格值",-1)])]),_:1},8,["disabled","onClick"])):b("",!0)])]),_:2},1032,["list"])]),f<1?(v(),y("div",Fe," 仅支持为第一组规格设置规格图片，买家选择不同规格会看到对应规格图片，建议尺寸：800 x 800像素 ")):b("",!0)]))),256)),r("div",Me,[u(t,{disabled:m.disabled,onClick:e[1]||(e[1]=a=>ae())},{default:i(()=>[...e[13]||(e[13]=[r("i",{class:"btn-ico"},"+",-1),L("添加商品规格",-1)])]),_:1},8,["disabled"])])]),r("div",He,O(E.value),1)]),_:1})):b("",!0),u(re,{ref_key:"productFormRef",ref:A,model:d.value,"label-width":"100px",name:"form_in_modal"},{default:i(()=>[m.skuType===2&&W.value.length>0||m.skuType===1&&d.value.length>0?(v(),C(n,{key:0,label:"规格明细",prop:"productList"},{default:i(()=>[r("div",qe,[u(ue,{data:d.value,style:{width:"100%"}},{default:i(()=>[m.skuType===2?(v(!0),y(H,{key:0},q(W.value[0].attrs,a=>(v(),C(s,{prop:"attrs",label:a.attrName,align:"center"},{default:i(({row:f,$index:o})=>[L(O(R(f.attrs,a.attrName)),1)]),_:2},1032,["label"]))),256)):b("",!0),u(s,{prop:"skuSn",label:"商品编码",width:"120",fixed:"right"},{header:i(()=>[u(g(S),{isDirect:!0,isHover:!1,max:100,"org-value":p.value.skuSn,"onUpdate:orgValue":e[2]||(e[2]=a=>p.value.skuSn=a),onCallback:T,label:"商品编码"},{default:i(()=>[r("div",Oe,[m.productSnGenerateType==2?(v(),y("em",Ge,"*")):b("",!0),e[14]||(e[14]=L("商品编码 ",-1))])]),_:1},8,["org-value"])]),default:i(({row:a,$index:f})=>[u(n,{label:"",prop:`productList.${f}.skuSn`,rules:[{required:m.productSnGenerateType==2,validator:X}]},{default:i(()=>[u(c,{modelValue:a.skuSn,"onUpdate:modelValue":o=>a.skuSn=o,disabled:m.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop","rules"])]),_:1}),u(s,{prop:"skuTsn",label:"商品条码",width:"120",fixed:"right"},{header:i(()=>[u(g(S),{isDirect:!0,isHover:!1,max:100,"org-value":p.value.skuTsn,"onUpdate:orgValue":e[3]||(e[3]=a=>p.value.skuTsn=a),onCallback:T,label:"商品条码"},{default:i(()=>[...e[15]||(e[15]=[r("div",{class:"flex flex-align-center flex-justify-center"},"商品条码",-1)])]),_:1},8,["org-value"])]),default:i(({row:a,$index:f})=>[u(c,{modelValue:a.skuTsn,"onUpdate:modelValue":o=>a.skuTsn=o,disabled:m.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1}),u(s,{prop:"supplyPrice",label:"供货价",width:"150",fixed:"right"},{header:i(()=>[u(g(S),{isDirect:!0,isHover:!1,max:100,type:"decimal","org-value":p.value.supplyPrice,"onUpdate:orgValue":e[4]||(e[4]=a=>p.value.supplyPrice=a),onCallback:T,label:"供货价"},{default:i(()=>[...e[16]||(e[16]=[r("div",{class:"flex flex-align-center flex-justify-center"},[r("em",{class:"red"},"*"),r("div",null,"供货价")],-1)])]),_:1},8,["org-value"])]),default:i(({row:a,$index:f})=>[u(n,{label:"",prop:`productList.${f}.supplyPrice`,rules:[{required:!0,validator:Y}]},{default:i(()=>[u(ye,{modelValue:a.supplyPrice,"onUpdate:modelValue":o=>a.supplyPrice=o,modelValueModifiers:{number:!0},disabled:m.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop","rules"])]),_:1}),u(s,{prop:"supplyPriceLimitVal",label:"限购金额",width:"170",fixed:"right"},{header:i(()=>[u(g(S),{isDirect:!0,isHover:!1,max:100,type:"decimal","org-value":p.value.supplyPriceLimitVal,"onUpdate:orgValue":e[5]||(e[5]=a=>p.value.supplyPriceLimitVal=a),onCallback:T,label:"限购金额"},{default:i(()=>[...e[17]||(e[17]=[r("div",{class:"flex flex-align-center flex-justify-center"},[r("em",{class:"red"},"*"),r("div",null,"限购金额")],-1)])]),_:1},8,["org-value"])]),default:i(({row:a,$index:f})=>[u(n,{label:"",prop:`productList.${f}.supplyPriceLimitVal`,rules:[{required:!0,validator:K}]},{default:i(()=>[u(c,{type:"decimal",modelValue:a.supplyPriceLimitVal,"onUpdate:modelValue":o=>a.supplyPriceLimitVal=o,modelModifiers:{modelValue:!0},disabled:m.disabled,min:0},{prepend:i(()=>[u(P,{modelValue:a.supplyPriceLimitType,"onUpdate:modelValue":o=>a.supplyPriceLimitType=o,placeholder:"请选择",style:{width:"88px"},disabled:m.disabled},{default:i(()=>[u(h,{label:"按金额",value:1}),u(h,{label:"按比例",value:2})]),_:1},8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop","rules"])]),_:1}),u(s,{prop:"skuWeight",label:"重量","min-width":"100",fixed:"right"},{header:i(()=>[u(g(S),{isDirect:!0,isHover:!1,max:100,"org-value":p.value.skuWeight,"onUpdate:orgValue":e[6]||(e[6]=a=>p.value.skuWeight=a),onCallback:T,label:"重量"},{default:i(()=>[...e[18]||(e[18]=[r("div",{class:"flex flex-align-center flex-justify-center"},"重量",-1)])]),_:1},8,["org-value"])]),default:i(({row:a,$index:f})=>[u(n,{label:"",prop:`productList.${f}.skuWeight`},{default:i(()=>[u(c,{type:"decimal",modelValue:a.skuWeight,"onUpdate:modelValue":o=>a.skuWeight=o,disabled:m.disabled,min:0},{append:i(()=>[...e[19]||(e[19]=[L(" g ",-1)])]),_:1},8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop"])]),_:1}),u(s,{prop:"skuStock",label:"库存","min-width":"100",fixed:"right"},{header:i(()=>[u(g(S),{isDirect:!0,isHover:!1,max:100,"org-value":p.value.skuStock,"onUpdate:orgValue":e[7]||(e[7]=a=>p.value.skuStock=a),onCallback:T,label:"库存"},{default:i(()=>[...e[20]||(e[20]=[r("div",{class:"flex flex-align-center flex-justify-center"},[r("em",{class:"red"},"*"),L(" 库存")],-1)])]),_:1},8,["org-value"])]),default:i(({row:a,$index:f})=>[u(n,{label:"",prop:`productList.${f}.skuStock`,rules:[{required:!0,validator:Q}]},{default:i(()=>[u(c,{type:"integer",modelValue:a.skuStock,"onUpdate:modelValue":o=>a.skuStock=o,modelModifiers:{number:!0},disabled:m.disabled,min:0},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop","rules"])]),_:1})]),_:1},8,["data"])])]),_:1})):b("",!0)]),_:1},8,["model"])])}}}),it=ve(ze,[["__scopeId","data-v-9a1290a0"]]);export{it as default};

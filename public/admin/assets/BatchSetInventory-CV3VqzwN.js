import{d as ee,r as m,b as le,ab as te,Y as C,o as ae,f as d,g as f,h as n,i as r,k as _,l as x,z as s,m as t,j as b,dK as oe,t as S,Q as v,L as q,O as R,F as N,p as O,P,H as B,_ as se}from"./index-B52YIGC0.js";import{s as ue}from"./inventoryCalendar-CGXkAm9Q.js";import{a as de}from"./product-hE35r0Q_.js";import"./index-KjhYqCTY.js";import{_ as ne}from"./Image.vue_vue_type_script_setup_true_lang-B8qXJKJq.js";import{_ as z}from"./DialogForm.vue_vue_type_script_setup_true_lang-CT6mpwCc.js";import"./index-C9ZdVeVx.js";import"./format-BxqOrW-w.js";const re={class:"container"},ie={class:"content_wrapper"},pe={class:"tip"},ce={key:0,style:{display:"flex","align-items":"center"}},me={style:{"margin-left":"15px"}},ve={key:0,style:{color:"#8a8099"}},ye={class:"stores-box"},fe={style:{display:"flex","align-items":"center"}},_e={key:2,class:"mt10"},ge=ee({__name:"BatchSetInventory",props:{},emits:["submitCallback","update:confirmLoading","close"],setup(ke,{expose:F,emit:E}){const h=E,w=m(!0);le().currentRoute.value.query;const Y=te(),l=m({productId:0,selectionType:1,quantity:0,dateRange:[],excludeType:1,excludeDay:[]}),u=m([]),p=m(!1),g=m([]),D=m({}),L=m([]),$=a=>{const e=new Date;return e.setHours(0,0,0,0),a.getTime()<e.getTime()},M=a=>{u.value=a,console.log(u.value)},j=a=>{u.value=u.value.filter(e=>e.shopId!==a.shopId)},H=a=>{L.value=a&&a.length?a:[],l.value.productId=a&&a.length?a[0]:0,A(),u.value=[]},A=async()=>{try{const a=await de({ids:l.value.productId});D.value=a.records[0]}catch(a){P.error(a.message)}finally{w.value=!1}},K=async()=>{await Y.value.validate();const a=u.value.map(i=>i.shopId).filter(i=>i!==void 0),e=p.value&&l.value.excludeType===1&&l.value.excludeDay?l.value.excludeDay:[],T=p.value&&l.value.excludeType===2&&l.value.excludeDay?l.value.excludeDay:[],k=[];l.value.selectionType===1&&u.value.length&&(l.value.selectionType=2);const c={selectionType:l.value.selectionType,shopIds:a},y={excludeWeekdays:e,excludeMonthDays:T,excludeSpecificDates:k},I={productId:l.value.productId,shopSelection:c,startDate:B(l.value.dateRange[0]).format("YYYY-MM-DD"),endDate:B(l.value.dateRange[1]).format("YYYY-MM-DD"),dateExclusion:y,quantity:Number(l.value.quantity)};try{h("update:confirmLoading",!0);const i=await ue(I);h("submitCallback",i),P.success("操作成功")}catch(i){P.error(i.message)}finally{h("update:confirmLoading",!1)}};F({onFormSubmit:()=>{K()}});const U=()=>{l.value.excludeType===1?g.value=[{key:1,label:"周一"},{key:2,label:"周二"},{key:3,label:"周三"},{key:4,label:"周四"},{key:5,label:"周五"},{key:6,label:"周六"},{key:7,label:"周日"}]:l.value.excludeType===2?g.value=Array.from({length:31},(a,e)=>({key:e+1,label:`${e+1}号`})):g.value=[]};return C(()=>l.value.excludeType,()=>{l.value.excludeDay=[],U()},{immediate:!0}),C(p,a=>{a?U():(l.value.excludeDay=[],g.value=[])}),C(()=>l.value.selectionType,()=>{u.value=[]}),ae(()=>{w.value=!1}),(a,e)=>{const T=d("el-icon"),k=d("el-button"),c=d("el-form-item"),y=d("el-radio"),I=d("el-radio-group"),i=d("el-tag"),Q=d("el-date-picker"),W=d("el-checkbox"),G=d("el-option"),J=d("el-select"),X=d("TigInput"),Z=d("el-form");return n(),f("div",re,[r("div",ie,[r("div",pe,[s(T,{color:"#006aff",size:"16px"},{default:t(()=>[s(b(oe))]),_:1}),e[6]||(e[6]=r("span",null,"批量设置库存即：同时对商品设置多个门店的库存",-1))]),w.value?x("",!0):(n(),_(Z,{key:0,ref_key:"formRef",ref:Y,model:l.value,"label-width":"auto"},{default:t(()=>[s(c,{rules:[{required:!0,message:"请选择商品规格"}],label:"商品",prop:"productId"},{default:t(()=>{var o,V;return[l.value.productId?(n(),f("div",ce,[s(b(ne),{src:(o=D.value)==null?void 0:o.picUrl,fit:"contain",width:"40",height:"40"},null,8,["src"]),r("span",me,S((V=D.value)==null?void 0:V.productName),1)])):x("",!0),s(b(z),{params:{isMultiple:!1,isSku:!1,reservationProduct:1,selectedIds:L.value},isDrawer:"",path:"product/product/src/SelectProduct",title:"选择商品",width:"600px",onOkCallback:H,maskClose:!1,showFooter:!0},{default:t(()=>[s(k,{type:"primary",link:""},{default:t(()=>[v(S(l.value.productId?"修改":"选择商品"),1)]),_:1})]),_:1},8,["params"])]}),_:1}),s(c,{label:"门店"},{default:t(()=>[l.value.productId?(n(),_(I,{key:1,modelValue:l.value.selectionType,"onUpdate:modelValue":e[0]||(e[0]=o=>l.value.selectionType=o),style:{width:"100%"}},{default:t(()=>[s(y,{value:1,size:"large"},{default:t(()=>[e[8]||(e[8]=r("span",null,"全部门店",-1)),s(b(z),{dialogClass:"noPadding",maskClose:!1,params:{isSelect:!0,selectedIds:u.value,distributionProductId:l.value.productId},isDrawer:"",path:"product/product/store/OrganizePop",title:"选择门店",width:"1100px",onOkCallback:M},{default:t(()=>[q(s(k,{type:"primary",link:""},{default:t(()=>[...e[7]||(e[7]=[v("排除门店",-1)])]),_:1},512),[[R,l.value.selectionType===1]])]),_:1},8,["params"])]),_:1}),s(y,{value:3,size:"large"},{default:t(()=>[e[10]||(e[10]=r("span",null,"指定门店",-1)),s(b(z),{dialogClass:"noPadding",maskClose:!1,params:{isSelect:!0,selectedIds:u.value,distributionProductId:l.value.productId},isDrawer:"",path:"product/product/store/OrganizePop",title:"选择门店",width:"1100px",onOkCallback:M},{default:t(()=>[q(s(k,{type:"primary",link:""},{default:t(()=>[...e[9]||(e[9]=[v("选择门店",-1)])]),_:1},512),[[R,l.value.selectionType===3]])]),_:1},8,["params"])]),_:1})]),_:1},8,["modelValue"])):(n(),f("span",ve,"请先选择商品")),q(r("div",ye,[(n(!0),f(N,null,O(u.value,o=>(n(),_(i,{closable:"",key:o.shopId,onClose:V=>j(o)},{default:t(()=>[v(S(o.shopTitle),1)]),_:2},1032,["onClose"]))),128))],512),[[R,u.value.length]])]),_:1}),s(c,{label:"日期范围",prop:"dateRange",rules:[{required:!0,message:"请选择时间范围"}]},{default:t(()=>[r("div",fe,[s(Q,{modelValue:l.value.dateRange,"onUpdate:modelValue":e[1]||(e[1]=o=>l.value.dateRange=o),type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"50%","margin-right":"10px"},"disabled-date":$},null,8,["modelValue"]),s(W,{modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=o=>p.value=o),"true-value":1,"false-value":0},{default:t(()=>[...e[11]||(e[11]=[v("排除时间",-1)])]),_:1},8,["modelValue"])]),p.value?(n(),_(c,{key:0,prop:"excludeType",rules:[{required:!0,message:"请选择排除类型"}],style:{width:"100%"}},{default:t(()=>[s(I,{modelValue:l.value.excludeType,"onUpdate:modelValue":e[3]||(e[3]=o=>l.value.excludeType=o)},{default:t(()=>[s(y,{value:1,size:"large"},{default:t(()=>[...e[12]||(e[12]=[v("每周排除",-1)])]),_:1}),s(y,{value:2,size:"large"},{default:t(()=>[...e[13]||(e[13]=[v("每月排除",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})):x("",!0),p.value?(n(),_(c,{key:1,prop:"excludeDay",rules:[{required:!0,message:"请选择排除时间"}]},{default:t(()=>[s(J,{modelValue:l.value.excludeDay,"onUpdate:modelValue":e[4]||(e[4]=o=>l.value.excludeDay=o),placeholder:"",style:{width:"240px"},multiple:""},{default:t(()=>[(n(!0),f(N,null,O(g.value,o=>(n(),_(G,{key:o.key,label:o.label,value:o.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):x("",!0),p.value?(n(),f("div",_e,[...e[14]||(e[14]=[r("p",{style:{color:"#8a8099"}},"仅修改商品在改日期范围内的可预约数量",-1)])])):x("",!0)]),_:1}),s(c,{label:"可预约数量",rules:[{required:!0,message:"请输入变更库存数量"}],prop:"quantity"},{default:t(()=>[e[15]||(e[15]=r("span",{style:{"margin-right":"10px"}},"所选商品在每个可预约时间段上同时增加/减少",-1)),s(X,{type:"integer",width:"60px",allowNegative:"",size:"medium",modelValue:l.value.quantity,"onUpdate:modelValue":e[5]||(e[5]=o=>l.value.quantity=o),placeholder:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]))])])}}}),Se=se(ge,[["__scopeId","data-v-8c3ff3ed"]]);export{Se as default};

import{l as K}from"./lodash-DLXBIuYo.js";import{d as P,r as T,ab as X,Y as Z,as as ee,f as k,g as c,h as p,z as r,m as o,i as d,Q as v,l as x,k as D,F as U,p as N,t as M,_ as te}from"./index-B52YIGC0.js";const le={key:0,style:{margin:"10px 0px 0px 20px"},class:"time-cycle"},ae={class:"flex align-center"},se={key:0},oe={style:{margin:"10px 0px 0px 20px"},class:"time-cycle"},ne={class:"week flex align-center mb10"},re={key:0},ue={class:"flex align-center"},ie={class:"week-list"},de={class:"flex mt10"},me={class:"errorMsg"},pe=P({__name:"BusinessHours",props:{formData:{type:Object,default:{}}},setup(I,{expose:A}){const w=T(!1),B=[{label:"周一",value:1},{label:"周二",value:2},{label:"周三",value:3},{label:"周四",value:4},{label:"周五",value:5},{label:"周六",value:6},{label:"周日",value:7}],t=T({type:1,times:[{start:"",end:""}],timesWeek:[{dayOfWeek:[1],ranges:[{start:"",end:""}]}]}),R=I,$=X();Z(()=>R.formData,l=>{const e=K.cloneDeep(l);e.type===3?(e.times.map(a=>{typeof a.dayOfWeek=="string"&&(a.dayOfWeek=a.dayOfWeek.split(",").map(Number))}),t.value.type=e.type,t.value.timesWeek=e.times):e.type&&(t.value.type=e.type,t.value.times=e.times)},{deep:!0,immediate:!0});const E=l=>{},W=T([1]),j=l=>{if(t.value.timesWeek&&t.value.timesWeek.length>0)return t.value.timesWeek.some(e=>e.dayOfWeek&&Array.isArray(e.dayOfWeek)?e.dayOfWeek.includes(l):!1)},q=()=>{if(W.value.length===0){C.value="请选择至少一个星期";return}const l=[...W.value],e=t.value.timesWeek.flatMap(u=>u.dayOfWeek),a=l.filter(u=>!e.includes(u));t.value.timesWeek.push({dayOfWeek:a,ranges:[{start:"",end:""}]}),w.value=!1},F=()=>{t.value.times.push({start:"",end:""})},L=l=>{t.value.times.splice(l,1)},z=l=>{const e=t.value.timesWeek[l].dayOfWeek;t.value.timesWeek.splice(l,1),W.value=W.value.filter(a=>!e.includes(a))},Q=l=>{t.value.timesWeek[l].ranges.push({start:"",end:""})},S=(l,e)=>{t.value.timesWeek[l].ranges.splice(e,1)},Y=(l,e,a,u)=>{let i=t.value.times[u];if(!i.start||!i.end){a(new Error("请选择时间"));return}const[n,f]=i.start.split(":").map(Number),[b,V]=i.end.split(":").map(Number),_=new Date;_.setHours(n,f,0,0);const g=new Date;if(g.setHours(b,V,0,0),g<=_){a(new Error("结束时间必须大于开始时间"));return}a()},G=(l,e,a,u)=>{if(t.value.type===3&&t.value.timesWeek.length===0){a(new Error("请至少选择一个周"));return}if(t.value.type===3&&t.value.timesWeek[u].ranges.length===0){a(new Error("请至少添加一个时间"));return}a()},J=(l,e,a,u,i)=>{let n=t.value.timesWeek[u].ranges[i];if(!n.start||!n.end){a(new Error("请选择时间"));return}const[f,b]=n.start.split(":").map(Number),[V,_]=n.end.split(":").map(Number),g=new Date;g.setHours(f,b,0,0);const s=new Date;if(s.setHours(V,_,0,0),s<=g){a(new Error("结束时间必须大于开始时间"));return}a()},H=ee({times:[{validator:(l,e,a)=>{const u=/times(\d+)/,n=(l==null?void 0:l.field.match(u))[1];Y(l,e,a,n)},trigger:"blur"}],timesWeek:[{validator:(l,e,a)=>{const u=/timesWeek(\d+)/,n=(l==null?void 0:l.field.match(u))[1];G(l,e,a,n)},trigger:"blur"}],timesWeekChild:[{validator:(l,e,a)=>{const u=/defaultData\.timesWeek\.(\d+)\.ranges\.(\d+)/,i=l==null?void 0:l.field.match(u),n=i[1],f=i[2];J(l,e,a,n,f)},trigger:"blur"}]}),C=T("");return A({submit:async()=>(await $.value.validate(),C.value="",t.value.type===3&&t.value.timesWeek.length===0?(C.value="请至少选择一个周",!1):!0),formData:t}),(l,e)=>{const a=k("el-radio"),u=k("el-radio-group"),i=k("el-time-picker"),n=k("el-button"),f=k("el-form-item"),b=k("el-checkbox"),V=k("el-checkbox-group"),_=k("el-popover"),g=k("el-form");return p(),c("div",null,[r(g,{ref_key:"formDataRef",ref:$,model:t.value,rules:H,"label-width":"auto"},{default:o(()=>[r(f,{label:"营业时间",prop:"type",required:""},{default:o(()=>[d("div",null,[d("div",null,[r(u,{modelValue:t.value.type,"onUpdate:modelValue":e[0]||(e[0]=s=>t.value.type=s),onChange:E},{default:o(()=>[r(a,{value:1},{default:o(()=>[...e[6]||(e[6]=[v("全天",-1)])]),_:1})]),_:1},8,["modelValue"])]),d("div",null,[d("div",null,[r(u,{modelValue:t.value.type,"onUpdate:modelValue":e[1]||(e[1]=s=>t.value.type=s),onChange:E},{default:o(()=>[r(a,{value:2},{default:o(()=>[...e[7]||(e[7]=[v("每天重复",-1)])]),_:1})]),_:1},8,["modelValue"]),t.value.type===2?(p(),c("div",le,[(p(!0),c(U,null,N(t.value.times,(s,y)=>(p(),D(f,{prop:"defaultData.times"+y,rules:H.times,style:{"margin-bottom":"10px"}},{default:o(()=>[d("div",ae,[r(i,{format:"HH:mm","value-format":"HH:mm",style:{width:"110px"},modelValue:s.start,"onUpdate:modelValue":m=>s.start=m,placeholder:"开始时间"},null,8,["modelValue","onUpdate:modelValue"]),e[9]||(e[9]=d("div",{style:{margin:"0 10px"}},"至",-1)),r(i,{format:"HH:mm","value-format":"HH:mm",style:{width:"110px"},modelValue:s.end,"onUpdate:modelValue":m=>s.end=m,placeholder:"结束时间"},null,8,["modelValue","onUpdate:modelValue"]),r(n,{class:"ml10",type:"primary",link:"",onClick:m=>L(y)},{default:o(()=>[...e[8]||(e[8]=[v("删除",-1)])]),_:1},8,["onClick"])])]),_:2},1032,["prop","rules"]))),256)),t.value.times.length<3?(p(),D(n,{key:0,type:"primary",link:"",onClick:F},{default:o(()=>[...e[10]||(e[10]=[v("添加时间",-1)])]),_:1})):x("",!0)])):x("",!0)]),d("div",null,[r(u,{modelValue:t.value.type,"onUpdate:modelValue":e[2]||(e[2]=s=>t.value.type=s),onChange:E},{default:o(()=>[r(a,{value:3},{default:o(()=>[...e[11]||(e[11]=[v("每周重复",-1)])]),_:1})]),_:1},8,["modelValue"]),t.value.type===3?(p(),c("div",se,[d("div",oe,[(p(!0),c(U,null,N(t.value.timesWeek,(s,y)=>(p(),D(f,{prop:"defaultData.timesWeek"+y,rules:H.timesWeek,style:{"margin-bottom":"10px"}},{default:o(()=>[d("div",ne,[s.dayOfWeek&&Array.isArray(s.dayOfWeek)?(p(),c("p",re,M(s.dayOfWeek.map(m=>B.find(h=>h.value===m).label).join("、")),1)):x("",!0),r(n,{class:"ml10",type:"primary",link:"",onClick:m=>z(y)},{default:o(()=>[...e[12]||(e[12]=[v("删除",-1)])]),_:1},8,["onClick"])]),(p(!0),c(U,null,N(s.ranges,(m,h)=>(p(),D(f,{prop:"defaultData.timesWeek."+y+".ranges."+h,rules:H.timesWeekChild,style:{"margin-bottom":"10px"}},{default:o(()=>[d("div",ue,[r(i,{format:"HH:mm","value-format":"HH:mm",style:{width:"110px"},modelValue:m.start,"onUpdate:modelValue":O=>m.start=O,placeholder:"开始时间"},null,8,["modelValue","onUpdate:modelValue"]),e[14]||(e[14]=d("div",{style:{margin:"0 10px"}},"至",-1)),r(i,{format:"HH:mm","value-format":"HH:mm",style:{width:"110px"},modelValue:m.end,"onUpdate:modelValue":O=>m.end=O,placeholder:"结束时间"},null,8,["modelValue","onUpdate:modelValue"]),r(n,{class:"ml10",type:"primary",link:"",onClick:O=>S(y,h)},{default:o(()=>[...e[13]||(e[13]=[v("删除",-1)])]),_:1},8,["onClick"])])]),_:2},1032,["prop","rules"]))),256)),t.value.timesWeek[y].ranges.length<3?(p(),D(n,{key:0,type:"primary",link:"",onClick:m=>Q(y)},{default:o(()=>[...e[15]||(e[15]=[v("添加时间",-1)])]),_:1},8,["onClick"])):x("",!0)]),_:2},1032,["prop","rules"]))),256))]),r(_,{visible:w.value,placement:"right-end",width:150},{reference:o(()=>[r(n,{type:"primary",link:"",onClick:e[5]||(e[5]=s=>w.value=!0)},{default:o(()=>[...e[18]||(e[18]=[v("添加星期",-1)])]),_:1})]),default:o(()=>[d("div",ie,[r(V,{modelValue:W.value,"onUpdate:modelValue":e[3]||(e[3]=s=>W.value=s)},{default:o(()=>[(p(),c(U,null,N(B,s=>r(b,{key:s.label,label:s.label,value:s.value,disabled:j(s.value)},{default:o(()=>[v(M(s.label),1)]),_:2},1032,["label","value","disabled"])),64))]),_:1},8,["modelValue"]),d("div",de,[r(n,{type:"primary",onClick:q},{default:o(()=>[...e[16]||(e[16]=[v("确定",-1)])]),_:1}),r(n,{onClick:e[4]||(e[4]=s=>w.value=!1)},{default:o(()=>[...e[17]||(e[17]=[v("取消",-1)])]),_:1})])])]),_:1},8,["visible"]),d("div",me,M(C.value),1)])):x("",!0)])])])]),_:1})]),_:1},8,["model","rules"])])}}}),ke=te(pe,[["__scopeId","data-v-5b48b3c7"]]);export{ke as default};

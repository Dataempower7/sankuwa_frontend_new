import"./index-KjhYqCTY.js";import{i as W,p as X}from"./format-BxqOrW-w.js";import{a as Y}from"./product-hE35r0Q_.js";import{d as Z,aq as ee,r as _,ar as D,o as le,x as te,as as oe,P as L,f as y,g as c,h as a,i as u,z as i,l as r,m as n,k as S,j as T,Q as f,t as g,$ as se,F as $,p as ae,_ as ue}from"./index-B52YIGC0.js";import de from"./SelectSku-ZXdrD9qH.js";import{_ as ce}from"./DialogForm.vue_vue_type_script_setup_true_lang-CT6mpwCc.js";import"./index-C9ZdVeVx.js";/* empty css                                                                  */const ie={class:"lyecs-product-select-group"},ne={key:0,class:"ml10"},re={key:0,class:"lyecs-product-selected-con"},pe={class:"product-selected-list"},ve={class:"col col1"},fe={class:"col col4 product-info"},me=["src"],ke={class:"product-name"},_e={key:0,class:"product-sku"},ye={class:"col col1"},be={key:0,class:"col col1"},he={key:1,class:"col col2"},ge={class:"flex"},Ie={key:0,style:{"margin-right":"5px"}},xe={key:3,style:{"margin-left":"5px"}},Ve={key:4,style:{"margin-left":"5px"}},Se={class:"col col3"},Ce=["onClick"],Me={class:"dialog-footer"},Te=Z({__name:"DiscountForm",props:ee({max:{type:Number,default:-1},isMultiple:{type:Boolean,default:!0},isSku:{type:Boolean,default:!1}},{ids:{type:Array,default:[]},idsModifiers:{},skuIds:{type:Array,default:[]},skuIdsModifiers:{}}),emits:["update:ids","update:skuIds"],setup(m,{expose:O}){const I=m,k=_(!1),d=D(m,"ids"),p=D(m,"skuIds"),o=_([]);le(async()=>{d.value&&d.value.length>0?await w(d.value):d.value=[],p.value&&p.value.length>0?(o.value=p.value,p.value.forEach(t=>{d.value.push(t.productId)}),x.value=!1):o.value=[]});const j=_(0),b=_({});te();const x=_(!0),A=oe({page:1,sortField:"",sortOrder:"",keyword:""}),w=async t=>{x.value=!0;try{const e=await Y({ids:t.join(","),...A,size:t.length});e.records.forEach(s=>{o.value.forEach(V=>{V.productId===s.productId&&(V.product=s)})}),console.log(o.value),p.value=o.value,j.value=e.total}catch(e){L.error(e.message)}finally{x.value=!1}},R=t=>{let e=d.value;if(I.isMultiple==!1&&(e=[]),I.isSku)for(let s in t)e.push(t[s].productId),t[s].discountType=1,t[s].value="",o.value.push(t[s]);console.log(o.value),d.value=e,w(e)},q=()=>{o.value=[],d.value=[]},Q=t=>{let e=o.value[t].productId;d.value=d.value.filter(s=>s!==e),o.value=o.value.filter(s=>s.productId!==e),p.value=p.value.filter(s=>s!==e)},G=t=>{t.product.skuIds=t.skuIds,b.value=t.product,k.value=!0},N=()=>{b.value="",k.value=!1},C=_(),H=()=>{C.value.skuIds.length>0?(o.value.forEach(t=>{t.productId==b.value.productId&&(t.skuIds=C.value.skuIds)}),b.value="",k.value=!1):L.error("请选择规格")};return O({ids:d,skuList:o}),(t,e)=>{const s=y("el-button"),V=y("el-space"),M=y("el-option"),J=y("el-select"),F=y("TigInput"),K=y("el-dialog");return a(),c($,null,[u("div",ie,[i(V,null,{default:n(()=>{var l;return[i(T(ce),{params:{selectedIds:d.value,isMultiple:I.isMultiple,isSku:I.isSku,isSelf:1},isDrawer:"",path:"product/product/src/SelectProduct",title:"选择商品",width:"600px",onOkCallback:R},{default:n(()=>{var h;return[i(s,{disabled:m.max>0&&((h=o.value)==null?void 0:h.length)>=m.max,type:"primary"},{default:n(()=>[...e[1]||(e[1]=[f("选择商品",-1)])]),_:1},8,["disabled"])]}),_:1},8,["params"]),o.value.length>0?(a(),c("span",ne,[e[2]||(e[2]=f("已选择 ",-1)),u("b",null,g((l=o.value)==null?void 0:l.length),1),e[3]||(e[3]=f(" 个商品",-1))])):r("",!0),o.value.length>0?(a(),S(s,{key:1,onClick:q},{default:n(()=>[...e[4]||(e[4]=[f("清空",-1)])]),_:1})):r("",!0)]}),_:1}),o.value.length>0&&!x.value?(a(),c("div",re,[u("div",pe,[e[5]||(e[5]=se('<div class="product-selected-list-tr product-selected-list-th" data-v-6b362cbb><div class="col col1" data-v-6b362cbb>商品编号</div><div class="col col4" data-v-6b362cbb>商品信息</div><div class="col col1" data-v-6b362cbb>原价</div><div class="col col1" data-v-6b362cbb>优惠方式</div><div class="col col2" data-v-6b362cbb>优惠内容</div><div class="col col3" data-v-6b362cbb>操作</div></div>',1)),(a(!0),c($,null,ae(o.value,(l,h)=>{var U,z,B,P,E;return a(),c("div",{key:h,class:"product-selected-list-tr"},[u("div",ve,g((U=l.product)==null?void 0:U.productSn),1),u("div",fe,[u("div",null,[u("img",{src:T(W)((z=l.product)==null?void 0:z.picThumb),height:"50",width:"50"},null,8,me)]),u("div",null,[u("div",ke,g((B=l.product)==null?void 0:B.productName),1),l.product&&l.product.productSku&&l.product.productSku!==null&&l.product.productSku.length>0&&l.skuIds?(a(),c("div",_e,[i(s,{type:"primary",link:"",size:"mini",onClick:v=>G(l)},{default:n(()=>[f("+ 已选"+g(l.skuIds.length||0)+"个规格",1)]),_:2},1032,["onClick"])])):r("",!0)])]),u("div",ye,[u("div",null,g(T(X)((P=l.product)==null?void 0:P.productPrice)),1)]),l.discountType?(a(),c("div",be,[i(J,{modelValue:l.discountType,"onUpdate:modelValue":v=>l.discountType=v,size:"mini"},{default:n(()=>[i(M,{label:"打折",value:1}),i(M,{label:"减钱",value:2}),i(M,{label:"促销",value:3})]),_:1},8,["modelValue","onUpdate:modelValue"])])):r("",!0),l.discountType?(a(),c("div",he,[u("div",ge,[l.discountType==2?(a(),c("div",Ie,"减")):r("",!0),l.discountType==1?(a(),S(F,{key:1,type:"decimal",min:.1,max:9.9,modelValue:l.value,"onUpdate:modelValue":v=>l.value=v,size:"mini",width:"70px"},null,8,["modelValue","onUpdate:modelValue"])):(a(),S(F,{key:2,type:"decimal",min:1,max:Number((E=l.product)==null?void 0:E.productPrice),modelValue:l.value,"onUpdate:modelValue":v=>l.value=v,size:"mini",width:"70px"},null,8,["max","modelValue","onUpdate:modelValue"])),l.discountType>1?(a(),c("div",xe,"元")):(a(),c("div",Ve,"折"))])])):r("",!0),u("div",Se,[u("a",{class:"del-btn",onClick:v=>Q(h)},"删除",8,Ce)])])}),128))])])):r("",!0)]),i(K,{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=l=>k.value=l),title:"选择规格",width:"500","before-close":N,"close-on-click-modal":!1},{footer:n(()=>[u("div",Me,[i(s,{onClick:N},{default:n(()=>[...e[6]||(e[6]=[f("取消",-1)])]),_:1}),i(s,{type:"primary",onClick:H},{default:n(()=>[...e[7]||(e[7]=[f("保存",-1)])]),_:1})])]),default:n(()=>[k.value?(a(),S(de,{key:0,ref_key:"skuRef",ref:C,productInfo:b.value,isMultiple:m.isMultiple},null,8,["productInfo","isMultiple"])):r("",!0)]),_:1},8,["modelValue"])],64)}}}),De=ue(Te,[["__scopeId","data-v-6b362cbb"]]);export{De as default};

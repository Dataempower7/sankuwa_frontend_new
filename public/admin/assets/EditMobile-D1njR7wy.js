import{d as q,ab as L,r as a,c as R,f as v,g as _,h as b,i as h,z as s,m as u,l as w,q as A,t as C,eB as D,P as c,eC as F,_ as O}from"./index-B52YIGC0.js";import{_ as P}from"./Verify.vue_vue_type_script_setup_true_lang-PjsVF6v4.js";import"./Verify.vue_vue_type_style_index_0_lang-BAuPCCIW.js";import"./index-C9ZdVeVx.js";const U={class:"container"},$={class:"content_wrapper"},j={class:"lyecs-form-table"},G={key:1,class:"code-text"},H=q({__name:"EditMobile",props:{id:{type:Number,default:0},form:{type:Object,default:{}},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close"],setup(J,{expose:x,emit:T}){const d=T,m=L(),o=a({mobile:"",code:""}),V=a("获取验证码"),r=a(!0),n=a(60),y=a(),i=a(null),S=e=>{i.value=e.verifyToken,g()},g=async()=>{if(await m.value.validateField("mobile"),!i.value){y.value.show();return}try{const e=await D({type:"code",...o.value,verifyToken:i.value});c.success("验证码发送成功"),r.value=!1,i.value=null,E()}catch(e){c.error(e.message)}},B=async()=>{await m.value.validate();try{d("update:confirmLoading",!0);const e=await F({modifyType:3,...o.value});d("submitCallback",e),c.success("修改成功")}catch(e){c.error(e.message)}finally{d("update:confirmLoading",!1)}},I=()=>{B()},M=(e,t,l)=>{if(!t){l(new Error("手机号不能为空"));return}/^(?:\+?86)?1[3-9]\d{9}$/.test(t)?l():l("手机号格式错误")},z=R(()=>n.value+"秒后重发"),k=a(),E=()=>{k.value=setInterval(()=>{n.value--,n.value<=0&&(clearInterval(k.value),r.value=!0,n.value=60)},1e3)};return x({onFormSubmit:I}),(e,t)=>{const l=v("TigInput"),p=v("el-form-item"),N=v("el-form");return b(),_("div",U,[h("div",$,[h("div",j,[s(N,{ref_key:"formRef",ref:m,model:o.value,"label-width":"auto"},{default:u(()=>[s(p,{label:"新手机号：",prop:"mobile",rules:[{required:!0,validator:M,trigger:"blur"}]},{default:u(()=>[s(l,{classType:"tig-form-input",modelValue:o.value.mobile,"onUpdate:modelValue":t[0]||(t[0]=f=>o.value.mobile=f),placeholder:"请输入新手机号"},null,8,["modelValue"])]),_:1},8,["rules"]),s(p,{label:"获取验证码：",prop:"code",rules:[{required:!0,message:"验证码不能为空!",trigger:"blur"}]},{default:u(()=>[s(l,{classType:"tig-form-input",modelValue:o.value.code,"onUpdate:modelValue":t[1]||(t[1]=f=>o.value.code=f)},{append:u(()=>[r.value?(b(),_("div",{key:0,class:"code-btn",onClick:A(g,["stop"])},C(V.value),1)):w("",!0),r.value?w("",!0):(b(),_("div",G,C(z.value),1))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"]),s(P,{ref_key:"verify",ref:y,mode:"pop",captchaType:"blockPuzzle",imgSize:{width:"310px",height:"155px"},onOkCallback:S},null,512)])])])}}}),Y=O(H,[["__scopeId","data-v-5ea72b33"]]);export{Y as default};

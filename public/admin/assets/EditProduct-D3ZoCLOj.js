import{d as $,r as m,b as j,ab as F,o as M,P as y,c as z,f as n,g as Q,h as C,i as r,k as G,l as H,z as e,m as l,L as J,j as f,Q as _,t as x,O as K,_ as W}from"./index-B52YIGC0.js";import{p as I}from"./format-BxqOrW-w.js";/* empty css                                                                    */import{P as X}from"./ProductCard-8OYszTHR.js";import"./index-KjhYqCTY.js";import{d as Y,l as Z,n as tt}from"./order-BVunCi_y.js";import{_ as et}from"./DialogForm.vue_vue_type_script_setup_true_lang-CT6mpwCc.js";import"./index-C9ZdVeVx.js";const ot={class:"container"},at={class:"content_wrapper"},lt={class:"lyecs-form-table"},st=["onClick"],nt={class:"operating-style"},rt={class:"operating-left"},it={class:"left"},ut={class:"operating-right"},dt=$({__name:"EditProduct",props:{id:{type:Number,default:0},act:{type:String,default:""},form:{type:Object,default:()=>({})},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close"],setup(N,{expose:S,emit:T}){const c=T,u=N,p=m(!0),v=j().currentRoute.value.query,g=m(u.isDialog?u.act:String(v.act)),h=m(u.isDialog?u.id:Number(v.id));g.value;const V=F(),i=m(u.form);M(()=>{q()});const q=async()=>{try{p.value=!0;const a=await Y(g.value,{id:h.value});Object.assign(i.value,a)}catch(a){y.error(a.message),c("close")}finally{p.value=!1}},D=z(()=>{let a=0;return i.value.items.forEach(o=>{a+=o.quantity*o.price}),a}),k=async()=>{await V.value.validate();try{c("update:confirmLoading",!0);const a=await Z({id:h.value,items:i.value.items});c("submitCallback",a),y.success("操作成功")}catch(a){y.error(a.message)}finally{c("update:confirmLoading",!1)}},O=()=>{k()},P=async a=>{try{const o=await tt({ids:a});console.log(o),o.forEach(s=>{s.quantity=1,s.itemId=0,i.value.items.push(s)})}catch{}finally{c("update:confirmLoading",!1)}},B=a=>{i.value.items.splice(a,1)};return S({onFormSubmit:O}),(a,o)=>{const s=n("el-table-column"),w=n("TigInput"),R=n("el-input-number"),U=n("el-table"),b=n("el-button"),E=n("el-form-item"),L=n("el-form"),A=n("a-spin");return C(),Q("div",ot,[r("div",at,[r("div",lt,[p.value?H("",!0):(C(),G(L,{key:0,ref_key:"formRef",ref:V,model:i.value,"label-width":"auto"},{default:l(()=>[e(U,{data:i.value.items,style:{width:"100%"}},{default:l(()=>[e(s,{type:"selection",width:"50"}),e(s,{label:"商品名称",prop:"productId",width:"320"},{default:l(({row:t})=>[e(f(X),{picThumb:t.picThumb,productId:t.productId,productName:t.productName,productType:t.productType,url:t.url},null,8,["picThumb","productId","productName","productType","url"])]),_:1}),e(s,{label:"货号",prop:"productSn"}),e(s,{label:"价格",prop:"price"},{default:l(({row:t})=>[e(w,{type:"decimal",modelValue:t.price,"onUpdate:modelValue":d=>t.price=d},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(s,{label:"数量",prop:"quantity",width:"110"},{default:l(({row:t})=>[e(R,{class:"input-number","controls-position":"right",modelValue:t.quantity,"onUpdate:modelValue":d=>t.quantity=d,type:"number",min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(s,{label:"属性",prop:"productAttr"},{default:l(({row:t})=>[e(w,{rows:1,modelValue:t.productAttr,"onUpdate:modelValue":d=>t.productAttr=d,type:"textarea"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(s,{label:"小计",prop:"subtotal"},{default:l(({row:t})=>[_(x(f(I)(t.quantity*t.price)),1)]),_:1}),e(s,{label:"操作",prop:"name"},{default:l(t=>[r("a",{onClick:d=>B(t.$index)},"删除",8,st)]),_:1})]),_:1},8,["data"]),r("div",nt,[r("div",rt,[r("div",it,[e(b,{disabled:""},{default:l(()=>[...o[1]||(o[1]=[_("拆分订单",-1)])]),_:1}),e(f(et),{isDrawer:"",onOkCallback:P,title:"选择商品",width:"600px",path:"product/product/src/SelectProduct",params:{isMultiple:!0}},{default:l(()=>[e(b,null,{default:l(()=>[...o[2]||(o[2]=[_("添加商品",-1)])]),_:1})]),_:1})]),o[3]||(o[3]=r("div",null," 提示：手动添加商品时，商品价格为商品基础售价，不会判断促销、满减等活动；已付款或发货的订单无法修改、添加商品。 ",-1))]),r("div",ut,"合计："+x(f(I)(D.value)),1)]),J(e(E,{"wrapper-col":{offset:4,span:16}},{default:l(()=>[e(b,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:o[0]||(o[0]=t=>k())},{default:l(()=>[...o[4]||(o[4]=[_("提交 ",-1)])]),_:1},512)]),_:1},512),[[K,!u.isDialog]])]),_:1},8,["model"])),e(A,{spinning:p.value,style:{width:"100%","margin-top":"100px"}},null,8,["spinning"])])])])}}}),gt=W(dt,[["__scopeId","data-v-633a5012"]]);export{gt as default};

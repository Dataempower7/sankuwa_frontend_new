import{d as ve,r as m,a5 as fe,c as _e,o as ke,P as p,f as g,g as u,h as d,i as a,l as y,n as N,j as n,F as T,p as $,t as q,z as r,m as c,Q as O,k as H,dv as Ie,G as Q,L as X,al as A,eH as be,_ as he}from"./index-B52YIGC0.js";import"./index-KjhYqCTY.js";import{i as J}from"./format-BxqOrW-w.js";/* empty css                                                                    */import{P as Ce}from"./Pagination-C8J7-6Em.js";import{u as we}from"./gallery-DcB9WyRo.js";import{g as K,a as Ge,u as xe,b as Ne,d as Te,c as $e}from"./gallery-BnfhcmY9.js";import{_ as U}from"./DialogForm.vue_vue_type_script_setup_true_lang-CT6mpwCc.js";import{M as Oe}from"./index-C9ZdVeVx.js";const Ue={class:"gallery_warp",id:"gallery_warp"},Le={class:"lyecs_gallery_box"},Ve={class:"gallery-folder-warp"},Fe={class:"gallery-folder-list"},ze=["onClick"],Pe={class:"item-name"},Se={class:"folder-item-edit"},Me={class:"add-gallery-folder-con"},Be={class:"gallery-pics-warp"},Ee={class:"gallery-main",id:"gallery-main"},Re={class:"gallery-pic-action"},je={class:"gallery-pic-action-l"},De={class:"gallery-pic-action-r"},qe={class:"gallery-list gallery-list",suppressScrollX:!1},He={key:0},Qe={class:"gallery-item"},Xe=["onClick"],Ae={key:0},Je=["src"],Ke={class:"pic-actions"},We={class:"desc"},Ye=["onUpdate:modelValue","onChange"],Ze={key:1,class:"gallery-list-ul"},el={key:0},ll=["onClick"],tl={class:"pic-actions"},al={class:"desc"},sl=["onUpdate:modelValue","onChange"],ol={key:1,class:"gallery-upload-con"},rl={class:"txt"},nl={key:2,class:"empty-warp"},il={key:0,class:"empty-bg"},dl={class:"gallery-list-page"},cl=ve({__name:"Gallery",props:{isMultiple:{type:Boolean,default:!1}},emits:["submitCallback","okType"],setup(W,{expose:Y,emit:Z}){const ee=W,s=we();m(0),m(0);const w=m([]),F=m([]),z=m([]),P=m(),_=m({}),b=m([]),{isMultiple:le}=fe(ee);m([]);const v=m([]),S=m(15),G=m(!0),k=_e(()=>z.value.concat(F.value)),te=l=>{const e=l.size/1024/1024<10;return e||p.error("只能上传10M以内的图片"),e},ae=l=>{l.file.status=="uploading",l.file.status,l.file.status==="done"?l.file.response.code!==0?(l.file.status="error",p.error(l.file.response.message)):(h(s.galleryId),p.success("图片上传成功！")):l.file.status==="error"&&p.error(`${l.file.name} 图片上传失败！`)},h=async l=>{try{const e=await K({galleryId:l});Object.assign(w.value,e.records),f(l,s.page),L()}catch(e){p.error(e.message)}};ke(()=>{L()});const L=async()=>{try{const l=await K({galleryId:0});w.value=l.records,f(s.galleryId,s.page)}catch(l){p.error(l.message)}},M=l=>{f(l),s.page=1,s.topGalleryId=l},se=l=>{f(s.galleryId,l)},f=async(l,e=1)=>{G.value=!0,s.page=e;try{const o=await Ge({galleryId:l,page:e,sortOrder:s.sortOrder});z.value=[],F.value=o.galleryPicPage.records,b.value=o.childGalleryList,P.value=o.galleryPicPage.total,s.galleryId=l,_.value=o.galleryInfo}catch(o){p.error(o.message)}finally{G.value=!1}},oe=l=>{s.sortOrder=l,f(s.galleryId)},B=(l,e)=>{e==!0?h(s.galleryId):f(s.galleryId)},E=l=>{l==0?h(s.galleryId):f(s.galleryId)},re=async(l,e)=>{try{const o=await xe({id:e,val:l.target.value,field:"galleryName"});p.success("操作成功")}catch(o){p.error(o.message)}},ne=async(l,e)=>{try{const o=await Ne({id:e,val:l.target.value,field:"picName"});p.success("操作成功")}catch(o){p.error(o.message)}},ie=async l=>{try{const e=await Te({id:l});p.success("操作成功"),h(s.galleryId)}catch(e){p.error(e.message)}},R=async(l,e)=>{try{const o=await $e({id:l});p.success("操作成功"),b.value.splice(e,1),s.galleryId==l&&(s.topGalleryId=0,s.galleryId=0),h(s.galleryId)}catch(o){p.error(o.message)}},de=(l,e)=>{Oe.confirm({title:"您确认要删除所选相册吗？",okType:"danger",onOk(){R(l,e),L()}})},V=Z;V("okType",!1);const ce=(l,e)=>{let o=!1;if(v.value.length>0)for(let I in v.value)v.value[I].picId==l.picId&&(k.value[e].selected=!1,v.value.splice(I,1),o=!0);if(o==!1){if(le.value==!1){v.value=[];for(let I in k.value)k.value[I].selected=!1}k.value[e].selected=!0,v.value.push({picId:l.picId,picThumb:l.picThumb,picUrl:l.picUrl,picName:l.picName})}V("okType",v.value.length>0)};return Y({onFormSubmit:()=>{V("submitCallback",v.value)}}),(l,e)=>{const o=g("el-dropdown-item"),I=g("el-dropdown-menu"),ue=g("el-dropdown"),x=g("el-button"),pe=g("el-space"),j=g("el-option"),me=g("el-select"),D=g("a-popconfirm"),ge=g("el-image"),ye=g("a-spin");return d(),u("div",Ue,[a("div",Le,[a("div",Ve,[a("div",Fe,[w.value?(d(),u("div",{key:0,class:N("gallery-folder-item "+(n(s).topGalleryId==0?"current":"")),onClick:e[0]||(e[0]=t=>M(0))},[...e[7]||(e[7]=[a("div",{class:"folder-item-con"},[a("i",{class:"item-ico"}),a("div",{class:"item-name"},"全部")],-1)])],2)):y("",!0),(d(!0),u(T,null,$(w.value,(t,C)=>(d(),u("div",{class:N("gallery-folder-item "+(n(s).topGalleryId==t.galleryId?"current":""))},[a("div",{class:N("folder-item-con"),onClick:i=>M(t.galleryId)},[e[8]||(e[8]=a("i",{class:"item-ico"},null,-1)),a("div",Pe,q(t.galleryName),1)],8,ze),a("div",Se,[r(ue,{trigger:"click"},{dropdown:c(()=>[r(I,null,{default:c(()=>[r(n(U),{width:"600px",onOkCallback:i=>B(t.galleryId,!0),title:"编辑相册",path:"gallery/GalleryEdit",params:{act:"detail",id:t.galleryId}},{default:c(()=>[r(o,null,{default:c(()=>[...e[9]||(e[9]=[a("div",null,"编辑相册",-1)])]),_:1})]),_:1},8,["onOkCallback","params"]),r(o,{onClick:i=>de(t.galleryId,C)},{default:c(()=>[...e[10]||(e[10]=[a("div",null,"删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),default:c(()=>[e[11]||(e[11]=a("i",{title:"编辑",class:"ico-font"},"",-1))]),_:2},1024)])],2))),256))]),a("div",Me,[r(n(U),{width:"600px",onOkCallback:e[1]||(e[1]=t=>E(0)),title:"添加相册",path:"gallery/GalleryEdit",params:{act:"add",parentId:0}},{default:c(()=>[r(x,{class:"add-gallery-folder-btn"},{default:c(()=>[...e[12]||(e[12]=[a("em",null,"+",-1),O(" 添加相册",-1)])]),_:1})]),_:1})])]),a("div",Be,[a("div",Ee,[a("div",Re,[a("div",je,[r(pe,null,{default:c(()=>[r(n(Ie),{name:"file",action:n(Q).prefix+"/setting/galleryPic/uploadImg?galleryId="+n(s).galleryId,headers:n(Q).headers(),onChange:ae,showUploadList:!1,"before-upload":te,multiple:!0},{default:c(()=>[r(x,{type:"primary"},{default:c(()=>[...e[13]||(e[13]=[O("上传图片",-1)])]),_:1})]),_:1},8,["action","headers"]),_.value&&_.value.parentId>0?(d(),H(x,{key:0,class:"lyecs-btn return-gallery-btn",onClick:e[2]||(e[2]=t=>f(_.value.parentId))},{default:c(()=>[...e[14]||(e[14]=[O("返回上一级",-1)])]),_:1})):y("",!0),_.value&&n(s).galleryId>0?(d(),H(n(U),{key:1,width:"600px",onOkCallback:e[3]||(e[3]=t=>E(_.value.galleryId)),title:"添加子相册",path:"gallery/GalleryEdit",params:{act:"add",parentId:_.value.galleryId}},{default:c(()=>[r(x,{class:"lyecs-btn add-gallery-btn"},{default:c(()=>[...e[15]||(e[15]=[O("添加子相册",-1)])]),_:1})]),_:1},8,["params"])):y("",!0)]),_:1})]),a("div",De,[e[16]||(e[16]=a("span",{style:{"word-break":"keep-all"}},"排序：",-1)),r(me,{onChange:oe,class:"a-select-ui gallery_pic_sort",modelValue:n(s).sortOrder,"onUpdate:modelValue":e[4]||(e[4]=t=>n(s).sortOrder=t)},{default:c(()=>[r(j,{label:"时间从先到后",value:"asc"}),r(j,{label:"时间从后到先",value:"desc"})]),_:1},8,["modelValue"])])]),r(ye,{spinning:G.value},{default:c(()=>[a("div",qe,[b.value.length>0&&n(s).galleryId>0?(d(),u("ul",He,[(d(!0),u(T,null,$(b.value,(t,C)=>(d(),u("li",Qe,[a("div",{class:"img",onClick:i=>f(t.galleryId)},[t.galleryPics.length==0?(d(),u("a",Ae,[...e[17]||(e[17]=[a("span",{class:"img-empty"},"相册为空",-1)])])):y("",!0),(d(!0),u(T,null,$(t.galleryPics,(i,pl)=>(d(),u("img",{class:"gallery_pics",src:n(J)(i.picThumb)},null,8,Je))),256))],8,Xe),a("p",Ke,[r(n(U),{width:"600px",onOkCallback:i=>B(t.galleryId,!1),title:"编辑相册",path:"gallery/GalleryEdit",params:{act:"detail",id:t.galleryId,parentId:t.parentId}},{default:c(()=>[...e[18]||(e[18]=[a("a",{class:"btn-edit ico-font"},"",-1)])]),_:1},8,["onOkCallback","params"]),r(D,{title:"您确认要删掉该相册吗？",onConfirm:i=>R(t.galleryId,C),placement:"bottom"},{default:c(()=>[...e[19]||(e[19]=[a("a",{class:"btn-del ico-font",title:"删除"},"",-1)])]),_:1},8,["onConfirm"])]),a("div",We,[X(a("input",{class:"galleryName","onUpdate:modelValue":i=>t.galleryName=i,onChange:i=>re(i,t.galleryId),type:"text"},null,40,Ye),[[A,t.galleryName]])])]))),256))])):y("",!0),k.value.length>0?(d(),u("ul",Ze,[(d(!0),u(T,null,$(k.value,(t,C)=>(d(),u("li",{class:N("gallery-pic-item "+(v.value.some(i=>i.picId===t.picId)?"selected":""))},[t.picThumb?(d(),u("div",el,[a("div",{class:"img",onClick:i=>ce(t,C)},[r(ge,{fit:"cover",src:n(J)(t.picThumb),style:{width:"100%",height:"100%"}},null,8,["src"])],8,ll),a("p",tl,[r(D,{title:"您确认要删掉该图片吗？",onConfirm:i=>ie(t.picId),placement:"bottom"},{default:c(()=>[...e[20]||(e[20]=[a("a",{class:"btn-del ico-font",title:"删除"},"",-1)])]),_:1},8,["onConfirm"])]),a("div",al,[X(a("input",{class:"pic_name",autocomplete:"off",placeholder:"图片名称","onUpdate:modelValue":i=>t.picName=i,onChange:i=>ne(i,t.picId),type:"text"},null,40,sl),[[A,t.picName]])]),e[21]||(e[21]=a("div",{class:"img-selected-box"},[a("div",{class:"img-selected-box-angle"}),a("div",{class:"img-selected-box-sort ico-font"},"")],-1))])):y("",!0),t.picThumb?y("",!0):(d(),u("div",ol,[a("span",rl,q(t.status=="error"?"上传失败":t.status=="done"?"上传成功":"图片上传中"),1),r(n(be),{percent:t.percent,status:t.status=="error"?"exception":"normal"},null,8,["percent","status"])]))],2))),256))])):y("",!0),k.value.length==0&&b.value.length==0?(d(),u("div",nl,[G.value?y("",!0):(d(),u("div",il,"暂无数据"))])):y("",!0)]),a("div",dl,[r(n(Ce),{page:n(s).page,"onUpdate:page":e[5]||(e[5]=t=>n(s).page=t),size:S.value,"onUpdate:size":e[6]||(e[6]=t=>S.value=t),total:P.value,onCallback:se,layout:"slot ,prev, pager, next",background:!1},null,8,["page","size","total"])])]),_:1},8,["spinning"])])])])])}}}),hl=he(cl,[["__scopeId","data-v-751f1e8f"]]);export{hl as default};

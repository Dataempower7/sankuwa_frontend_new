import{d as _e,r as m,a0 as ve,c as fe,o as ke,K as p,e as y,f as u,g as i,h as a,k as g,n as G,i as r,F as $,m as T,t as q,z as n,l as c,L as O,j as K,dl as Ie,dk as X,G as A,aa as H,eg as be,_ as he}from"./index-BLXOA87U.js";import"./index-DpgvsnVO.js";import{i as J}from"./format-DdZABYp4.js";/* empty css                                                                    */import{P as Ce}from"./Pagination-w0YHSLYy.js";import{u as we}from"./gallery-DNIPSvyh.js";import{g as Q,a as Ge,u as xe,b as Ne,d as $e,c as Te}from"./gallery-FWj2DHMt.js";import{_ as U}from"./DialogForm.vue_vue_type_script_setup_true_lang-6GHo9HCV.js";import{M as Oe}from"./index-B16C4gX_.js";const Ue={class:"gallery_warp",id:"gallery_warp"},Le={class:"lyecs_gallery_box"},Ve={class:"gallery-folder-warp"},Fe={class:"gallery-folder-list"},ze=["onClick"],Se={class:"item-name"},Me={class:"folder-item-edit"},Pe={class:"add-gallery-folder-con"},Be={class:"gallery-pics-warp"},Ee={class:"gallery-main",id:"gallery-main"},Re={class:"gallery-pic-action"},je={class:"gallery-pic-action-l"},De={class:"gallery-pic-action-r"},qe={class:"gallery-list gallery-list",suppressScrollX:!1},Ke={key:0},Xe={class:"gallery-item"},Ae=["onClick"],He={key:0},Je=["src"],Qe={class:"pic-actions"},We={class:"desc"},Ye=["onUpdate:modelValue","onChange"],Ze={key:1,class:"gallery-list-ul"},el={key:0},ll=["onClick"],tl={class:"pic-actions"},al={class:"desc"},sl=["onUpdate:modelValue","onChange"],ol={key:1,class:"gallery-upload-con"},rl={class:"txt"},nl={key:2,class:"empty-warp"},il={key:0,class:"empty-bg"},dl={class:"gallery-list-page"},cl=_e({__name:"Gallery",props:{isMultiple:{type:Boolean,default:!1}},emits:["submitCallback","okType"],setup(W,{expose:Y,emit:Z}){const ee=W,s=we();m(0),m(0);const b=m([]),z=m([]),S=m([]),M=m(),f=m({}),h=m([]),{isMultiple:le}=ve(ee);m([]);const _=m([]),P=m(15),x=m(!0),k=fe(()=>S.value.concat(z.value)),te=l=>{const e=l.size/1024/1024<10;return e||p.error("只能上传10M以内的图片"),e},ae=l=>{l.file.status=="uploading",l.file.status,l.file.status==="done"?l.file.response.code!==0?(l.file.status="error",p.error(l.file.response.message)):(C(s.galleryId),p.success("图片上传成功！")):l.file.status==="error"&&p.error(`${l.file.name} 图片上传失败！`)},C=async l=>{try{const e=await Q({galleryId:l});Object.assign(b.value,e.records),v(l,s.page),L()}catch(e){p.error(e.message)}};ke(()=>{L()});const L=async()=>{try{const l=await Q({galleryId:0});b.value=l.records,v(s.galleryId,s.page)}catch(l){p.error(l.message)}},V=l=>{v(l),s.page=1,s.topGalleryId=l},se=l=>{v(s.galleryId,l)},v=async(l,e=1)=>{x.value=!0,s.page=e;try{const o=await Ge({galleryId:l,page:e,sortOrder:s.sortOrder});S.value=[],z.value=o.galleryPicPage.records,h.value=o.childGalleryList,M.value=o.galleryPicPage.total,s.galleryId=l,f.value=o.galleryInfo}catch(o){p.error(o.message)}finally{x.value=!1}},oe=l=>{s.sortOrder=l,v(s.galleryId)},B=(l,e)=>{e==!0?C(s.galleryId):v(s.galleryId)},E=l=>{l==0?C(s.galleryId):v(s.galleryId)},re=async(l,e)=>{try{const o=await xe({id:e,val:l.target.value,field:"galleryName"});p.success("操作成功")}catch(o){p.error(o.message)}},ne=async(l,e)=>{try{const o=await Ne({id:e,val:l.target.value,field:"picName"});p.success("操作成功")}catch(o){p.error(o.message)}},ie=async l=>{try{const e=await $e({id:l});p.success("操作成功"),C(s.galleryId)}catch(e){p.error(e.message)}},R=async(l,e)=>{try{const o=await Te({id:l});p.success("操作成功"),h.value.splice(e,1),s.galleryId==l&&(s.topGalleryId=0,s.galleryId=0),C(s.galleryId)}catch(o){p.error(o.message)}},de=(l,e)=>{Oe.confirm({title:"您确认要删除所选相册吗？",okType:"danger",onOk(){R(l,e),L()}})},F=Z;F("okType",!1);const ce=(l,e)=>{let o=!1;if(_.value.length>0)for(let I in _.value)_.value[I].picId==l.picId&&(k.value[e].selected=!1,_.value.splice(I,1),o=!0);if(o==!1){if(le.value==!1){_.value=[];for(let I in k.value)k.value[I].selected=!1}k.value[e].selected=!0,_.value.push({picId:l.picId,picThumb:l.picThumb,picUrl:l.picUrl,picName:l.picName})}F("okType",_.value.length>0)};return Y({onFormSubmit:()=>{F("submitCallback",_.value)}}),(l,e)=>{const o=y("el-dropdown-item"),I=y("el-dropdown-menu"),ue=y("el-dropdown"),N=y("el-button"),pe=y("el-space"),j=y("el-option"),me=y("el-select"),D=y("a-popconfirm"),ge=y("el-image"),ye=y("a-spin");return i(),u("div",Ue,[a("div",Le,[a("div",Ve,[a("div",Fe,[b.value?(i(),u("div",{key:0,class:G("gallery-folder-item "+(r(s).topGalleryId==0?"current":"")),onClick:e[0]||(e[0]=t=>V(0))},e[8]||(e[8]=[a("div",{class:"folder-item-con"},[a("i",{class:"item-ico"}),a("div",{class:"item-name"},"全部")],-1)]),2)):g("",!0),b.value?(i(),u("div",{key:1,class:G("gallery-folder-item "+(r(s).topGalleryId==-1?"current":"")),onClick:e[1]||(e[1]=t=>V(-1))},e[9]||(e[9]=[a("div",{class:"folder-item-con"},[a("i",{class:"item-ico"}),a("div",{class:"item-name"},"我的服务")],-1)]),2)):g("",!0),(i(!0),u($,null,T(b.value,(t,w)=>(i(),u("div",{class:G("gallery-folder-item "+(r(s).topGalleryId==t.galleryId?"current":""))},[a("div",{class:G("folder-item-con"),onClick:d=>V(t.galleryId)},[e[10]||(e[10]=a("i",{class:"item-ico"},null,-1)),a("div",Se,q(t.galleryName),1)],8,ze),a("div",Me,[n(ue,{trigger:"click"},{dropdown:c(()=>[n(I,null,{default:c(()=>[n(r(U),{width:"600px",onOkCallback:d=>B(t.galleryId,!0),title:"编辑相册",path:"gallery/GalleryEdit",params:{act:"detail",id:t.galleryId}},{default:c(()=>[n(o,null,{default:c(()=>e[11]||(e[11]=[a("div",null,"编辑相册",-1)])),_:1,__:[11]})]),_:2},1032,["onOkCallback","params"]),n(o,{onClick:d=>de(t.galleryId,w)},{default:c(()=>e[12]||(e[12]=[a("div",null,"删除",-1)])),_:2,__:[12]},1032,["onClick"])]),_:2},1024)]),default:c(()=>[e[13]||(e[13]=a("i",{title:"编辑",class:"ico-font"},"",-1))]),_:2,__:[13]},1024)])],2))),256))]),a("div",Pe,[n(r(U),{width:"600px",onOkCallback:e[2]||(e[2]=t=>E(0)),title:"添加相册",path:"gallery/GalleryEdit",params:{act:"add",parentId:0}},{default:c(()=>[n(N,{class:"add-gallery-folder-btn"},{default:c(()=>e[14]||(e[14]=[a("em",null,"+",-1),O(" 添加相册",-1)])),_:1,__:[14]})]),_:1})])]),a("div",Be,[a("div",Ee,[a("div",Re,[a("div",je,[n(pe,null,{default:c(()=>[n(r(Ie),{name:"file",action:r(X).prefix+"/setting/galleryPic/uploadImg?galleryId="+r(s).galleryId,headers:r(X).headers(),onChange:ae,showUploadList:!1,"before-upload":te,multiple:!0},{default:c(()=>[n(N,{type:"primary"},{default:c(()=>e[15]||(e[15]=[O("上传图片",-1)])),_:1,__:[15]})]),_:1},8,["action","headers"]),f.value&&f.value.parentId>0?(i(),K(N,{key:0,class:"lyecs-btn return-gallery-btn",onClick:e[3]||(e[3]=t=>v(f.value.parentId))},{default:c(()=>e[16]||(e[16]=[O("返回上一级",-1)])),_:1,__:[16]})):g("",!0),f.value&&r(s).galleryId>0?(i(),K(r(U),{key:1,width:"600px",onOkCallback:e[4]||(e[4]=t=>E(f.value.galleryId)),title:"添加子相册",path:"gallery/GalleryEdit",params:{act:"add",parentId:f.value.galleryId}},{default:c(()=>[n(N,{class:"lyecs-btn add-gallery-btn"},{default:c(()=>e[17]||(e[17]=[O("添加子相册",-1)])),_:1,__:[17]})]),_:1},8,["params"])):g("",!0)]),_:1})]),a("div",De,[e[18]||(e[18]=a("span",{style:{"word-break":"keep-all"}},"排序：",-1)),n(me,{onChange:oe,class:"a-select-ui gallery_pic_sort",modelValue:r(s).sortOrder,"onUpdate:modelValue":e[5]||(e[5]=t=>r(s).sortOrder=t)},{default:c(()=>[n(j,{label:"时间从先到后",value:"asc"}),n(j,{label:"时间从后到先",value:"desc"})]),_:1},8,["modelValue"])])]),n(ye,{spinning:x.value},{default:c(()=>[a("div",qe,[h.value.length>0&&r(s).galleryId>0?(i(),u("ul",Ke,[(i(!0),u($,null,T(h.value,(t,w)=>(i(),u("li",Xe,[a("div",{class:"img",onClick:d=>v(t.galleryId)},[t.galleryPics.length==0?(i(),u("a",He,e[19]||(e[19]=[a("span",{class:"img-empty"},"相册为空",-1)]))):g("",!0),(i(!0),u($,null,T(t.galleryPics,(d,pl)=>(i(),u("img",{class:"gallery_pics",src:r(J)(d.picThumb)},null,8,Je))),256))],8,Ae),a("p",Qe,[n(r(U),{width:"600px",onOkCallback:d=>B(t.galleryId,!1),title:"编辑相册",path:"gallery/GalleryEdit",params:{act:"detail",id:t.galleryId,parentId:t.parentId}},{default:c(()=>e[20]||(e[20]=[a("a",{class:"btn-edit ico-font"},"",-1)])),_:2,__:[20]},1032,["onOkCallback","params"]),n(D,{title:"您确认要删掉该相册吗？",onConfirm:d=>R(t.galleryId,w),placement:"bottom"},{default:c(()=>e[21]||(e[21]=[a("a",{class:"btn-del ico-font",title:"删除"},"",-1)])),_:2,__:[21]},1032,["onConfirm"])]),a("div",We,[A(a("input",{class:"galleryName","onUpdate:modelValue":d=>t.galleryName=d,onChange:d=>re(d,t.galleryId),type:"text"},null,40,Ye),[[H,t.galleryName]])])]))),256))])):g("",!0),k.value.length>0?(i(),u("ul",Ze,[(i(!0),u($,null,T(k.value,(t,w)=>(i(),u("li",{class:G("gallery-pic-item "+(_.value.some(d=>d.picId===t.picId)?"selected":""))},[t.picThumb?(i(),u("div",el,[a("div",{class:"img",onClick:d=>ce(t,w)},[n(ge,{fit:"cover",src:r(J)(t.picThumb),style:{width:"100%",height:"100%"}},null,8,["src"])],8,ll),a("p",tl,[n(D,{title:"您确认要删掉该图片吗？",onConfirm:d=>ie(t.picId),placement:"bottom"},{default:c(()=>e[22]||(e[22]=[a("a",{class:"btn-del ico-font",title:"删除"},"",-1)])),_:2,__:[22]},1032,["onConfirm"])]),a("div",al,[A(a("input",{class:"pic_name",autocomplete:"off",placeholder:"图片名称","onUpdate:modelValue":d=>t.picName=d,onChange:d=>ne(d,t.picId),type:"text"},null,40,sl),[[H,t.picName]])]),e[23]||(e[23]=a("div",{class:"img-selected-box"},[a("div",{class:"img-selected-box-angle"}),a("div",{class:"img-selected-box-sort ico-font"},"")],-1))])):g("",!0),t.picThumb?g("",!0):(i(),u("div",ol,[a("span",rl,q(t.status=="error"?"上传失败":t.status=="done"?"上传成功":"图片上传中"),1),n(r(be),{percent:t.percent,status:t.status=="error"?"exception":"normal"},null,8,["percent","status"])]))],2))),256))])):g("",!0),k.value.length==0&&h.value.length==0?(i(),u("div",nl,[x.value?g("",!0):(i(),u("div",il,"暂无数据"))])):g("",!0)]),a("div",dl,[n(r(Ce),{page:r(s).page,"onUpdate:page":e[6]||(e[6]=t=>r(s).page=t),size:P.value,"onUpdate:size":e[7]||(e[7]=t=>P.value=t),total:M.value,onCallback:se,layout:"slot ,prev, pager, next",background:!1},null,8,["page","size","total"])])]),_:1},8,["spinning"])])])])])}}}),hl=he(cl,[["__scopeId","data-v-8671ab60"]]);export{hl as default};

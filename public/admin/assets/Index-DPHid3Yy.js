/* empty css             */import Z from"./Map-HaxAD4r_.js";import{g as ee,a as te,b as le,s as se}from"./intraCityDelivery-CDNtFMRZ.js";import{d as ae}from"./format-BxqOrW-w.js";import{d as ie,u as ne,ab as re,r as _,o as oe,Y as de,f as m,g as U,h,i as l,z as i,m as r,t as O,Q as L,j as N,av as ue,F as T,p as pe,k as ce,ah as me,P as b,ac as ge,s as C,_ as fe}from"./index-B52YIGC0.js";import{e as ve}from"./shop-CBisV8Of.js";import"./index-Wb8975_T.js";const be={class:"container"},ye={class:"content_wrapper"},_e={class:"form-item"},Le={class:"flex flex-align-center mb10"},Se={class:"tips ml10"},Pe={class:"content_wrapper"},he={class:"base-info"},Oe={class:"base-info"},we={class:"form-item"},Ve={class:"base-info"},Re={class:"setting-box"},ke={class:"flex flex-align-center"},Ee={class:"pricing-rule-item"},Fe={class:"selected-action"},Ie=ie({__name:"Index",setup(Ue){const{themeInfo:x}=ne(),g=re(),A=_(),w=_([116.433322,39.900256]),c=_({storeSelfOperatedName:"",storeSelfOperatedAddress:"",storeSelfOperatedRegion:"",storeSelfOperatedLogo:"",storeSelfOperatedLongitude:"",storeSelfOperatedLatitude:"",storeSelfOperatedRegions:[]}),S=_(!1),s=_({distancePricingList:[],minOrderAmount:0,baseDeliveryFee:0,deliveryRadius:1e3,distancePricingEnabled:0,enabled:0}),f=_(!0),D=t=>{t||(s.value.distancePricingList=[])},$=[{validator:(t,e,a)=>{var n;e===1&&((n=s.value.distancePricingList)==null?void 0:n.length)===0?a(new Error("开启叠加溢价时，至少需要添加一条溢价规则")):a()},trigger:"change"}],q=t=>[{required:!0,message:"请输入距离",trigger:"blur"},{validator:(e,a,n)=>{if(!a||a===""||a===0){n(new Error("距离不能为空或为0"));return}const o=Number(a);if(t>0){const p=s.value.distancePricingList[t-1],u=Number(p.distanceThreshold);if(o<=u){n(new Error(`距离值必须大于前一条规则的值 (${u}km)`));return}}if(t<s.value.distancePricingList.length-1){const p=s.value.distancePricingList[t+1],u=Number(p.distanceThreshold);if(o>=u){n(new Error(`距离值必须小于后一条规则的值 (${u}km)`));return}}n()},trigger:"blur"}],j=()=>[{required:!0,message:"请输入距离单位",trigger:"blur"},{validator:(t,e,a)=>{if(!e||e===""||e===0){a(new Error("距离单位不能为空或为0"));return}a()},trigger:"blur"}],B=()=>[{required:!0,message:"请输入附加费用",trigger:"blur"},{validator:(t,e,a)=>{if(!e||e===""||e===0){a(new Error("附加费用不能为空或为0"));return}a()},trigger:"blur"}],z=async()=>{f.value=!0;try{const t=await ee();Object.assign(s.value,ae(t))}catch(t){b.error(t.message)}finally{f.value=!1}},M=async()=>{f.value=!0;try{const t=await te();s.value={...t,distancePricingList:t.distancePricingList?[...t.distancePricingList]:[]}}catch(t){b.error(t.message)}finally{f.value=!1}},J=async()=>{var t,e;f.value=!0;try{if(ge()&&JSON.parse(localStorage.getItem("shopInfo")||"{}").shopId){const a=await ve("detail",{shopId:JSON.parse(localStorage.getItem("shopInfo")||"{}").shopId}),{shopTitle:n,shopLogo:o,shopLongitude:p,shopLatitude:u}=a||{};Object.assign(c.value,{storeSelfOperatedName:n||"",storeSelfOperatedLogo:o||"",storeSelfOperatedLongitude:p||"",storeSelfOperatedLatitude:u||"",storeSelfOperatedAddress:(a==null?void 0:a.shopDetailedAddress)||"",storeSelfOperatedRegions:(a==null?void 0:a.shopRegionNames)||[]})}else{const a=await le();c.value=a}w.value=[Number((t=c.value)==null?void 0:t.storeSelfOperatedLongitude),Number((e=c.value)==null?void 0:e.storeSelfOperatedLatitude)]}catch(a){b.error(a.message)}finally{f.value=!1}},Q=()=>{var t,e;if(((t=s.value.distancePricingList)==null?void 0:t.length)>=10)return b.error("最多只能添加10条收费规则");s.value.distancePricingList.push({distanceThreshold:0,distanceUnit:0,additionalFee:0,sortOrder:((e=s.value.distancePricingList)==null?void 0:e.length)+1})},Y=t=>{if(s.value.distancePricingList.length===1)return b.warning("最少需要添加一条收费规则");s.value.distancePricingList.splice(t,1),C(()=>{var e;(e=g.value)==null||e.validateField("distancePricingEnabled"),s.value.distancePricingList.forEach((a,n)=>{var o,p,u;(o=g.value)==null||o.validateField(`distancePricingList.${n}.distanceThreshold`),(p=g.value)==null||p.validateField(`distancePricingList.${n}.distanceUnit`),(u=g.value)==null||u.validateField(`distancePricingList.${n}.additionalFee`)})})},G=async()=>{try{await g.value.validate(),S.value=!0;const t=await se(s.value);b.success("修改成功")}catch(t){t.message&&b.error(t.message)}finally{S.value=!1}},H=t=>{s.value.deliveryRadius=t};return oe(async()=>{await J(),await M(),z()}),de(()=>s.value.distancePricingList,t=>{t&&t.length<=1&&C(()=>{var e;(e=g.value)==null||e.validateField("distancePricingEnabled")})},{deep:!0}),(t,e)=>{const a=m("el-switch"),n=m("TigInput"),o=m("el-form-item"),p=m("el-checkbox"),u=m("el-icon"),K=m("el-tooltip"),P=m("el-button"),W=m("el-form"),X=m("a-spin");return h(),U(T,null,[l("div",be,[i(X,{spinning:f.value},{default:r(()=>[i(W,{ref_key:"formRef",ref:g,model:s.value,"label-width":"auto",style:{display:"flex",gap:"0.75rem","flex-direction":"column"}},{default:r(()=>{var V,R,k,E,F,I;return[l("div",ye,[l("div",_e,[l("div",Le,[e[4]||(e[4]=l("div",{class:"label mr10"},"同城配送功能",-1)),i(a,{modelValue:s.value.enabled,"onUpdate:modelValue":e[0]||(e[0]=d=>s.value.enabled=d),"active-value":1,"inactive-value":0},null,8,["modelValue"]),l("div",Se,O(s.value.enabled?"已开启":"已关闭"),1)]),e[5]||(e[5]=l("div",{class:"extra"},"买家下单支持同城配送，商家可自行配送",-1))])]),l("div",Pe,[l("div",he,[e[6]||(e[6]=l("span",{style:{color:"#919191"}},"发货方：",-1)),l("span",null,O((V=c.value)!=null&&V.storeSelfOperatedName?(R=c.value)==null?void 0:R.storeSelfOperatedName:"--"),1)]),l("div",Oe,[e[8]||(e[8]=l("span",{style:{color:"#919191"}},"门店地址：",-1)),l("div",null,[l("span",null,O((k=c.value)!=null&&k.storeSelfOperatedRegions?((F=(E=c.value)==null?void 0:E.storeSelfOperatedRegions)==null?void 0:F.join(""))+((I=c.value)==null?void 0:I.storeSelfOperatedAddress):"--"),1),e[7]||(e[7]=l("div",{class:"base-info mt10",style:{color:"#bdc3c7"}}," 配送区域以门店为中心设置服务半径，若要修改地址，请前往门店设置-->门店信息进行编辑修改 ",-1))])]),l("div",we,[i(Z,{ref_key:"mapRef",ref:A,center:w.value,radius:s.value.deliveryRadius,onUpdateRadius:H},null,8,["center","radius"]),e[9]||(e[9]=l("div",{class:"base-info mt20",style:{color:"#bdc3c7"}},"收货地址在配送范围之外的买家将不可下单",-1))]),l("div",Ve,[e[21]||(e[21]=l("span",{style:{color:"#919191"}},"配送价格：",-1)),l("div",Re,[i(o,{label:"起送价",prop:"minOrderAmount",rules:[{required:!0,message:"请输入起送价",trigger:"blur"}]},{default:r(()=>[i(n,{width:"160px",modelValue:s.value.minOrderAmount,"onUpdate:modelValue":e[1]||(e[1]=d=>s.value.minOrderAmount=d),type:"integer"},{append:r(()=>[...e[10]||(e[10]=[L("元",-1)])]),_:1},8,["modelValue"]),e[11]||(e[11]=l("span",{style:{color:"#b6babf"},class:"ml5"},"订单中的商品在优惠前的总金额（不包含运费）低于起送价时，买家将不能下单",-1))]),_:1}),i(o,{label:"基础运费",prop:"minOrderAmount",rules:[{required:!0,message:"请输入基础运费",trigger:"blur"}]},{default:r(()=>[i(n,{width:"160px",modelValue:s.value.baseDeliveryFee,"onUpdate:modelValue":e[2]||(e[2]=d=>s.value.baseDeliveryFee=d),type:"integer"},{append:r(()=>[...e[12]||(e[12]=[L("元",-1)])]),_:1},8,["modelValue"]),e[13]||(e[13]=l("span",{style:{color:"#b6babf"},class:"ml5"},"商家未设置叠加溢价规则时，则所有订单统一运费标准；商家可按配送服务半径设置叠加溢价规则",-1))]),_:1}),i(o,{label:"叠加溢价",prop:"distancePricingEnabled",rules:$},{default:r(()=>[l("div",ke,[i(p,{"true-value":1,"false-value":0,modelValue:s.value.distancePricingEnabled,"onUpdate:modelValue":e[3]||(e[3]=d=>s.value.distancePricingEnabled=d),onChange:D},{default:r(()=>[...e[14]||(e[14]=[L("开启叠加溢价",-1)])]),_:1},8,["modelValue"]),i(K,{effect:"dark",content:"最终费用 = 基础运费 + 叠加溢价",placement:"top"},{default:r(()=>[i(u,{color:"#b6babf",class:"ml5"},{default:r(()=>[i(N(ue))]),_:1})]),_:1})])]),_:1}),(h(!0),U(T,null,pe(s.value.distancePricingList,(d,v)=>(h(),ce(o,{label:v===0?"溢价规则":" ",key:v},{default:r(()=>[l("div",Ee,[e[16]||(e[16]=l("span",null,"超过",-1)),i(o,{prop:`distancePricingList.${v}.distanceThreshold`,rules:q(v),style:{display:"inline-block",margin:"0"}},{default:r(()=>[i(n,{width:"100px",modelValue:d.distanceThreshold,"onUpdate:modelValue":y=>d.distanceThreshold=y,type:"integer",class:"ml5 mr10"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"]),e[17]||(e[17]=l("span",null,"km，每增加",-1)),i(o,{prop:`distancePricingList.${v}.distanceUnit`,rules:j(),style:{display:"inline-block",margin:"0"}},{default:r(()=>[i(n,{width:"100px",modelValue:d.distanceUnit,"onUpdate:modelValue":y=>d.distanceUnit=y,type:"integer",class:"ml5 mr10"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"]),e[18]||(e[18]=l("span",null,"km，配送费增加",-1)),i(o,{prop:`distancePricingList.${v}.additionalFee`,rules:B(),style:{display:"inline-block",margin:"0"}},{default:r(()=>[i(n,{width:"100px",modelValue:d.additionalFee,"onUpdate:modelValue":y=>d.additionalFee=y,type:"integer",class:"ml5 mr10"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"]),e[19]||(e[19]=l("span",null,"元",-1)),i(P,{class:"ml10",link:"",type:"primary",onClick:y=>Y(v)},{default:r(()=>[...e[15]||(e[15]=[L("删除",-1)])]),_:1},8,["onClick"])])]),_:2},1032,["label"]))),128)),i(o,{label:" "},{default:r(()=>[i(P,{link:"",type:"primary",onClick:Q,disabled:!s.value.distancePricingEnabled},{default:r(()=>[...e[20]||(e[20]=[L("添加收费规则",-1)])]),_:1},8,["disabled"])]),_:1})])])])]}),_:1},8,["model"])]),_:1},8,["spinning"])]),l("div",{class:"selected-action-warp selected-warp-left",style:me({left:N(x).layout!=="topMenu"?"23.0625rem":"16.875rem"})},[l("div",Fe,[i(P,{loading:S.value,class:"form-submit-btn",size:"large",type:"primary",onClick:G},{default:r(()=>[...e[22]||(e[22]=[L("提 交",-1)])]),_:1},8,["loading"])])],4)],64)}}}),qe=fe(Ie,[["__scopeId","data-v-75802e79"]]);export{qe as default};

import{d as me,r as f,b as fe,ab as ce,c as ve,o as he,f as m,g as O,h as u,i as r,k as i,l as c,z as a,m as l,L as ge,j as _,W as ye,Q as p,t as b,F as _e,p as be,O as ke,P as C,_ as Ie}from"./index-B52YIGC0.js";import"./index-KjhYqCTY.js";import{F as N}from"./UploadAvatar.vue_vue_type_style_index_0_scoped_3ec2e0ca_lang-BGZZHoO-.js";import"./vuedraggable.umd-BauR0rTv.js";import{g as xe}from"./merchant-DFkOu60N.js";import{e as we,u as De}from"./shop-CBisV8Of.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-1fz1RqDZ.js";/* empty css                                                                    *//* empty css                                                                  *//* empty css                                                                              */import{S as Ce}from"./SelectRegion-B1dYo0k6.js";/* empty css             */import{M as Se}from"./MapContainer-C9hjajVp.js";import Te from"./BusinessHours-CjCjYR0K.js";import Le from"./BusinessMobile-CdydowP1.js";import{l as A}from"./lodash-DLXBIuYo.js";import{S as G}from"./StatusDot-DuKP0Xmc.js";import{_ as $}from"./DialogForm.vue_vue_type_script_setup_true_lang-CT6mpwCc.js";import"./index-C9ZdVeVx.js";import"./Image.vue_vue_type_script_setup_true_lang-B8qXJKJq.js";import"./format-BxqOrW-w.js";import"./BusinessImg-B_fZOjqm.js";import"./currencyManagement-DNysi_dA.js";/* empty css                                                                    */import"./time-EzYK4E-P.js";import"./region-BXYVi85_.js";import"./region-DzZbv6Nj.js";/* empty css                                                                     */import"./index-Wb8975_T.js";const Ve="/admin/assets/shopCoverPicture-Bs46SjRr.png",Re="/admin/assets/shopShowPicture-Vh1J7QNf.png",Me="/admin/assets/shopTips-D2V5P0y4.png",Pe={class:"container"},Oe={class:"content_wrapper"},Ne={class:"lyecs-form-table"},Ae={class:"ssdw"},Fe={class:"extra"},Be={class:"extra"},We={class:"map-container"},qe={key:0},Ue={class:"extra"},Ee=me({__name:"Info",props:{id:{type:Number,default:0},act:{type:String,default:""},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close"],setup(Q,{expose:z,emit:J}){const k=J,I=Q,S=f(),V=f(),F=f(),h=f(!0),R=fe().currentRoute.value.query,T=f(I.isDialog?I.act:String(R.act)),x=f(I.isDialog?I.id:Number(R.id)),B=T.value==="add"?"create":"update",W=ce(),q=f(!1),g=f([]),t=f({shopType:2,status:1,shopTips:[],shopTitle:"",merchantId:R.id??""}),K=ve(()=>t.value.shopLatitude&&t.value.shopLongitude?t.value.shopLongitude+","+t.value.shopLatitude:""),L=f(""),X=o=>{o.map(e=>{L.value+=e.regionName}),S.value.search(L.value)},Y=()=>{const o=L.value+t.value.shopDetailedAddress;o&&S.value.search(o)},Z=()=>{L.value="",t.value.shopRegionIds=[],t.value.shopDetailedAddress="",S.value.clearSearch()},ee=o=>{t.value.shopLongitude=o.position[0],t.value.shopLatitude=o.position[1],t.value.shopDetailedAddress=o.name},te=async()=>{g.value=[];try{const o=await we(T.value,{shopId:x.value});t.value=o,o.tips&&o.tips.length>0&&(g.value=o.tips)}catch(o){C.error(o.message),k("close")}finally{h.value=!1}},oe=async()=>{try{const o=await xe({merchantId:x.value});t.value.merchantId=x.value,w.value=o.records}catch(o){C.error(o.message),k("close")}},w=f([]),se=async o=>{w.value=o.merchant,t.value.merchantId=o.merchantId},ae=o=>{g.value=o.value};he(()=>{B==="update"?te():h.value=!1,w.value=[],t.value.merchantId=0,x.value!=0&&(q.value=!0,oe())});const le=o=>{let e=[];return o.forEach(n=>{n.checked&&n.mobiles.forEach(d=>{e.push({type:n.type,values:n.type!==3?`${d.code}-${d.value}`:d.value})})}),e},re=o=>{const e=A.cloneDeep(o);let n={};return n.type=e.type,e.type===1?n.times=[]:e.type===2?n.times=A.cloneDeep(e.times):e.type===3&&(n.times=A.cloneDeep(e.timesWeek),Array.isArray(n.times)&&n.times.length>0&&n.times.forEach(d=>{d.dayOfWeek&&Array.isArray(d.dayOfWeek)?d.dayOfWeek=d.dayOfWeek.join(","):d.dayOfWeek=[]})),n},U=async()=>{if(await W.value.validate(),await V.value.submit(),t.value.shopContactConfig=le(F.value.formData),t.value.shopOpenCloseConfig=re(V.value.formData),t.value.merchantId==0||t.value.merchantId==null||!t.value.merchantId){C.error("请选择所属商户!");return}g.value.length>0&&(t.value.shopTips=[],g.value.forEach(o=>{t.value.shopTips.push(o.tipId)}));try{k("update:confirmLoading",!0);const o=await De(B,{id:x.value,...t.value});k("submitCallback",o),C.success("操作成功")}catch(o){C.error(o.message)}finally{k("update:confirmLoading",!1)}};return z({onFormSubmit:()=>{U()}}),(o,e)=>{const n=m("el-button"),d=m("Tag"),D=m("el-table-column"),ne=m("el-table"),v=m("el-form-item"),M=m("el-popover"),P=m("TigInput"),ue=m("el-tag"),E=m("el-radio"),ie=m("el-radio-group"),pe=m("el-form"),de=m("a-spin");return u(),O("div",Pe,[r("div",Oe,[r("div",Ne,[h.value?c("",!0):(u(),i(pe,{key:0,ref_key:"formRef",ref:W,model:t.value,"label-width":"auto"},{default:l(()=>[_(ye)()=="admin"&&T.value=="add"?(u(),i(v,{key:0,label:"所属商户",prop:"merchantId",rules:[{required:!0,message:"请选择所属商户!"}]},{default:l(()=>[q.value?c("",!0):(u(),i(_($),{key:0,params:{isMultiple:!1,selectedIds:[t.value.merchantId]},isDrawer:"",path:"adminMerchant/merchant/src/SelectMerchant",title:"选择商户",width:"1100px",onOkCallback:se},{default:l(()=>[a(n,{type:"primary"},{default:l(()=>[...e[8]||(e[8]=[p("选择商户",-1)])]),_:1})]),_:1},8,["params"])),w.value.length>0?(u(),i(ne,{key:1,data:w.value,"row-key":"merchantId",class:"mt10"},{default:l(()=>[a(D,{label:"商户所属单位"},{default:l(({row:s})=>[r("div",Ae,[s.type==1?(u(),i(d,{key:0,transparent:!0,text:"个人"})):(u(),i(d,{key:1,color:"#409EFF",transparent:!1,text:"企业"})),p(" "+b(s.type==1?""+s.corporateName:""+s.companyName),1)])]),_:1}),a(D,{label:"商户所属会员(ID)"},{default:l(({row:s})=>{var y,H,j;return[p(b((y=s.user)==null?void 0:y.username)+b((H=s.user)!=null&&H.userId?"("+((j=s.user)==null?void 0:j.userId)+")":""),1)]}),_:1}),a(D,{label:"商户类型",prop:"typeText",sortable:"custom"}),a(D,{label:"管理员",sortable:"custom"},{default:l(({row:s})=>{var y;return[p(b(((y=s.admin)==null?void 0:y.username)||"--"),1)]}),_:1}),a(D,{label:"认证状态",prop:"statusText",sortable:"custom"},{default:l(({row:s})=>[s.status==1?(u(),i(G,{key:0,color:"#52c41a",flicker:!0})):c("",!0),s.status==2?(u(),i(G,{key:1,color:"#f5222d",flicker:!1})):c("",!0),p(" "+b(s.statusText),1)]),_:1})]),_:1},8,["data"])):c("",!0)]),_:1})):c("",!0),a(v,{label:"门店LOGO",prop:"shopLogo",rules:[{required:!0,message:"请上传门店LOGO!"}]},{default:l(()=>[h.value?c("",!0):(u(),i(_(N),{key:0,photo:t.value.shopLogo,"onUpdate:photo":e[0]||(e[0]=s=>t.value.shopLogo=s)},null,8,["photo"])),e[9]||(e[9]=r("div",{class:"extra"},"建议尺寸300x300",-1))]),_:1}),a(v,{label:"门头封面",prop:"shopCoverPicture",rules:[{required:!0,message:"请上传门头封面!"}]},{default:l(()=>[h.value?c("",!0):(u(),i(_(N),{key:0,photo:t.value.shopCoverPicture,"onUpdate:photo":e[1]||(e[1]=s=>t.value.shopCoverPicture=s)},null,8,["photo"])),r("div",Fe,[e[12]||(e[12]=p(" 您上传的图片，将作为用户端门店首页的头图，建议尺寸 1500x1500 ",-1)),a(M,{width:400,placement:"right-end",trigger:"click"},{reference:l(()=>[...e[10]||(e[10]=[r("a",null,"查看示例",-1)])]),default:l(()=>[...e[11]||(e[11]=[r("img",{src:Ve,style:{width:"380px"}},null,-1)])]),_:1})])]),_:1}),a(v,{label:"门店相册",prop:"shopShowPicture"},{default:l(()=>[h.value?c("",!0):(u(),i(_(N),{key:0,isMultiple:"",photos:t.value.shopShowPicture,"onUpdate:photos":e[2]||(e[2]=s=>t.value.shopShowPicture=s)},null,8,["photos"])),r("div",Be,[e[15]||(e[15]=p(" 您上传的图片将在用户端作为相册展示给客户，您可以通过拖拽来调整相册图片顺序 ",-1)),a(M,{width:400,placement:"right-end",trigger:"click"},{reference:l(()=>[...e[13]||(e[13]=[r("a",null,"查看示例",-1)])]),default:l(()=>[...e[14]||(e[14]=[r("img",{src:Re,style:{width:"380px"}},null,-1)])]),_:1})])]),_:1}),a(v,{label:"门店名称",prop:"shopTitle",rules:[{required:!0,message:"门店名称不能为空!"}]},{default:l(()=>[a(P,{classType:"tig-form-input",modelValue:t.value.shopTitle,"onUpdate:modelValue":e[3]||(e[3]=s=>t.value.shopTitle=s),maxlength:100,showWordLimit:""},null,8,["modelValue"])]),_:1}),a(v,{label:"门店公告",prop:"description"},{default:l(()=>[a(P,{width:"90%",placeholder:"请填写门店公告",modelValue:t.value.description,"onUpdate:modelValue":e[4]||(e[4]=s=>t.value.description=s),type:"textarea",maxlength:200,showWordLimit:"",rows:4},null,8,["modelValue"]),e[16]||(e[16]=r("div",{class:"extra"},"请填写门店简介，该简介会显示在用户门店详细中",-1))]),_:1}),a(v,{label:"门店地址",prop:"shopRegionIds",rules:[{required:!0,message:"请选择门店地址!"}]},{default:l(()=>[r("div",null,[T.value=="add"||!h.value?(u(),i(_(Ce),{key:0,selectedIds:t.value.shopRegionIds,"onUpdate:selectedIds":e[5]||(e[5]=s=>t.value.shopRegionIds=s),onChange:X,onClear:Z,style:{width:"260px","margin-bottom":"10px"}},null,8,["selectedIds"])):c("",!0),a(P,{width:"500px",placeholder:"详细地址",modelValue:t.value.shopDetailedAddress,"onUpdate:modelValue":e[6]||(e[6]=s=>t.value.shopDetailedAddress=s),onInput:Y},null,8,["modelValue"]),r("div",We,[a(Se,{ref_key:"MapRef",ref:S,defaultPosition:K.value,onPositionChange:ee},null,8,["defaultPosition"])])])]),_:1}),a(v,{label:"门店标签",prop:"shopTips"},{default:l(()=>[r("div",null,[g.value?(u(),O("div",qe,[(u(!0),O(_e,null,be(g.value,(s,y)=>(u(),i(ue,{key:y,class:"mr10"},{default:l(()=>[p(b(s.tipName),1)]),_:2},1024))),128))])):c("",!0),r("div",null,[a(_($),{params:{selectedIds:g.value},isDrawer:"",path:"store/adminPages/storeTipManage/src/SelectTips",title:"选择标签",width:"600px",onOkCallback:ae},{default:l(()=>[a(n,{link:"",type:"primary"},{default:l(()=>[...e[17]||(e[17]=[p(" 选择标签 ",-1)])]),_:1})]),_:1},8,["params"])]),r("div",Ue,[e[20]||(e[20]=p(" 门店标签将显示在门店列表及门店首页中 ",-1)),a(M,{width:400,placement:"right-end",trigger:"click"},{reference:l(()=>[...e[18]||(e[18]=[r("a",null,"查看示例",-1)])]),default:l(()=>[...e[19]||(e[19]=[r("img",{src:Me,style:{width:"380px"}},null,-1)])]),_:1})])])]),_:1}),a(v,{label:"营业状态",prop:"status",required:""},{default:l(()=>[a(ie,{modelValue:t.value.status,"onUpdate:modelValue":e[7]||(e[7]=s=>t.value.status=s)},{default:l(()=>[a(E,{value:1},{default:l(()=>[...e[21]||(e[21]=[p("开业",-1)])]),_:1}),a(E,{value:4},{default:l(()=>[...e[22]||(e[22]=[p("停业",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(Le,{formData:t.value.shopContactConfig,ref_key:"businessMobileRef",ref:F},null,8,["formData"]),a(Te,{formData:t.value.shopOpenCloseConfig,ref_key:"businessHoursRef",ref:V},null,8,["formData"]),ge(a(v,{"wrapper-col":{offset:4,span:16}},{default:l(()=>[a(n,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:U},{default:l(()=>[...e[23]||(e[23]=[p("提交",-1)])]),_:1},512)]),_:1},512),[[ke,!I.isDialog]])]),_:1},8,["model"])),a(de,{spinning:h.value,style:{width:"100%","margin-top":"100px"}},null,8,["spinning"])])])])}}}),_t=Ie(Ee,[["__scopeId","data-v-f3d053d6"]]);export{_t as default};

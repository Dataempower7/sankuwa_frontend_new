import{d as ae,r as p,b as se,ab as le,c as re,o as ue,f as d,g as h,h as u,i as k,k as m,l as n,z as s,m as l,L as ne,j as y,W as U,Q as f,t as I,O as ie,P as T,_ as pe}from"./index-B52YIGC0.js";import{_ as de}from"./Image.vue_vue_type_script_setup_true_lang-B8qXJKJq.js";import"./index-KjhYqCTY.js";import{F as me}from"./UploadAvatar.vue_vue_type_style_index_0_scoped_3ec2e0ca_lang-BGZZHoO-.js";import"./vuedraggable.umd-BauR0rTv.js";import{e as fe,u as ce}from"./shop-CBisV8Of.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-1fz1RqDZ.js";/* empty css                                                                    *//* empty css                                                                  *//* empty css                                                                              */import{S as ve}from"./SelectRegion-B1dYo0k6.js";/* empty css             */import{M as he}from"./MapContainer-C9hjajVp.js";import ye from"./BusinessHours-CjCjYR0K.js";import _e from"./BusinessMobile-CdydowP1.js";import{l as V}from"./lodash-DLXBIuYo.js";import{S as O}from"./StatusDot-DuKP0Xmc.js";import{_ as ge}from"./DialogForm.vue_vue_type_script_setup_true_lang-CT6mpwCc.js";import"./format-BxqOrW-w.js";import"./index-C9ZdVeVx.js";import"./BusinessImg-B_fZOjqm.js";import"./currencyManagement-DNysi_dA.js";/* empty css                                                                    */import"./time-EzYK4E-P.js";import"./region-BXYVi85_.js";import"./region-DzZbv6Nj.js";/* empty css                                                                     */import"./index-Wb8975_T.js";const be={class:"container"},ke={class:"content_wrapper"},Ie={class:"lyecs-form-table"},De={key:0},Ce={key:0},Le={key:1},xe={key:3,style:{color:"red"}},Se={key:4,style:{color:"green"}},Te={class:"map-container"},Re=ae({__name:"Info",props:{id:{type:Number,default:0},act:{type:String,default:""},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close"],setup(E,{expose:G,emit:H}){const D=p(1),C=H,_=E,L=p(),R=p(),P=p(),v=p(!0),M=se().currentRoute.value.query,g=p(_.isDialog?_.act:String(M.act)),A=p(_.isDialog?_.id:Number(M.id)),N=g.value==="add"?"create":"update",w=le(),t=p({shopType:3,status:1,shopTitle:""}),$=re(()=>t.value.shopLatitude&&t.value.shopLongitude?t.value.shopLongitude+","+t.value.shopLatitude:""),x=p(""),j=a=>{a.map(e=>{x.value+=e.regionName}),L.value.search(x.value)},z=()=>{const a=x.value+t.value.shopDetailedAddress;a&&L.value.search(a)},Q=()=>{x.value="",t.value.shopRegionIds=[],t.value.shopDetailedAddress="",t.value.shopLongitude="",t.value.shopLatitude="",L.value.clearSearch()},J=a=>{t.value.shopLongitude=a.position[0],t.value.shopLatitude=a.position[1],t.value.shopDetailedAddress=a.name},K=async()=>{try{const a=await fe(g.value,{shopId:A.value});a.shopTitle=a.shopTitle.replace("（自提点）",""),Object.assign(t.value,a)}catch(a){T.error(a.message),C("close")}finally{v.value=!1}},S=p([]),X=async a=>{S.value=a.shopInfo,t.value.storeParentId=a.shopId};ue(()=>{N==="update"?K():v.value=!1,S.value=[],t.value.storeParentId=0});const Y=a=>{let e=[];return a.forEach(r=>{r.checked&&r.mobiles.forEach(i=>{e.push({type:r.type,values:r.type!==3?`${i.code}-${i.value}`:i.value})})}),e},Z=a=>{const e=V.cloneDeep(a);let r={};return r.type=e.type,e.type===1?r.times=[]:e.type===2?r.times=V.cloneDeep(e.times):e.type===3&&(r.times=V.cloneDeep(e.timesWeek),Array.isArray(r.times)&&r.times.length>0&&r.times.forEach(i=>{i.dayOfWeek&&Array.isArray(i.dayOfWeek)?i.dayOfWeek=i.dayOfWeek.join(","):i.dayOfWeek=[]})),r},q=async()=>{if(await w.value.validate(),await R.value.submit(),t.value.shopContactConfig=Y(P.value.formData),t.value.shopOpenCloseConfig=Z(R.value.formData),D.value==2&&(t.value.storeParentId==0||t.value.storeParentId==null||!t.value.storeParentId)){T.error("请选择所属商户!");return}t.value.shopTitle+="（自提点）";try{C("update:confirmLoading",!0);const a=await ce(N,{id:A.value,...t.value});C("submitCallback",a),T.success("操作成功")}catch(a){T.error(a.message)}finally{C("update:confirmLoading",!1)}};return G({onFormSubmit:()=>{q()}}),(a,e)=>{const r=d("el-radio"),i=d("el-radio-group"),c=d("el-form-item"),B=d("el-button"),b=d("el-table-column"),ee=d("el-table"),W=d("TigInput"),te=d("el-form"),oe=d("a-spin");return u(),h("div",be,[k("div",ke,[k("div",Ie,[v.value?n("",!0):(u(),m(te,{key:0,ref_key:"formRef",ref:w,model:t.value,"label-width":"auto"},{default:l(()=>[y(U)()=="admin"&&g.value=="add"?(u(),m(c,{key:0,label:"所属类型",prop:"status",required:""},{default:l(()=>[s(i,{modelValue:D.value,"onUpdate:modelValue":e[0]||(e[0]=o=>D.value=o)},{default:l(()=>[s(r,{value:1},{default:l(()=>[...e[6]||(e[6]=[f("平台自营",-1)])]),_:1}),s(r,{value:2},{default:l(()=>[...e[7]||(e[7]=[f("门店自营",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})):n("",!0),y(U)()=="admin"&&g.value=="add"&&D.value==2?(u(),m(c,{key:1,label:"所属门店",prop:"storeParentId",rules:[{required:!0,message:"请选择所属门店!"}]},{default:l(()=>[s(y(ge),{params:{isMultiple:!1,selectedIds:[t.value.storeParentId]},isDrawer:"",path:"store/adminPages/selfPackManage/src/SelectStoreList",title:"选择门店",width:"700px",onOkCallback:X},{default:l(()=>[s(B,{type:"primary"},{default:l(()=>[...e[8]||(e[8]=[f("选择门店",-1)])]),_:1})]),_:1},8,["params"]),S.value.length>0?(u(),m(ee,{key:0,data:S.value,"row-key":"storeParentId",class:"mt10"},{default:l(()=>[s(b,{label:"门店名称"},{default:l(({row:o})=>[f(I(o.shopTitle||"--"),1)]),_:1}),s(b,{label:"门店LOGO"},{default:l(({row:o})=>[s(y(de),{src:o.shopLogo,fit:"contain",style:{height:"25px",width:"60px"}},null,8,["src"])]),_:1}),s(b,{label:"商户名称",width:200},{default:l(({row:o})=>{var F;return[o.merchant?(u(),h("div",De,[o.merchant.type==2?(u(),h("span",Ce,I(((F=o.merchant.merchantData)==null?void 0:F.merchantName)||"--"),1)):n("",!0),o.merchant.type==1?(u(),h("span",Le,I(o.merchant.corporateName||"--"),1)):n("",!0)])):n("",!0)]}),_:1}),s(b,{label:"门店状态",sortable:"custom"},{default:l(({row:o})=>[o.status==10?(u(),m(O,{key:0,color:"red",flicker:!0})):n("",!0),o.status==4?(u(),m(O,{key:1,color:"red",flicker:!0})):n("",!0),o.status==1?(u(),m(O,{key:2,color:"green",flicker:!0})):n("",!0),o.status===10||o.status===4?(u(),h("span",xe,I(o.statusText),1)):o.status===1?(u(),h("span",Se,I(o.statusText),1)):n("",!0)]),_:1}),s(b,{label:"认证日期",prop:"addTime",sortable:"custom"})]),_:1},8,["data"])):n("",!0)]),_:1})):n("",!0),s(c,{label:"自提点LOGO",prop:"shopLogo",rules:[{required:!0,message:"请上传自提点LOGO!"}]},{default:l(()=>[v.value?n("",!0):(u(),m(y(me),{key:0,photo:t.value.shopLogo,"onUpdate:photo":e[1]||(e[1]=o=>t.value.shopLogo=o)},null,8,["photo"])),e[9]||(e[9]=k("div",{class:"extra"},"建议尺寸100x100",-1))]),_:1}),s(c,{label:"自提点名称",prop:"shopTitle",rules:[{required:!0,message:"自提点名称不能为空!"}]},{default:l(()=>[s(W,{classType:"tig-form-input",modelValue:t.value.shopTitle,"onUpdate:modelValue":e[2]||(e[2]=o=>t.value.shopTitle=o),maxlength:100,showWordLimit:""},{append:l(()=>[...e[10]||(e[10]=[f(" （自提点） ",-1)])]),_:1},8,["modelValue"])]),_:1}),s(c,{label:"营业状态",prop:"status",required:""},{default:l(()=>[s(i,{modelValue:t.value.status,"onUpdate:modelValue":e[3]||(e[3]=o=>t.value.status=o)},{default:l(()=>[s(r,{value:1},{default:l(()=>[...e[11]||(e[11]=[f("启用",-1)])]),_:1}),s(r,{value:10},{default:l(()=>[...e[12]||(e[12]=[f("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),s(c,{label:"自提点地址",prop:"shopRegionIds",rules:[{required:!0,message:"请选择自提点地址!"}]},{default:l(()=>[k("div",null,[g.value=="add"||!v.value?(u(),m(y(ve),{key:0,selectedIds:t.value.shopRegionIds,"onUpdate:selectedIds":e[4]||(e[4]=o=>t.value.shopRegionIds=o),onChange:j,onClear:Q,style:{width:"260px","margin-bottom":"10px"}},null,8,["selectedIds"])):n("",!0),s(W,{width:"500px",placeholder:"详细地址",modelValue:t.value.shopDetailedAddress,"onUpdate:modelValue":e[5]||(e[5]=o=>t.value.shopDetailedAddress=o),onInput:z},null,8,["modelValue"]),k("div",Te,[s(he,{ref_key:"MapRef",ref:L,defaultPosition:$.value,onPositionChange:J},null,8,["defaultPosition"])])])]),_:1}),s(_e,{formData:t.value.shopContactConfig,ref_key:"businessMobileRef",ref:P},null,8,["formData"]),s(ye,{formData:t.value.shopOpenCloseConfig,ref_key:"businessHoursRef",ref:R},null,8,["formData"]),ne(s(c,{"wrapper-col":{offset:4,span:16}},{default:l(()=>[s(B,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:q},{default:l(()=>[...e[13]||(e[13]=[f("提交",-1)])]),_:1},512)]),_:1},512),[[ie,!_.isDialog]])]),_:1},8,["model"])),s(oe,{spinning:v.value,style:{width:"100%","margin-top":"100px"}},null,8,["spinning"])])])])}}}),lt=pe(Re,[["__scopeId","data-v-60cb8e3d"]]);export{lt as default};

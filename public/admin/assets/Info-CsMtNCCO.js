import{d as $,r as t,a as z,a2 as K,o as A,K as c,e as b,f as y,g as n,h as L,j as _,k as G,l as i,z as d,F as C,m as B,t as H,i as N}from"./index-BLXOA87U.js";import{b as J,g as P,u as Q}from"./promoter-CsD8c1kZ.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-BfFy9xcT.js";import"./index-DpgvsnVO.js";/* empty css                                                                    *//* empty css                                                                  *//* empty css                                                                              */import{g as T}from"./user-x3qW2Zo8.js";import{a as W,_ as X}from"./SelectPromoteMode.vue_vue_type_script_setup_true_lang-Bjrxr0tW.js";import"./time-DX2Q3n6c.js";import"./index-B16C4gX_.js";/* empty css             */import"./subgroup-oUMrWUeM.js";import"./promoteMode-BWxoWwor.js";const Y={class:"container"},Z={class:"content_wrapper"},ee={class:"lyecs-form-table"},ae={key:1},be=$({__name:"Info",props:{id:{type:Number,default:0},act:{type:String,default:""},isDialog:{type:Boolean,default:!1}},emits:["submitCallback","update:confirmLoading","close"],setup(R,{expose:D,emit:F}){const p=F,f=R,I=t(!0),U=z().currentRoute.value.query,v=t(f.isDialog?f.act:String(U.act)),S=t(f.isDialog?f.id:Number(U.id)),q=v.value==="add"?"create":"update",O=K(),a=t({}),k=t(!1),h=t([]),E=async e=>{try{if(e){k.value=!0;const r=await T({keyword:e});r.records.forEach(l=>{l.value=l.userId,l.key=l.userId,l.label=l.username}),h.value=r.records}else h.value=[]}catch(s){c.error(s.message)}finally{k.value=!1}},V=t([]),w=t(!1),x=async e=>{try{if(e){w.value=!0;const r=await P({mobile:e});r.records.forEach(l=>{var u,g;l.value=l.salesmanId,l.key=l.salesmanId,l.label=((u=l.baseUserInfo)==null?void 0:u.nickname)||((g=l.baseUserInfo)==null?void 0:g.username)}),V.value=r.records}else V.value=[]}catch(s){c.error(s.message)}finally{w.value=!1}};A(()=>{v.value==="detail"?j():I.value=!1});const j=async()=>{try{const e=await J(v.value,{id:S.value});(e.salesmanVO.pid==0||e.salesmanVO.pid==null)&&(e.salesmanVO.pid=""),Object.assign(a.value,e.salesmanVO),a.value.userId=e.salesmanVO.baseUserInfo?String(e.salesmanVO.baseUserInfo.userId):"",a.value.nickname=e.salesmanVO.baseUserInfo?e.salesmanVO.baseUserInfo.nickname:"",a.value.pidUserInfo&&x(a.value.pidUserInfo.baseUserInfo.mobile||"")}catch(e){c.error(e.message),p("close")}finally{I.value=!1}},M=async()=>{await O.value.validate();try{p("update:confirmLoading",!0);const e=await Q(q,{id:S.value,...a.value});p("submitCallback",e),c.success("操作成功")}catch(e){c.error(e.message)}finally{p("update:confirmLoading",!1)}};return D({onFormSubmit:()=>{M()}}),(e,s)=>{const r=b("el-option"),l=b("el-select"),u=b("el-form-item"),g=b("el-form");return n(),y("div",Y,[L("div",Z,[L("div",ee,[I.value?G("",!0):(n(),_(g,{key:0,ref_key:"formRef",ref:O,model:a.value,"label-width":"auto"},{default:i(()=>[d(u,{prop:"userId",label:"绑定账号",rules:[{required:!0,message:"请选择账号",trigger:"change"}]},{default:i(()=>{var o;return[v.value==="add"?(n(),_(l,{key:0,style:{width:"400px"},modelValue:a.value.userId,"onUpdate:modelValue":s[0]||(s[0]=m=>a.value.userId=m),filterable:"",remote:"","reserve-keyword":"",placeholder:"可输入手机号查询绑定会员","remote-method":E,loading:k.value},{default:i(()=>[(n(!0),y(C,null,B(h.value,m=>(n(),_(r,{key:m.key,label:m.label+"("+m.mobile+")",value:m.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])):(n(),y("p",ae,H(a.value.nickname||((o=a.value.baseUserInfo)==null?void 0:o.username)||"--"),1))]}),_:1}),d(u,{prop:"level",label:"等级",rules:[{required:!0,message:"请选择分销员等级",trigger:"change"}]},{default:i(()=>[d(N(W),{style:{width:"400px"},level:a.value.level,"onUpdate:level":s[1]||(s[1]=o=>a.value.level=o)},null,8,["level"])]),_:1}),d(u,{prop:"groupId",label:"分组",rules:[{required:!0,message:"请选择分销员分组",trigger:"change"}]},{default:i(()=>[d(N(X),{style:{width:"400px"},groupId:a.value.groupId,"onUpdate:groupId":s[2]||(s[2]=o=>a.value.groupId=o)},null,8,["groupId"])]),_:1}),d(u,{prop:"nickname",label:"上级分销员"},{default:i(()=>[d(l,{style:{width:"400px"},modelValue:a.value.pid,"onUpdate:modelValue":s[3]||(s[3]=o=>a.value.pid=o),filterable:"",remote:"","reserve-keyword":"",placeholder:"可输入手机号查询上级分销员","remote-method":x,loading:w.value},{default:i(()=>[(n(!0),y(C,null,B(V.value,o=>(n(),_(r,{key:o.key,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1},8,["model"]))])])])}}});export{be as default};

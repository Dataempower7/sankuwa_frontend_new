import{d as R,v as $,ab as D,r as a,c as M,f as v,g as w,h as y,i as m,z as s,m as l,Q as O,t as g,l as V,q as j,eB as F,P as p,eC as Q}from"./index-B52YIGC0.js";import{_ as Z}from"./Verify.vue_vue_type_script_setup_true_lang-PjsVF6v4.js";import"./Verify.vue_vue_type_style_index_0_lang-BAuPCCIW.js";import"./index-C9ZdVeVx.js";const G={class:"container"},H={class:"content_wrapper"},J={class:"lyecs-form-table"},K={key:1,class:"code-text"},oe=R({__name:"Info",props:{id:{type:Number,default:0},form:{type:Object,default:{}},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close"],setup(k,{expose:x,emit:h}){const c=h,{logout:S}=$(),z=k,_=D(),r=a({mobile:z.form.mobile,code:"",password:"",pwdConfirm:""}),B=a("获取验证码"),u=a(!0),i=a(60),b=a(),d=a(null),E=t=>{d.value=t.verifyToken,C()},C=async()=>{if(!d.value){b.value.show();return}try{const t=await F({type:"code",verifyToken:d.value});p.success("验证码发送成功"),u.value=!1,d.value=null,P()}catch(t){p.error(t.message)}},I=(t,e,o)=>{if(!e){o(new Error("确认密码不能为空"));return}r.value.password==e?o():o("两次密码输入不一致")},N=(t,e,o)=>{e===""?o(new Error("请输入密码")):e.length<8?o(new Error("密码长度至少为8位")):/^\d+$/.test(e)||/^[a-zA-Z]+$/.test(e)?o(new Error("密码不能是纯数字或纯字母")):o()},q=M(()=>i.value+"秒后重发"),T=a(),P=()=>{T.value=setInterval(()=>{i.value--,i.value<=0&&(clearInterval(T.value),u.value=!0,i.value=60)},1e3)},U=async()=>{await _.value.validate();try{c("update:confirmLoading",!0);const t=await Q({modifyType:2,...r.value});c("submitCallback",t),p.success("修改成功"),S()}catch(t){p.error(t.message)}finally{c("update:confirmLoading",!1)}},A=()=>{U()};return a(""),x({onFormSubmit:A}),(t,e)=>{const o=v("el-form-item"),f=v("TigInput"),L=v("el-form");return y(),w("div",G,[m("div",H,[m("div",J,[s(L,{ref_key:"formRef",ref:_,model:r.value,"label-width":"auto"},{default:l(()=>[s(o,{label:"手机号："},{default:l(()=>[O(g(r.value.mobile),1)]),_:1}),s(o,{label:"获取验证码：",prop:"code",rules:[{required:!0,message:"验证码不能为空!",trigger:"blur"}]},{default:l(()=>[s(f,{classType:"tig-form-input",modelValue:r.value.code,"onUpdate:modelValue":e[0]||(e[0]=n=>r.value.code=n)},{append:l(()=>[u.value?(y(),w("div",{key:0,class:"code-btn",onClick:j(C,["stop"])},g(B.value),1)):V("",!0),u.value?V("",!0):(y(),w("div",K,g(q.value),1))]),_:1},8,["modelValue"])]),_:1}),s(o,{label:"新密码：",prop:"password",rules:[{required:!0,validator:N,trigger:"blur"}]},{default:l(()=>[s(f,{classType:"tig-form-input",type:"password",modelValue:r.value.password,"onUpdate:modelValue":e[1]||(e[1]=n=>r.value.password=n)},null,8,["modelValue"]),e[3]||(e[3]=m("div",{class:"extra"},"密码长度至少为8位，并且不能是纯数字或纯字母。",-1))]),_:1},8,["rules"]),s(o,{label:"确认密码：",prop:"pwdConfirm",rules:[{required:!0,validator:I,trigger:"blur"}]},{default:l(()=>[s(f,{classType:"tig-form-input",type:"password",modelValue:r.value.pwdConfirm,"onUpdate:modelValue":e[2]||(e[2]=n=>r.value.pwdConfirm=n)},null,8,["modelValue"]),e[4]||(e[4]=m("div",{class:"extra"},"请再次输入密码，确保与上次输入一致。",-1))]),_:1},8,["rules"])]),_:1},8,["model"]),s(Z,{ref_key:"verify",ref:b,mode:"pop",captchaType:"blockPuzzle",imgSize:{width:"310px",height:"155px"},onOkCallback:E},null,512)])])])}}});export{oe as default};

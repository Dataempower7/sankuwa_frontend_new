import{d as F,r as f,b as O,ab as j,o as z,Y as M,f as d,g as P,h as D,i as u,k as Q,l as W,z as l,m as t,L as Y,Q as c,O as h,P as b,_ as A}from"./index-B52YIGC0.js";import{c as G,u as H}from"./appointmentTpl-DplhS7jl.js";const J={class:"container"},K={class:"content_wrapper"},X={class:"ml10"},Z={class:"flex flex-align-center"},$={class:"flex flex-align-center ml10"},ee={class:"flex flex-align-center ml10"},ae=F({__name:"Info",props:{id:{type:Number,default:0},act:{type:String,default:""},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close"],setup(T,{expose:U,emit:R}){const v=R,m=T,p=f(!0),_=O().currentRoute.value.query,y=f(m.isDialog?m.act:String(_.act)),x=f(m.isDialog?m.id:Number(_.id)),S=y.value==="add"?"create":"update",g=j(),e=f({templateName:"",reservationType:0,advanceNumber:0,advanceUnit:"d",maxDays:0}),C=async()=>{try{const o=await G(y.value,{id:x.value});Object.assign(e.value,o)}catch(o){b.error(o.message),v("close")}finally{p.value=!1}},B=(o,a,s)=>{let n=Number(e.value.advanceNumber),i=Number(e.value.maxDays);e.value.advanceUnit=="h"&&(i=e.value.maxDays?Number(e.value.maxDays)*24:0),e.value.reservationType==1&&!Number(e.value.advanceNumber)?s(new Error("提前预约天数不能为空或为0!")):n&&i&&n>=i?s(new Error("提前预约时间需小于最长预约时间!")):s()},E=(o,a,s)=>{let n=e.value.advanceNumber,i=e.value.maxDays;e.value.advanceUnit=="d"&&(n=e.value.advanceNumber?Number(e.value.advanceNumber)*24:""),i=e.value.maxDays?Number(e.value.maxDays)*24:"",console.log(!Number(e.value.maxDays)),e.value.maxDays&&!Number(e.value.maxDays)?s(new Error("最长预约天数不能为空或为0!")):n&&i&&n>=i?s(new Error("最长预约时间需大于提前预约时间!")):e.value.maxDays&&Number(e.value.maxDays)>30?s(new Error("最长预约天数不能超过30天!")):s()},N=async()=>{await g.value.validate();try{v("update:confirmLoading",!0);const o=await H(S,{reservationTplId:x.value,...e.value});v("submitCallback",o),b.success("操作成功")}catch(o){b.error(o.message)}finally{v("update:confirmLoading",!1)}};return U({onFormSubmit:()=>{N()}}),z(async()=>{y.value==="detail"?await C():p.value=!1}),M(()=>e.value.reservationType,o=>{o===0&&(e.value.advanceNumber="")}),(o,a)=>{const s=d("TigInput"),n=d("el-form-item"),i=d("el-radio"),w=d("el-radio-group"),V=d("el-option"),I=d("el-select"),q=d("el-button"),L=d("el-form"),k=d("a-spin");return D(),P("div",J,[u("div",K,[p.value?W("",!0):(D(),Q(L,{key:0,ref_key:"formRef",ref:g,model:e.value,"label-width":"auto"},{default:t(()=>[l(n,{rules:[{required:!0,message:"模板名称不能为空!"}],label:"模板名称",prop:"templateName"},{default:t(()=>[l(s,{width:"300px",modelValue:e.value.templateName,"onUpdate:modelValue":a[0]||(a[0]=r=>e.value.templateName=r),placeholder:"请输入模板名称，最多20个字",maxlength:20,showWordLimit:""},null,8,["modelValue"])]),_:1}),l(n,{label:"预约时间",prop:"reservationType",rules:[{required:e.value.reservationType==1,validator:B}]},{default:t(()=>[u("div",X,[u("div",null,[l(w,{modelValue:e.value.reservationType,"onUpdate:modelValue":a[1]||(a[1]=r=>e.value.reservationType=r)},{default:t(()=>[l(i,{value:0},{default:t(()=>[...a[6]||(a[6]=[c("无需提前",-1)])]),_:1})]),_:1},8,["modelValue"])]),u("div",Z,[l(w,{modelValue:e.value.reservationType,"onUpdate:modelValue":a[2]||(a[2]=r=>e.value.reservationType=r)},{default:t(()=>[l(i,{value:1},{default:t(()=>[...a[7]||(a[7]=[c("需提前",-1)])]),_:1})]),_:1},8,["modelValue"]),u("div",$,[l(s,{width:"160px",modelValue:e.value.advanceNumber,"onUpdate:modelValue":a[4]||(a[4]=r=>e.value.advanceNumber=r),type:"integer",disabled:e.value.reservationType!=1},{append:t(()=>[l(I,{modelValue:e.value.advanceUnit,"onUpdate:modelValue":a[3]||(a[3]=r=>e.value.advanceUnit=r),style:{width:"80px"},disabled:e.value.reservationType!=1},{default:t(()=>[l(V,{label:"天",value:"d"}),l(V,{label:"小时",value:"h"})]),_:1},8,["modelValue","disabled"])]),_:1},8,["modelValue","disabled"]),a[8]||(a[8]=u("p",{class:"ml10"},"预约",-1))])])])]),_:1},8,["rules"]),l(n,{label:"最长预约",prop:"maxDays",rules:[{required:!0,validator:E}]},{default:t(()=>[u("div",null,[u("div",ee,[a[10]||(a[10]=u("p",{class:"mr10"},"最长允许预约",-1)),l(s,{width:"160px",modelValue:e.value.maxDays,"onUpdate:modelValue":a[5]||(a[5]=r=>e.value.maxDays=r),type:"integer",maxNum:30},{append:t(()=>[...a[9]||(a[9]=[c(" 天 ",-1)])]),_:1},8,["modelValue"]),a[11]||(a[11]=u("p",{class:"ml10"},"内的订单",-1))]),a[12]||(a[12]=u("div",{class:"extra ml10"},"如：最长预约7天内订单，则买家最早可以选择当天+未来6天内的预约时间",-1))])]),_:1},8,["rules"]),Y(l(n,{"wrapper-col":{offset:4,span:16}},{default:t(()=>[l(q,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:N},{default:t(()=>[...a[13]||(a[13]=[c("提交",-1)])]),_:1},512)]),_:1},512),[[h,!m.isDialog]])]),_:1},8,["model"])),l(k,{spinning:p.value,style:{width:"100%","margin-top":"100px"}},null,8,["spinning"])])])}}}),se=A(ae,[["__scopeId","data-v-e26f5aba"]]);export{se as default};

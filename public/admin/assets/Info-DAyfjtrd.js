import{d as x,r as n,b as D,ab as P,o as R,P as i,f as d,g as h,h as b,i as I,k as G,l as L,m as u,z as r,L as O,j as T,Q as U,O as q}from"./index-B52YIGC0.js";import{a as j,u as F}from"./productGift-BHesvM8X.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-1fz1RqDZ.js";import"./index-KjhYqCTY.js";import{S as J}from"./SelectProduct-C4WsEKWV.js";/* empty css                                                                    *//* empty css                                                                              *//* empty css                                                                     *//* empty css             */import"./time-EzYK4E-P.js";import"./index-C9ZdVeVx.js";import"./format-BxqOrW-w.js";import"./product-hE35r0Q_.js";import"./Pagination-C8J7-6Em.js";import"./SelectSku-ZXdrD9qH.js";/* empty css                                                                  */import"./DialogForm.vue_vue_type_script_setup_true_lang-CT6mpwCc.js";const M={class:"container"},z={class:"content_wrapper"},E={class:"lyecs-form-table"},nt=x({__name:"Info",props:{id:{type:Number,default:0},act:{type:String,default:""},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close"],setup(_,{expose:S,emit:y}){const l=y,s=_,c=n(!0),f=D().currentRoute.value.query,m=n(s.isDialog?s.act:String(f.act)),g=n(s.isDialog?s.id:Number(f.id)),N=m.value==="add"?"create":"update",v=P(),o=n({productId:"",skuId:"",giftName:"",giftStock:1});R(()=>{m.value==="detail"?w():c.value=!1});const w=async()=>{try{const t=await j(m.value,{giftId:g.value});t.productId&&(t.productId=[t.productId]),Object.assign(o.value,t)}catch(t){i.error(t.message),l("close")}finally{c.value=!1}},k=async()=>{await v.value.validate();try{l("update:confirmLoading",!0);let t=JSON.parse(JSON.stringify(o.value));if(t.productId&&t.productId.length>0)t.productId=t.productId[0];else{i.error("请选择商品!");return}if(t.giftStock>0){const e=await F(N,{id:g.value,...t});l("submitCallback",e),i.success("操作成功")}else{i.error("赠品库存必须大于0");return}}catch(t){i.error(t.message)}finally{l("update:confirmLoading",!1)}};return S({onFormSubmit:()=>{k()}}),(t,e)=>{const C=d("TigInput"),p=d("el-form-item"),V=d("el-button"),B=d("el-form");return b(),h("div",M,[I("div",z,[I("div",E,[c.value?L("",!0):(b(),G(B,{key:0,ref_key:"formRef",ref:v,model:o.value,"label-width":"auto"},{default:u(()=>[r(p,{prop:"giftName",label:"赠品名称",rules:[{required:!0,message:"赠品名称不能为空!"}]},{default:u(()=>[r(C,{modelValue:o.value.giftName,"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.giftName=a),classType:"tig-form-input"},null,8,["modelValue"])]),_:1}),r(p,{prop:"productInfo",label:"选择商品"},{default:u(()=>[r(T(J),{isSku:!0,isSelf:1,isGift:!0,isMultiple:!1,ids:o.value.productId,"onUpdate:ids":e[1]||(e[1]=a=>o.value.productId=a),skuId:o.value.skuId,"onUpdate:skuId":e[2]||(e[2]=a=>o.value.skuId=a),skuStock:o.value.giftStock,"onUpdate:skuStock":e[3]||(e[3]=a=>o.value.giftStock=a)},null,8,["ids","skuId","skuStock"])]),_:1}),O(r(p,{"wrapper-col":{offset:4,span:16}},{default:u(()=>[r(V,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:k},{default:u(()=>[...e[4]||(e[4]=[U("提交",-1)])]),_:1},512)]),_:1},512),[[q,!s.isDialog]])]),_:1},8,["model"]))])])])}}});export{nt as default};

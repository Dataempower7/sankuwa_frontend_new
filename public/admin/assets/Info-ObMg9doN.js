import{d as X,r as u,b as Q,ab as K,c as x,W as Z,aw as Y,w as ee,Y as te,o as oe,P as U,as as ae,f as d,g as le,h as k,i as a,k as se,l as re,z as s,m as i,j as ie,Q as m,_ as ue}from"./index-B52YIGC0.js";import{B as ne}from"./BusinessData-Dbgv1FCM.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-1fz1RqDZ.js";import"./index-KjhYqCTY.js";/* empty css                                                                    *//* empty css                                                                  *//* empty css                                                                              *//* empty css                                                                     */import{S as pe}from"./SelectTimeInterval-BUZ-hmxo.js";/* empty css             */import{f as v}from"./time-EzYK4E-P.js";import{c as de,u as me}from"./groupon-BtcEMuW-.js";import q from"./ImgSelect-eypWh8y4.js";import"./currencyManagement-DNysi_dA.js";import"./DialogForm.vue_vue_type_script_setup_true_lang-CT6mpwCc.js";import"./index-C9ZdVeVx.js";import"./vuedraggable.umd-BauR0rTv.js";import"./Image.vue_vue_type_script_setup_true_lang-B8qXJKJq.js";import"./format-BxqOrW-w.js";import"./BusinessImg-B_fZOjqm.js";/* empty css                                                                    */const ve={class:"container"},ge={class:"content_wrapper"},fe={class:"lyecs-form-table"},ce={class:"group activity-base"},ye={class:"group-content"},Te={class:"flex flex-align-center"},_e={class:"group activity-rule"},be={class:"group-content"},xe={class:"flex"},Ye={class:"group activity-guide"},he={class:"group-content"},Ie=X({__name:"Info",props:{id:{type:Number,default:0},groupType:{type:Number,default:0},act:{type:String,default:""},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close"],setup(C,{expose:B,emit:j}){const f=j,p=C,c=u(!0),h=Q().currentRoute.value.query,I=u(p.isDialog?p.act:String(h.act)),D=u(p.isDialog?p.id:Number(h.id)),M=u(p.isDialog?p.groupType:Number(h.groupType)),R=I.value==="add"?"create":"update",S=K(),y=u(0),T=u(24),_=u(0),n=u([]),V=u(0),A=x(()=>Z());x(()=>A.value==="admin"&&V.value===1),x(()=>n.value.length===0?"":n.value.length===1?n.value[0].shopTitle??"":`${n.value[0].shopTitle}等${n.value.length}个组织(店铺/门店）`);const w=x(()=>n.value.map(t=>t.shopId)),E=(t,e)=>({groupon:new Map([[1,"https://oss.tigshop.com/img/gallery/202508/1756438001oGreqNb5OFAuCIJJ4S.jpeg"],[2,"https://oss.tigshop.com/img/gallery/202508/1756450144lRbOpyA51VGhJYNw5d.jpeg"]]),share:new Map([[1,"https://oss.tigshop.com/img/gallery/202508/1756438009cgWMViU51p4b7dWX44.jpeg"],[2,"https://oss.tigshop.com/img/gallery/202508/1756450125U4O78zVX5s5HlS1hye.jpeg"]])})[t].get(e)||"",o=u({groupType:M.value||0,startTime:v(new Date,"YYYY-MM-DD HH:mm:ss"),endTime:v(Y(1,"add"),"YYYY-MM-DD HH:mm:ss"),expirationTime:0,grouponImage:E("groupon",M.value),shareImage:E("share",M.value),grouponExplain:""}),G=()=>{const t=y.value*24*60*60,e=T.value*60*60,r=_.value*60;return t+e+r},O=t=>{const e=Math.floor(t/86400),r=Math.floor(t%(24*60*60)/(60*60)),g=Math.floor(t%(60*60)/60);return{days:e,hours:r,minutes:g}};ee(()=>{o.value.expirationTime=G()}),te(w,t=>{o.value.shopIds=w.value});const H=u(0),N=t=>{if(t===-1){H.value=t;return}o.value.startTime=v(new Date,"YYYY-MM-DD HH:mm:ss"),t===0&&(o.value.endTime=v(Y(1,"add"),"YYYY-MM-DD HH:mm:ss")),t===1&&(o.value.endTime=v(Y(7,"add"),"YYYY-MM-DD HH:mm:ss")),t===2&&(o.value.endTime=v(Y(15,"add"),"YYYY-MM-DD HH:mm:ss"))};oe(()=>{I.value==="detail"?W():c.value=!1});const W=async()=>{try{const t=await de(I.value,{grouponPromotionId:D.value});Object.assign(o.value,t);const e=O(o.value.expirationTime||0);y.value=e.days,T.value=e.hours,_.value=e.minutes,t.shops&&t.shops.length>0&&(n.value=t.shops,w.value.length>0&&(V.value=1))}catch(t){U.error(t.message),f("close")}finally{c.value=!1}},J=async()=>{await S.value.validate();try{f("update:confirmLoading",!0),V.value===0&&(o.value.shopIds=[-1]);const t=await me(R,{id:D.value,...o.value});f("submitCallback",t),U.success("操作成功")}catch(t){U.error(t.message)}finally{f("update:confirmLoading",!1)}},L=()=>{J()},$=ae({name:[{required:!0,message:"活动名称不能为空!",trigger:"blur"}],activityTime:[{required:!0,validator:(t,e,r)=>{if(!o.value.startTime&&!o.value.endTime){r(new Error("请输入活动时间"));return}r()},trigger:"blur"}],groupType:[{required:!0,message:"请至少选择一个组织",trigger:"blur"}],expirationTime:[{required:!0,validator:(t,e,r)=>{if(!o.value.expirationTime){r(new Error("成团有效时间不能为空!"));return}if(o.value.expirationTime<15*60||o.value.expirationTime>30*24*60*60){r(new Error("成团有效时间需在15分钟到30天之间"));return}r()},trigger:"blur"}]});return B({onFormSubmit:L}),(t,e)=>{const r=d("el-form-item"),g=d("el-radio-button"),z=d("el-radio-group"),b=d("TigInput"),F=d("el-form"),P=d("a-spin");return k(),le("div",ve,[a("div",ge,[a("div",fe,[c.value?re("",!0):(k(),se(F,{key:0,ref_key:"formRef",ref:S,rules:$,model:o.value,"label-width":"auto"},{default:i(()=>[a("div",ce,[e[14]||(e[14]=a("div",{class:"group-header"},[a("div",{class:"group__block"}),a("div",{class:"group__title"},"基础设置")],-1)),a("div",ye,[s(r,{required:"",label:"活动名称",prop:"name"},{default:i(()=>[s(ne,{modelValue:o.value.name,"onUpdate:modelValue":e[0]||(e[0]=l=>o.value.name=l),placeholder:"请输入活动名称",dataType:4,dataId:D.value},null,8,["modelValue","dataId"])]),_:1}),s(r,{required:"",label:"活动时间",prop:"activityTime"},{default:i(()=>[a("div",Te,[s(ie(pe),{"end-date":o.value.endTime,"onUpdate:endDate":e[1]||(e[1]=l=>o.value.endTime=l),"start-date":o.value.startTime,"onUpdate:startDate":e[2]||(e[2]=l=>o.value.startTime=l),clearable:"",type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss",onCallback:e[3]||(e[3]=l=>N(-1))},null,8,["end-date","start-date"]),s(z,{class:"itemWidth",modelValue:H.value,"onUpdate:modelValue":e[4]||(e[4]=l=>H.value=l),onChange:N},{default:i(()=>[s(g,{value:0},{default:i(()=>[...e[11]||(e[11]=[m("1天",-1)])]),_:1}),s(g,{value:1},{default:i(()=>[...e[12]||(e[12]=[m("7天",-1)])]),_:1}),s(g,{value:2},{default:i(()=>[...e[13]||(e[13]=[m("15天",-1)])]),_:1})]),_:1},8,["modelValue"])])]),_:1})])]),a("div",_e,[e[19]||(e[19]=a("div",{class:"group-header"},[a("div",{class:"group__block"}),a("div",{class:"group__title"},"活动规则")],-1)),a("div",be,[s(r,{prop:"expirationTime",label:"成团有效时间"},{default:i(()=>[a("div",null,[a("div",xe,[s(b,{class:"mr10",type:"integer",modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=l=>y.value=l),width:"120px"},{append:i(()=>[...e[15]||(e[15]=[m("日",-1)])]),_:1},8,["modelValue"]),s(b,{class:"mr10",type:"integer",modelValue:T.value,"onUpdate:modelValue":e[6]||(e[6]=l=>T.value=l),width:"120px"},{append:i(()=>[...e[16]||(e[16]=[m("时",-1)])]),_:1},8,["modelValue"]),s(b,{type:"integer",modelValue:_.value,"onUpdate:modelValue":e[7]||(e[7]=l=>_.value=l),width:"120px"},{append:i(()=>[...e[17]||(e[17]=[m("分",-1)])]),_:1},8,["modelValue"])]),e[18]||(e[18]=a("div",{class:"extra"},"拼团有效期需在15分钟至30天之间，若设置1日，用户开团后，需要在1日内成团，超时则拼团失败",-1))])]),_:1})])]),a("div",Ye,[e[22]||(e[22]=a("div",{class:"group-header"},[a("div",{class:"group__block"}),a("div",{class:"group__title"},"活动引导")],-1)),a("div",he,[s(r,{label:"活动图片",prop:"grouponImage"},{default:i(()=>[s(q,{photo:o.value.grouponImage,"onUpdate:photo":e[8]||(e[8]=l=>o.value.grouponImage=l)},null,8,["photo"]),e[20]||(e[20]=a("div",{class:"extra"},"建议尺寸：750*660或等比图片，将会在默认活动页面顶部展示",-1))]),_:1}),s(r,{label:"专题页分享图",prop:"shareImage"},{default:i(()=>[s(q,{photo:o.value.shareImage,"onUpdate:photo":e[9]||(e[9]=l=>o.value.shareImage=l)},null,8,["photo"]),e[21]||(e[21]=a("div",{class:"extra"},"建议尺寸：630*504或宽高比为5:4的图片，将会分享活动专题页的时候作为小程序分享图",-1))]),_:1}),s(r,{label:"活动规则",prop:"grouponExplain"},{default:i(()=>[s(b,{classType:"tig-form-input",modelValue:o.value.grouponExplain,"onUpdate:modelValue":e[10]||(e[10]=l=>o.value.grouponExplain=l),row:3,type:"textarea"},null,8,["modelValue"])]),_:1})])])]),_:1},8,["rules","model"])),s(P,{spinning:c.value,style:{width:"100%","margin-top":"100px"}},null,8,["spinning"])])])])}}}),Fe=ue(Ie,[["__scopeId","data-v-984785e9"]]);export{Fe as default};

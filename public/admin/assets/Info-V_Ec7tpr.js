import{d as R,v as $,a2 as D,r as s,c as M,e as v,f as w,g as _,h as m,z as a,l,L as O,t as y,k as T,p as j,ea as F,K as p,eb as K}from"./index-BLXOA87U.js";import{_ as Z}from"./Verify.vue_vue_type_script_setup_true_lang-CHLZzIIP.js";import"./Verify.vue_vue_type_style_index_0_lang-6inGDsc1.js";import"./index-B16C4gX_.js";const G={class:"container"},H={class:"content_wrapper"},J={class:"lyecs-form-table"},Q={key:1,class:"code-text"},oe=R({__name:"Info",props:{id:{type:Number,default:0},form:{type:Object,default:{}},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close"],setup(V,{expose:x,emit:h}){const c=h,{logout:S}=$(),z=V,g=D(),r=s({mobile:z.form.mobile,code:"",password:"",pwdConfirm:""}),E=s("获取验证码"),u=s(!0),i=s(60),b=s(),d=s(null),I=t=>{d.value=t.verifyToken,C()},C=async()=>{if(!d.value){b.value.show();return}try{const t=await F({type:"code",verifyToken:d.value});p.success("验证码发送成功"),u.value=!1,d.value=null,U()}catch(t){p.error(t.message)}},N=(t,e,o)=>{if(!e){o(new Error("确认密码不能为空"));return}r.value.password==e?o():o("两次密码输入不一致")},B=(t,e,o)=>{e===""?o(new Error("请输入密码")):e.length<8?o(new Error("密码长度至少为8位")):/^\d+$/.test(e)||/^[a-zA-Z]+$/.test(e)?o(new Error("密码不能是纯数字或纯字母")):o()},L=M(()=>i.value+"秒后重发"),k=s(),U=()=>{k.value=setInterval(()=>{i.value--,i.value<=0&&(clearInterval(k.value),u.value=!0,i.value=60)},1e3)},q=async()=>{await g.value.validate();try{c("update:confirmLoading",!0);const t=await K({modifyType:2,...r.value});c("submitCallback",t),p.success("修改成功"),S()}catch(t){p.error(t.message)}finally{c("update:confirmLoading",!1)}},A=()=>{q()};return s(""),x({onFormSubmit:A}),(t,e)=>{const o=v("el-form-item"),f=v("TigInput"),P=v("el-form");return _(),w("div",G,[m("div",H,[m("div",J,[a(P,{ref_key:"formRef",ref:g,model:r.value,"label-width":"auto"},{default:l(()=>[a(o,{label:"手机号："},{default:l(()=>[O(y(r.value.mobile),1)]),_:1}),a(o,{label:"获取验证码：",prop:"code",rules:[{required:!0,message:"验证码不能为空!",trigger:"blur"}]},{default:l(()=>[a(f,{classType:"tig-form-input",modelValue:r.value.code,"onUpdate:modelValue":e[0]||(e[0]=n=>r.value.code=n)},{append:l(()=>[u.value?(_(),w("div",{key:0,class:"code-btn",onClick:j(C,["stop"])},y(E.value),1)):T("",!0),u.value?T("",!0):(_(),w("div",Q,y(L.value),1))]),_:1},8,["modelValue"])]),_:1}),a(o,{label:"新密码：",prop:"password",rules:[{required:!0,validator:B,trigger:"blur"}]},{default:l(()=>[a(f,{classType:"tig-form-input",type:"password",modelValue:r.value.password,"onUpdate:modelValue":e[1]||(e[1]=n=>r.value.password=n)},null,8,["modelValue"]),e[3]||(e[3]=m("div",{class:"extra"},"密码长度至少为8位，并且不能是纯数字或纯字母。",-1))]),_:1,__:[3]},8,["rules"]),a(o,{label:"确认密码：",prop:"pwdConfirm",rules:[{required:!0,validator:N,trigger:"blur"}]},{default:l(()=>[a(f,{classType:"tig-form-input",type:"password",modelValue:r.value.pwdConfirm,"onUpdate:modelValue":e[2]||(e[2]=n=>r.value.pwdConfirm=n)},null,8,["modelValue"]),e[4]||(e[4]=m("div",{class:"extra"},"请再次输入密码，确保与上次输入一致。",-1))]),_:1,__:[4]},8,["rules"])]),_:1},8,["model"]),a(Z,{ref_key:"verify",ref:b,mode:"pop",captchaType:"blockPuzzle",imgSize:{width:"310px",height:"155px"},onOkCallback:I},null,512)])])])}}});export{oe as default};

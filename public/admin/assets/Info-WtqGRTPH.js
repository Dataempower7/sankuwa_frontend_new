import{d as E,r as s,ah as V,a as B,a2 as L,o as q,K as u,e as c,f as R,g as _,h as m,j as M,k as U,l as n,z as a,G as Y,i as $,L as F,J as j}from"./index-BLXOA87U.js";import{a as H,u as P}from"./limitdiscount-9imL2PeT.js";import z from"./DiscountForm-CHUiTIDp.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-BfFy9xcT.js";import"./index-DpgvsnVO.js";/* empty css                                                                    *//* empty css                                                                  *//* empty css                                                                              */import{S as A}from"./SelectTimeInterval-ah59IDPd.js";/* empty css             */import"./format-DdZABYp4.js";import"./product-CsYu5zzV.js";import"./Pagination-w0YHSLYy.js";import"./SelectSku-DmHOajuh.js";import"./DialogForm.vue_vue_type_script_setup_true_lang-6GHo9HCV.js";import"./index-B16C4gX_.js";import"./time-DX2Q3n6c.js";const G={class:"container"},J={class:"content_wrapper"},K={class:"lyecs-form-table"},ve=E({__name:"Info",props:{id:{type:Number,default:0},promotionType:{type:Number,default:0},act:{type:String,default:""},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close"],setup(w,{expose:N,emit:D}){const d=D;s([]);const k=V({promotionName:[{required:!0,message:"请输入活动名称！",trigger:"blur"}],item:[{required:!0,validator:(e,o,l)=>{if(!t.value.item||t.value.item.length==0){l(new Error("活动商品不能为空"));return}else l()},trigger:"blur"}],productTime:[{required:!0,validator:(e,o,l)=>{if(!t.value.startTime||!t.value.endTime){l(new Error("活动日期不能为空"));return}else l()},trigger:"blur"}]}),i=w,f=s(!0),v=B().currentRoute.value.query,g=s(i.isDialog?i.act:String(v.act)),b=s(i.isDialog?i.id:Number(v.id)),I=s(i.isDialog?i.promotionType:Number(v.couponType)||0),S=g.value==="add"?"create":"update",y=L(),t=s({item:[]});q(()=>{g.value==="detail"?x():f.value=!1});const x=async()=>{try{const e=await H(g.value,{discountId:b.value,promotionType:I.value});console.log(e.discountInfo),Object.assign(t.value,e.discountInfo)}catch(e){u.error(e.message),d("close")}finally{f.value=!1}},T=async()=>{await y.value.validate(),t.value.item.forEach(e=>{if(!e.value)throw u.error(`【${e.product.productName}】: 请输入折扣值`),new Error;if(e.discountType==1&&(e.value<=0||e.value>9.9))throw u.error(`【${e.product.productName}】: 请输入0.1-9.9之间折扣`),new Error;if(e.discountType>1&&(e.value<=0||e.value>Number(e.productPrice)))throw u.error(`【${e.product.productName}】: 请输入大于0并且小于商品原价的折扣`),new Error}),console.log(t.value);try{d("update:confirmLoading",!0);const e=await P(S,{id:b.value,...t.value});d("submitCallback",e),u.success("操作成功")}catch(e){u.error(e.message)}finally{d("update:confirmLoading",!1)}};return N({onFormSubmit:()=>{T()}}),(e,o)=>{const l=c("TigInput"),p=c("el-form-item"),h=c("el-button"),C=c("el-form");return _(),R("div",G,[m("div",J,[m("div",K,[f.value?U("",!0):(_(),M(C,{key:0,ref_key:"formRef",ref:y,rules:k,model:t.value,"label-width":"auto"},{default:n(()=>[a(p,{prop:"promotionName",label:"活动名称"},{default:n(()=>[a(l,{width:"432px",maxlength:60,modelValue:t.value.promotionName,"onUpdate:modelValue":o[0]||(o[0]=r=>t.value.promotionName=r)},null,8,["modelValue"])]),_:1}),a(p,{prop:"productTime",label:"活动时间"},{default:n(()=>[m("div",null,[m("div",null,[a($(A),{"end-date":t.value.endTime,"onUpdate:endDate":o[1]||(o[1]=r=>t.value.endTime=r),"start-date":t.value.startTime,"onUpdate:startDate":o[2]||(o[2]=r=>t.value.startTime=r),clearable:!1,type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["end-date","start-date"])]),o[5]||(o[5]=m("div",{class:"extra"},"只有当前时间介于起始日期和截止日期之间时，此活动才可以生效",-1))])]),_:1}),a(p,{prop:"item",label:"活动商品"},{default:n(()=>[a(z,{skuIds:t.value.item,"onUpdate:skuIds":o[3]||(o[3]=r=>t.value.item=r),isMultiple:!0,isSku:!0},null,8,["skuIds"])]),_:1}),Y(a(p,{"wrapper-col":{offset:4,span:16}},{default:n(()=>[a(h,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:o[4]||(o[4]=r=>T())},{default:n(()=>o[6]||(o[6]=[F("提交",-1)])),_:1,__:[6]},512)]),_:1},512),[[j,!i.isDialog]])]),_:1},8,["rules","model"]))])])])}}});export{ve as default};

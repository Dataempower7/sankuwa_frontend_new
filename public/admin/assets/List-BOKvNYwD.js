/* empty css             */import"./index-DpgvsnVO.js";import{_ as le}from"./Switch.vue_vue_type_script_setup_true_lang-D9gOYX51.js";import{D as P}from"./DeleteRecord-D6PcywRa.js";/* empty css                                                                    */import{P as re}from"./Pagination-w0YHSLYy.js";import{d as ne,u as ie,a as L,M as de,x as ue,r as p,ah as $,o as pe,R as ce,dI as S,K as me,f as _,h as r,j as z,k as f,i as l,l as o,z as a,e as c,L as q,dJ as N,t as I,n as _e,F as w,m as ye,dK as B,dL as he,g as u}from"./index-BLXOA87U.js";import{P as T}from"./PopSelect.vue_vue_type_style_index_0_scoped_5832cf6b_lang-Bx-dDInM.js";import{i as fe}from"./version-hjn5tnxG.js";import{_ as V}from"./DialogForm.vue_vue_type_script_setup_true_lang-6GHo9HCV.js";import"./index-B16C4gX_.js";const ve=["href"],Ie={class:"container"},ge={class:"content_wrapper"},be={key:1,class:"lyecs-table-list-warp"},ke={class:"list-table-tool lyecs-search-warp"},Ce={class:"list-table-tool-row"},xe={class:"list-table-tool-col"},Ae={class:"table-container"},Se={style:{position:"relative"}},ze=["onClick"],qe={key:1},Ne={class:"empty-warp"},Oe={key:0,class:"empty-bg"},Te={key:0,class:"pagination-con"},Ke=ne({__name:"List",setup(Ve){const E=ie(),{currentRoute:K}=L();L(),de();const D=ue(),j=p(D.icoDefinedCss),v=p("admin"),J=s=>{i.adminType=s,i.page=1,m()},U=p([]),k=p(!0),C=p(0),G=p([]),H=p([]),i=$({page:1,size:D.get("pageSize"),sortField:"sortOrder",sortOrder:"",adminType:"admin",keyword:"",parentId:0}),x=p([0]);p();const Q=ce(),g=$({});pe(()=>{const s=K.value.query;s.id>0&&(i.parentId=s.id),Q.meta.title="",m()});const m=async()=>{k.value=!0;try{const s=await S({...i});U.value=s.records,C.value=s.total}catch(s){me.error(s.message)}finally{k.value=!1}},W=async(s,t,n)=>{g[s.authorityId]={},g[s.authorityId].resolve=n,g[s.authorityId].expandCount=0;const y=await S({page:1,parentId:s.authorityId,sortField:"sortOrder",size:1e3});n(y.records)},X=async(s,t)=>{const n=g[s.authorityId];if(n.expandCount++,t&&n.expandCount>1&&!n.prevStatus){const y=await S({page:1,parentId:s.authorityId,sortField:"sortOrder",size:1e3});n.resolve(y.records)}n.prevStatus=t},A=p(null),O=async(s,t)=>{const n=g[t.parentId];if(n){const y=await S({page:1,parentId:t.parentId,sortField:"sortOrder",size:1e3});A.value.store.states.lazyTreeNodeMap.value[t.parentId].length>1?A.value.store.states.lazyTreeNodeMap[t.parentId]=[]:A.value.store.states.lazyTreeNodeMap.value[t.parentId]=[],n.resolve(y.records)}else m()},b=async()=>{E.mainMenu=await he()},Y=s=>{x.value.push(s),i.parentId=s,m()},Z=()=>{x.value.pop(),i.parentId=x.value[x.value.length-1],m()},ee=s=>{G.value=s.map(t=>t.authorityId)};return(s,t)=>{const n=c("el-tab-pane"),y=c("el-tabs"),F=c("el-button"),M=c("el-space"),te=c("el-form"),h=c("el-table-column"),R=c("el-divider"),ae=c("el-table"),se=c("a-spin");return u(),_(w,null,[r("link",{href:j.value,rel:"stylesheet"},null,8,ve),r("div",Ie,[r("div",ge,[l(fe)()?(u(),z(y,{key:0,modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=e=>v.value=e),class:"lyecs-tabs","tab-position":"top",onTabChange:J},{default:o(()=>[a(n,{label:"管理后台",name:"admin"}),a(n,{label:"店铺后台",name:"shop"})]),_:1},8,["modelValue"])):f("",!0),v.value!=null?(u(),_("div",be,[r("div",ke,[a(te,{model:i,name:"form"},{default:o(()=>[r("div",Ce,[r("div",xe,[a(M,null,{default:o(()=>[i.parentId>0?(u(),z(F,{key:0,onClick:Z},{default:o(()=>t[4]||(t[4]=[r("i",{class:"iconfont icon-fanhui",style:{"font-size":"14px","padding-right":"5px"}},null,-1),q(" 返回上一级 ",-1)])),_:1,__:[4]})):f("",!0),a(l(V),{params:{act:"add",parentId:i.parentId,adminType:v.value},isDrawer:"",path:"authority/authority/Info",title:"添加权限",width:"580px",onOkCallback:m},{default:o(()=>[a(F,{type:"primary"},{default:o(()=>t[5]||(t[5]=[q("添加权限",-1)])),_:1,__:[5]})]),_:1},8,["params"])]),_:1})])])]),_:1},8,["model"])]),r("div",Ae,[a(se,{spinning:k.value},{default:o(()=>[a(ae,{ref_key:"tableRef",ref:A,data:U.value,"expand-row-keys":H.value,indent:30,load:W,total:C.value,"tree-props":{children:"children",hasChildren:"hasChildren"},lazy:"","row-key":"authorityId",onSelectionChange:ee,onExpandChange:X},{empty:o(()=>[r("div",Ne,[k.value?f("",!0):(u(),_("div",Oe,"暂无数据"))])]),default:o(()=>[a(h,{width:260,label:"权限名称"},{default:o(({row:e})=>[a(M,{style:{height:"30px"}},{default:o(()=>[r("div",Se,[a(l(T),{"org-value":e.authorityName,"onUpdate:orgValue":d=>e.authorityName=d,params:{id:e.authorityId,field:"authorityName"},requestApi:l(N),label:"权限名称",type:"textarea",onCallback:b},{default:o(()=>[e.hasChildren?(u(),_("a",{key:0,onClick:d=>Y(e.authorityId)},I(e.authorityName),9,ze)):(u(),_("span",qe,I(e.authorityName),1))]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])])]),_:2},1024)]),_:1}),a(h,{width:100,label:"权限图标"},{default:o(({row:e})=>[r("em",{class:_e([e.authorityIco,"main_pel_m"])},null,2)]),_:1}),a(h,{label:"唯一编码"},{default:o(({row:e})=>[a(l(T),{"org-value":e.authoritySn,"onUpdate:orgValue":d=>e.authoritySn=d,params:{id:e.authorityId,field:"authoritySn"},requestApi:l(N),label:"唯一编码",type:"textarea",onCallback:b},{default:o(()=>[r("div",null,I(e.authoritySn||"-"),1)]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])]),_:1}),a(h,{label:"细分权限"},{default:o(({row:e})=>[(u(!0),_(w,null,ye(e.childAuth,(d,oe)=>(u(),_("span",null,I(oe!=0?",":"")+I(d.authName),1))),256))]),_:1}),a(h,{key:"isShow",sorter:!0,label:"是否显示"},{default:o(({row:e})=>[a(l(le),{checked:e.isShow,"onUpdate:checked":d=>e.isShow=d,params:{id:e.authorityId,field:"isShow"},requestApi:l(N),onCallback:b},null,8,["checked","onUpdate:checked","params","requestApi"])]),_:1}),a(h,{key:"sortOrder",sorter:!0,label:"排序"},{default:o(({row:e})=>[a(l(T),{"org-value":e.sortOrder,"onUpdate:orgValue":d=>e.sortOrder=d,params:{id:e.authorityId,field:"sortOrder"},requestApi:l(N),label:"排序",type:"integer",onCallback:b},{default:o(()=>[r("div",null,I(e.sortOrder),1)]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])]),_:1}),a(h,{width:220,fixed:"right",label:"操作"},{default:o(({row:e})=>[a(l(V),{data:{parentId:e.parentId},params:{act:"detail",id:e.authorityId,adminType:v.value},isDrawer:"",path:"authority/authority/Info",title:"编辑权限",width:"580px",onOkCallback:O},{default:o(()=>t[6]||(t[6]=[r("a",{class:"btn-link"},"编辑",-1)])),_:2,__:[6]},1032,["data","params"]),a(R,{direction:"vertical"}),a(l(V),{data:{parentId:e.parentId||e.authorityId},params:{act:"add",parentId:e.authorityId,adminType:v.value},isDrawer:"",path:"authority/authority/Info",title:"编辑权限",width:"580px",onOkCallback:O},{default:o(()=>t[7]||(t[7]=[r("a",{class:"btn-link"},"添加子目录",-1)])),_:2,__:[7]},1032,["data","params"]),a(R,{direction:"vertical"}),e.parentId?(u(),z(l(P),{key:0,params:{id:e.authorityId},requestApi:l(B),onAfterDelete:d=>O({},{parentId:e.parentId})},{default:o(()=>t[8]||(t[8]=[q("删除 ",-1)])),_:2,__:[8]},1032,["params","requestApi","onAfterDelete"])):f("",!0),e.parentId?f("",!0):(u(),z(l(P),{key:1,params:{id:e.authorityId},requestApi:l(B),onAfterDelete:t[1]||(t[1]=d=>{m(),b()})},{default:o(()=>t[9]||(t[9]=[q("删除 ",-1)])),_:2,__:[9]},1032,["params","requestApi"]))]),_:1})]),_:1},8,["data","expand-row-keys","total"])]),_:1},8,["spinning"]),C.value>0?(u(),_("div",Te,[a(l(re),{page:i.page,"onUpdate:page":t[2]||(t[2]=e=>i.page=e),size:i.size,"onUpdate:size":t[3]||(t[3]=e=>i.size=e),total:C.value,onCallback:m},null,8,["page","size","total"])])):f("",!0)])])):f("",!0)])])],64)}}});export{Ke as default};

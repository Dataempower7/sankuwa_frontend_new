/* empty css             */import"./index-KjhYqCTY.js";import{_ as re}from"./Switch.vue_vue_type_script_setup_true_lang-D-71VfIC.js";import{D as P}from"./DeleteRecord-BTXBpwL2.js";/* empty css                                                                    */import{P as ne}from"./Pagination-C8J7-6Em.js";import{d as ie,a as de,b as $,R as ue,x as pe,r as p,as as w,X as ce,o as me,dQ as z,P as ye,f as m,g as h,h as n,i,z as a,l as c,m as o,k as v,j as l,A as he,E as B,D as _e,Q as q,dR as N,t as I,n as fe,F as E,p as ve,dS as L,dT as ge}from"./index-B52YIGC0.js";import{P as D}from"./PopSelect.vue_vue_type_style_index_0_scoped_5832cf6b_lang-CRFq-JzZ.js";import{_ as O}from"./DialogForm.vue_vue_type_script_setup_true_lang-CT6mpwCc.js";import"./index-C9ZdVeVx.js";const Ie=["href"],be={class:"container"},ke={class:"content_wrapper"},Ce={key:0,class:"lyecs-table-list-warp"},Se={class:"list-table-tool lyecs-search-warp"},xe={class:"list-table-tool-row"},Ae={class:"list-table-tool-col"},ze={class:"table-container"},qe={style:{position:"relative"}},Ne=["onClick"],Te={key:1},De={class:"empty-warp"},Oe={key:0,class:"empty-bg"},Ve={key:0,class:"pagination-con"},je=ie({__name:"List",setup(Ue){const Q=de(),{currentRoute:j}=$();$(),ue();const V=pe(),K=p(V.icoDefinedCss),g=p("admin"),X=s=>{d.adminType=s,d.page=1,y()},U=p([]),C=p(!0),S=p(0),G=p([]),H=p([]),d=w({page:1,size:V.get("pageSize"),sortField:"sortOrder",sortOrder:"",adminType:"admin",keyword:"",parentId:0}),x=p([0]);p();const J=ce(),b=w({});me(()=>{const s=j.value.query;s.id>0&&(d.parentId=s.id),J.meta.title="",y()});const y=async()=>{C.value=!0;try{const s=await z({...d});U.value=s.records,S.value=s.total}catch(s){ye.error(s.message)}finally{C.value=!1}},W=async(s,t,r)=>{b[s.authorityId]={},b[s.authorityId].resolve=r,b[s.authorityId].expandCount=0;const _=await z({page:1,parentId:s.authorityId,sortField:"sortOrder",size:1e3});r(_.records)},Y=async(s,t)=>{const r=b[s.authorityId];if(r.expandCount++,t&&r.expandCount>1&&!r.prevStatus){const _=await z({page:1,parentId:s.authorityId,sortField:"sortOrder",size:1e3});r.resolve(_.records)}r.prevStatus=t},A=p(null),T=async(s,t)=>{const r=b[t.parentId];if(r){const _=await z({page:1,parentId:t.parentId,sortField:"sortOrder",size:1e3});A.value.store.states.lazyTreeNodeMap.value[t.parentId].length>1?A.value.store.states.lazyTreeNodeMap[t.parentId]=[]:A.value.store.states.lazyTreeNodeMap.value[t.parentId]=[],r.resolve(_.records)}else y()},k=async()=>{Q.mainMenu=await ge()},Z=s=>{x.value.push(s),d.parentId=s,y()},ee=()=>{x.value.pop(),d.parentId=x.value[x.value.length-1],y()},te=s=>{G.value=s.map(t=>t.authorityId)};return(s,t)=>{const r=m("el-tab-pane"),_=m("el-tabs"),F=m("el-button"),R=m("el-space"),ae=m("el-form"),f=m("el-table-column"),M=m("el-divider"),se=m("el-table"),oe=m("a-spin");return n(),h(E,null,[i("link",{href:K.value,rel:"stylesheet"},null,8,Ie),i("div",be,[i("div",ke,[a(_,{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=e=>g.value=e),class:"lyecs-tabs","tab-position":"top",onTabChange:X},{default:o(()=>[a(r,{label:"管理后台",name:"admin"}),l(he)()?(n(),v(r,{key:0,label:"店铺后台",name:"shop"})):c("",!0),l(B)()?(n(),v(r,{key:1,label:"门店后台",name:"store"})):c("",!0),l(B)()?(n(),v(r,{key:2,label:"自提点后台",name:"pickup"})):c("",!0),l(_e)()?(n(),v(r,{key:3,label:"供应商后台",name:"vendor"})):c("",!0)]),_:1},8,["modelValue"]),g.value!=null?(n(),h("div",Ce,[i("div",Se,[a(ae,{model:d,name:"form"},{default:o(()=>[i("div",xe,[i("div",Ae,[a(R,null,{default:o(()=>[d.parentId>0?(n(),v(F,{key:0,onClick:ee},{default:o(()=>[...t[4]||(t[4]=[i("i",{class:"iconfont icon-fanhui",style:{"font-size":"14px","padding-right":"5px"}},null,-1),q(" 返回上一级 ",-1)])]),_:1})):c("",!0),a(l(O),{params:{act:"add",parentId:d.parentId,adminType:g.value},isDrawer:"",path:"authority/authority/Info",title:"添加权限",width:"580px",onOkCallback:y},{default:o(()=>[a(F,{type:"primary"},{default:o(()=>[...t[5]||(t[5]=[q("添加权限",-1)])]),_:1})]),_:1},8,["params"])]),_:1})])])]),_:1},8,["model"])]),i("div",ze,[a(oe,{spinning:C.value},{default:o(()=>[a(se,{ref_key:"tableRef",ref:A,data:U.value,"expand-row-keys":H.value,indent:30,load:W,total:S.value,"tree-props":{children:"children",hasChildren:"hasChildren"},lazy:"","row-key":"authorityId",onSelectionChange:te,onExpandChange:Y},{empty:o(()=>[i("div",De,[C.value?c("",!0):(n(),h("div",Oe,"暂无数据"))])]),default:o(()=>[a(f,{width:260,label:"权限名称"},{default:o(({row:e})=>[a(R,{style:{height:"30px"}},{default:o(()=>[i("div",qe,[a(l(D),{"org-value":e.authorityName,"onUpdate:orgValue":u=>e.authorityName=u,params:{id:e.authorityId,field:"authorityName"},requestApi:l(N),label:"权限名称",type:"textarea",onCallback:k},{default:o(()=>[e.hasChildren?(n(),h("a",{key:0,onClick:u=>Z(e.authorityId)},I(e.authorityName),9,Ne)):(n(),h("span",Te,I(e.authorityName),1))]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])])]),_:2},1024)]),_:1}),a(f,{width:100,label:"权限图标"},{default:o(({row:e})=>[i("em",{class:fe([e.authorityIco,"main_pel_m"])},null,2)]),_:1}),a(f,{label:"唯一编码"},{default:o(({row:e})=>[a(l(D),{"org-value":e.authoritySn,"onUpdate:orgValue":u=>e.authoritySn=u,params:{id:e.authorityId,field:"authoritySn"},requestApi:l(N),label:"唯一编码",type:"textarea",onCallback:k},{default:o(()=>[i("div",null,I(e.authoritySn||"-"),1)]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])]),_:1}),a(f,{label:"细分权限"},{default:o(({row:e})=>[(n(!0),h(E,null,ve(e.childAuth,(u,le)=>(n(),h("span",null,I(le!=0?",":"")+I(u.authName),1))),256))]),_:1}),a(f,{key:"isShow",sorter:!0,label:"是否显示"},{default:o(({row:e})=>[a(l(re),{checked:e.isShow,"onUpdate:checked":u=>e.isShow=u,params:{id:e.authorityId,field:"isShow"},requestApi:l(N),onCallback:k},null,8,["checked","onUpdate:checked","params","requestApi"])]),_:1}),a(f,{key:"sortOrder",sorter:!0,label:"排序"},{default:o(({row:e})=>[a(l(D),{"org-value":e.sortOrder,"onUpdate:orgValue":u=>e.sortOrder=u,params:{id:e.authorityId,field:"sortOrder"},requestApi:l(N),label:"排序",type:"integer",onCallback:k},{default:o(()=>[i("div",null,I(e.sortOrder),1)]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])]),_:1}),a(f,{width:220,fixed:"right",label:"操作"},{default:o(({row:e})=>[a(l(O),{data:{parentId:e.parentId},params:{act:"detail",id:e.authorityId,adminType:g.value},isDrawer:"",path:"authority/authority/Info",title:"编辑权限",width:"580px",onOkCallback:T},{default:o(()=>[...t[6]||(t[6]=[i("a",{class:"btn-link"},"编辑",-1)])]),_:1},8,["data","params"]),a(M,{direction:"vertical"}),a(l(O),{data:{parentId:e.parentId||e.authorityId},params:{act:"add",parentId:e.authorityId,adminType:g.value},isDrawer:"",path:"authority/authority/Info",title:"编辑权限",width:"580px",onOkCallback:T},{default:o(()=>[...t[7]||(t[7]=[i("a",{class:"btn-link"},"添加子目录",-1)])]),_:1},8,["data","params"]),a(M,{direction:"vertical"}),e.parentId?(n(),v(l(P),{key:0,params:{id:e.authorityId},requestApi:l(L),onAfterDelete:u=>T({},{parentId:e.parentId})},{default:o(()=>[...t[8]||(t[8]=[q("删除 ",-1)])]),_:1},8,["params","requestApi","onAfterDelete"])):c("",!0),e.parentId?c("",!0):(n(),v(l(P),{key:1,params:{id:e.authorityId},requestApi:l(L),onAfterDelete:t[1]||(t[1]=u=>{y(),k()})},{default:o(()=>[...t[9]||(t[9]=[q("删除 ",-1)])]),_:1},8,["params","requestApi"]))]),_:1})]),_:1},8,["data","expand-row-keys","total"])]),_:1},8,["spinning"]),S.value>0?(n(),h("div",Ve,[a(l(ne),{page:d.page,"onUpdate:page":t[2]||(t[2]=e=>d.page=e),size:d.size,"onUpdate:size":t[3]||(t[3]=e=>d.size=e),total:S.value,onCallback:y},null,8,["page","size","total"])])):c("",!0)])])):c("",!0)])])],64)}}});export{je as default};

/* empty css             */import"./index-KjhYqCTY.js";import{_ as oe}from"./Switch.vue_vue_type_script_setup_true_lang-D-71VfIC.js";import{D as U}from"./DeleteRecord-BTXBpwL2.js";/* empty css                                                                    */import{P as se}from"./Pagination-C8J7-6Em.js";import{i as re}from"./format-BxqOrW-w.js";import{d as le,b as V,R as ne,x as de,r as c,as as T,o as ie,X as pe,P as N,g as f,i as r,l as u,z as o,m as s,j as n,F as ce,f as m,h as d,k as I,Q as _,t as P}from"./index-B52YIGC0.js";import{P as B}from"./PopSelect.vue_vue_type_style_index_0_scoped_5832cf6b_lang-CRFq-JzZ.js";import{u as ue,g as z,a as q,d as $,b as me}from"./shopProductCategory-DyQBhq8U.js";import{_ as D}from"./DialogForm.vue_vue_type_script_setup_true_lang-CT6mpwCc.js";import"./index-C9ZdVeVx.js";const ge=["href"],ye={class:"container"},fe={class:"content_wrapper"},_e={class:"lyecs-table-list-warp"},he={class:"list-table-tool lyecs-search-warp"},ve={class:"list-table-tool-row"},Ie={class:"list-table-tool-col"},ke={class:"table-container"},Ce={style:{position:"relative"}},be=["onClick"],Se={key:1},xe={key:0},Pe={class:"empty-warp"},ze={key:0,class:"empty-bg"},Ae={key:0,class:"pagination-con"},Ne={key:0,class:"selected-action-warp selected-warp-left"},qe={class:"selected-action"},je=le({__name:"List",setup(De){const M=ue(),{currentRoute:E}=V();V(),ne();const w=de(),L=c(w.icoDefinedCss),O=c([]),k=c(!0),C=c(0),b=c([]),j=c([]),i=T({page:1,size:w.get("pageSize"),sortField:"",sortOrder:"",keyword:"",isShow:-1,parentId:0}),S=c([0]);c();const Q=pe(),v=T({});ie(()=>{const a=E.value.query;a.id>0&&(i.parentId=a.id),Q.meta.title="",g()});const g=async()=>{k.value=!0;try{const a=await z({...i});O.value=a.records,C.value=a.total}catch(a){N.error(a.message)}finally{k.value=!1}},X=async(a,e,l)=>{v[a.categoryId]={},v[a.categoryId].resolve=l,v[a.categoryId].expandCount=0;const p=await z({page:1,parentId:a.categoryId,size:1e3});l(p.records)},G=async(a,e)=>{const l=v[a.categoryId];if(l.expandCount++,e&&l.expandCount>1&&!l.prevStatus){const p=await z({page:1,parentId:a.categoryId,size:1e3});l.resolve(p.records)}l.prevStatus=e},x=c(),A=async(a,e)=>{const l=v[e.parentId];if(l){const p=await z({page:1,parentId:e.parentId,size:1e3});x.value.store.states.lazyTreeNodeMap.value[e.parentId].length>1?x.value.store.states.lazyTreeNodeMap[e.parentId]=[]:x.value.store.states.lazyTreeNodeMap.value[e.parentId]=[],l.resolve(p.records)}else await g()},F=()=>{M.clearShopProductCategory()},H=a=>{S.value.push(a),i.parentId=a,g()},J=()=>{S.value.pop(),i.parentId=S.value[S.value.length-1],g()},K=async a=>{try{const e=await me(a,{ids:b.value});N.success("操作成功"),await g()}catch(e){N.error(e.message)}},W=a=>{b.value=a.map(e=>e.categoryId)};return(a,e)=>{const l=m("el-button"),p=m("el-space"),Y=m("el-form"),h=m("el-table-column"),Z=m("el-image"),R=m("el-divider"),ee=m("el-table"),te=m("a-spin"),ae=m("el-popconfirm");return d(),f(ce,null,[r("link",{href:L.value,rel:"stylesheet"},null,8,ge),r("div",ye,[r("div",fe,[r("div",_e,[r("div",he,[o(Y,{model:i,name:"form"},{default:s(()=>[r("div",ve,[r("div",Ie,[o(p,null,{default:s(()=>[i.parentId>0?(d(),I(l,{key:0,onClick:J},{default:s(()=>[...e[3]||(e[3]=[r("i",{class:"iconfont icon-fanhui",style:{"font-size":"14px","padding-right":"5px"}},null,-1),_(" 返回上一级 ",-1)])]),_:1})):u("",!0),o(n(D),{params:{act:"add",parentId:i.parentId},isDrawer:"",path:"product/shopProductCategory/Info",title:"添加分类",width:"600px",onOkCallback:g},{default:s(()=>[o(l,{type:"primary"},{default:s(()=>[...e[4]||(e[4]=[_("添加分类",-1)])]),_:1})]),_:1},8,["params"])]),_:1})])])]),_:1},8,["model"])]),r("div",ke,[o(te,{spinning:k.value},{default:s(()=>[o(ee,{data:O.value,"expand-row-keys":j.value,indent:30,load:X,total:C.value,"tree-props":{children:"children",hasChildren:"hasChildren"},lazy:"","row-key":"categoryId",onSelectionChange:W,onExpandChange:G,ref_key:"tableRef",ref:x},{empty:s(()=>[r("div",Pe,[k.value?u("",!0):(d(),f("div",ze,"暂无数据"))])]),default:s(()=>[o(h,{type:"selection",width:"32"}),o(h,{label:"分类名称"},{default:s(({row:t})=>[o(p,{style:{height:"30px"}},{default:s(()=>[r("div",Ce,[o(n(B),{"org-value":t.categoryName,"onUpdate:orgValue":y=>t.categoryName=y,params:{id:t.categoryId,field:"categoryName"},requestApi:n(q),label:"分类名称",type:"textarea",onCallback:F},{default:s(()=>[t.hasChildren?(d(),f("a",{key:0,onClick:y=>H(t.categoryId)},P(t.categoryName),9,be)):(d(),f("span",Se,P(t.categoryName),1))]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])])]),_:2},1024)]),_:1}),o(h,{width:120,label:"分类图片"},{default:s(({row:t})=>[t.categoryPic?(d(),f("div",xe,[o(Z,{src:n(re)(t.categoryPic),fit:"contain",style:{height:"30px",width:"30px"}},null,8,["src"])])):u("",!0)]),_:1}),o(h,{key:"isShow",sorter:!0,label:"是否显示"},{default:s(({row:t})=>[o(n(oe),{checked:t.isShow,"onUpdate:checked":y=>t.isShow=y,params:{id:t.categoryId,field:"isShow"},requestApi:n(q)},null,8,["checked","onUpdate:checked","params","requestApi"])]),_:1}),o(h,{key:"sortOrder",sorter:!0,label:"排序"},{default:s(({row:t})=>[o(n(B),{"org-value":t.sortOrder,"onUpdate:orgValue":y=>t.sortOrder=y,params:{id:t.categoryId,field:"sortOrder"},requestApi:n(q),label:"排序",type:"input",onCallback:F},{default:s(()=>[r("div",null,P(t.sortOrder),1)]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])]),_:1}),o(h,{width:200,fixed:"right",label:"操作"},{default:s(({row:t})=>[o(n(D),{params:{act:"detail",id:t.categoryId},data:{parentId:t.parentId},isDrawer:"",path:"product/shopProductCategory/Info",title:"编辑分类",width:"600px",onOkCallback:A},{default:s(()=>[...e[5]||(e[5]=[r("a",{class:"btn-link"},"编辑",-1)])]),_:1},8,["params","data"]),o(R,{direction:"vertical"}),t.parentId?u("",!0):(d(),I(n(D),{key:0,params:{act:"add",parentId:t.categoryId},data:{parentId:t.parentId||t.categoryId},isDrawer:"",path:"product/shopProductCategory/Info",title:"添加子分类",width:"600px",onOkCallback:A},{default:s(()=>[...e[6]||(e[6]=[r("a",{class:"btn-link"},"添加子分类",-1)])]),_:1},8,["params","data"])),t.parentId?u("",!0):(d(),I(R,{key:1,direction:"vertical"})),t.parentId?(d(),I(n(U),{key:2,params:{id:t.categoryId},requestApi:n($),onAfterDelete:y=>A({},{parentId:t.parentId})},{default:s(()=>[...e[7]||(e[7]=[_("删除 ",-1)])]),_:1},8,["params","requestApi","onAfterDelete"])):u("",!0),t.parentId?u("",!0):(d(),I(n(U),{key:3,params:{id:t.categoryId},requestApi:n($),onAfterDelete:g},{default:s(()=>[...e[8]||(e[8]=[_("删除",-1)])]),_:1},8,["params","requestApi"]))]),_:1})]),_:1},8,["data","expand-row-keys","total"])]),_:1},8,["spinning"]),C.value>0?(d(),f("div",Ae,[o(n(se),{page:i.page,"onUpdate:page":e[0]||(e[0]=t=>i.page=t),size:i.size,"onUpdate:size":e[1]||(e[1]=t=>i.size=t),total:C.value,onCallback:g},null,8,["page","size","total"])])):u("",!0)]),b.value.length>0?(d(),f("div",Ne,[r("div",qe,[o(p,null,{default:s(()=>[r("span",null,[e[9]||(e[9]=_("已选择：",-1)),r("b",null,P(b.value.length),1),e[10]||(e[10]=_(" 项",-1))]),o(ae,{title:"您确认要批量删除所选数据吗？",onConfirm:e[2]||(e[2]=t=>K("del"))},{reference:s(()=>[o(l,null,{default:s(()=>[...e[11]||(e[11]=[_("批量删除",-1)])]),_:1})]),_:1})]),_:1})])])):u("",!0)])])])],64)}}});export{je as default};

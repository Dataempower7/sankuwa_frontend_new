import{d as he,b as Ie,x as De,r as _,aw as ee,c as ye,o as ke,g as Y,i as o,z as s,m as d,q as ge,l as N,j as k,P as te,f as h,h as I,a8 as Ye,Q as z,L as be,t as f,O as Me,k as j,W as $e,F as Ce,p as Te,dz as Se,dA as Ve,H as L,_ as we}from"./index-B52YIGC0.js";/* empty css             */import{_ as xe}from"./Image.vue_vue_type_script_setup_true_lang-B8qXJKJq.js";/* empty css                                                                    */import{P as Ne}from"./Pagination-C8J7-6Em.js";import"./index-KjhYqCTY.js";import{f as b}from"./time-EzYK4E-P.js";import{g as ze}from"./inventoryCalendar-CGXkAm9Q.js";import{_ as P}from"./DialogForm.vue_vue_type_script_setup_true_lang-CT6mpwCc.js";import"./format-BxqOrW-w.js";import"./index-C9ZdVeVx.js";const Le={class:"container"},Ue={class:"content_wrapper"},Fe={class:"lyecs-table-list-warp"},Pe={class:"list-table-tool lyecs-search-warp"},Re={class:"list-table-tool-row"},Be={class:"simple-form-warp"},Oe={class:"simple-form-field"},He={class:"form-group"},je={class:"control-container"},qe={class:"simple-form-field"},Ae={class:"form-group"},Ee={class:"control-container"},Ke={class:"filter-item"},We={class:"simple-form-field"},Ge={class:"form-group total-group"},Qe={class:"total"},Je={class:"value"},Xe={class:"simple-form-field"},Ze={key:0,class:"time-box"},et={key:1,class:"time-box"},tt={class:"product-info"},at={class:"day"},ot={key:0,class:"week"},lt={class:"date"},st={key:1},nt={key:0,class:"pagination-con"},dt=he({__name:"List",setup(ut){const{productName:q}=Ie().currentRoute.value.query;De();const R=_(!0),U=_(0),ae=_([]),m=_([]),B=_(),v=_({}),A=_([]),a=_({page:1,size:10,shopScopeType:0,shopIds:"",productName:"",timeType:"week",startDate:b(new Date,"YYYY-MM-DD"),endDate:b(ee(6,"add"),"YYYY-MM-DD")}),E=_([]);_({visible:!1,title:"设置库存",type:"set"});const oe=ye(()=>{if(a.value.timeType==="week"){const n=b(new Date,"YYYY-MM-DD");return a.value.startDate===n}else{const n=b(new Date,"YYYY-MM");return a.value.startDate===n}}),K=n=>{if(a.value.timeType==="week"){const e=L(a.value.startDate),u=n==="prev"?-7:7,c=e.add(u,"day");a.value.startDate=c.format("YYYY-MM-DD"),a.value.endDate=c.add(6,"day").format("YYYY-MM-DD")}else{const e=L(a.value.startDate),u=n==="prev"?-1:1,c=e.add(u,"month");a.value.startDate=c.format("YYYY-MM")}i()},le=n=>{const e=new Date;return e.setHours(0,0,0,0),n.getTime()<e.getTime()},se=n=>{const e=new Date;return e.setDate(1),e.setHours(0,0,0,0),n.getTime()<e.getTime()},ne=()=>{a.value.timeType=="week"?(a.value.startDate=b(new Date,"YYYY-MM-DD"),a.value.endDate=b(ee(6,"add"),"YYYY-MM-DD")):a.value.startDate=b(new Date,"YYYY-MM"),i()},de=()=>{a.value.timeType=="week"&&a.value.startDate&&(a.value.endDate=L(a.value.startDate).add(6,"day").format("YYYY-MM-DD"),i())},ue=()=>{a.value.shopScopeType===0&&(a.value.shopIds="",ae.value=[]),i()},i=async()=>{var n;R.value=!0;try{const e=await ze({...a.value}),u=e.records.map(c=>{var M;const g={};return(M=c.dateStockList)==null||M.forEach($=>{g[$.stockDate]=$}),{...c,_dayMap:g}});E.value=u,A.value=(n=u[0])==null?void 0:n.dateStockList.map(c=>c.stockDate),U.value=e.total,m.value=[]}catch(e){te.error(e.message)}finally{R.value=!1}},O=(n,e)=>{var u;return(u=n==null?void 0:n._dayMap)==null?void 0:u[e]},re=n=>["周日","周一","周二","周三","周四","周五","周六"][L(n).day()],ie=n=>L(n).format("MM-DD"),pe=(n,e)=>{if(B.value.clearSelection(),n.length==0){m.value=[];return}B.value.toggleRowSelection(e,!0),m.value.length=0,m.value.push(e)},ce=()=>!m.value||m.value.length===0?(te.error("请至少选择一项商品"),!1):!0,ve=({row:n,column:e,rowIndex:u,columnIndex:c})=>c>=3?"day-cell":"";return ke(()=>{q&&(a.value.productName=q),i()}),(n,e)=>{const u=h("el-button"),c=h("TigInput"),g=h("el-option"),M=h("el-select"),$=h("el-space"),H=h("el-date-picker"),me=h("el-form"),F=h("el-table-column"),fe=h("el-table"),_e=h("a-spin");return I(),Y("div",Le,[o("div",Ue,[o("div",Fe,[o("div",Pe,[s(me,{model:a.value,onSubmit:ge(i,["prevent"])},{default:d(()=>[o("div",Re,[o("div",Be,[o("div",Oe,[o("div",He,[e[12]||(e[12]=o("label",{class:"control-label"},[o("span",null,"商品名称：")],-1)),o("div",je,[s(c,{modelValue:a.value.productName,"onUpdate:modelValue":e[0]||(e[0]=t=>a.value.productName=t),name:"productName",placeholder:"输入商品名称",onKeyup:Ye(i,["enter"]),clearable:"",onClear:i},{append:d(()=>[s(u,{onClick:i},{default:d(()=>[...e[11]||(e[11]=[o("span",{class:"iconfont icon-chakan1"},null,-1)])]),_:1})]),_:1},8,["modelValue"])])])]),o("div",qe,[o("div",Ae,[e[13]||(e[13]=o("label",{class:"control-label",style:{width:"100px"}},[o("span",null,"库存查看范围：")],-1)),o("div",Ee,[s(M,{modelValue:a.value.shopScopeType,"onUpdate:modelValue":e[1]||(e[1]=t=>a.value.shopScopeType=t),onChange:ue},{default:d(()=>[s(g,{label:"全部门店",value:0}),s(g,{label:"指定门店",value:1})]),_:1},8,["modelValue"])])])])]),o("div",Ke,[o("div",We,[o("div",Ge,[o("div",Qe,[z(" 共"+f(U.value)+"条",1),be(o("span",null,",已选择"+f(m.value.length)+"条",513),[[Me,m.value.length]])]),o("div",Je,[s($,null,{default:d(()=>{var t,D;return[s(k(P),{params:{},path:"product/inventoryCalendar/BatchSetInventory",title:"批量设置库存",maskClose:!1,showFooter:!0,width:"600px",onOkCallback:i},{default:d(()=>[k($e)()==="admin"?(I(),j(u,{key:0,type:"primary"},{default:d(()=>[...e[14]||(e[14]=[z("统一设置库存",-1)])]),_:1})):N("",!0)]),_:1}),s(k(P),{params:{productInfo:((t=m.value[0])==null?void 0:t.productInfo)??null,shopInfo:(D=m.value[0])==null?void 0:D.shopInfo},path:"product/inventoryCalendar/ModifyInventory",title:"单个设置库存",maskClose:!1,showFooter:!0,width:"600px",onOkCallback:i},{default:d(()=>[s(u,{disabled:!m.value.length,onClick:ce},{default:d(()=>[...e[15]||(e[15]=[z("按时段设置库存",-1)])]),_:1},8,["disabled"])]),_:1},8,["params"])]}),_:1})])])]),o("div",Xe,[s($,null,{default:d(()=>[s(M,{modelValue:a.value.timeType,"onUpdate:modelValue":e[2]||(e[2]=t=>a.value.timeType=t),style:{width:"90px"},onChange:ne},{default:d(()=>[s(g,{label:"按周",value:"week"}),s(g,{label:"按月",value:"month"})]),_:1},8,["modelValue"]),s(u,{disabled:oe.value,onClick:e[3]||(e[3]=t=>K("prev"))},{default:d(()=>[z("上一"+f(a.value.timeType=="week"?"周":"月"),1)]),_:1},8,["disabled"]),a.value.timeType=="week"?(I(),Y("div",Ze,[s(H,{style:{width:"160px"},"value-format":"YYYY-MM-DD",modelValue:a.value.startDate,"onUpdate:modelValue":e[4]||(e[4]=t=>a.value.startDate=t),type:"date","disabled-date":le,onChange:e[5]||(e[5]=t=>de())},null,8,["modelValue"]),e[16]||(e[16]=o("p",null,"~",-1)),s(H,{disabled:"",style:{width:"160px"},"value-format":"YYYY-MM-DD",modelValue:a.value.endDate,"onUpdate:modelValue":e[6]||(e[6]=t=>a.value.endDate=t),type:"date"},null,8,["modelValue"])])):N("",!0),a.value.timeType=="month"?(I(),Y("div",et,[s(H,{style:{width:"160px"},"value-format":"YYYY-MM",modelValue:a.value.startDate,"onUpdate:modelValue":e[7]||(e[7]=t=>a.value.startDate=t),type:"month","disabled-date":se},null,8,["modelValue"])])):N("",!0),s(u,{onClick:e[8]||(e[8]=t=>K("next"))},{default:d(()=>[z("下一"+f(a.value.timeType=="week"?"周":"月"),1)]),_:1})]),_:1})])])])]),_:1},8,["model"])]),o("div",null,[s(_e,{spinning:R.value},{default:d(()=>[s(fe,{data:E.value,onSelect:pe,ref_key:"tableRef",ref:B,"highlight-current-row":!1,"cell-class-name":ve,border:""},{default:d(()=>[s(F,{type:"selection",width:"35",align:"center",class:"check-head"}),s(F,{label:"商品信息",align:"center"},{default:d(({row:t})=>{var D;return[o("div",tt,[s(k(xe),{src:t.productInfo.productImage,fit:"contain",width:"40",height:"40"},null,8,["src"]),o("span",null,f((D=t.productInfo)==null?void 0:D.productName),1)])]}),_:1}),s(F,{label:"门店",align:"center"},{default:d(({row:t})=>{var D;return[o("span",null,f((D=t.shopInfo)==null?void 0:D.shopName),1)]}),_:1}),(I(!0),Y(Ce,null,Te(A.value,(t,D)=>(I(),j(F,{key:t,align:"center"},{header:d(()=>[o("div",at,[a.value.timeType=="week"?(I(),Y("div",ot,f(re(t)),1)):N("",!0),o("div",lt,f(ie(t)),1)])]),default:d(({row:l})=>{var W,G,Q,J,X,Z;return[(W=O(l,t))!=null&&W.totalStock?(I(),Y("div",st,[o("p",null,"可预约数："+f((J=O(l,t))==null?void 0:J.availableStock),1),s(k(P),{params:{type:"edit",stockDate:t,shopId:(X=l.shopInfo)==null?void 0:X.shopId,productId:(Z=l.productInfo)==null?void 0:Z.productId},path:"product/inventoryCalendar/SetInventory",title:"修改库存",maskClose:!1,showFooter:!0,width:"40%",onOkCallback:i},{default:d(()=>{var C,T,S,V,w,x;return[s(u,{type:v.value[`edit-${(C=l.productInfo)==null?void 0:C.productId}-${(T=l.shopInfo)==null?void 0:T.shopId}-${t}`]?"primary":"info",disabled:!v.value[`edit-${(S=l.productInfo)==null?void 0:S.productId}-${(V=l.shopInfo)==null?void 0:V.shopId}-${t}`],onMouseenter:y=>{var r,p;return v.value[`edit-${(r=l.productInfo)==null?void 0:r.productId}-${(p=l.shopInfo)==null?void 0:p.shopId}-${t}`]=!0},onMouseleave:y=>{var r,p;return v.value[`edit-${(r=l.productInfo)==null?void 0:r.productId}-${(p=l.shopInfo)==null?void 0:p.shopId}-${t}`]=!1},icon:v.value[`edit-${(w=l.productInfo)==null?void 0:w.productId}-${(x=l.shopInfo)==null?void 0:x.shopId}-${t}`]?k(Ve):"",link:""},{default:d(()=>{var y,r,p;return[o("span",null,f(v.value[`edit-${(y=l.productInfo)==null?void 0:y.productId}-${(r=l.shopInfo)==null?void 0:r.shopId}-${t}`]?"修改库存":`已预约数：${((p=O(l,t))==null?void 0:p.usedStock)??0}`),1)]}),_:2},1032,["type","disabled","onMouseenter","onMouseleave","icon"])]}),_:2},1032,["params"])])):(I(),j(k(P),{key:0,params:{type:"set",stockDate:t,shopId:(G=l.shopInfo)==null?void 0:G.shopId,productId:(Q=l.productInfo)==null?void 0:Q.productId},path:"product/inventoryCalendar/SetInventory",title:"设置库存",maskClose:!1,showFooter:!0,width:"600px",onOkCallback:i},{default:d(()=>{var C,T,S,V,w,x;return[s(u,{type:v.value[`set-${(C=l.productInfo)==null?void 0:C.productId}-${(T=l.shopInfo)==null?void 0:T.shopId}-${t}`]?"primary":"info",disabled:!v.value[`set-${(S=l.productInfo)==null?void 0:S.productId}-${(V=l.shopInfo)==null?void 0:V.shopId}-${t}`],onMouseenter:y=>{var r,p;return v.value[`set-${(r=l.productInfo)==null?void 0:r.productId}-${(p=l.shopInfo)==null?void 0:p.shopId}-${t}`]=!0},onMouseleave:y=>{var r,p;return v.value[`set-${(r=l.productInfo)==null?void 0:r.productId}-${(p=l.shopInfo)==null?void 0:p.shopId}-${t}`]=!1},link:"",icon:v.value[`set-${(w=l.productInfo)==null?void 0:w.productId}-${(x=l.shopInfo)==null?void 0:x.shopId}-${t}`]?k(Se):""},{default:d(()=>{var y,r;return[o("span",null,f(v.value[`set-${(y=l.productInfo)==null?void 0:y.productId}-${(r=l.shopInfo)==null?void 0:r.shopId}-${t}`]?"设置库存":"未设置"),1)]}),_:2},1032,["type","disabled","onMouseenter","onMouseleave","icon"])]}),_:2},1032,["params"]))]}),_:2},1024))),128))]),_:1},8,["data"])]),_:1},8,["spinning"]),U.value>0?(I(),Y("div",nt,[s(k(Ne),{page:a.value.page,"onUpdate:page":e[9]||(e[9]=t=>a.value.page=t),size:a.value.size,"onUpdate:size":e[10]||(e[10]=t=>a.value.size=t),total:U.value,onCallback:i},null,8,["page","size","total"])])):N("",!0)])])])])}}}),yt=we(dt,[["__scopeId","data-v-ea2c1819"]]);export{yt as default};

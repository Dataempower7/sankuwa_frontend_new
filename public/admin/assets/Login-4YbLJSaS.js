import{Y as Q,Z as W,$ as X,d as D,a0 as j,r as t,c as Y,y as ee,e as c,f as h,g as k,F as le,z as l,n as oe,l as a,k as B,p as te,t as R,_ as Z,s as G,a as se,o as ae,q as ne,h as C,T as re,j as ie,a1 as O,i as n,L as q,C as ue}from"./index-BLXOA87U.js";import{_ as H}from"./Verify.vue_vue_type_script_setup_true_lang-CHLZzIIP.js";import"./Verify.vue_vue_type_style_index_0_lang-6inGDsc1.js";import"./zh-cn-DldQh89R.js";import{_ as de}from"./SelectShop.vue_vue_type_script_setup_true_lang-BCpapszh.js";import me from"./Logo-D9yGvc7k.js";import"./index-B16C4gX_.js";import"./merchant_logo-DuVmNXah.js";import"./format-DdZABYp4.js";import"./theme-BlP4l20S.js";import"./version-hjn5tnxG.js";function pe(r,d,T){d=Q(d,r);var i=-1,u=d.length;for(u||(u=1,r=void 0);++i<u;){var f=r==null?void 0:r[W(d[i])];f===void 0&&(i=u,f=T),r=X(f)?f.call(r):f}return r}const ce={key:1,class:"code-text"},fe=D({__name:"MobileCode",props:{class:String,mobileCode:{type:String,default:""},mobile:{type:String,default:""},requestApi:{type:Function,default:pe}},emits:["update:mobileCode","mobileErrorCallback"],setup(r,{emit:d}){const T=r,{mobile:i}=j(T),u=d,f=t("获取验证码"),x=t("");t(0);const m=t(!0),F=t(),V=t(null),v=t(60),S=()=>{u("update:mobileCode",x.value)},g=async()=>{if(i.value=="")return u("mobileErrorCallback","手机号不能为空！"),!1;if(!y(i.value)){u("mobileErrorCallback","手机号格式错误");return}if(!V.value){F.value.show();return}try{const p=await T.requestApi({mobile:i.value,verifyToken:V.value,event:"login"});m.value=!1,V.value=null,w()}catch(p){u("mobileErrorCallback",p.message);return}finally{}},y=p=>!!/^(?:\+?86)?1[3-9]\d{9}$/.test(p),s=Y(()=>v.value+"秒后重发"),U=t(),w=()=>{U.value=setInterval(()=>{v.value--,v.value<=0&&(clearInterval(U.value),m.value=!0,v.value=60)},1e3)},M=p=>{V.value=p.verifyToken,g()};return ee(()=>{clearInterval(U.value)}),(p,z)=>{const $=c("TigInput");return k(),h(le,null,[l($,{width:"100%",size:"large",class:oe(r.class),placeholder:"请输入验证码",modelValue:x.value,"onUpdate:modelValue":z[0]||(z[0]=P=>x.value=P),onInput:S},{suffix:a(()=>[m.value?(k(),h("div",{key:0,class:"code-btn",onClick:te(g,["stop"])},R(f.value),1)):B("",!0),m.value?B("",!0):(k(),h("div",ce,R(s.value),1))]),_:1},8,["class","modelValue"]),l(H,{ref_key:"verify",ref:F,mode:"pop",captchaType:"blockPuzzle",imgSize:{width:"310px",height:"155px"},onOkCallback:M},null,512)],64)}}}),ve=Z(fe,[["__scopeId","data-v-6809bd99"]]),ge=r=>G({url:"login/signin",method:"post",data:r}),be=r=>G({url:"login/sendMobileCode",method:"post",data:r}),_e={class:"page-container"},ke={class:"login-page-right"},ye={class:"login-box"},we={class:"login-title"},Ce={class:"login-title-intro"},he={class:"login-tabs-warp"},Te={key:0,class:"erro-message"},xe={class:"flex flex-justify-between",style:{width:"100%"}},Ve={key:0,class:"erro-message"},Se={key:1},Ie=D({__name:"Login",setup(r){const d=t(),T=t(!0),i=t(!1),x=se().currentRoute.value.fullPath.includes("merchantLogin"),m=t("password"),F=t(""),V=t(""),v=t(""),S=t(!1),g=t(),y=t();let s=t({username:"",password:"",remember:!1,verifyToken:null});const U=t(""),w=async b=>{if(b){await b.validate(),S.value=!0;try{const e=await ge({loginType:m.value,captchaUid:U.value,...s.value});localStorage.setItem("accessToken",e.token??""),localStorage.setItem("adminType",e.adminType??""),i.value=!0}catch(e){console.error(e),e.code==1002?d.value.show():e.code>0&&(ue.error({message:"错误",description:e.message}),m.value=="password"?V.value=e.message:v.value=e.message)}finally{setTimeout(()=>{S.value=!1},600)}}},M=t(),p=b=>{s.value.verifyToken=b.verifyToken,g.value&&w(g.value)},z=()=>{y.value&&y.value.validateField("mobile")},$=Y(()=>!1),P=(b,e,I)=>{if(!e){I(new Error("手机号不能为空"));return}/^(?:\+?86)?1[3-9]\d{9}$/.test(e)?I():I("手机号格式错误")};return ae(()=>{const b=localStorage.getItem("accessToken"),e=localStorage.getItem("shopId");b&&!e&&ne(()=>{i.value=!0})}),(b,e)=>{const I=c("el-alert"),E=c("TigInput"),_=c("el-form-item"),L=c("el-button"),N=c("el-checkbox"),A=c("el-form"),K=c("el-tab-pane"),J=c("el-tabs");return k(),h("div",_e,[l(me),C("div",ke,[C("div",ye,[C("h1",we,[e[13]||(e[13]=C("span",{class:"login-title-welcome"},"欢迎登录",-1)),C("span",Ce,R(T.value?"商城后台管理系统":"商家后台管理系统"),1)]),C("div",he,[l(re,{mode:"out-in",name:"slide-fade"},{default:a(()=>[i.value?(k(),h("div",Se,[l(de,{selectShopFlag:i.value,"onUpdate:selectShopFlag":e[12]||(e[12]=o=>i.value=o)},null,8,["selectShopFlag"])])):(k(),ie(J,{key:0,modelValue:m.value,"onUpdate:modelValue":e[11]||(e[11]=o=>m.value=o),class:"login-tabs"},{default:a(()=>[l(K,{name:"password",label:"密码登录"},{default:a(()=>[l(A,{ref_key:"passwordFormRef",ref:g,model:n(s),onKeyup:e[4]||(e[4]=O(o=>w(g.value??null),["enter"]))},{default:a(()=>[F.value?(k(),h("div",Te,[l(I,{type:"error",title:F.value,"show-icon":""},null,8,["title"])])):B("",!0),l(_,{class:"login-row",prop:"username",rules:[{required:!0,message:"用户名不能为空!"}]},{default:a(()=>[l(E,{width:"100%",class:"login-input",size:"large",modelValue:n(s).username,"onUpdate:modelValue":e[0]||(e[0]=o=>n(s).username=o),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),l(_,{class:"login-row",prop:"password",rules:[{required:!0,message:"密码不能为空!"}]},{default:a(()=>[l(E,{width:"100%",type:"password","show-password":"",class:"login-input",size:"large",modelValue:n(s).password,"onUpdate:modelValue":e[1]||(e[1]=o=>n(s).password=o),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),l(_,null,{default:a(()=>[l(L,{ref_key:"submitBtn",ref:M,loading:S.value,class:"login-submit-btn",disabled:$.value,type:"primary",onClick:e[2]||(e[2]=o=>w(g.value??null))},{default:a(()=>e[14]||(e[14]=[q(" 登 录 ",-1)])),_:1,__:[14]},8,["loading","disabled"])]),_:1}),l(_,{prop:"remember"},{default:a(()=>[C("div",xe,[l(N,{checked:n(s).remember,"onUpdate:checked":e[3]||(e[3]=o=>n(s).remember=o)},{default:a(()=>e[15]||(e[15]=[q("记住登录状态",-1)])),_:1,__:[15]},8,["checked"])])]),_:1})]),_:1},8,["model"]),l(H,{ref_key:"verify",ref:d,mode:"pop",captchaType:"blockPuzzle",imgSize:{width:"310px",height:"155px"},onOkCallback:p},null,512)]),_:1}),l(K,{name:"mobile",label:"手机登录"},{default:a(()=>[l(A,{ref_key:"mobileFormRef",ref:y,model:n(s),onKeyup:e[10]||(e[10]=O(o=>w(y.value??null),["enter"]))},{default:a(()=>[v.value?(k(),h("div",Ve,[l(I,{type:"error",title:v.value,"show-icon":""},null,8,["title"])])):B("",!0),l(_,{class:"login-row",prop:"mobile",rules:[{validator:P,trigger:"blur"}]},{default:a(()=>[l(E,{width:"100%",class:"login-input",size:"large",modelValue:n(s).mobile,"onUpdate:modelValue":e[5]||(e[5]=o=>n(s).mobile=o),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1},8,["rules"]),l(_,{class:"login-row",prop:"mobileCode",rules:[{required:!0,message:"验证码不能为空!",trigger:"blur"}]},{default:a(()=>[l(n(ve),{class:"login-input",mobile:n(s).mobile,"onUpdate:mobile":e[6]||(e[6]=o=>n(s).mobile=o),mobileCode:n(s).mobileCode,"onUpdate:mobileCode":e[7]||(e[7]=o=>n(s).mobileCode=o),requestApi:n(be),onMobileErrorCallback:z},null,8,["mobile","mobileCode","requestApi"])]),_:1}),l(_,null,{default:a(()=>[l(L,{ref_key:"submitBtn",ref:M,loading:S.value,class:"login-submit-btn",disabled:$.value,type:"primary",onClick:e[8]||(e[8]=o=>w(y.value??null))},{default:a(()=>e[16]||(e[16]=[q(" 登 录 ",-1)])),_:1,__:[16]},8,["loading","disabled"])]),_:1}),l(_,{prop:"remember"},{default:a(()=>[l(N,{checked:n(s).remember,"onUpdate:checked":e[9]||(e[9]=o=>n(s).remember=o)},{default:a(()=>e[17]||(e[17]=[q("记住登录状态",-1)])),_:1,__:[17]},8,["checked"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["modelValue"]))]),_:1})])])])])}}}),Ne=Z(Ie,[["__scopeId","data-v-22160f35"]]);export{Ne as default};

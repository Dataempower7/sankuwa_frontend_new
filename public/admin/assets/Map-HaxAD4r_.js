import{_,r as o,o as k,Y as A,y as R,g as b,h,i as c,L as x,al as V,P as p,e7 as E}from"./index-B52YIGC0.js";import{A as I}from"./index-Wb8975_T.js";const S={class:"circle-editor"},B={class:"radius-control"},J={__name:"Map",props:{center:{type:Array,default:()=>[116.433322,39.900256]},radius:{type:Number,default:1e3}},emits:["updateRadius"],setup(f,{expose:m,emit:y}){const g=o(!0),d=o(null),s=o(null),a=o(null),n=o(null),i=o(null),l=o(1);o("#1791fc"),o("#FF33FF");const u=f,w=y,v=()=>{s.value&&a.value&&setTimeout(()=>{s.value.setFitView([a.value])},100)},M=()=>{if(l.value>=1e5&&(l.value=99999,p.warning("同城配送范围半径请填写0~100000")),a.value&&typeof l.value=="number"&&l.value>0){const e=l.value*1e3;a.value.setRadius(e),n.value&&(n.value.close(),n.value.open()),w("updateRadius",e),v()}},C=async e=>{try{window._AMapSecurityConfig={securityJsCode:e.amapJsSecret};const t=await I.load({key:e.amapJsKey,version:"2.0",plugins:["AMap.CircleEditor"]});i.value=t,s.value=new i.value.Map(d.value,{center:u.center,zoom:14}),l.value=u.radius/1e3,a.value=new i.value.Circle({center:u.center,radius:u.radius,borderWeight:3,strokeColor:"#FF33FF",strokeOpacity:1,strokeWeight:6,strokeOpacity:.2,fillOpacity:.3,strokeStyle:"dashed",strokeDasharray:[10,10],fillColor:"#628fdd",zIndex:50}),s.value.add(a.value),s.value.setFitView([a.value]),n.value=new i.value.CircleEditor(s.value,a.value),n.value.open(),n.value.on("move",function(r){console.log("触发事件：move")}),n.value.on("adjust",function(r){console.log("触发事件：adjust"),a.value&&(l.value=a.value.getRadius()/1e3),v()}),n.value.on("end",function(r){console.log("触发事件：end")})}catch(t){console.error("地图加载失败:",t)}},F=async()=>{try{const e=await E({use:1});C(e)}catch(e){p.error(e.message)}finally{g.value=!1}};return k(()=>{}),A(()=>u.center,e=>{F()},{immediate:!0}),R(()=>{s.value&&s.value.destroy()}),m({}),(e,t)=>(h(),b("div",S,[c("div",{class:"map-container",ref_key:"mapContainerRef",ref:d},null,512),c("div",B,[t[2]||(t[2]=c("label",{for:"radius-input"},"半径（公里）:",-1)),x(c("input",{id:"radius-input","onUpdate:modelValue":t[0]||(t[0]=r=>l.value=r),type:"number",class:"radius-input",max:1e5,onInput:t[1]||(t[1]=r=>M()),placeholder:"请输入半径",step:"0.1"},null,544),[[V,l.value,void 0,{number:!0}]])])]))}},z=_(J,[["__scopeId","data-v-2c924b45"]]);export{z as default};

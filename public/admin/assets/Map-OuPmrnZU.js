import{_,r as t,o as C,y as w,g as F,h as k,i as c,L as h,al as A,e7 as b}from"./index-B52YIGC0.js";import{A as x}from"./index-Wb8975_T.js";const R={class:"circle-editor"},V={class:"radius-control"},E={__name:"Map",props:{center:{type:Array,default:()=>[116.433322,39.900256]},radius:{type:Number,default:1e3}},setup(p,{expose:f}){const m=t(!0),d=t(null),o=t(null),e=t(null),l=t(null),r=t(null),n=t(1);t("#1791fc"),t("#FF33FF");const u=p,v=()=>{o.value&&e.value&&setTimeout(()=>{o.value.setFitView([e.value])},100)},y=()=>{if(e.value&&typeof n.value=="number"&&n.value>0){const a=n.value*1e3;e.value.setRadius(a),l.value&&(l.value.close(),l.value.open()),v()}},g=async a=>{try{window._AMapSecurityConfig={securityJsCode:a.amapJsSecret};const s=await x.load({key:a.amapJsKey,version:"2.0",plugins:["AMap.CircleEditor"]});r.value=s,o.value=new r.value.Map(d.value,{center:u.center,zoom:14}),n.value=u.radius/1e3,e.value=new r.value.Circle({center:u.center,radius:u.radius,borderWeight:3,strokeColor:"#FF33FF",strokeOpacity:1,strokeWeight:6,strokeOpacity:.2,fillOpacity:.3,strokeStyle:"dashed",strokeDasharray:[10,10],fillColor:"#628fdd",zIndex:50}),o.value.add(e.value),o.value.setFitView([e.value]),l.value=new r.value.CircleEditor(o.value,e.value),l.value.open(),l.value.on("move",function(i){console.log("触发事件：move")}),l.value.on("adjust",function(i){console.log("触发事件：adjust"),e.value&&(n.value=e.value.getRadius()/1e3),v()}),l.value.on("end",function(i){console.log("触发事件：end")})}catch(s){console.error("地图加载失败:",s)}},M=async()=>{try{const a=await b({use:1});g(a)}catch(a){message.error(a.message)}finally{m.value=!1}};return C(()=>{M()}),w(()=>{o.value&&o.value.destroy()}),f({}),(a,s)=>(k(),F("div",R,[c("div",{class:"map-container",ref_key:"mapContainerRef",ref:d},null,512),c("div",V,[s[1]||(s[1]=c("label",{for:"radius-input"},"半径（公里）:",-1)),h(c("input",{id:"radius-input","onUpdate:modelValue":s[0]||(s[0]=i=>n.value=i),type:"number",class:"radius-input",onChange:y,placeholder:"请输入半径",step:"0.1"},null,544),[[A,n.value,void 0,{number:!0}]])])]))}},I=_(E,[["__scopeId","data-v-4811527e"]]);export{I as default};

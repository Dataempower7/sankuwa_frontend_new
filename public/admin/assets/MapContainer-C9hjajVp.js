import{A as I}from"./index-Wb8975_T.js";import{_ as W,r as s,o as Z,y as O,g as p,h as d,i as n,l as S,Q,t as C,F as U,p as $,e7 as q,P as G}from"./index-B52YIGC0.js";const H={class:"map-page"},X={class:"map-content"},Y={class:"map-card"},ee={key:0,class:"loading-overlay"},ae={key:0,class:"error-message"},te={key:0,class:"custom-search-results"},oe={class:"results-list"},se=["onClick"],ne={class:"result-name"},le={class:"result-address"},re={__name:"MapContainer",props:{defaultPosition:{type:String,default:""},isDialog:Boolean},emits:["positionChange"],setup(T,{expose:A,emit:B}){const f=T,K=B;let t=null,g=null;const w=s(null),r=s(!0),m=s(!1),h=s(""),_=s("未加载"),L=s(10),P=s([116.397428,39.90923].join(", ")),y=s(null),i=s(""),c=s([]),v=s([]),u=s([]);s({amapWebKey:"",amapWebSecret:"",amapJsKey:"",amapJsSecret:"",amapMiniKey:"",amapMiniSecret:""});const M=(e,a,o)=>{if(!t)return;const l=new AMap.Marker({position:[e,a],title:o});return t.add(l),l},N=()=>{if(t){L.value=t.getZoom();const e=t.getCenter();P.value=[e.getLng(),e.getLat()].join(", ")}},x=e=>{r.value=!0,m.value=!1,_.value="加载中",window._AMapSecurityConfig={securityJsCode:e.amapJsSecret},I.load({key:e.amapJsKey,version:"2.0",plugins:["AMap.Scale","AMap.ToolBar","AMap.MapType","AMap.PlaceSearch"]}).then(a=>{let o=f.defaultPosition||P.value,[l,k]=o.split(",").map(Number);if(isNaN(l)||isNaN(k)){m.value=!0,h.value="无效的默认位置，请检查输入的坐标。",r.value=!1;return}if(t=new a.Map(w.value,{zoom:L.value,center:[l,k],viewMode:"2D"}),g=new a.PlaceSearch({map:t}),t.addControl(new a.Scale),t.addControl(new a.ToolBar),t.addControl(new a.MapType),f.defaultPosition){const[R,V]=f.defaultPosition.split(",").map(Number),j=M(R,V,"默认位置");u.value.push(j)}t.on("moveend",N),t.on("zoomchange",N),_.value="已加载",r.value=!1}).catch(a=>{console.error(a),m.value=!0,h.value=a.message,_.value="加载失败",r.value=!1})},J=e=>{i.value=e,b()},b=()=>{!g||!i.value.trim()||g.search(i.value,(e,a)=>{if(e==="complete"&&a.info==="OK"){if(c.value=a.poiList.pois,v.value.includes(i.value)||(v.value.unshift(i.value),v.value.length>5&&v.value.pop()),c.value.length>0){const o=c.value[0];D(o.location,o.name)}}else console.error("搜索失败:",a)})},D=(e,a)=>{if(t){const o=M(e.lng,e.lat,a);o&&(y.value={title:a,position:o.getPosition(),time:new Date().toLocaleTimeString()})}else console.error("地图未加载，无法添加标记")},z=e=>{if(!t)return;u.value.forEach(o=>o.setMap(null)),u.value=[],t.setCenter([e.location.lng,e.location.lat]),t.setZoom(15);const a=M(e.location.lng,e.location.lat,e.name);y.value={title:e.name,position:a.getPosition(),time:new Date().toLocaleTimeString()},K("positionChange",{position:[e.location.lng,e.location.lat],name:e.name}),u.value.push(a)},E=()=>{c.value=[],i.value="",u.value.forEach(e=>e.setMap(null)),u.value=[],y.value=null},F=async()=>{try{const e=await q({use:1});x(e)}catch(e){G.error(e.message)}finally{r.value=!1}};return Z(()=>{F()}),O(()=>{t&&t.destroy()}),A({search:J,clearSearch:E}),(e,a)=>(d(),p("div",H,[n("div",X,[n("div",Y,[n("div",{id:"container",class:"map-container",ref_key:"mapContainer",ref:w},[r.value?(d(),p("div",ee,[...a[0]||(a[0]=[n("div",{class:"spinner"},null,-1),n("p",null,"地图加载中，请稍候...",-1)])])):S("",!0)],512),m.value?(d(),p("div",ae,[a[1]||(a[1]=Q(" 地图加载失败，请检查网络连接或刷新页面重试。 ",-1)),n("p",null,"错误信息: "+C(h.value),1)])):S("",!0)]),c.value.length>0?(d(),p("div",te,[a[2]||(a[2]=n("div",{class:"results-header"},[n("h3",null,"搜索结果")],-1)),n("div",oe,[(d(!0),p(U,null,$(c.value,(o,l)=>(d(),p("div",{key:l,class:"result-item",onClick:k=>z(o)},[n("div",ne,C(o.name),1),n("div",le,C(o.address),1)],8,se))),128))])])):S("",!0)])]))}},ue=W(re,[["__scopeId","data-v-523259c0"]]);export{ue as M};

import{d as X,r as p,b as Z,ab as ee,o as te,Y as E,f as n,g as D,h as c,i as s,z as l,m as a,k as x,l as b,j as z,t as h,Q as w,F as le,p as ae,av as oe,P as q,H as B,_ as ne}from"./index-B52YIGC0.js";import{a as se,b as ue}from"./inventoryCalendar-CGXkAm9Q.js";import{_ as de}from"./Image.vue_vue_type_script_setup_true_lang-B8qXJKJq.js";import"./format-BxqOrW-w.js";const re={class:"container"},ie={class:"content_wrapper"},ce={class:"header"},pe={class:"header-left"},me={style:{"margin-left":"15px"}},_e={style:{color:"#8a9099"}},fe={style:{display:"flex","align-items":"center"}},ye={key:2},ve={class:"table-header"},ge={class:"input-wrapper"},xe=X({__name:"ModifyInventory",props:{productInfo:{type:Object,required:!0},shopInfo:{type:Object,required:!0}},emits:["submitCallback","update:confirmLoading","close"],setup(R,{expose:F,emit:$}){var L;const k=$,m=R,_=p(!0);Z().currentRoute.value.query;const S=ee(),t=p({dateRange:[],excludeType:1,excludeDay:[],selectionType:3,shopIds:(L=m.shopInfo)==null?void 0:L.shopId}),I=p([]),r=p(!1),f=p([]),T=p({}),O=async()=>{var u;_.value=!0;try{const e=await se({productId:(u=m.productInfo)==null?void 0:u.productId});T.value=e,I.value=e.timeSlotStockList.map(y=>({...y,quantity:0}))}catch(e){q.error(e.message)}finally{_.value=!1}},P=async()=>{var v,g,i;console.log(t.value.shopId,m.shopInfo),await S.value.validate();const u={selectionType:t.value.selectionType,shopIds:t.value.shopIds};console.log(t.value.shopIds,m.shopInfo);const e={};r.value&&(t.value.excludeType===1?e.excludeWeekdays=t.value.excludeDay:t.value.excludeType===2&&(e.excludeMonthDays=t.value.excludeDay));const y=I.value.map(d=>({productReservationTimeId:d.productReservationTimeId,quantity:d.quantity||0})),V={productId:(v=m.productInfo)==null?void 0:v.productId,shopSelection:u,startDate:B((g=t.value.dateRange)==null?void 0:g[0]).format("YYYY-MM-DD"),endDate:B((i=t.value.dateRange)==null?void 0:i[1]).format("YYYY-MM-DD"),dateExclusion:Object.keys(e).length>0?e:void 0,timeSlotStockItems:y};try{k("update:confirmLoading",!0);const d=await ue(V);k("submitCallback",d),q.success("操作成功")}catch(d){q.error(d.message)}finally{k("update:confirmLoading",!1)}};F({onFormSubmit:()=>{P()}});const C=()=>{t.value.excludeType===1?f.value=[{key:1,label:"周一"},{key:2,label:"周二"},{key:3,label:"周三"},{key:4,label:"周四"},{key:5,label:"周五"},{key:6,label:"周六"},{key:7,label:"周日"}]:t.value.excludeType===2?f.value=Array.from({length:31},(u,e)=>({key:e+1,label:`${e+1}号`})):f.value=[]};return te(()=>{O()}),E(()=>t.value.excludeType,()=>{t.value.excludeDay=[],C()},{immediate:!0}),E(r,u=>{u?C():(t.value.excludeDay=[],f.value=[])}),(u,e)=>{const y=n("el-date-picker"),V=n("el-checkbox"),v=n("el-radio"),g=n("el-radio-group"),i=n("el-form-item"),d=n("el-option"),A=n("el-select"),Y=n("el-table-column"),H=n("el-icon"),Q=n("el-tooltip"),W=n("TigInput"),G=n("el-table"),M=n("a-spin"),J=n("el-form");return c(),D("div",re,[s("div",ie,[l(M,{spinning:_.value,style:{width:"100%","margin-top":"100px"}},{default:a(()=>{var N,U,j;return[s("div",ce,[s("div",pe,[l(z(de),{src:(N=T.value)==null?void 0:N.picUrl,fit:"contain",width:"40",height:"40"},null,8,["src"]),s("span",me,h((U=T.value)==null?void 0:U.productName),1)]),s("span",_e,"门店："+h((j=R.shopInfo)==null?void 0:j.shopName),1)]),_.value?b("",!0):(c(),x(J,{key:0,ref_key:"formRef",ref:S,model:t.value,inline:"","label-width":"auto"},{default:a(()=>[l(i,{label:"日期范围",prop:"dateRange",rules:[{required:!0,message:"请选择时间范围"}]},{default:a(()=>[s("div",fe,[l(y,{modelValue:t.value.dateRange,"onUpdate:modelValue":e[0]||(e[0]=o=>t.value.dateRange=o),type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"50%","margin-right":"10px"}},null,8,["modelValue"]),l(V,{modelValue:r.value,"onUpdate:modelValue":e[1]||(e[1]=o=>r.value=o),"true-value":1,"false-value":0},{default:a(()=>[...e[4]||(e[4]=[w("排除时间",-1)])]),_:1},8,["modelValue"])]),r.value?(c(),x(i,{key:0,prop:"excludeType",rules:[{required:!0,message:"请选择排除类型"}]},{default:a(()=>[l(g,{modelValue:t.value.excludeType,"onUpdate:modelValue":e[2]||(e[2]=o=>t.value.excludeType=o)},{default:a(()=>[l(v,{value:1,size:"large"},{default:a(()=>[...e[5]||(e[5]=[w("每周排除",-1)])]),_:1}),l(v,{value:2,size:"large"},{default:a(()=>[...e[6]||(e[6]=[w("每月排除",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})):b("",!0),r.value?(c(),x(i,{key:1,prop:"excludeDay",rules:[{required:!0,message:"请选择排除时间"}]},{default:a(()=>[l(A,{modelValue:t.value.excludeDay,"onUpdate:modelValue":e[3]||(e[3]=o=>t.value.excludeDay=o),placeholder:"",style:{width:"240px"},multiple:""},{default:a(()=>[(c(!0),D(le,null,ae(f.value,o=>(c(),x(d,{key:o.key,label:o.label,value:o.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):b("",!0),r.value?(c(),D("div",ye,[...e[7]||(e[7]=[s("p",{style:{color:"#8a8099","margin-top":"15px"}},"仅修改商品在改日期范围内的可预约数量",-1)])])):b("",!0)]),_:1}),l(i,{label:"可预约时段",rules:[{required:!0}]},{default:a(()=>[l(M,{spinning:_.value},{default:a(()=>[l(G,{data:I.value,border:"",align:"center"},{default:a(()=>[l(Y,{label:"时间段",align:"center","min-width":"200px"},{default:a(({row:o})=>[s("span",null,h(`${o.startTime}~${o.endTime}`),1)]),_:1}),l(Y,{prop:"stockChange","min-width":"200px",align:"center"},{header:a(()=>[s("div",ve,[e[8]||(e[8]=s("span",null,h("增加 / 减少数量"),-1)),l(Q,{effect:"dark",content:"正数为增加数量 负数为减少数量",placement:"top"},{default:a(()=>[l(H,null,{default:a(()=>[l(z(oe))]),_:1})]),_:1})])]),default:a(({row:o})=>[s("div",ge,[l(W,{width:"60px",classType:"tig-input",type:"integer",allowNegative:"",size:"medium",modelValue:o.quantity,"onUpdate:modelValue":K=>o.quantity=K,placeholder:""},null,8,["modelValue","onUpdate:modelValue"])])]),_:1})]),_:1},8,["data"])]),_:1},8,["spinning"])]),_:1})]),_:1},8,["model"]))]}),_:1},8,["spinning"])])])}}}),Ve=ne(xe,[["__scopeId","data-v-3f6a6e9f"]]);export{Ve as default};

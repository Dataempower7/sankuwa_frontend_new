import{d as P,b as Q,ar as Y,r as w,Y as G,o as J,f as p,g,h as c,z as m,m as d,Q as C,F as I,p as H,k as K,i as T,n as $,j as W,ds as X,l as O,t as U,P as N,_ as Z}from"./index-B52YIGC0.js";import{a as B}from"./appointmentTpl-DplhS7jl.js";const x={class:"time-picker-row"},ee={class:"time-picker-wrapper"},te={class:"time-picker-wrapper"},re={class:"error-messages-row"},ae={key:0,class:"error-message"},oe={key:1,class:"error-message"},se={class:"add-tip"},le=P({__name:"OrderInfo",props:{formState:{default:{}},formStateModifiers:{}},emits:["update:formState"],setup(q){const M=Q(),n=Y(q,"formState"),o=w([{startTime:"",endTime:""}]),V=w([]),v=w({}),z=[{required:!0,trigger:"blur",validator:(r,e,t)=>{if(!o.value||o.value.length===0){console.log(111,"cuowu"),t(new Error("请至少添加一个时间段"));return}if(!o.value.some(i=>i.startTime&&i.endTime)){t(new Error("请至少配置一个完整的时间段"));return}if(h().length>0){t(new Error("请根据提示完成时间段调整"));return}t()}}],A=()=>{if(o.value.length===10)return N.error("最多只能添加10个时间段");o.value.push({startTime:"",endTime:""})},D=r=>{if(o.value.length===1)return N.error("请至少保留配置一个时间段");o.value.splice(r,1),delete v.value[r],h()},E=r=>{const e=o.value[r];if(!e.startTime||!e.endTime){v.value[r]={},n.value.reservationTimes=o.value;return}const t={};e.startTime>=e.endTime&&(t.startTime="开始时间不能大于或等于结束时间",t.endTime="结束时间不能小于或等于开始时间");for(let s=0;s<o.value.length;s++){if(s===r)continue;const a=o.value[s];!a.startTime||!a.endTime||R(e.startTime,e.endTime,a.startTime,a.endTime)&&(t.startTime=t.startTime||"时间段不能重复",t.endTime=t.endTime||"时间段不能重复")}if(r>0){const s=o.value[r-1];s.startTime&&s.endTime&&e.startTime&&e.startTime<s.endTime&&(t.startTime=t.startTime||"时间段不能早于前一个时间段的结束时间")}v.value[r]=t,n.value.reservationTimes=o.value,h()},h=()=>{const r=[];return o.value.forEach((e,t)=>{const s=o.value[t];if(!s.startTime||!s.endTime){v.value[t]={};return}const a={};s.startTime>=s.endTime&&(a.startTime="开始时间不能大于或等于结束时间",a.endTime="结束时间不能小于或等于开始时间");for(let i=0;i<o.value.length;i++){if(i===t)continue;const f=o.value[i];!f.startTime||!f.endTime||R(s.startTime,s.endTime,f.startTime,f.endTime)&&(a.startTime=a.startTime||"时间段不能重复",a.endTime=a.endTime||"时间段不能重复")}if(t>0){const i=o.value[t-1];i.startTime&&i.endTime&&s.startTime&&s.startTime<i.endTime&&(a.startTime=a.startTime||"时间段不能早于前一个时间段的结束时间")}v.value[t]=a,a.startTime&&r.push(`第${t+1}个时间段开始时间: ${a.startTime}`),a.endTime&&r.push(`第${t+1}个时间段结束时间: ${a.endTime}`)}),r},R=(r,e,t,s)=>r<s&&t<e,k=r=>{var t;const e=o.value[r];return!e.startTime||!e.endTime?"":(t=v.value[r])==null?void 0:t.startTime},F=()=>{M.push({path:"/setting/appointment-tpl/list"})},y=r=>{var t;const e=o.value[r];return!e.startTime||!e.endTime?"":(t=v.value[r])==null?void 0:t.endTime};(async()=>{if(n.value.shopId&&n.value.shopId>0){const e=await B({shopId:n.value.shopId});V.value=e;return}const r=await B();V.value=r})();const j=()=>{console.log("初始化数据回显:",n.value),n.value.reservationTimes&&n.value.reservationTimes.length>0&&(o.value=n.value.reservationTimes)};return G(()=>n.value,r=>{r&&r.reservationTimes&&(o.value=r.reservationTimes,h())},{deep:!0,immediate:!0}),J(()=>{j()}),(r,e)=>{const t=p("el-radio"),s=p("el-radio-group"),a=p("el-form-item"),i=p("el-option"),f=p("el-select"),S=p("el-button"),b=p("el-time-picker"),L=p("el-icon");return c(),g(I,null,[m(a,{label:"配送方式",rules:[{required:!0,message:"请选择配送方式"}],prop:"noShipping"},{default:d(()=>[m(s,{modelValue:n.value.noShipping,"onUpdate:modelValue":e[0]||(e[0]=l=>n.value.noShipping=l),style:{width:"100%","margin-bottom":"10px"}},{default:d(()=>[m(t,{value:1},{default:d(()=>[...e[2]||(e[2]=[C("无需配送",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),m(a,{label:"预约模板",prop:"reservationTplId",rules:[{required:!0,message:"请选择预约模板"}]},{default:d(()=>[m(f,{modelValue:n.value.reservationTplId,"onUpdate:modelValue":e[1]||(e[1]=l=>n.value.reservationTplId=l),placeholder:"请选择预约模板",style:{width:"250px"}},{default:d(()=>[(c(!0),g(I,null,H(V.value,l=>(c(),K(i,{key:l==null?void 0:l.reservationTplId,label:l==null?void 0:l.templateName,value:l==null?void 0:l.reservationTplId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),m(S,{type:"primary",link:"",onClick:F,class:"ml5"},{default:d(()=>[...e[3]||(e[3]=[C("去设置",-1)])]),_:1})]),_:1}),m(a,{label:"预约时间段",prop:"reservationTimes",rules:z},{default:d(()=>[(c(!0),g(I,null,H(o.value,(l,u)=>(c(),g("div",{class:"time-period",key:u},[T("div",x,[T("div",ee,[m(b,{format:"HH:mm","value-format":"HH:mm",style:{width:"110px"},modelValue:l.startTime,"onUpdate:modelValue":_=>l.startTime=_,placeholder:"开始时间",class:$({"is-error":k(u)}),onChange:_=>E(u)},null,8,["modelValue","onUpdate:modelValue","class","onChange"])]),e[4]||(e[4]=T("div",{class:"time-separator"},"-",-1)),T("div",te,[m(b,{format:"HH:mm","value-format":"HH:mm",style:{width:"110px"},modelValue:l.endTime,"onUpdate:modelValue":_=>l.endTime=_,placeholder:"结束时间",class:$({"is-error":y(u)}),onChange:_=>E(u)},null,8,["modelValue","onUpdate:modelValue","class","onChange"])]),m(L,{color:"#8a9099",onClick:_=>D(u),class:"remove-icon"},{default:d(()=>[m(W(X))]),_:1},8,["onClick"])]),T("div",re,[k(u)?(c(),g("div",ae,U(k(u)),1)):O("",!0),y(u)?(c(),g("div",oe,U(y(u)),1)):O("",!0)])]))),128)),T("div",se,[m(S,{type:"primary",link:"",onClick:A},{default:d(()=>[...e[5]||(e[5]=[C("+添加时间段",-1)])]),_:1}),e[6]||(e[6]=T("span",null,"最多添加10个时间段",-1))])]),_:1}),m(a,{label:" "},{default:d(()=>[...e[7]||(e[7]=[T("div",{style:{color:"#8a9099",width:"100%"}},"请前往商品>库存管理>库存日历 设置库存",-1)])]),_:1})],64)}}}),ue=Z(le,[["__scopeId","data-v-89272702"]]);export{ue as default};

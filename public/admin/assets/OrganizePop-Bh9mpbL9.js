import{d as re,r as v,x as ce,as as ue,o as pe,f as h,g as d,h as n,z as a,m as i,i as r,F,p as U,n as ve,t as m,l as f,j as P,L as $,Q as x,O as j,k as L,ds as fe,s as O,P as k,_ as he}from"./index-B52YIGC0.js";import{S as B}from"./StatusDot-DuKP0Xmc.js";import{a as me,h as _e,i as ge}from"./shop-CBisV8Of.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-1fz1RqDZ.js";import"./index-KjhYqCTY.js";import{k as Ie}from"./product-hE35r0Q_.js";/* empty css                                                                    */import{P as ye}from"./Pagination-C8J7-6Em.js";/* empty css                                                                  *//* empty css                                                                              */import{S as be}from"./SelectRegion-B1dYo0k6.js";/* empty css             */import{_ as Se}from"./SslectArea.vue_vue_type_script_setup_true_lang-CwMSZx5L.js";import"./time-EzYK4E-P.js";import"./index-C9ZdVeVx.js";import"./region-BXYVi85_.js";import"./region-DzZbv6Nj.js";/* empty css                                                                     */import"./areaManage-rIHpuU4l.js";const ke={class:"tabs-row"},Ce=["onClick"],Te={class:"table-row"},xe={key:0,class:"list-table-form"},we={class:"form-tool-row"},Pe={class:"form-tool-row"},Re={class:"form-tool-row"},ze={class:"table-container"},Le={class:"empty-warp"},Oe={key:0,class:"empty-bg"},Be={key:0},Me={key:3,style:{color:"red"}},Ne={key:4,style:{color:"green"}},Ve={class:"empty-warp"},Ae={key:0,class:"empty-bg"},De={key:0,class:"pagination-con"},Ee={class:"select-row"},Fe={class:"select-num-row"},Ue={class:"lable"},$e={key:0,class:"btn"},je={key:0,class:"select-list"},Qe={class:"title"},qe=["onClick"],Ge={key:1,class:"empty"},He=re({__name:"OrganizePop",props:{selectedIds:{type:Array,default:[]},productId:{type:String,default:""},type:{type:String,default:""},isSelect:{type:Boolean,default:!1},distributionProductId:{type:Number,default:null}},emits:["submitCallback","okType","update:confirmLoading"],setup(Q,{expose:q,emit:G}){const _=v(null),g=v(null),c=Q,H=v([{name:"商城",value:1},{name:"门店",value:2}]),M=v([{shopId:0,shopTitle:"商城自营"}]),S=v(1),C=v([]),I=v(!0),T=v(0),s=v(c.selectedIds);v(!0);const w=G,J=ce(),u=ue({shopType:2,page:1,size:J.get("pageSize"),sortField:"",sortOrder:"",keyword:"",areaStoreManagerId:"",shopRegionId:""}),y=async()=>{I.value=!0;try{const t=await me({...u,productId:c.productId,distributionProductId:c.distributionProductId});if(C.value=t.records.filter(e=>e.shopId!==0),c.distributionProductId&&!t.records.find(e=>e.shopId===0)&&(M.value=[]),T.value=t.total,O(()=>{se()}),c.isSelect&&s.value.length>0){const e=s.value.findIndex(l=>l.shopId===0);e!==-1&&O(()=>{D(s.value[e])})}}catch(t){k.error(t.message)}finally{I.value=!1}},K=async()=>{try{s.value=[],await _e({shopId:0,productId:c.productId})==!0&&s.value.push({shopId:0,shopTitle:"商城自营"}),O(()=>{D(s.value[0])})}catch(t){k.error(t.message)}},W=async()=>{try{const t=await ge({productId:c.productId});t.length>0&&t.forEach(e=>{s.value.push({shopId:e.shopId,shopTitle:e.shopTitle})}),await y()}catch(t){k.error(t.message)}};pe(()=>{c.isSelect?y():(K(),W())});const N=(t,e)=>{if(t.includes(e))s.value.some(p=>p.shopId===e.shopId)||s.value.push({shopId:e.shopId,shopTitle:e.shopTitle});else{const p=s.value.findIndex(z=>z.shopId===e.shopId);p>-1&&s.value.splice(p,1)}},V=t=>{t.length===0?C.value.forEach(e=>{const l=s.value.findIndex(p=>p.shopId===e.shopId);l>-1&&s.value.splice(l,1)}):t.forEach(e=>{s.value.some(l=>l.shopId===e.shopId)||s.value.push({shopId:e.shopId,shopTitle:e.shopTitle})})},A=t=>{},X=t=>{const e=s.value.findIndex(l=>l.shopId===t.shopId);if(e>-1){s.value.splice(e,1);const l=C.value.find(p=>p.shopId===t.shopId);l&&_.value&&_.value.toggleRowSelection(l,!1)}t.shopId===0&&g.value&&g.value.clearSelection()},Y=()=>{s.value=[],_.value&&_.value.clearSelection(),g.value&&g.value.clearSelection()},R=v([]),Z=t=>{R.value=t,t.length>0&&(u.shopRegionId=t[t.length-1].regionId),y()},ee=()=>{u.shopRegionId="",y()},te=async()=>{try{w("update:confirmLoading",!0);const t=await Ie({type:c.type,productIds:[c.productId],shopIds:s.value.map(e=>e.shopId)});w("submitCallback",t),k.success("操作成功")}catch(t){k.error(t.message)}finally{w("update:confirmLoading",!1)}},oe=()=>{if(s.value.length===0){k.error("请选择门店");return}c.isSelect?w("submitCallback",s.value):te()},se=()=>{_.value&&(_.value.clearSelection(),C.value.forEach(t=>{s.value.some(l=>l.shopId===t.shopId)&&_.value.toggleRowSelection(t,!0)}))},D=t=>{g.value&&(g.value.clearSelection(),g.value.toggleRowSelection(t,!0))};return q({onFormSubmit:oe}),(t,e)=>{const l=h("el-col"),p=h("el-button"),z=h("TigInput"),b=h("el-table-column"),E=h("el-table"),ae=h("a-spin"),le=h("el-icon"),ne=h("el-empty"),ie=h("el-row");return n(),d("div",null,[a(ie,{class:"orfanize-content"},{default:i(()=>[a(l,{span:3},{default:i(()=>[r("div",ke,[(n(!0),d(F,null,U(H.value,o=>(n(),d("div",{class:ve(["tabs",{active:o.value===S.value}]),onClick:de=>S.value=o.value},m(o.name),11,Ce))),256))])]),_:1}),a(l,{span:15},{default:i(()=>[r("div",Te,[S.value===2?(n(),d("div",xe,[r("div",we,[a(z,{width:"210px",modelValue:u.keyword,"onUpdate:modelValue":e[0]||(e[0]=o=>u.keyword=o),name:"keyword",placeholder:"门店名称"},{append:i(()=>[a(p,{onClick:y},{default:i(()=>[...e[5]||(e[5]=[r("span",{class:"iconfont icon-chakan1"},null,-1)])]),_:1})]),_:1},8,["modelValue"])]),r("div",Pe,[a(P(Se),{areaStoreManagerId:u.areaStoreManagerId,"onUpdate:areaStoreManagerId":e[1]||(e[1]=o=>u.areaStoreManagerId=o),onOnChange:y},null,8,["areaStoreManagerId"])]),r("div",Re,[a(P(be),{selectedIds:R.value,"onUpdate:selectedIds":e[2]||(e[2]=o=>R.value=o),onChange:Z,onClear:ee,style:{width:"210px","margin-bottom":"10px"}},null,8,["selectedIds"])])])):f("",!0),r("div",ze,[a(ae,{spinning:I.value},{default:i(()=>[$(a(E,{ref_key:"tableRefOne",ref:g,data:M.value,loading:I.value,total:T.value,"row-key":"shopId",onSelectionChange:A,onSelect:N,onSelectAll:V},{empty:i(()=>[r("div",Le,[I.value?f("",!0):(n(),d("div",Oe,"暂无数据"))])]),default:i(()=>[a(b,{type:"selection",width:"32","reserve-selection":""}),a(b,{label:"组织名称"},{default:i(({row:o})=>[x(m(o.shopTitle||"--"),1)]),_:1}),a(b,{label:"编号"},{default:i(({row:o})=>[...e[6]||(e[6]=[x(" -- ",-1)])]),_:1})]),_:1},8,["data","loading","total"]),[[j,S.value===1]]),$(a(E,{ref_key:"tableRef",ref:_,data:C.value,loading:I.value,total:T.value,"row-key":"shopId",onSelectionChange:A,onSelect:N,onSelectAll:V},{empty:i(()=>[r("div",Ve,[I.value?f("",!0):(n(),d("div",Ae,"暂无数据"))])]),default:i(()=>[a(b,{type:"selection",width:"32","reserve-selection":""}),a(b,{label:"门店名称",width:"200"},{default:i(({row:o})=>[x(m(o.shopTitle||"--"),1)]),_:1}),a(b,{label:"门店地址"},{default:i(({row:o})=>[o.shopRegionNames?(n(),d("span",Be,m(o.shopRegionNames.join("")),1)):f("",!0),x(" "+m(o.shopDetailedAddress||"--"),1)]),_:1}),a(b,{label:"门店状态",width:"100"},{default:i(({row:o})=>[o.status==10?(n(),L(B,{key:0,color:"red",flicker:!0})):f("",!0),o.status==4?(n(),L(B,{key:1,color:"red",flicker:!0})):f("",!0),o.status==1?(n(),L(B,{key:2,color:"green",flicker:!0})):f("",!0),o.status===10||o.status===4?(n(),d("span",Me,m(o.statusText),1)):o.status===1?(n(),d("span",Ne,m(o.statusText),1)):f("",!0)]),_:1})]),_:1},8,["data","loading","total"]),[[j,S.value===2]])]),_:1},8,["spinning"]),T.value>0&&S.value===2?(n(),d("div",De,[a(P(ye),{page:u.page,"onUpdate:page":e[3]||(e[3]=o=>u.page=o),size:u.size,"onUpdate:size":e[4]||(e[4]=o=>u.size=o),total:T.value,onCallback:y},null,8,["page","size","total"])])):f("",!0)])])]),_:1}),a(l,{span:6},{default:i(()=>[r("div",Ee,[r("div",Fe,[r("div",Ue,"已选择"+m(s.value.length)+"个门店:",1),s.value.length>0?(n(),d("div",$e,[a(p,{link:"",type:"primary",onClick:Y},{default:i(()=>[...e[7]||(e[7]=[x("清空",-1)])]),_:1})])):f("",!0)]),s.value.length>0?(n(),d("div",je,[(n(!0),d(F,null,U(s.value,o=>(n(),d("div",{class:"select-item",key:o.shopId},[r("div",Qe,m(o.shopTitle||"--"),1),r("div",{class:"del-btn",onClick:de=>X(o)},[a(le,{color:"#fb0606"},{default:i(()=>[a(P(fe))]),_:1})],8,qe)]))),128))])):(n(),d("div",Ge,[a(ne,{"image-size":80,description:"暂无选中门店"})]))])]),_:1})]),_:1})])}}}),vt=he(He,[["__scopeId","data-v-a56b1c75"]]);export{vt as default};

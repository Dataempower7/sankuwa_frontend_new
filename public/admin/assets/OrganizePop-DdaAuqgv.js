import{d as ie,r as p,x as re,as as de,o as ce,f as v,g as r,h as l,z as s,m as n,i as d,F as D,p as E,n as ue,t as f,l as _,j as T,L as F,Q as C,O as U,k as M,ds as pe,s as ve,P as x,_ as fe}from"./index-B52YIGC0.js";import{S as O}from"./StatusDot-DuKP0Xmc.js";import{a as A}from"./shop-CBisV8Of.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-1fz1RqDZ.js";import"./index-KjhYqCTY.js";/* empty css                                                                    */import{P as _e}from"./Pagination-C8J7-6Em.js";/* empty css                                                                  *//* empty css                                                                              */import{S as he}from"./SelectRegion-B1dYo0k6.js";/* empty css             */import{_ as me}from"./SslectArea.vue_vue_type_script_setup_true_lang-CwMSZx5L.js";import"./time-EzYK4E-P.js";import"./index-C9ZdVeVx.js";import"./region-BXYVi85_.js";import"./region-DzZbv6Nj.js";/* empty css                                                                     */import"./areaManage-rIHpuU4l.js";const ge={class:"tabs-row"},ye=["onClick"],Ie={class:"table-row"},ke={key:0,class:"list-table-form"},Se={class:"form-tool-row"},be={class:"form-tool-row"},Ce={class:"form-tool-row"},Te={class:"table-container"},xe={key:0},we={key:3,style:{color:"red"}},Re={key:4,style:{color:"green"}},ze={class:"empty-warp"},Le={key:0,class:"empty-bg"},Me={key:0,class:"pagination-con"},Oe={class:"select-row"},Pe={class:"select-num-row"},Ve={class:"lable"},Ne={key:0,class:"btn"},Be={key:0,class:"select-list"},De={class:"title"},Ee=["onClick"],Fe={key:1,class:"empty"},Ue=ie({__name:"OrganizePop",props:{selectedIds:{type:Array,default:[]},productId:{type:String,default:""},type:{type:String,default:""}},emits:["submitCallback","okType","update:confirmLoading"],setup($,{expose:j,emit:Q}){const h=p(null),k=p(null),w=$,q=p([{name:"商城",value:1},{name:"门店",value:2}]),G=[{shopId:0,shopTitle:"商城自营"}],g=p(1),S=p([]),y=p(!0),b=p(0),a=p(w.selectedIds||[]),R=Q,H=re(),c=de({shopType:1,page:1,size:H.get("pageSize"),sortField:"",sortOrder:"",keyword:"",areaStoreManagerId:"",shopRegionId:""}),I=async()=>{y.value=!0;try{const o=await A({...c,productId:w.productId});S.value=o.records,b.value=o.total,ve(()=>{te()})}catch(o){x.error(o.message)}finally{y.value=!1}},J=async()=>{try{const o=await A({productId:w.productId});o.code==0&&o.records.length>0&&o.records.forEach(e=>{a.value.push({shopId:e.shopId,shopTitle:e.shopTitle})}),await I()}catch(o){x.error(o.message)}};ce(()=>{J()});const P=(o,e)=>{if(o.includes(e))a.value.some(u=>u.shopId===e.shopId)||a.value.push({shopId:e.shopId,shopTitle:e.shopTitle});else{const u=a.value.findIndex(L=>L.shopId===e.shopId);u>-1&&a.value.splice(u,1)}},V=o=>{o.length===0?S.value.forEach(e=>{const i=a.value.findIndex(u=>u.shopId===e.shopId);i>-1&&a.value.splice(i,1)}):o.forEach(e=>{a.value.some(i=>i.shopId===e.shopId)||a.value.push({shopId:e.shopId,shopTitle:e.shopTitle})})},N=o=>{},K=o=>{const e=a.value.findIndex(i=>i.shopId===o.shopId);if(e>-1){a.value.splice(e,1);const i=S.value.find(u=>u.shopId===o.shopId);i&&h.value&&h.value.toggleRowSelection(i,!1)}o.shopId===0&&k.value&&k.value.clearSelection()},W=()=>{a.value=[],h.value&&h.value.clearSelection(),k.value&&k.value.clearSelection()},z=p([]),X=o=>{z.value=o,o.length>0&&(c.shopRegionId=o[o.length-1].regionId),I()},Y=()=>{c.shopRegionId="",I()},Z=async()=>{if(a.value.length===0){x.error("请选择门店");return}try{R("update:confirmLoading",!0),R("submitCallback",a.value)}catch(o){x.error(o.message)}finally{R("update:confirmLoading",!1)}},ee=()=>{Z()},te=()=>{h.value&&(h.value.clearSelection(),S.value.forEach(o=>{a.value.some(i=>i.shopId===o.shopId)&&h.value.toggleRowSelection(o,!0)}))};return j({onFormSubmit:ee}),(o,e)=>{const i=v("el-col"),u=v("el-button"),L=v("TigInput"),m=v("el-table-column"),B=v("el-table"),oe=v("a-spin"),se=v("el-icon"),ae=v("el-empty"),le=v("el-row");return l(),r("div",null,[s(le,{class:"orfanize-content"},{default:n(()=>[s(i,{span:3},{default:n(()=>[d("div",ge,[(l(!0),r(D,null,E(q.value,t=>(l(),r("div",{class:ue(["tabs",{active:t.value===g.value}]),onClick:ne=>g.value=t.value},f(t.name),11,ye))),256))])]),_:1}),s(i,{span:15},{default:n(()=>[d("div",Ie,[g.value===2?(l(),r("div",ke,[d("div",Se,[s(L,{width:"210px",modelValue:c.keyword,"onUpdate:modelValue":e[0]||(e[0]=t=>c.keyword=t),name:"keyword",placeholder:"门店名称"},{append:n(()=>[s(u,{onClick:I},{default:n(()=>[...e[5]||(e[5]=[d("span",{class:"iconfont icon-chakan1"},null,-1)])]),_:1})]),_:1},8,["modelValue"])]),d("div",be,[s(T(me),{areaStoreManagerId:c.areaStoreManagerId,"onUpdate:areaStoreManagerId":e[1]||(e[1]=t=>c.areaStoreManagerId=t),onOnChange:I},null,8,["areaStoreManagerId"])]),d("div",Ce,[s(T(he),{selectedIds:z.value,"onUpdate:selectedIds":e[2]||(e[2]=t=>z.value=t),onChange:X,onClear:Y,style:{width:"210px","margin-bottom":"10px"}},null,8,["selectedIds"])])])):_("",!0),d("div",Te,[s(oe,{spinning:y.value},{default:n(()=>[F(s(B,{ref_key:"tableRefOne",ref:k,data:G,loading:y.value,total:b.value,"row-key":"shopId",onSelectionChange:N,onSelect:P,onSelectAll:V},{default:n(()=>[s(m,{type:"selection",width:"32","reserve-selection":""}),s(m,{label:"组织名称"},{default:n(({row:t})=>[C(f(t.shopTitle||"--"),1)]),_:1}),s(m,{label:"编号"},{default:n(({row:t})=>[...e[6]||(e[6]=[C(" -- ",-1)])]),_:1})]),_:1},8,["loading","total"]),[[U,g.value===1]]),F(s(B,{ref_key:"tableRef",ref:h,data:S.value,loading:y.value,total:b.value,"row-key":"shopId",onSelectionChange:N,onSelect:P,onSelectAll:V},{empty:n(()=>[d("div",ze,[y.value?_("",!0):(l(),r("div",Le,"暂无数据"))])]),default:n(()=>[s(m,{type:"selection",width:"32","reserve-selection":""}),s(m,{label:"门店名称",width:"200"},{default:n(({row:t})=>[C(f(t.shopTitle||"--"),1)]),_:1}),s(m,{label:"门店地址"},{default:n(({row:t})=>[t.shopRegionNames?(l(),r("span",xe,f(t.shopRegionNames.join("")),1)):_("",!0),C(" "+f(t.shopDetailedAddress||"--"),1)]),_:1}),s(m,{label:"门店状态",width:"100"},{default:n(({row:t})=>[t.status==10?(l(),M(O,{key:0,color:"red",flicker:!0})):_("",!0),t.status==4?(l(),M(O,{key:1,color:"red",flicker:!0})):_("",!0),t.status==1?(l(),M(O,{key:2,color:"green",flicker:!0})):_("",!0),t.status===10||t.status===4?(l(),r("span",we,f(t.statusText),1)):t.status===1?(l(),r("span",Re,f(t.statusText),1)):_("",!0)]),_:1})]),_:1},8,["data","loading","total"]),[[U,g.value===2]])]),_:1},8,["spinning"]),b.value>0&&g.value===2?(l(),r("div",Me,[s(T(_e),{page:c.page,"onUpdate:page":e[3]||(e[3]=t=>c.page=t),size:c.size,"onUpdate:size":e[4]||(e[4]=t=>c.size=t),total:b.value,onCallback:I},null,8,["page","size","total"])])):_("",!0)])])]),_:1}),s(i,{span:6},{default:n(()=>[d("div",Oe,[d("div",Pe,[d("div",Ve,"已选择"+f(a.value.length)+"个门店:",1),a.value.length>0?(l(),r("div",Ne,[s(u,{link:"",type:"primary",onClick:W},{default:n(()=>[...e[7]||(e[7]=[C("清空",-1)])]),_:1})])):_("",!0)]),a.value.length>0?(l(),r("div",Be,[(l(!0),r(D,null,E(a.value,t=>(l(),r("div",{class:"select-item",key:t.shopId},[d("div",De,f(t.shopTitle||"--"),1),d("div",{class:"del-btn",onClick:ne=>K(t)},[s(se,{color:"#fb0606"},{default:n(()=>[s(T(pe))]),_:1})],8,Ee)]))),128))])):(l(),r("div",Fe,[s(ae,{"image-size":80,description:"暂无选中门店"})]))])]),_:1})]),_:1})])}}}),lt=fe(Ue,[["__scopeId","data-v-a8b71f84"]]);export{lt as default};

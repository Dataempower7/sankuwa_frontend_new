import{d as E,a6 as z,r as u,f as d,g as i,h as l,z as s,m as t,i as y,F as D,p as $,k as I,t as Q,Q as C,L as Y,aY as G,j as q,M as H,P as B,_ as J}from"./index-B52YIGC0.js";const K={class:"lyecs-popedit"},W={key:0,class:"table-product-box"},X={key:1,class:"table-product-inp"},Z={class:"table-btn-box"},ee=E({__name:"ProductStockPop",props:{params:{type:Object,default:{id:null,productInfo:{}}},requestApi:{type:Function,default:z}},emits:["callback"],setup(F,{emit:N}){var R;const p=u(!1),V=u(),f=u(!1),T=a=>{p.value&&!q(V).popperRef.contentRef.contains(a.target)&&(p.value=!1)},m=F,r=u({skuList:m.params.productInfo.productSku||[],productStock:m.params.productInfo.productStock||0}),h=u((R=r.value.skuList[0])==null?void 0:R.skuData),_=u({skuStock:[{required:!0,message:"不能为空",trigger:"blur"}],productStock:[{required:!0,message:"不能为空",trigger:"blur"}]}),j=N,b=u();u(!1);const k=u(m.params.productInfo.productSku||[]),x=a=>(f.value=!0,new Promise((e,n)=>{b.value.validate().then(()=>{let c=null;a.field=="productSku"?c=A(k.value):c=r.value.productStock,m.requestApi({id:m.params.id,field:a.field,val:c}).then(v=>{j("callback"),B.success("操作成功"),f.value=!1,p.value=!1,e(!0)}).catch(v=>{f.value=!1,B.error(v.message),n()})})}));function A(a){let e=[];return a.forEach(n=>{e.push({skuId:n.skuId,skuStock:Number(n.skuStock)})}),e}return(a,e)=>{const n=d("el-table-column"),c=d("TigInput"),v=d("el-form-item"),M=d("el-table"),L=d("el-form"),S=d("el-button"),O=d("el-popover");return l(),i("div",K,[s(O,{visible:p.value,ref_key:"popoverRef",ref:V,placement:"left",width:0},{reference:t(()=>[Y((l(),i("div",{class:"lyecs-popedit-con",onClick:e[0]||(e[0]=o=>p.value=!0)},[G(a.$slots,"default",{},void 0,!0),e[5]||(e[5]=y("span",{class:"lyecs-popedit-btn iconfont icon-bianji1"},null,-1))])),[[q(H),T]])]),default:t(()=>[k.value&&k.value.length>0?(l(),i("div",W,[s(L,{model:r.value,rules:_.value,ref_key:"formRef",ref:b,class:"formDiv"},{default:t(()=>[s(M,{data:r.value.skuList,style:{width:"100%"},border:""},{default:t(()=>[(l(!0),i(D,null,$(h.value,o=>(l(),I(n,{label:o.name},{default:t(({row:g,$index:P})=>[y("ul",null,[(l(!0),i(D,null,$(g.skuData,(w,U)=>(l(),i("li",{key:U},Q(o.name==w.name?w.value:""),1))),128))])]),_:2},1032,["label"]))),256)),s(n,{label:"库存",width:"100px"},{default:t(({row:o,$index:g})=>[s(v,{prop:"skuList."+g+".skuStock",rules:_.value.skuStock},{default:t(()=>[s(c,{type:"integer",modelValue:o.skuStock,"onUpdate:modelValue":P=>o.skuStock=P,modelModifiers:{trim:!0},placeholder:"请输入商品库存"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),_:1})]),_:1},8,["data"])]),_:1},8,["model","rules"])])):(l(),i("div",X,[s(L,{model:r.value,rules:_.value,ref_key:"formRef",ref:b,class:"formDiv"},{default:t(()=>[s(v,{prop:"productStock",rules:_.value.productStock},{default:t(()=>[s(c,{type:"integer",modelValue:r.value.productStock,"onUpdate:modelValue":e[1]||(e[1]=o=>r.value.productStock=o),modelModifiers:{trim:!0},placeholder:"请输入商品库存"},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["model","rules"])])),y("div",Z,[s(S,{ref:"buttonRef",onClick:e[2]||(e[2]=o=>p.value=!1)},{default:t(()=>[...e[6]||(e[6]=[C("取消",-1)])]),_:1},512),k.value&&k.value.length>0?(l(),I(S,{key:0,type:"primary",onClick:e[3]||(e[3]=o=>x({field:"productSku"})),loading:f.value},{default:t(()=>[...e[7]||(e[7]=[C("保存",-1)])]),_:1},8,["loading"])):(l(),I(S,{key:1,type:"primary",onClick:e[4]||(e[4]=o=>x({field:"productStock"})),loading:f.value},{default:t(()=>[...e[8]||(e[8]=[C("保存",-1)])]),_:1},8,["loading"]))])]),_:3},8,["visible"])])}}}),oe=J(ee,[["__scopeId","data-v-95abbc70"]]);export{oe as default};

import{d as M,s as z,r as u,f as d,z as l,e as i,l as t,h as y,F as P,m as $,j as I,t as G,L as C,G as H,i as q,H as K,aO as J,K as B,g as s,_ as Q}from"./index-BLXOA87U.js";const W={class:"lyecs-popedit"},X={key:0,class:"table-product-box"},Y={key:1,class:"table-product-inp"},Z={class:"table-btn-box"},ee=M({__name:"ProductStockPop",props:{params:{type:Object,default:{id:null,productInfo:{}}},requestApi:{type:Function,default:z}},emits:["callback"],setup(F,{emit:N}){var R;const p=u(!1),V=u(),f=u(!1),O=a=>{p.value&&!q(V).popperRef.contentRef.contains(a.target)&&(p.value=!1)},m=F,r=u({skuList:m.params.productInfo.productSku||[],productStock:m.params.productInfo.productStock||0}),T=u((R=r.value.skuList[0])==null?void 0:R.skuData),_=u({skuStock:[{required:!0,message:"不能为空",trigger:"blur"}],productStock:[{required:!0,message:"不能为空",trigger:"blur"}]}),h=N,b=u();u(!1);const k=u(m.params.productInfo.productSku||[]),x=a=>(f.value=!0,new Promise((e,n)=>{b.value.validate().then(()=>{let c=null;a.field=="productSku"?c=j(k.value):c=r.value.productStock,m.requestApi({id:m.params.id,field:a.field,val:c}).then(v=>{h("callback"),B.success("操作成功"),f.value=!1,p.value=!1,e(!0)}).catch(v=>{f.value=!1,B.error(v.message),n()})})}));function j(a){let e=[];return a.forEach(n=>{e.push({skuId:n.skuId,skuStock:Number(n.skuStock)})}),e}return(a,e)=>{const n=i("el-table-column"),c=i("TigInput"),v=i("el-form-item"),A=i("el-table"),L=i("el-form"),S=i("el-button"),U=i("el-popover");return s(),d("div",W,[l(U,{visible:p.value,ref_key:"popoverRef",ref:V,placement:"left",width:0},{reference:t(()=>[H((s(),d("div",{class:"lyecs-popedit-con",onClick:e[0]||(e[0]=o=>p.value=!0)},[J(a.$slots,"default",{},void 0,!0),e[5]||(e[5]=y("span",{class:"lyecs-popedit-btn iconfont icon-bianji1"},null,-1))])),[[q(K),O]])]),default:t(()=>[k.value&&k.value.length>0?(s(),d("div",X,[l(L,{model:r.value,rules:_.value,ref_key:"formRef",ref:b,class:"formDiv"},{default:t(()=>[l(A,{data:r.value.skuList,style:{width:"100%"},border:""},{default:t(()=>[(s(!0),d(P,null,$(T.value,o=>(s(),I(n,{label:o.name},{default:t(({row:g,$index:w})=>[y("ul",null,[(s(!0),d(P,null,$(g.skuData,(D,E)=>(s(),d("li",{key:E},G(o.name==D.name?D.value:""),1))),128))])]),_:2},1032,["label"]))),256)),l(n,{label:"库存",width:"100px"},{default:t(({row:o,$index:g})=>[l(v,{prop:"skuList."+g+".skuStock",rules:_.value.skuStock},{default:t(()=>[l(c,{type:"integer",modelValue:o.skuStock,"onUpdate:modelValue":w=>o.skuStock=w,modelModifiers:{trim:!0},placeholder:"请输入商品库存"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),_:1})]),_:1},8,["data"])]),_:1},8,["model","rules"])])):(s(),d("div",Y,[l(L,{model:r.value,rules:_.value,ref_key:"formRef",ref:b,class:"formDiv"},{default:t(()=>[l(v,{prop:"productStock",rules:_.value.productStock},{default:t(()=>[l(c,{type:"integer",modelValue:r.value.productStock,"onUpdate:modelValue":e[1]||(e[1]=o=>r.value.productStock=o),modelModifiers:{trim:!0},placeholder:"请输入商品库存"},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["model","rules"])])),y("div",Z,[l(S,{ref:"buttonRef",onClick:e[2]||(e[2]=o=>p.value=!1)},{default:t(()=>e[6]||(e[6]=[C("取消",-1)])),_:1,__:[6]},512),k.value&&k.value.length>0?(s(),I(S,{key:0,type:"primary",onClick:e[3]||(e[3]=o=>x({field:"productSku"})),loading:f.value},{default:t(()=>e[7]||(e[7]=[C("保存",-1)])),_:1,__:[7]},8,["loading"])):(s(),I(S,{key:1,type:"primary",onClick:e[4]||(e[4]=o=>x({field:"productStock"})),loading:f.value},{default:t(()=>e[8]||(e[8]=[C("保存",-1)])),_:1,__:[8]},8,["loading"]))])]),_:3},8,["visible"])])}}}),oe=Q(ee,[["__scopeId","data-v-95abbc70"]]);export{oe as default};

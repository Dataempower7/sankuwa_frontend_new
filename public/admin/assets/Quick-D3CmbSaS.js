import{g as H}from"./languagesList-g8H0RafD.js";import{f as J}from"./translationContent-DeplWi7W.js";import{d as R,r as n,o as U,S as E,e as C,f as _,g as r,z as v,l as u,L as h,h as T,t as M,k as S,j as z,K as j,_ as W}from"./index-BLXOA87U.js";const X={class:"flex flex-align-center"},Y={key:0,class:"flex flex-align-center mr10"},Z={key:0},$={key:1},ee={class:"empty-warp"},ae={key:0,class:"empty-bg"},le=R({__name:"Quick",props:{dataType:{type:Number,default:0},total:{type:Number,default:0},ids:{type:Array,default:[]},visible:{type:Boolean,default:!0}},emits:["submitCallback","update:confirmLoading","close","closeConfirm"],setup(Q,{expose:D,emit:I}){const y=I,f=Q,l=n(!1),t=n(!1),o=n(0),L=n(f.total),g=n(20),b=n([]),d=n([]),k=n(!0),i=n(0),K=async()=>{try{const e=await H({isEnabled:1,size:-1});e.records.forEach(a=>{a.translationValue=""}),Object.assign(d.value,e.records)}catch(e){j.error(e.message)}finally{k.value=!1}};U(()=>{K()});const V=n(""),p=n(0),B=async()=>{if(!l.value){for(V.value="all",l.value=!0,t.value=!1,b.value.length===0&&(b.value=new Array(d.value.length).fill(0));o.value<d.value.length&&!t.value;)i.value=d.value[o.value].id,await A(i.value,o.value),t.value||(o.value++,p.value=0);t.value||(l.value=!1,y("submitCallback",!1))}},x=()=>{t.value=!0},P=async e=>{V.value="single",l.value=!0,t.value=!1,o.value=e,i.value=d.value[e].id,await A(i.value,e),l.value=!1,t.value||(i.value=0,p.value=0)},A=async(e,a)=>{try{for(let s=p.value;s<L.value;s+=g.value){if(t.value){o.value=a,i.value=0;return}const m=Math.floor(s/g.value)+1,N=await J({ids:f.ids,localesId:e,dataType:f.dataType,size:g.value,page:m});p.value=Math.min(s+g.value,L.value),b.value[a]=p.value}}catch(s){j.error(s.message)}finally{y("update:confirmLoading",!1)}},O=async e=>{o.value!==null&&(t.value=!1,l.value=!1,V.value==="all"?B():P(e))},q=e=>`${b.value[e]||0}/${L.value}`;return E(()=>l.value,e=>{l.value==!0?y("closeConfirm",!0,"当前还有正在进行中的翻译，关闭之后会停止所有翻译操作，是否确认关闭？"):y("closeConfirm",!1)}),E(()=>f.visible,e=>{f.visible==!1&&x()}),D({pauseTranslation:x}),(e,a)=>{const s=C("el-button"),m=C("el-table-column"),N=C("a-spin"),F=C("el-table");return r(),_("div",null,[v(N,{spinning:k.value},{default:u(()=>[v(s,{type:"primary",class:"mb20",onClick:B,disabled:l.value},{default:u(()=>a[0]||(a[0]=[h("全部翻译",-1)])),_:1,__:[0]},8,["disabled"]),v(F,{data:d.value,"row-key":"id",loading:k.value},{empty:u(()=>[T("div",ee,[k.value?S("",!0):(r(),_("div",ae,"暂无数据"))])]),default:u(()=>[v(m,{label:"语言",prop:"language",width:"180px"},{default:u(({row:w})=>[T("div",null,M(w.language||"--"),1)]),_:1}),v(m,{label:"翻译进度",prop:"progress"},{default:u(({row:w,$index:c})=>[T("div",X,[i.value==w.id&&o.value===c?(r(),_("div",Y,[v(N,{size:"small",class:"mr10"}),t.value?(r(),_("span",Z,"当前翻译完成后暂停...")):(r(),_("span",$,"正在翻译中，请稍候... "))])):S("",!0),T("div",null," ("+M(q(c))+") ",1)])]),_:1}),v(m,{label:"操作",width:"90px"},{default:u(({row:w,$index:c})=>[l.value&&o.value===c&&!t.value?(r(),z(s,{key:0,onClick:x,type:"primary",link:""},{default:u(()=>a[1]||(a[1]=[h("暂停翻译",-1)])),_:1,__:[1]})):t.value&&o.value===c?(r(),z(s,{key:1,onClick:G=>O(c),disabled:!l.value,type:"primary",link:""},{default:u(()=>a[2]||(a[2]=[h("继续翻译",-1)])),_:2,__:[2]},1032,["onClick","disabled"])):(r(),z(s,{key:2,onClick:G=>P(c),disabled:l.value,type:"primary",link:""},{default:u(()=>a[3]||(a[3]=[h("单独翻译",-1)])),_:2,__:[3]},1032,["onClick","disabled"]))]),_:1})]),_:1},8,["data","loading"])]),_:1},8,["spinning"])])}}}),oe=W(le,[["__scopeId","data-v-43d48cb3"]]);export{oe as default};

import"./index-KjhYqCTY.js";import{i as ee}from"./format-BxqOrW-w.js";import{a as le}from"./product-hE35r0Q_.js";import{d as te,aq as $,ar as U,r as m,x as se,as as ae,Y as de,f as z,g as u,h as t,F as D,i,z as y,k as g,l as r,m as c,j as F,Q as k,t as b,p as oe,P as R,_ as ue}from"./index-B52YIGC0.js";/* empty css                                                                    */import{P as ie}from"./Pagination-C8J7-6Em.js";import ne from"./SelectSku-ZXdrD9qH.js";import{_ as re}from"./DialogForm.vue_vue_type_script_setup_true_lang-CT6mpwCc.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-1fz1RqDZ.js";const ce={class:"lyecs-product-select-group"},ke={key:2,class:"ml10"},ve={key:1},fe={key:0,class:"ml10"},pe={key:2,class:"lyecs-product-selected-con"},me={class:"product-selected-list"},ye={class:"product-selected-list-tr product-selected-list-th"},ge={key:0,class:"col col3"},Se={key:1,class:"col col3"},be={class:"col col1"},Ie={class:"col col4 product-info"},xe=["src"],Me={class:"product-name"},Ce={key:0,class:"product-sku"},Ve={key:0,class:"col col3"},we={key:1,class:"col col3"},he={key:2,class:"col col3"},ze={key:3,class:"col col3"},Pe={key:0,class:"pagination-con"},Be={class:"dialog-footer"},Ne=te({__name:"SelectProduct",props:$({act:{type:String,default:"add"},max:{type:Number,default:-1},isMultiple:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},isSku:{type:Boolean,default:!1},isGift:{type:Boolean,default:!1},isSelf:{type:Number,default:0}},{ids:{type:Array,default:[]},idsModifiers:{},skuId:{type:String,default:""},skuIdModifiers:{},skuStock:{type:Number,default:0},skuStockModifiers:{}}),emits:$(["update:ids"],["update:ids","update:skuId","update:skuStock"]),setup(l,{expose:q,emit:E}){const v=l,s=U(l,"ids"),f=U(l,"skuId"),I=U(l,"skuStock"),Q=E,p=m([]),w=m(0),Y=se(),P=m(!0),x=ae({page:1,size:Y.get("pageSize"),sortField:"",sortOrder:"",keyword:""}),L=m(""),B=async a=>{var e;P.value=!0;try{L.value=Array.isArray(a)?a.join(","):((e=s==null?void 0:s.value)==null?void 0:e.join(","))||"";const o=await le({ids:L.value,...x});p.value=o.records,w.value=o.total}catch(o){R.error(o.message)}finally{P.value=!1}},H=a=>{let e=s.value||[];if(f.value="",I.value=0,v.isMultiple==!1&&(e=[]),v.isSku)e.push(a[0].productId),a[0].skuIds&&(f.value=a[0].skuIds[0]);else for(let o in a)e.push(a[o]);s.value=e,Q("update:ids",e),B(e)};de(s,async a=>{a&&a.length>0&&await B(a)},{deep:!0,immediate:!0});const J=()=>{p.value=[],s.value=[]},K=a=>{let e=p.value[a].productId;s.value=s.value.filter(o=>o!==e),p.value.splice(a,1),w.value--},N=m(),S=m(!1),h=m({}),W=a=>{a.skuIds=[f.value],h.value=a,S.value=!0},T=()=>{h.value="",S.value=!1},X=()=>{N.value.skuIds.length>0?(f.value=N.value.skuIds[0],h.value="",S.value=!1):R.error("请选择规格")};return q({ids:s,productList:p}),(a,e)=>{var A,G,O;const o=z("el-button"),Z=z("el-space"),j=z("TigInput"),_=z("el-dialog");return t(),u(D,null,[i("div",ce,[["add","edit"].includes(v.act)?(t(),g(Z,{key:0},{default:c(()=>{var d,M,C,V;return[l.disabled?(t(),g(o,{key:1,disabled:l.max>0&&((d=s.value)==null?void 0:d.length)>=l.max||l.disabled,type:"primary"},{default:c(()=>[...e[6]||(e[6]=[k("选择商品",-1)])]),_:1},8,["disabled"])):(t(),g(F(re),{key:0,params:{selectedIds:s.value,isMultiple:v.isMultiple,isSku:v.isSku,isSelf:v.isSelf},isDrawer:"",path:"product/product/src/SelectProduct",title:"选择商品",width:"600px",onOkCallback:H},{default:c(()=>{var n;return[y(o,{disabled:l.max>0&&((n=s.value)==null?void 0:n.length)>=l.max,type:"primary"},{default:c(()=>[...e[5]||(e[5]=[k("选择商品",-1)])]),_:1},8,["disabled"])]}),_:1},8,["params"])),l.isMultiple&&((M=s.value)==null?void 0:M.length)>0?(t(),u("span",ke,[e[7]||(e[7]=k("已选择 ",-1)),i("b",null,b((C=s.value)==null?void 0:C.length),1),e[8]||(e[8]=k(" 个商品",-1))])):r("",!0),l.isMultiple&&((V=s.value)==null?void 0:V.length)>0?(t(),g(o,{key:3,disabled:l.disabled,onClick:J},{default:c(()=>[...e[9]||(e[9]=[k("清空",-1)])]),_:1},8,["disabled"])):r("",!0)]}),_:1})):(t(),u("div",ve,[l.isMultiple&&((A=s.value)==null?void 0:A.length)>0?(t(),u("span",fe,[e[10]||(e[10]=k("已选择 ",-1)),i("b",null,b((G=s.value)==null?void 0:G.length),1),e[11]||(e[11]=k(" 个商品",-1))])):r("",!0)])),p.value.length>0&&!P.value?(t(),u("div",pe,[i("div",me,[i("div",ye,[e[12]||(e[12]=i("div",{class:"col col1"},"商品编号",-1)),e[13]||(e[13]=i("div",{class:"col col4"},"商品信息",-1)),e[14]||(e[14]=i("div",{class:"col col3"},"商品库存",-1)),l.isSku&&l.isGift?(t(),u("div",ge,"赠品库存")):r("",!0),["add","edit"].includes(v.act)?(t(),u("div",Se,"操作")):r("",!0)]),(t(!0),u(D,null,oe(p.value,(d,M)=>{var C,V;return t(),u("div",{key:M,class:"product-selected-list-tr"},[i("div",be,b(d.productSn),1),i("div",Ie,[i("div",null,[i("img",{src:F(ee)(d.picThumb),height:"50",width:"50"},null,8,xe)]),i("div",null,[i("div",Me,b(d.productName),1),l.isSku&&f.value?(t(),u("div",Ce,[y(o,{disabled:l.disabled,link:"",size:"mini",onClick:n=>W(d)},{default:c(()=>[...e[15]||(e[15]=[k("+ 已选1个规格",-1)])]),_:1},8,["disabled","onClick"])])):r("",!0)])]),l.isSku&&f.value&&d.productSku!==null?(t(),u("div",Ve,b((C=d.productSku.find(n=>n.skuId==f.value))==null?void 0:C.skuStock),1)):(t(),u("div",we,b(d.productStock),1)),l.isSku&&l.isGift?(t(),u("div",he,[d.productSku!==null?(t(),g(j,{key:0,disabled:l.disabled,min:0,type:"integer",max:(V=d.productSku.find(n=>n.skuId==f.value))==null?void 0:V.skuStock,modelValue:I.value,"onUpdate:modelValue":e[0]||(e[0]=n=>I.value=n),width:"100%"},null,8,["disabled","max","modelValue"])):(t(),g(j,{key:1,disabled:l.disabled,min:0,type:"integer",max:d.productStock,modelValue:I.value,"onUpdate:modelValue":e[1]||(e[1]=n=>I.value=n),width:"100%"},null,8,["disabled","max","modelValue"]))])):r("",!0),["add","edit"].includes(v.act)?(t(),u("div",ze,[y(o,{link:"",type:"primary",class:"del-btn",onClick:n=>K(M),disabled:l.disabled},{default:c(()=>[...e[16]||(e[16]=[k("删除",-1)])]),_:1},8,["onClick","disabled"])])):r("",!0)])}),128))]),l.isMultiple&&((O=s.value)==null?void 0:O.length)>0&&w.value>0?(t(),u("div",Pe,[y(F(ie),{page:x.page,"onUpdate:page":e[2]||(e[2]=d=>x.page=d),size:x.size,"onUpdate:size":e[3]||(e[3]=d=>x.size=d),total:w.value,onCallback:B,layout:"slot ,prev, pager, next",background:!1},null,8,["page","size","total"])])):r("",!0)])):r("",!0)]),y(_,{modelValue:S.value,"onUpdate:modelValue":e[4]||(e[4]=d=>S.value=d),title:"选择规格",width:"500","before-close":T,"close-on-click-modal":!1},{footer:c(()=>[i("div",Be,[y(o,{onClick:T},{default:c(()=>[...e[17]||(e[17]=[k("取消",-1)])]),_:1}),y(o,{type:"primary",onClick:X},{default:c(()=>[...e[18]||(e[18]=[k("保存",-1)])]),_:1})])]),default:c(()=>[S.value?(t(),g(ne,{key:0,ref_key:"skuRef",ref:N,productInfo:h.value,isMultiple:l.isMultiple},null,8,["productInfo","isMultiple"])):r("",!0)]),_:1},8,["modelValue"])],64)}}}),De=ue(Ne,[["__scopeId","data-v-e5ef50b1"]]);export{De as S};

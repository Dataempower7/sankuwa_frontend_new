/* empty css             */import{d as K,aq as F,ar as W,r as c,x as X,as as Y,o as Z,f as r,g,h as p,i as o,z as s,l as h,m as a,j as V,Q as M,n as ee,k as N,t as z,F as te,P as le,_ as oe}from"./index-B52YIGC0.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-1fz1RqDZ.js";import{_ as se}from"./SelectCategory.vue_vue_type_script_setup_true_lang-Bb2xH4oQ.js";import"./index-KjhYqCTY.js";import{i as ae}from"./format-BxqOrW-w.js";import{a as ne}from"./product-hE35r0Q_.js";/* empty css                                                                    */import{P as ue}from"./Pagination-C8J7-6Em.js";import ie from"./SelectSku-ZXdrD9qH.js";/* empty css                                                                              *//* empty css                                                                     */import"./time-EzYK4E-P.js";import"./category-BhaHXalE.js";import"./category-D6KF81Ae.js";import"./index-C9ZdVeVx.js";/* empty css                                                                  */const de={class:"container",style:{position:"relative",height:"100%"}},re={class:"content_wrapper"},ce={class:"",style:{display:"flex","flex-direction":"column",width:"100%",height:"100%",position:"absolute"}},pe={class:"list-table-tool lyecs-search-warp",style:{flex:"0"}},fe={class:"list-table-tool-row",style:{"margin-bottom":"5px"}},me={class:"list-table-tool-col"},ke={style:{"padding-right":"15px","box-sizing":"border-box"}},_e={class:"flex"},ge={key:0,class:"span-pic"},ve=["href"],ye=["src"],be={class:"gray"},he={class:"flex"},Se={key:0},Ie={key:1},xe={class:"empty-warp"},Ce={key:0,class:"empty-bg"},we={key:0,class:"pagination-con",style:{"flex-shrink":"0"}},Ve={class:"dialog-footer"},Me=K({__name:"SelectProduct",props:F({selectedIds:{type:Array,default:[]},modelValue:{type:Object,default:{}},isMultiple:{type:Boolean,default:!0},isSku:{type:Boolean,default:!1},isSelf:{type:Number,default:0},reservationProduct:{type:Number,default:0}},{linkSelectData:{},linkSelectDataModifiers:{}}),emits:F(["submitCallback","okType","update:modelValue"],["update:linkSelectData"]),setup(v,{expose:D,emit:R}){const d=v,B=W(v,"linkSelectData"),f=R;f("okType",!1);const u=c([]),y=c(!0),S=c(0),U=X(),m=c([]),i=Y({page:1,size:U.get("pageSize"),sortField:"",sortOrder:"",keyword:"",isDelete:0,productStatus:1,checkStatus:1,shopId:d.isSelf?0:-1,reservationProduct:d.reservationProduct?1:0}),x=async()=>{y.value=!0,d.isSku&&(u.value=[]);try{const t=await ne({...i});m.value=t.records,S.value=t.total}catch(t){le.error(t.message)}finally{y.value=!1}};Z(()=>{x()});const P=()=>{x()},I=c(),C=c(),A=t=>{if(d.isMultiple){let e=[];t.forEach(n=>{e.push(n.productId)}),u.value=e,f("okType",u.value.length>0)}},k=c({}),_=c(!1),E=(t,e)=>{if(t.includes(e)?d.isSku&&e.productSku!==null&&e.productSku.length>1&&(k.value=e,_.value=!0):e.skuIds=[],!d.isMultiple){if(I.value.clearSelection(),t.length==0){u.value=[];return}I.value.toggleRowSelection(e,!0),u.value.length=0,u.value.push(e.productId),f("okType",u.value.length>0)}B.value={path:"product",label:"商品",name:e.productName,id:e.productId,sn:e.productSn,data:{id:e.productId,sn:e.productSn}},f("update:modelValue",e)},j=t=>{d.isSku&&(t.length!=0?m.value.map(e=>{let n=[];e.productSku&&e.productSku.length>1&&(n=e.productSku.map(b=>b.skuId)),e.skuIds=n}):m.value.map(e=>{e.skuIds=[]}))},O=(t,e)=>{var n;return!((n=d.selectedIds)!=null&&n.includes(t.productId))},T=()=>{I.value.toggleRowSelection(k.value,!1),u.value=[],k.value="",_.value=!1},q=()=>{console.log(C.value.skuIds),m.value.forEach(t=>{t.productId==k.value.productId&&(t.skuIds=C.value.skuIds)}),k.value="",_.value=!1};return D({onFormSubmit:()=>{if(d.isSku){const t=m.value.filter(e=>u.value.includes(e.productId)).map(e=>{const n={productId:e.productId};return e.skuIds&&(n.skuIds=e.skuIds),n});f("submitCallback",t)}else f("submitCallback",u.value)}}),(t,e)=>{const n=r("TigInput"),b=r("el-button"),L=r("el-space"),Q=r("el-form"),w=r("el-table-column"),$=r("el-table"),G=r("a-spin"),H=r("perfect-scrollbar"),J=r("el-dialog");return p(),g(te,null,[o("div",de,[o("div",re,[o("div",ce,[o("div",pe,[s(Q,{model:i,name:"form",onFinish:P},{default:a(()=>[o("div",fe,[o("div",me,[s(L,null,{default:a(()=>[s(V(se),{categoryId:i.categoryId,"onUpdate:categoryId":e[0]||(e[0]=l=>i.categoryId=l),style:{width:"150px"}},null,8,["categoryId"]),s(n,{width:"230px",modelValue:i.keyword,"onUpdate:modelValue":e[1]||(e[1]=l=>i.keyword=l),placeholder:"商品名称/货号"},null,8,["modelValue"]),s(b,{onClick:P},{default:a(()=>[...e[5]||(e[5]=[M("搜索",-1)])]),_:1})]),_:1})]),e[6]||(e[6]=o("div",{class:"list-table-tool-col"},null,-1))])]),_:1},8,["model"])]),s(H,{class:"table-container",style:{flex:"1"}},{default:a(()=>[s(G,{spinning:y.value},{default:a(()=>[o("div",ke,[s($,{ref_key:"tableRef",ref:I,class:ee([v.isMultiple?"":"hide-checkbox","result-table"]),data:m.value,loading:y.value,total:S.value,"row-key":"productId",onSelect:E,onSelectAll:j,onSelectionChange:A},{empty:a(()=>[o("div",xe,[y.value?h("",!0):(p(),g("div",Ce,"暂无数据"))])]),default:a(()=>[s(w,{selectable:O,type:"selection",width:"32"}),s(w,{label:"商品信息",prop:"productId"},{default:a(({row:l})=>[o("div",_e,[l.picThumb?(p(),g("div",ge,[o("a",{href:l.url,target:"_blank"},[o("img",{src:V(ae)(l.picThumb),height:"40",width:"40"},null,8,ye)],8,ve)])):h("",!0),o("div",null,[o("p",null,z(l.productName),1),o("p",be,"货号："+z(l.productSn),1)])])]),_:1}),v.isSku?(p(),N(w,{key:0,label:"规格",prop:"skuId"},{default:a(({row:l})=>[o("div",he,[l.skuIds&&l.skuIds.length>0?(p(),g("p",Se," 已选："+z(l.skuIds.length)+"个规格 ",1)):(p(),g("p",Ie,"--"))])]),_:1})):h("",!0)]),_:1},8,["class","data","loading","total"])])]),_:1},8,["spinning"])]),_:1}),S.value>0?(p(),g("div",we,[s(V(ue),{page:i.page,"onUpdate:page":e[2]||(e[2]=l=>i.page=l),size:i.size,"onUpdate:size":e[3]||(e[3]=l=>i.size=l),total:S.value,onCallback:x,layout:"slot ,prev, pager, next",background:!1},null,8,["page","size","total"])])):h("",!0)])])]),s(J,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=l=>_.value=l),title:"选择规格",width:"500","before-close":T,"close-on-click-modal":!1},{footer:a(()=>[o("div",Ve,[s(b,{onClick:T},{default:a(()=>[...e[7]||(e[7]=[M("取消",-1)])]),_:1}),s(b,{type:"primary",onClick:q},{default:a(()=>[...e[8]||(e[8]=[M("保存",-1)])]),_:1})])]),default:a(()=>[_.value?(p(),N(ie,{key:0,ref_key:"skuRef",ref:C,productInfo:k.value,isMultiple:v.isMultiple},null,8,["productInfo","isMultiple"])):h("",!0)]),_:1},8,["modelValue"])],64)}}}),He=oe(Me,[["__scopeId","data-v-001eb027"]]);export{He as default};

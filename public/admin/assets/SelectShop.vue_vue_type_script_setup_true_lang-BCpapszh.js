import{d as P,v as V,e as m,f as l,g as n,h as s,k as a,z as r,L as _,t as w,F as j,m as N,i as B,_ as O,s as q,Q as A,r as T,a2 as U,l as v,K as M,a as z,o as D,j as R,x as E,u as K,C as H,a3 as Q,B as W}from"./index-BLXOA87U.js";import{_ as G}from"./merchant_logo-DuVmNXah.js";import{i as J}from"./format-DdZABYp4.js";import{u as X}from"./theme-BlP4l20S.js";import{i as Y}from"./version-hjn5tnxG.js";const Z="/admin/assets/shop_logo_b-DK_MbwV3.png",ee="/admin/assets/shop_logo-0stPotOH.png",te={class:"select-shop-warp"},se={class:"warp-info"},oe={class:"back-btn"},ne={key:0,class:"sub-title-name"},le={key:1,class:"shop-list"},ie={class:"left-item"},ae={class:"left-info"},re={class:"left-title"},ce={key:0},de={key:2,class:"shop-list shop-list-min-height"},ue=["onClick"],pe={class:"left-item"},me={class:"left-info"},fe={class:"left-title"},ge={key:3,class:"shop-list shop-list-min-height"},he=P({__name:"LoginSelectShop",props:{selectShopFlag:{type:Boolean,default:!1},myShopList:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},userinfo:{type:Object,default:()=>{}},adminType:{type:String,default:""}},emits:["closePopup","update:selectShopFlag","callBack"],setup(t,{emit:C}){const x=C,c=async i=>{x("callBack",i)},{logout:f}=V(),$=()=>{x("update:selectShopFlag",!1),f()},b=i=>/^1[3-9]\d{9}$/.test(i),g=i=>b(i)?i.slice(0,3)+"****"+i.slice(7):i;return(i,o)=>{var S,L,u;const h=m("a-spin"),d=m("el-image"),e=m("el-empty");return n(),l("div",te,[s("div",se,[s("div",oe,[s("div",{class:"bark",onClick:o[0]||(o[0]=y=>$())},o[2]||(o[2]=[s("i",{class:"iconfont-admin icon-zuojiantou-copy"},null,-1),_("返回",-1)]))]),o[8]||(o[8]=s("div",{class:"title-name"},[s("div",{class:"left-title"},"您可以进入以下管理后台")],-1)),t.userinfo&&((S=t.userinfo)!=null&&S.username)?(n(),l("div",ne,[s("span",null,w(g((L=t.userinfo)==null?void 0:L.username)),1),o[3]||(o[3]=_(" 已绑定了以下店铺，您可以进入以下任一店铺 ",-1))])):a("",!0),r(h,{spinning:t.loading,style:{width:"100%","margin-top":"100px",height:"200px"}},null,8,["spinning"]),!t.loading&&t.adminType==="admin"?(n(),l("div",le,[s("div",{onClick:o[1]||(o[1]=y=>c(0)),class:"shop-item",style:{"border-color":"#ffeac7","background-color":"#fff4e6",color:"#4e4e4e"}},[s("div",ie,[o[5]||(o[5]=s("img",{class:"left-image",src:Z,alt:""},null,-1)),s("div",ae,[s("div",re,[o[4]||(o[4]=_(" 管理后台 ",-1)),t.userinfo&&t.userinfo.username&&t.userinfo.username!==""?(n(),l("span",ce,"（"+w(g((u=t.userinfo)==null?void 0:u.username))+"）",1)):a("",!0)])])]),o[6]||(o[6]=s("div",{class:"right-item"},[s("span",{class:"iconfont-admin icon-login-youjiantou"})],-1))])])):a("",!0),t.myShopList.length>0?(n(),l("div",de,[t.loading?a("",!0):(n(!0),l(j,{key:0},N(t.myShopList,y=>(n(),l("div",{onClick:p=>c(y.shopId),class:"shop-item"},[s("div",pe,[r(d,{class:"left-image",src:B(ee)},null,8,["src"]),s("div",me,[s("div",fe,w(y.shopTitle),1)])]),o[7]||(o[7]=s("div",{class:"right-item"},[s("span",{class:"iconfont-admin icon-login-youjiantou"})],-1))],8,ue))),256))])):a("",!0),!t.loading&&t.myShopList.length==0&&t.adminType!="admin"?(n(),l("div",ge,[r(e,{description:"您还没有已绑定的店铺哦～"})])):a("",!0)])])}}}),ye=O(he,[["__scopeId","data-v-fddad861"]]),ve="/admin/assets/admin_logo-BpneqWmR.png",Se=t=>q({url:"merchant/shop/myShop",method:"get",params:t,noErrorTip:!0}),ke=t=>q({url:"merchant/shop/create",method:"post",data:t}),_e={class:"select-shop-warp"},Te={key:0},xe={key:0,class:"warp-info"},$e={class:"list-box"},be={key:0},Le=["onClick"],Ie={class:"logo"},Ce=["src"],we={key:1,src:G,alt:""},Fe={class:"shop-name line1"},Be={key:0,class:"btn-box"},Pe={key:1},je={style:{padding:"40px 0"}},Me=P({__name:"IndexSelectShop",props:{selectShopFlag:{type:Boolean,default:!1},myShopList:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},userinfo:{type:Object,default:()=>{}},adminType:{type:String,default:""}},emits:["closePopup","update:selectShopFlag","callBack","changeShopList","close"],setup(t,{emit:C}){const x=A(),c=T({shopTitle:"",shopLogo:""}),f=C,$=()=>{f("close")},b=T(!1),g=async()=>{await i.value.validate();try{b.value=!0;const d=await ke({...c.value});M.success("创建成功"),o.value=!1,f("changeShopList",!0)}catch(d){M.error(d.message)}finally{b.value=!1}},i=U(),o=T(!1),h=async d=>{f("callBack",d)};return(d,e)=>{const S=m("el-scrollbar"),L=m("a-spin"),u=m("el-button"),y=m("TigInput"),p=m("el-form-item"),F=m("el-form");return n(),l("div",_e,[s("div",{class:"head-box flex flex-justify-between flex-align-center"},[e[6]||(e[6]=s("div",{class:"title"},"选择店铺",-1)),s("div",{class:"close",onClick:$},e[5]||(e[5]=[s("i",{class:"iconfont icon-cha1"},null,-1)]))]),o.value?(n(),l("div",Pe,[s("div",je,[r(F,{"label-width":"80",ref_key:"formRef",ref:i,model:c.value,class:"demo-ruleForm","status-icon":""},{default:v(()=>[r(p,{rules:[{required:!0,message:"店铺名称不能为空!"}],label:"店铺名称",prop:"shopTitle"},{default:v(()=>[r(y,{classType:"tig-form-input",modelValue:c.value.shopTitle,"onUpdate:modelValue":e[2]||(e[2]=k=>c.value.shopTitle=k)},null,8,["modelValue"])]),_:1}),r(p,{label:""},{default:v(()=>[r(u,{type:"primary",onClick:e[3]||(e[3]=k=>g())},{default:v(()=>e[10]||(e[10]=[_(" 创建 ",-1)])),_:1,__:[10]}),r(u,{onClick:e[4]||(e[4]=k=>o.value=!1)},{default:v(()=>e[11]||(e[11]=[_("取消",-1)])),_:1,__:[11]})]),_:1})]),_:1},8,["model"])])])):(n(),l("div",Te,[r(L,{spinning:t.loading,style:{width:"100%","margin-top":"100px",height:"200px"}},{default:v(()=>[t.loading?a("",!0):(n(),l("div",xe,[r(S,{style:{height:"100%"}},{default:v(()=>{var k;return[s("div",$e,[t.userinfo.adminType=="admin"?(n(),l("div",{key:0,class:"info-item admin",onClick:e[0]||(e[0]=I=>h(0))},[e[8]||(e[8]=s("div",{class:"logo"},[s("img",{src:ve,alt:""})],-1)),s("div",null,[e[7]||(e[7]=_(" 管理后台 ",-1)),t.userinfo&&t.userinfo.username&&t.userinfo.username!==""?(n(),l("span",be,"（"+w((k=t.userinfo)==null?void 0:k.username)+"）",1)):a("",!0)])])):a("",!0),t.myShopList.length>0?(n(!0),l(j,{key:1},N(t.myShopList,I=>(n(),l("div",{class:"info-item",key:I.shopId,onClick:Ve=>h(I.shopId)},[s("div",Ie,[I.shopLogo?(n(),l("img",{key:0,src:B(J)(I.shopLogo),alt:""},null,8,Ce)):(n(),l("img",we))]),s("div",Fe,w(I.shopTitle),1)],8,Le))),128)):a("",!0)])]}),_:1})]))]),_:1},8,["spinning"]),B(x)==="shop"?(n(),l("div",Be,[r(u,{type:"primary",onClick:e[1]||(e[1]=k=>o.value=!0),style:{width:"130px"}},{default:v(()=>e[9]||(e[9]=[_("新建店铺",-1)])),_:1,__:[9]})])):a("",!0)]))])}}}),Re=O(Me,[["__scopeId","data-v-d0163d87"]]),ze=P({__name:"SelectShop",props:{isIndex:{type:Boolean,default:!1},selectShopFlag:{type:Boolean,default:!1}},emits:["closePopup","update:selectShopFlag"],setup(t,{emit:C}){const x=t,c=C,f=z(),$=async e=>{localStorage.setItem("shopId",String(e)),e===0?localStorage.setItem("adminType","admin"):localStorage.setItem("adminType","shop");const S=V(),L=E(),u=K(),y=X();await Promise.all([S.updateUserInfo(),L.updateConfig()]),y.getThemeInfo(),H.success({message:"登录成功",placement:"top",duration:1.5,description:"您好，欢迎回来"}),u.clearMenus();const p=await Q();if(u.setRouters(p||[]),x.isIndex){c("closePopup");const F=`${f.options.history.base}${p?p[0].path:"/"}`;window.history.pushState({path:F},"",F),setTimeout(()=>{location.reload()},200);return}localStorage.setItem("lastOpenTime",String(W().unix())),f.push(p?p[0].path:"/"),setTimeout(()=>{location.reload()},20)},b=()=>{c("closePopup")},g=T([]),i=T(!0),o=T({username:""}),h=T(""),d=async()=>{try{i.value=!0;const e=await Se({sortField:"lastLoginTime"});e.shop.records&&(g.value=e.shop.records),e.userinfo&&(o.value=e.userinfo)}catch{}finally{i.value=!1}};return D(()=>{const e=localStorage.getItem("accessToken");h.value=localStorage.getItem("adminType"),e&&Y()?d():i.value=!1}),(e,S)=>(n(),l(j,null,[t.isIndex?a("",!0):(n(),R(ye,{key:0,selectShopFlag:t.selectShopFlag,myShopList:g.value,loading:i.value,userinfo:o.value,adminType:h.value,onCallBack:$},null,8,["selectShopFlag","myShopList","loading","userinfo","adminType"])),t.isIndex?(n(),R(Re,{key:1,selectShopFlag:t.selectShopFlag,myShopList:g.value,loading:i.value,userinfo:o.value,adminType:h.value,onCallBack:$,onChangeShopList:d,onClose:b},null,8,["selectShopFlag","myShopList","loading","userinfo","adminType"])):a("",!0)],64))}});export{ze as _};

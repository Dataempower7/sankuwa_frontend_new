import{a6 as w,d as V,v as q,f as y,g as i,h as o,i as s,l as a,z as h,Q as x,t as S,j as k,E as N,n as A,F as P,p as j,k as R,_ as D,r as L,ab as H,m as _,W,ac as G,P as z,b as J,o as K,A as Q,x as X,a as Y,u as Z,I as ee,ad as U,H as se}from"./index-B52YIGC0.js";import{_ as te}from"./merchant_logo-DuVmNXah.js";import{i as O}from"./format-BxqOrW-w.js";const ls=()=>w({url:"common/cacheManage/cleanup",method:"post"}),is=e=>w({url:"msg/adminMsg/msgCount",method:"get",params:e}),as=e=>w({url:"common/tipsManage/list",method:"get",params:e}),rs=()=>w({url:"common/csrf/create",method:"get"}),oe="/admin/assets/shop_logo_b-DK_MbwV3.png",ne="/admin/assets/shop_logo-0stPotOH.png",le="/admin/assets/gys-0-MRmT23.png",ie="/admin/assets/ztd-UcGjIvex.png",ae={class:"select-shop-warp"},re={class:"warp-info"},ce={class:"back-btn"},de={key:0,class:"sub-title-name"},ue={class:"shop-list-warp"},pe={key:0,class:"shop-list"},me={class:"left-item"},he={class:"left-info"},ge={class:"left-title"},fe={key:0},ye=["onClick"],ve={class:"left-item"},Se={class:"left-info"},ke={class:"left-title"},_e=["onClick"],Le={class:"left-item"},Te={class:"left-info"},$e={class:"left-title"},be={key:3,class:"shop-list shop-list-min-height"},Ie=V({__name:"LoginSelectShop",props:{selectShopFlag:{type:Boolean,default:!1},myShopList:{type:Array,default:()=>[]},vendorList:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},userinfo:{type:Object,default:()=>{}},adminType:{type:String,default:""}},emits:["closePopup","update:selectShopFlag","callBack"],setup(e,{emit:F}){const v=F,f=async(r,n)=>{v("callBack",{id:r,type:n})},{logout:C}=q(),T=()=>{v("update:selectShopFlag",!1),C()},B=r=>/^1[3-9]\d{9}$/.test(r),$=r=>B(r)?r.slice(0,3)+"****"+r.slice(7):r;return(r,n)=>{var I,l,p;const u=y("a-spin"),t=y("el-image"),b=y("el-empty");return o(),i("div",ae,[s("div",re,[s("div",ce,[s("div",{class:"bark",onClick:n[0]||(n[0]=d=>T())},[...n[2]||(n[2]=[s("i",{class:"iconfont-admin icon-zuojiantou-copy"},null,-1),x("返回",-1)])])]),n[8]||(n[8]=s("div",{class:"title-name"},[s("div",{class:"left-title"},"您可以进入以下管理后台")],-1)),e.userinfo&&((I=e.userinfo)!=null&&I.username)?(o(),i("div",de,[s("span",null,S($((l=e.userinfo)==null?void 0:l.username)),1),x(" 已绑定了以下"+S(k(N)()?"门店":"店铺")+"，您可以进入以下任一"+S(k(N)()?"门店":"店铺"),1)])):a("",!0),h(u,{spinning:e.loading,style:{width:"100%","margin-top":"100px",height:"200px"}},null,8,["spinning"]),s("div",ue,[!e.loading&&e.adminType==="admin"?(o(),i("div",pe,[s("div",{onClick:n[1]||(n[1]=d=>f(0,"admin")),class:"shop-item",style:{"border-color":"#ffeac7","background-color":"#fff4e6",color:"#4e4e4e"}},[s("div",me,[n[4]||(n[4]=s("img",{class:"left-image",src:oe,alt:""},null,-1)),s("div",he,[s("div",ge,[n[3]||(n[3]=x(" 管理后台 ",-1)),e.userinfo&&e.userinfo.username&&e.userinfo.username!==""?(o(),i("span",fe,"（"+S($((p=e.userinfo)==null?void 0:p.username))+"）",1)):a("",!0)])])]),n[5]||(n[5]=s("div",{class:"right-item"},[s("span",{class:"iconfont-admin icon-login-youjiantou"})],-1))])])):a("",!0),e.myShopList.length>0?(o(),i("div",{key:1,class:A(["shop-list",{"shop-list-min-height":e.vendorList.length==0}])},[e.loading?a("",!0):(o(!0),i(P,{key:0},j(e.myShopList,d=>(o(),i("div",{onClick:m=>f(d.shopId,"shop"),class:"shop-item"},[s("div",ve,[d.shopType!==3?(o(),R(t,{key:0,class:"left-image",src:k(ne)},null,8,["src"])):a("",!0),d.shopType===3?(o(),R(t,{key:1,class:"left-image",src:k(ie)},null,8,["src"])):a("",!0),s("div",Se,[s("div",ke,S(d.shopTitle),1)])]),n[6]||(n[6]=s("div",{class:"right-item"},[s("span",{class:"iconfont-admin icon-login-youjiantou"})],-1))],8,ye))),256))],2)):a("",!0),e.vendorList.length>0?(o(),i("div",{key:2,class:A(["shop-list shop-list-min-height",{top:e.myShopList.length>0}])},[e.loading?a("",!0):(o(!0),i(P,{key:0},j(e.vendorList,d=>(o(),i("div",{onClick:m=>f(d.vendorId,"vendor"),class:"shop-item"},[s("div",Le,[h(t,{class:"left-image",src:k(le)},null,8,["src"]),s("div",Te,[s("div",$e,S(d.vendorName),1)])]),n[7]||(n[7]=s("div",{class:"right-item"},[s("span",{class:"iconfont-admin icon-login-youjiantou"})],-1))],8,_e))),256))],2)):a("",!0),!e.loading&&e.myShopList.length==0&&e.vendorList.length==0&&e.adminType!="admin"?(o(),i("div",be,[h(b,{description:"您还没有已绑定的店铺哦～"})])):a("",!0)])])])}}}),xe=D(Ie,[["__scopeId","data-v-b5b9d782"]]),Ce="/admin/assets/admin_logo-BpneqWmR.png",we="/admin/assets/supplier_logo-DVgs8_3J.png",Fe=e=>w({url:"merchant/shop/myShop",method:"get",params:e,noErrorTip:!0}),Be=e=>w({url:"merchant/shop/create",method:"post",data:e}),Me={class:"select-shop-warp"},Pe={key:0},Re={key:0,class:"warp-info"},je={class:"list-box"},Ve={key:0},Ne=["onClick"],Ae={class:"logo"},ze={key:1,src:te,alt:""},Ue={class:"shop-name"},Oe={key:0,class:"label shop"},qe={key:1,class:"label store"},De={key:2,class:"label pickup"},Ee={class:"line1"},He=["onClick"],We={class:"logo"},Ge=["src"],Je={key:1,src:we,alt:""},Ke={class:"shop-name line1"},Qe={class:"line1"},Xe={key:0,class:"btn-box"},Ye={key:1},Ze={style:{padding:"40px 0"}},es=V({__name:"IndexSelectShop",props:{selectShopFlag:{type:Boolean,default:!1},myShopList:{type:Array,default:()=>[]},vendorList:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},userinfo:{type:Object,default:()=>{}},adminType:{type:String,default:""}},emits:["closePopup","update:selectShopFlag","callBack","changeShopList","close"],setup(e,{emit:F}){const v=L({shopTitle:"",shopLogo:""}),f=F,C=()=>{f("close")},T=L(!1),B=async()=>{await $.value.validate();try{T.value=!0;const u=await Be({...v.value});z.success("创建成功"),r.value=!1,f("changeShopList",!0)}catch(u){z.error(u.message)}finally{T.value=!1}},$=H(),r=L(!1),n=async(u,t)=>{f("callBack",{id:u,type:t})};return(u,t)=>{const b=y("el-image"),I=y("el-scrollbar"),l=y("a-spin"),p=y("el-button"),d=y("TigInput"),m=y("el-form-item"),M=y("el-form");return o(),i("div",Me,[s("div",{class:"head-box flex flex-justify-between flex-align-center"},[t[6]||(t[6]=s("div",{class:"title"},"选择组织",-1)),s("div",{class:"close",onClick:C},[...t[5]||(t[5]=[s("i",{class:"iconfont icon-cha1"},null,-1)])])]),r.value?(o(),i("div",Ye,[s("div",Ze,[h(M,{"label-width":"80",ref_key:"formRef",ref:$,model:v.value,class:"demo-ruleForm","status-icon":""},{default:_(()=>[h(m,{rules:[{required:!0,message:"店铺名称不能为空!"}],label:"店铺名称",prop:"shopTitle"},{default:_(()=>[h(d,{classType:"tig-form-input",modelValue:v.value.shopTitle,"onUpdate:modelValue":t[2]||(t[2]=g=>v.value.shopTitle=g)},null,8,["modelValue"])]),_:1}),h(m,{label:""},{default:_(()=>[h(p,{type:"primary",onClick:t[3]||(t[3]=g=>B())},{default:_(()=>[...t[11]||(t[11]=[x(" 创建 ",-1)])]),_:1}),h(p,{onClick:t[4]||(t[4]=g=>r.value=!1)},{default:_(()=>[...t[12]||(t[12]=[x("取消",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])])):(o(),i("div",Pe,[h(l,{spinning:e.loading,style:{width:"100%","margin-top":"100px",height:"200px"}},{default:_(()=>[e.loading?a("",!0):(o(),i("div",Re,[h(I,{style:{height:"100%"}},{default:_(()=>{var g;return[s("div",je,[e.userinfo.adminType=="admin"?(o(),i("div",{key:0,class:"info-item admin",onClick:t[0]||(t[0]=c=>n(0,"admin"))},[t[8]||(t[8]=s("div",{class:"logo"},[s("img",{src:Ce,alt:""})],-1)),s("div",null,[t[7]||(t[7]=x(" 管理后台 ",-1)),e.userinfo&&e.userinfo.username&&e.userinfo.username!==""?(o(),i("span",Ve,"（"+S((g=e.userinfo)==null?void 0:g.username)+"）",1)):a("",!0)])])):a("",!0),e.myShopList.length>0?(o(!0),i(P,{key:1},j(e.myShopList,c=>(o(),i("div",{class:"info-item",key:c.shopId,onClick:E=>n(c.shopId,"shop")},[s("div",Ae,[c.shopLogo?(o(),R(b,{key:0,class:"shop-img",src:k(O)(c.shopLogo),fit:"cover"},null,8,["src"])):(o(),i("img",ze))]),s("div",Ue,[c.shopType===1?(o(),i("p",Oe,"店铺")):a("",!0),c.shopType===2?(o(),i("p",qe,"门店")):a("",!0),c.shopType===3?(o(),i("p",De,"自提点")):a("",!0),s("p",Ee,S(c.shopTitle),1)])],8,Ne))),128)):a("",!0),e.vendorList.length>0?(o(!0),i(P,{key:2},j(e.vendorList,c=>(o(),i("div",{class:"info-item",key:c.vendorId,onClick:E=>n(c.vendorId,"vendor")},[s("div",We,[c.gysLogo?(o(),i("img",{key:0,src:k(O)(c.gysLogo),alt:""},null,8,Ge)):(o(),i("img",Je))]),s("div",Ke,[t[9]||(t[9]=s("p",{class:"label vendor"},"供应商",-1)),s("p",Qe,S(c.vendorName),1)])],8,He))),128)):a("",!0)])]}),_:1})]))]),_:1},8,["spinning"]),k(W)()==="shop"&&k(G)()===1?(o(),i("div",Xe,[h(p,{type:"primary",onClick:t[1]||(t[1]=g=>r.value=!0),style:{width:"130px"}},{default:_(()=>[...t[10]||(t[10]=[x("新建店铺",-1)])]),_:1})])):a("",!0)]))])}}}),ss=D(es,[["__scopeId","data-v-24f8d0ed"]]),cs=V({__name:"SelectShop",props:{isIndex:{type:Boolean,default:!1},selectShopFlag:{type:Boolean,default:!1}},emits:["closePopup","update:selectShopFlag"],setup(e,{emit:F}){const v=e,f=F,C=J(),T=async l=>{localStorage.setItem("adminType",l.type),localStorage.removeItem("shopId"),localStorage.removeItem("vendorId"),l.type=="shop"&&localStorage.setItem("shopId",String(l.id)),l.type=="vendor"&&localStorage.setItem("vendorId",String(l.id));const p=q(),d=X(),m=Y();if(Z(),await Promise.all([p.updateUserInfo(),d.updateConfig()]),ee.success({message:"登录成功",placement:"top",duration:1.5,description:"您好，欢迎回来"}),v.isIndex){setTimeout(()=>{location.reload()},20);const g=await U();m.setRouters(g||[]),f("closePopup");const c=`${C.options.history.base}${g?g[0].path:"/"}`;window.history.pushState({path:c},"",c);return}m.clearMenus();const M=await U();m.setRouters(M||[]),localStorage.setItem("lastOpenTime",String(se().unix())),C.push(M?B(M[0]):"/")},B=l=>{var p,d;if((p=l.children)!=null&&p[0]){const m=l.children[0];if(l.path===m.path)return l.path;if((d=m.children)!=null&&d[0])return(l.path=="/"?"":l.path)+"/"+m.children[0].path}return l.path},$=()=>{f("closePopup")},r=L([]),n=L([]),u=L(!0),t=L({username:""}),b=L(""),I=async()=>{try{u.value=!0;const l=await Fe({sortField:"lastLoginTime"});l.shop.records&&(r.value=l.shop.records),l.vendor.records&&(n.value=l.vendor.records),l.userinfo&&(t.value=l.userinfo)}catch{}finally{u.value=!1}};return K(()=>{const l=localStorage.getItem("accessToken");b.value=localStorage.getItem("adminType"),l&&Q()?I():u.value=!1}),(l,p)=>(o(),i(P,null,[e.isIndex?a("",!0):(o(),R(xe,{key:0,selectShopFlag:e.selectShopFlag,myShopList:r.value,vendorList:n.value,loading:u.value,userinfo:t.value,adminType:b.value,onCallBack:T},null,8,["selectShopFlag","myShopList","vendorList","loading","userinfo","adminType"])),e.isIndex?(o(),R(ss,{key:1,selectShopFlag:e.selectShopFlag,myShopList:r.value,vendorList:n.value,loading:u.value,userinfo:t.value,adminType:b.value,onCallBack:T,onChangeShopList:I,onClose:$},null,8,["selectShopFlag","myShopList","vendorList","loading","userinfo","adminType"])):a("",!0)],64))}});export{cs as _,we as a,as as b,ls as c,rs as d,is as g};

import{a6 as l,d as A,aM as B,r as d,du as G,o as K,y as N,f as w,g as p,h as f,i as o,z as m,m as h,j as u,G as k,dv as q,L as S,M as $,l as H,n as j,al as J,F as Q,p as W,ah as X,t as Y,P as _,_ as Z}from"./index-B52YIGC0.js";import{E as ee}from"./Emoji-D1NIuMzg.js";import{i as te}from"./format-BxqOrW-w.js";const ye=s=>l({prefix:"/im",url:"conversation/conversation/list",method:"get",params:s}),we=s=>l({prefix:"/im",url:"conversation/message/list",method:"get",params:s}),se=s=>l({prefix:"/im",url:"conversation/message/send",method:"post",data:s}),ke=s=>l({prefix:"/im",url:"conversation/message/setRead",method:"post",data:s}),Se=s=>l({prefix:"/im",url:"conversation/conversation/del",method:"post",data:s}),je=s=>l({prefix:"/im",url:"conversation/conversation/detail",method:"get",params:s}),Le=s=>l({prefix:"/im",url:"conversation/conversation/saveRemark",method:"post",data:s}),Re=s=>l({prefix:"/im",url:"conversation/conversation/create",method:"post",data:s}),oe={class:"im-edit-box comment-editor"},ae={class:"im-edit-box-toolbar"},ne={class:"zent-tooltip-wrapper"},ie={class:"emoji-container emoji-btn imicon imicon-emoji"},re={class:"toolbar-pop-m_wrap"},le={class:"image-btn"},ce={class:"comment-input default"},de={class:"input-box"},ue={key:0,class:"image-preview-box"},me={class:"item"},pe=["onClick"],fe={class:"text-count-wrapper"},ve={class:"text text-count-real"},ge=A({__name:"SendMessage",props:{messageInfo:{type:Object,default:{}}},emits:["update:isEditComment","successAdded","sendMessage"],setup(s,{emit:L}){const R=B("receiveValueFromGrandChild"),M=s,x=L,E=d(),U=d(),v=d([]),n=d(null),i=d(""),b=d(!1),C=G(()=>i.value.length);d(!1);const z=()=>{b.value=!0},F=()=>{b.value=!1,x("update:isEditComment",!1)},I=e=>{var t;(t=n.value)==null||t.focus(),i.value+="["+e+"]",g()},g=()=>{var t,a;const e=(t=n.value)==null?void 0:t.lastChild;if(e){const r=document.createRange();(a=n.value)==null||a.focus(),document.createRange();const c=window.getSelection();r.setStartAfter(e),r.collapse(!0),c&&(c.removeAllRanges(),c.addRange(r))}},O=e=>{const t=e.size/1024/1024<10;return t||_.error("只能上传10M以内的图片"),t},V=e=>{if(e.file.status=="uploading",e.file.status,e.file.status==="done")if(e.file.response.code!==0)e.file.status="error",_.error(e.file.response.data.message);else{for(let t in e.fileList)e.file.uid==e.fileList[t].uid&&(e.fileList[t]=Object.assign(e.fileList[t],e.fileList[t].response.data));console.log(e.fileList[0].picUrl),e.fileList.map(t=>{y("image",t.picUrl)})}else e.file.status},D=e=>{v.value.splice(e,1)},P=e=>{e.key==="Enter"&&(e.shiftKey||(y("text"),e.preventDefault()))},y=async(e="",t="")=>{if(i.value==""&&e=="text"){_.error("请输入回复内容");return}try{let a={};Object.assign(a,M.messageInfo,{content:{messageType:e||"text",content:i.value||"",pic:t||""}});const r=await se(a);x("sendMessage",r),R(r),i.value=""}catch(a){console.log(a)}finally{n.value.innerHTML=""}};return K(()=>{var e;(e=n.value)==null||e.focus(),n.value}),N(()=>{n.value}),(e,t)=>{const a=w("SvgIcon"),r=w("el-popover");return f(),p("div",oe,[o("div",ae,[o("div",ne,[o("div",{class:"toolbar-pop-m_wrap",onClick:g},[m(r,{ref_key:"popoverRef",ref:U,trigger:"click",width:"438px",teleported:!1,"hide-after":0,placement:"top-start",offset:15},{reference:h(()=>[o("div",ie,[o("div",{class:"emoji-box",ref_key:"emojiRef",ref:E},[m(a,{name:"im-face",height:"20",width:"20"})],512)])]),default:h(()=>[m(ee,{onInsertEmoji:I})]),_:1},512)]),o("div",re,[m(u(q),{name:"file",action:u(k).prefix+"/setting/galleryPic/uploadImg",headers:u(k).headers(),onChange:V,showUploadList:!1,"before-upload":O,multiple:!1},{default:h(()=>[o("div",le,[m(a,{name:"im-pic",height:"20",width:"20"})])]),_:1},8,["action","headers"])])])]),o("div",ce,[S((f(),p("div",de,[S(o("textarea",{ref_key:"editorRef",ref:n,onFocus:z,onKeydown:P,spellcheck:"false",placeholder:"提示：按Enter键发送，Shift+Enter换行",class:j(["rich-input",{empty:i.value.length==0}]),"onUpdate:modelValue":t[0]||(t[0]=c=>i.value=c)},null,34),[[J,i.value]]),v.value.length>0?(f(),p("div",ue,[(f(!0),p(Q,null,W(v.value,(c,T)=>(f(),p("div",me,[o("div",{class:"image-preview",style:X("background-image: url("+u(te)(c)+");")},null,4),o("div",{class:"clean-btn",onClick:_e=>D(T)},[m(a,{name:"close",width:"16",height:"16",style:{width:"16px",height:"16px"}})],8,pe)]))),256))])):H("",!0),o("div",{class:"action-box",onClick:g},[t[2]||(t[2]=o("div",{style:{flex:"1 1 0%"}},null,-1)),o("div",fe,[o("div",{class:j(["text-count",{"text-count-error":u(C)>1e3}])},[o("span",ve,Y(u(C))+" ",1),t[1]||(t[1]=o("span",{class:"text text-count-limit"},"/ 1000",-1))],2)])])])),[[u($),F]])])])}}}),he=Z(ge,[["__scopeId","data-v-42b3b9d9"]]),Me=Object.freeze(Object.defineProperty({__proto__:null,default:he},Symbol.toStringTag,{value:"Module"}));export{he as S,we as a,Le as b,Re as c,Se as d,ke as e,je as f,ye as g,Me as h,se as s};

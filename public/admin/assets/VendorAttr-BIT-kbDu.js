import{d as et,aq as I,x as at,r as k,ar as st,c as lt,o as rt,Y as ot,f as x,g as v,h as u,k as $,l as g,z as c,m as i,i as o,F as M,p as O,j as V,f7 as it,Q as h,t as y,_ as nt}from"./index-B52YIGC0.js";import{d as ut}from"./vuedraggable.umd-BauR0rTv.js";import"./index-KjhYqCTY.js";import{i as q}from"./format-BxqOrW-w.js";import{c as dt}from"./product-CL06FDSJ.js";import{_ as ct}from"./DialogForm.vue_vue_type_script_setup_true_lang-CT6mpwCc.js";import"./index-C9ZdVeVx.js";const pt={class:"attr-form"},mt={class:"attr-list"},ft={class:"attr-warp"},vt=["onClick"],kt={class:"attr-warp-title"},gt={class:"flex align-center"},_t={class:"attr-warp-box"},ht={class:"draggable-item"},bt={class:"attr-row"},yt=["onClick"],xt={key:1,class:"upload-img-wrap"},Vt={class:"pic-select-con"},Pt={key:0,class:"pic-select"},Lt={class:"pic-select-img"},Nt=["src"],wt=["onClick"],Ct={key:1,class:"pic-select"},Tt={class:"pic-select-img"},St=["src"],$t={key:1,class:"extra mt10",style:{"text-align":"center"}},At={class:"attr-warp-title"},Et={class:"red"},Ft={class:"lyecs-form-table"},Bt=et({__name:"VendorAttr",props:I({attrList:{type:Object,default:{normal:[],spe:[],extra:[]}},productList:{type:[Object,Array],default:[]},attrChanged:{type:Boolean,default:!1},disabled:{type:Boolean,default:!0},action:{type:String,default:"add"},attrTplList:{type:Array}},{skuErrorText:{default:""},skuErrorTextModifiers:{}}),emits:I(["update:productList","update:attrList","update:attrChanged"],["update:skuErrorText"]),setup(_,{expose:R,emit:z}){const D=at().config;k(!1);const A=_,E=k();k("");const C=st(_,"skuErrorText"),T=z,F={normal:0,spe:1,extra:2};k(null),k({});const d=k(A.attrList),p=k(A.productList),Q=(a,t)=>{const e=a.find(f=>f.attrName===t);return e?e.attrValue:""};lt(()=>{let a=0;for(let t in p.value)a+=Number(p.value[t].skuStock);return a}),k(!1),k({name:"",type:""});let B=!1;rt(()=>{T("update:productList",p),T("update:attrList",d)});const Y=(a,t,e)=>{const f=a.field.split(".")[1];let l=Number(p.value[f].skuPrice),s=Number(p.value[f].maxPrice),b=Number(p.value[f].supplyPrice);if(l)if(l>s){e(new Error("价格最大不可超过"+s));return}else if(l<b){e(new Error("售价不可小于供货价"+b));return}else e();else{e(new Error("请输入商品售价"));return}},G=async(a,t)=>{try{const e=await dt({vendorProductSkuId:t});console.log(e),p.value[a].maxPrice=e}catch(e){console.log(e)}},H=async()=>{await E.value.validate()},U=a=>{p.value=L()},J=(a,t)=>{d.value[a][t].attrList.push({attrValue:"",attrType:F[a],attrName:d.value[a][t].attrName})},K=(a,t,e)=>{d.value[a][t].attrList.splice(e,1),p.value=L()},W=(a,t)=>{d.value[a].splice(t,1),p.value=L()},X=a=>{d.value[a].push({attrName:"",attrList:[{attrType:F[a],attrName:"",attrValue:""}]})},Z=(a,t)=>{d.value[t.type][t.index].attrList[t.idx].attrPic=a[0].picUrl,d.value[t.type][t.index].attrList[t.idx].attrPicThumb=a[0].picThumb},tt=(a,t,e)=>{d.value[a][t].attrList[e].attrPic="",d.value[a][t].attrList[e].attrPicThumb=""};k();const S=k([]),L=()=>{if(d.value.spe.length==0)return[];let a=j(d.value.spe),t=[];for(let e in a){t[e]={attrNames:[],attrValues:[],attrs:[]};let f=[];for(let s in a[e])t[e].attrs[s]={attrName:a[e][s].attrName,attrValue:a[e][s].attrValue},f.push(a[e][s].attrName+":"+a[e][s].attrValue),t[e].attrNames.push(a[e][s].attrName),t[e].attrValues.push(a[e][s].attrValue),t[e].skuStock=t[e].skuStock;t[e].skuValue=f.join("|");const l=p.value.find(s=>t[e].skuValue==s.skuValue);l&&(t[e].skuStock=l.skuStock,t[e].skuSn=l.skuSn,t[e].skuTsn=l.skuTsn,t[e].skuPrice=l.skuPrice,t[e].supplyPrice=l.supplyPrice)}return p.value=t,t};ot(()=>d.value,(a,t)=>{B==!0&&T("update:attrChanged",!0),S.value=L(),B=!0},{deep:!0,immediate:!0});function j(a){const t=[];if(a.length===0)return C.value="",t.push([]),t;a.map(l=>{l.attrList.length>0&&l.attrList.map(s=>{s.attrName=l.attrName})});const e=a[0],f=a.slice(1);for(let l=0;l<e.attrList.length;l++){const s=[e.attrList[l]],b=j(f);for(let P=0;P<b.length;P++)t.push([...s,...b[P]])}return t}return R({skuErrorText:C,validateProductSku:H}),(a,t)=>{const e=x("TigInput"),f=x("el-button"),l=x("el-form-item"),s=x("el-table-column"),b=x("el-table"),P=x("el-form");return u(),v("div",pt,[d.value.spe.length>0?(u(),$(l,{key:0,label:"商品规格"},{default:i(()=>[o("div",mt,[(u(!0),v(M,null,O(d.value.spe,(r,n)=>(u(),v("div",ft,[_.disabled?g("",!0):(u(),v("div",{key:0,class:"btn-remove",onClick:m=>W("spe",n)},[...t[2]||(t[2]=[o("i",{class:"iconfont icon-cha1"},null,-1)])],8,vt)),o("div",kt,[o("div",gt,[t[4]||(t[4]=o("div",{class:"label"},"规格名：",-1)),o("div",null,[c(e,{modelValue:r.attrName,"onUpdate:modelValue":m=>r.attrName=m,style:{"margin-right":"20px"},width:"250px",disabled:_.disabled,onBlur:U,placeholder:"请输入规格项，如颜色、尺码、大小"},null,8,["modelValue","onUpdate:modelValue","disabled"]),t[3]||(t[3]=o("div",{class:"extra mt10"},"该商品为供应商商品，暂不支持修改规格",-1))])])]),o("div",_t,[c(V(ut),{class:"attr-row-box","item-key":"deagIndex",list:r.attrList,"ghost-class":"sortable-ghost","chosen-class":"toolChosenClass",animation:"300",onStart:t[0]||(t[0]=()=>{}),onEnd:U,group:{name:"advanced",pull:!1,put:!0}},{item:i(({element:m,index:N})=>[o("div",ht,[o("div",bt,[c(e,{modelValue:m.attrValue,"onUpdate:modelValue":w=>m.attrValue=w,placeholder:"请输入规格值，如：白色",width:"250px",disabled:_.disabled,"suffix-icon":V(it)},null,8,["modelValue","onUpdate:modelValue","disabled","suffix-icon"]),r.attrList.length>1&&!_.disabled?(u(),v("div",{key:0,class:"btn-remove2",onClick:w=>K("spe",n,N)},[...t[5]||(t[5]=[o("i",{class:"iconfont icon-cha1"},null,-1)])],8,yt)):g("",!0),n<1?(u(),v("div",xt,[t[6]||(t[6]=o("div",{class:"arrow"},null,-1)),o("div",Vt,[_.disabled?(u(),v("div",Ct,[o("div",Tt,[m.attrPicThumb?(u(),v("img",{key:0,src:V(q)(m.attrPicThumb)},null,8,St)):g("",!0)])])):(u(),v("div",Pt,[c(V(ct),{type:"gallery",onOkCallback:Z,data:{type:"spe",index:n,idx:N}},{default:i(()=>[o("div",Lt,[m.attrPicThumb?(u(),v("img",{key:0,src:V(q)(m.attrPicThumb)},null,8,Nt)):g("",!0)])]),_:2},1032,["data"]),m.attrPicThumb?(u(),v("i",{key:0,onClick:w=>tt("spe",n,N),class:"pic-select-del iconfont icon-cha"},null,8,wt)):g("",!0)]))])])):g("",!0)]),N===r.attrList.length-1?(u(),$(f,{key:0,disabled:_.disabled,onClick:w=>J("spe",n),link:"",type:"primary",class:"ml10",style:{"margin-top":"8px"}},{default:i(()=>[...t[7]||(t[7]=[o("i",{class:"btn-ico"},"+",-1),h("增加规格值",-1)])]),_:1},8,["disabled","onClick"])):g("",!0)])]),_:2},1032,["list"])]),n<1?(u(),v("div",$t," 仅支持为第一组规格设置规格图片，买家选择不同规格会看到对应规格图片，建议尺寸：800 x 800像素 ")):g("",!0)]))),256)),o("div",At,[c(f,{disabled:_.disabled,onClick:t[1]||(t[1]=r=>X("spe"))},{default:i(()=>[...t[8]||(t[8]=[o("i",{class:"btn-ico"},"+",-1),h("添加商品规格",-1)])]),_:1},8,["disabled"])])]),o("div",Et,y(C.value),1)]),_:1})):g("",!0),c(P,{ref_key:"productFormRef",ref:E,model:p.value,"label-width":"100px",name:"form_in_modal"},{default:i(()=>[c(l,{label:"规格明细",prop:"productList"},{default:i(()=>[o("div",Ft,[c(b,{data:p.value,style:{width:"100%"}},{default:i(()=>[S.value.length>0?(u(!0),v(M,{key:0},O(S.value[0].attrs,r=>(u(),$(s,{prop:"attrs",label:r.attrName,align:"center"},{default:i(({row:n,$index:m})=>[h(y(Q(n.attrs,r.attrName)),1)]),_:2},1032,["label"]))),256)):g("",!0),c(s,{prop:"skuSn",label:"商品编码",fixed:"right",align:"center","min-width":"120"},{default:i(({row:r,$index:n})=>[h(y(r.skuSn||"-"),1)]),_:1}),c(s,{prop:"skuTsn",label:"商品条形码",fixed:"right",align:"center","min-width":"100"},{default:i(({row:r,$index:n})=>[h(y(r.skuTsn||"-"),1)]),_:1}),c(s,{prop:"supplyPrice",label:"供货价",fixed:"right",align:"center","min-width":"100"},{default:i(({row:r,$index:n})=>[h(y(r.supplyPrice||"-"),1)]),_:1}),c(s,{prop:"skuPrice",label:"售价",fixed:"right","min-width":"120"},{default:i(({row:r,$index:n})=>[c(l,{label:"",prop:`productList.${n}.skuPrice`,rules:[{required:!0,validator:Y}]},{default:i(()=>[c(e,{type:"decimal",modelValue:r.skuPrice,"onUpdate:modelValue":m=>r.skuPrice=m,onFocus:m=>G(n,r.vendorProductSkuId),max:r.maxPrice},{append:i(()=>[h(y(V(D).dollarSign),1)]),_:1},8,["modelValue","onUpdate:modelValue","onFocus","max"])]),_:2},1032,["prop","rules"])]),_:1}),c(s,{prop:"skuStock",label:"库存",fixed:"right",align:"center","min-width":"100"},{header:i(()=>[...t[9]||(t[9]=[o("div",{class:"flex flex-align-center flex-justify-center"},"库存",-1)])]),default:i(({row:r,$index:n})=>[h(y(r.skuStock),1)]),_:1})]),_:1},8,["data"])])]),_:1})]),_:1},8,["model"])])}}}),zt=nt(Bt,[["__scopeId","data-v-d8cf6cf9"]]);export{zt as default};

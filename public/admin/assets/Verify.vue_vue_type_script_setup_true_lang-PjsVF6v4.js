import{C as j}from"./Verify.vue_vue_type_style_index_0_lang-BAuPCCIW.js";import{_ as de,a5 as se,bu as ue,r as i,as as fe,c as he,Y as ve,o as ge,f as pe,g as w,h as m,l as V,i as p,ah as x,z as ee,L as me,m as te,O as ye,n as ne,t as $,T as Se,s as be,a6 as re,d as we,k as xe,j as l}from"./index-B52YIGC0.js";import{M as ke}from"./index-C9ZdVeVx.js";function oe(a,r="XwKsGlMcdPMEhR1B"){var n=j.enc.Utf8.parse(r),e=j.enc.Utf8.parse(a),d=j.AES.encrypt(e,n,{mode:j.mode.ECB,padding:j.pad.Pkcs7});return d.toString()}function ze(a){var r,n,e,d,k=a.$el.parentNode.offsetWidth||window.offsetWidth,y=a.$el.parentNode.offsetHeight||window.offsetHeight;return a.imgSize.width.indexOf("%")!=-1?r=parseInt(a.imgSize.width)/100*k+"px":r=a.imgSize.width,a.imgSize.height.indexOf("%")!=-1?n=parseInt(a.imgSize.height)/100*y+"px":n=a.imgSize.height,a.barSize.width.indexOf("%")!=-1?e=parseInt(a.barSize.width)/100*k+"px":e=a.barSize.width,a.barSize.height.indexOf("%")!=-1?d=parseInt(a.barSize.height)/100*y+"px":d=a.barSize.height,{imgWidth:r,imgHeight:n,barWidth:e,barHeight:d}}const Be={name:"VerifySlide",props:{captchaType:{type:String},type:{type:String,default:"1"},mode:{type:String,default:"fixed"},vSpace:{type:Number,default:5},explain:{type:String,default:"向右拖动滑块填充拼图"},imgSize:{type:Object,default(){return{width:"310px",height:"155px"}}},blockSize:{type:Object,default(){return{width:"50px",height:"50px"}}},barSize:{type:Object,default(){return{width:"310px",height:"40px"}}}},setup(a,r){const{mode:n,captchaType:e,vSpace:d,imgSize:k,barSize:y,type:u,blockSize:C,explain:J}=se(a),{proxy:s}=ue();let h=i(""),I=i(""),R=i(""),S=i(""),b=i(""),v=i(""),W=i(""),K=i(""),g=i(""),z=i(""),T=i(""),f=fe({imgHeight:0,imgWidth:0,barHeight:0,barWidth:0}),U=i(0),le=i(0),X=i(void 0),A=i(void 0),H=i(void 0),O=i("#ddd"),E=i("#d1e0f1"),N=i(void 0),F=i("icon-right"),_=i(!1),B=i(!1),G=i(!0),Y=i(""),Q=i(""),Z=i(0);const M=he(()=>s.$el.querySelector(".verify-bar-area"));function ie(){z.value=J.value,ae(),be(()=>{let{imgHeight:t,imgWidth:o,barHeight:L,barWidth:c}=ze(s);f.imgHeight=t,f.imgWidth=o,f.barHeight=L,f.barWidth=c,s.$emit("ready",s)}),window.removeEventListener("touchmove",function(t){P(t)}),window.removeEventListener("mousemove",function(t){P(t)}),window.removeEventListener("touchend",function(){q()}),window.removeEventListener("mouseup",function(){q()}),window.addEventListener("touchmove",function(t){P(t)}),window.addEventListener("mousemove",function(t){P(t)}),window.addEventListener("touchend",function(){q()}),window.addEventListener("mouseup",function(){q()})}ve(u,()=>{ie()}),ge(()=>{ie(),s.$el.onselectstart=function(){return!1}});function ce(t){if(t=t||window.event,t.touches)var o=t.touches[0].pageX;else var o=t.clientX;Z.value=Math.floor(o-M.value.getBoundingClientRect().left),v.value=+new Date,B.value==!1&&(z.value="",H.value="#1991fa",O.value="#1991fa",E.value="#d1e0f1",N.value="#fff",t.stopPropagation(),_.value=!0)}function P(t){if(t=t||window.event,_.value&&B.value==!1){if(t.touches)var o=t.touches[0].pageX;else var o=t.clientX;var L=M.value.getBoundingClientRect().left,c=o-L;c>=M.value.offsetWidth-parseInt(parseInt(C.value.width)/2)-2&&(c=M.value.offsetWidth-parseInt(parseInt(C.value.width)/2)-2),c<=0&&(c=parseInt(parseInt(C.value.width)/2)),X.value=c-Z.value+"px",A.value=c-Z.value+40+"px"}}function q(){if(W.value=+new Date,_.value&&B.value==!1){var t=parseInt((X.value||"").replace("px",""));t=t*310/parseInt(f.imgWidth);let o={captchaType:e.value,pointJson:h.value?oe(JSON.stringify({x:t,y:5}),h.value):JSON.stringify({x:t,y:5}),token:b.value};re({url:"common/verification/check",method:"post",data:o}).then(L=>{H.value="#52ccba",O.value="#52ccba",E.value="#d2f4ef",N.value="#fff",F.value="icon-check",G.value=!1,B.value=!0,n.value=="pop"&&setTimeout(()=>{s.$parent.clickShow=!1,D()},1500),I.value=!0,g.value=`${((W.value-v.value)/1e3).toFixed(2)}s验证成功`;var c=h.value?oe(b.value+"---"+JSON.stringify({x:t,y:5}),h.value):b.value+"---"+JSON.stringify({x:t,y:5});setTimeout(()=>{g.value="",s.$emit("close"),s.$emit("success",{verifyToken:c})},1e3)}).catch(L=>{H.value="#d9534f",O.value="#d9534f",E.value="#fce1e1",N.value="#fff",F.value="icon-close",I.value=!1,setTimeout(function(){D()},1e3),s.$emit("error",s),g.value="验证失败",setTimeout(()=>{g.value=""},1e3)}),_.value=!1}}const D=()=>{G.value=!0,T.value="",Y.value="left .3s",X.value=0,A.value=void 0,Q.value="width .3s",O.value="#ddd",E.value="#d1e0f1",H.value="#fff",N.value="#666",F.value="icon-right",B.value=!1,ae(),setTimeout(()=>{Q.value="",Y.value="",z.value=J.value},300)};function ae(){let t={captchaType:e.value};re({url:"common/verification/captcha",method:"get",data:t}).then(o=>{R.value=o.originalImageBase64,S.value=o.jigsawImageBase64,b.value=o.token,h.value=o.secretKey}).catch(o=>{g.value=o.message})}return{secretKey:h,passFlag:I,backImgBase:R,blockBackImgBase:S,backToken:b,startMoveTime:v,endMovetime:W,tipsBackColor:K,tipWords:g,text:z,finishText:T,setSize:f,top:U,left:le,moveBlockLeft:X,leftBarWidth:A,moveBlockBackgroundColor:H,leftBarBorderColor:O,leftBarBackgroundColor:E,iconColor:N,iconClass:F,status:_,isEnd:B,showRefresh:G,transitionLeft:Y,transitionWidth:Q,barArea:M,refresh:D,start:ce}}},Ce={style:{position:"relative"}},Ie=["src"],We=["textContent"],Te=["textContent"],He=["src"];function Oe(a,r,n,e,d,k){const y=pe("a-spin");return m(),w("div",Ce,[n.type==="2"?(m(),w("div",{key:0,class:"verify-img-out",style:x({height:parseInt(e.setSize.imgHeight)+n.vSpace+"px"})},[p("div",{class:"verify-img-panel",style:x({width:e.setSize.imgWidth,height:e.setSize.imgHeight})},[ee(y,{spinning:!e.backImgBase,style:"width:100%;padding-top:39px"},{default:te(()=>[e.backImgBase?(m(),w("img",{key:0,src:"data:image/png;base64,"+e.backImgBase,alt:"",style:{width:"100%",height:"100%",display:"block"}},null,8,Ie)):V("",!0)]),_:1},8,["spinning"]),e.backImgBase?me((m(),w("div",{key:0,class:"verify-refresh",onClick:r[0]||(r[0]=(...u)=>e.refresh&&e.refresh(...u))},[...r[3]||(r[3]=[p("i",{class:"iconfont icon-refresh"},null,-1)])],512)),[[ye,e.showRefresh]]):V("",!0),ee(Se,{name:"tips"},{default:te(()=>[(m(),w("span",{key:0,class:ne("verify-tips "+(e.tipWords?"show ":"")+(e.passFlag?"suc-bg":"err-bg"))},$(e.tipWords),3))]),_:1})],4)],4)):V("",!0),p("div",{class:"verify-bar-area",style:x({width:e.setSize.imgWidth,height:n.barSize.height,"line-height":n.barSize.height})},[p("span",{class:"verify-msg",textContent:$(e.text)},null,8,We),p("div",{class:"verify-left-bar",style:x({width:e.leftBarWidth!==void 0?e.leftBarWidth:n.barSize.height,height:n.barSize.height,"border-color":e.leftBarBorderColor,"background-color":e.leftBarBackgroundColor,transaction:e.transitionWidth})},[p("span",{class:"verify-msg",textContent:$(e.finishText)},null,8,Te),p("div",{class:"verify-move-block",onTouchstart:r[1]||(r[1]=(...u)=>e.start&&e.start(...u)),onMousedown:r[2]||(r[2]=(...u)=>e.start&&e.start(...u)),style:x({width:n.barSize.height,height:n.barSize.height,"background-color":e.moveBlockBackgroundColor,left:e.moveBlockLeft,transition:e.transitionLeft})},[p("i",{class:ne(["verify-icon iconfont",e.iconClass]),style:x({color:e.iconColor})},null,6),n.type==="2"?(m(),w("div",{key:0,class:"verify-sub-block",style:x({width:Math.floor(parseInt(e.setSize.imgWidth)*47/310)+"px",height:e.setSize.imgHeight,top:"-"+(parseInt(e.setSize.imgHeight)+n.vSpace)+"px","background-size":e.setSize.imgWidth+" "+e.setSize.imgHeight})},[e.blockBackImgBase?(m(),w("img",{key:0,src:"data:image/png;base64,"+e.blockBackImgBase,alt:"",style:{width:"100%",height:"100%",display:"block","-webkit-user-drag":"none"}},null,8,He)):V("",!0)],4)):V("",!0)],36)],4)],4)])}const Ee=de(Be,[["render",Oe]]),Le=we({__name:"Verify",props:{captchaType:{type:String,required:!0},figure:{type:Number},arith:{type:Number},mode:{type:String,default:"pop"},vSpace:{type:Number},explain:{type:String},imgSize:{type:Object,default(){return{width:"310px",height:"155px"}}},blockSize:{type:Object},barSize:{type:Object},close:{type:Function}},emits:["okCallback"],setup(a,{expose:r,emit:n}){const e=a,{captchaType:d,figure:k,arith:y,mode:u,vSpace:C,explain:J,imgSize:s,blockSize:h,barSize:I}=se(e);i(!1),i(void 0);const R=i(void 0),S=i({}),b=n,v=i(!1),W=()=>{console.log(S.value),S.value.refresh&&S.value.refresh()},K=()=>{v.value=!1,W()},g=()=>{v.value=!0},z=T=>{b("okCallback",T)};return r({show:g}),(T,f)=>(m(),xe(l(ke),{class:"verifybox",open:v.value,"onUpdate:open":f[0]||(f[0]=U=>v.value=U),centered:"",width:parseInt(l(s).width)+30+"px",title:"请完成安全验证",destroyOnClose:!1,footer:null},{default:te(()=>[ee(Ee,{is:R.value,captchaType:l(d),type:"2",figure:l(k),arith:l(y),mode:l(u),vSpace:l(C),explain:l(J),imgSize:l(s),blockSize:l(h),barSize:l(I),ref_key:"instance",ref:S,onClose:K,onSuccess:z},null,8,["is","captchaType","figure","arith","mode","vSpace","explain","imgSize","blockSize","barSize"])]),_:1},8,["open","width"]))}});export{Le as _};

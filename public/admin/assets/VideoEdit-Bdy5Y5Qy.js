import"./index-KjhYqCTY.js";import{i as J}from"./format-BxqOrW-w.js";import{F as K}from"./UploadAvatar.vue_vue_type_style_index_0_scoped_3ec2e0ca_lang-BGZZHoO-.js";import"./vuedraggable.umd-BauR0rTv.js";import{d as X,r as u,x as Y,a5 as Z,o as ee,P as i,f as c,g as _,h as b,i as s,z as r,m as n,j as a,dv as te,G as V,dw as oe,t as ae,Q as S,_ as le}from"./index-B52YIGC0.js";import{n as re,o as se,p as ie}from"./gallery-BnfhcmY9.js";import{b as ne}from"./time-EzYK4E-P.js";import{u as de}from"./gallery-DcB9WyRo.js";import{_ as ue}from"./DialogForm.vue_vue_type_script_setup_true_lang-CT6mpwCc.js";import"./index-C9ZdVeVx.js";import"./Image.vue_vue_type_script_setup_true_lang-B8qXJKJq.js";import"./BusinessImg-B_fZOjqm.js";import"./currencyManagement-DNysi_dA.js";/* empty css                                                                    */const pe={class:"container"},ce={class:"content_wrapper"},me={class:"lyecs-form-table"},fe={key:0,class:"video-preview"},ve=["src"],ye={key:1,style:{width:"400px"}},ge={class:"gallery-add-item flex flex-justify-center flex-align-center"},_e={class:"extra mt10"},be={class:"flex flex-justify-between"},xe={class:"con-btn ml10 flex flex-align-center flex-justify-center"},he=X({__name:"VideoEdit",props:{id:{type:Number,default:0},parentId:{type:Number,default:0},act:{type:String,default:""},galleryId:{type:Number,default:0},isDialog:Boolean},emits:["submitCallback","okType","callback"],setup(N,{expose:L,emit:z}){const R=u(),x=Y();x.updateConfig();const v=x.config.uploadMaxSize,m=u([]),f=u(!0),j={label:"name",value:"id",children:"children",checkStrictly:!0,multiple:!1},E={strokeWidth:5,format:e=>`${parseFloat((e??"0").toString())}%`},h=N,{id:U,act:w}=Z(h),T=w.value=="add"?"create":"update",B=(e,t,l)=>{if(t)if(t.length>20){l(new Error("视频名称不能超过20个字"));return}else l();else{l(new Error("视频名称不能为空"));return}},F=z,I=u();let o=u({galleryId:h.galleryId,videoUrl:"",videoName:"",videoCover:"",format:"",duration:"",size:""});ee(()=>{w.value==="detail"&&M(),g()});const G=de(),k=u([]),y=u(!1),g=async e=>{y.value=!0;try{const t=await re();k.value=t,G.isRefresh=!0}catch(t){i.error(t.message)}finally{setTimeout(()=>{y.value=!1},200)}},M=async()=>{try{const e=await se({id:U.value});o.value=e}catch(e){i.error(e.message)}},$={".mp4":"video/mp4"},O=e=>{f.value=!0;const t="."+e.name.split(".").pop().toLowerCase();if(!Object.keys($).includes(t))return i.error(`不支持 ${t} 格式的视频文件`),!1;const l=e.size/1024/1024<Number(v);return l||i.error(`只能上传${v}M以内的视频`),q(e),l},q=e=>{const t=URL.createObjectURL(e),l=document.createElement("video");l.src=t,l.onloadedmetadata=()=>{const p=l.duration;o.value.duration=ne(p),l.currentTime=.1},l.onerror=()=>{i.error("视频文件损坏或无法读取"),URL.revokeObjectURL(t)}},A=e=>{e.file.status||(f.value=!1,m.value=[]),e.file.status=="uploading",e.file.status,e.file.status==="done"?e.file.response.code!==0?(e.file.status="error",i.error(e.file.response.message)):(m.value=[e.file],o.value.size=e.file&&e.file.size?`${(e.file.size/1024/1024).toFixed(2)}MB`:"",Object.assign(o.value,e.file.response.data),i.success("视频上传成功！"),f.value=!1):e.file.status==="error"&&i.error(`${e.file.name} 视频上传失败！`)},D=()=>{o.value.videoUrl="",o.value.videoName="",o.value.duration="",m.value=[],f.value=!0},P=async()=>{await I.value.validate(),Array.isArray(o.value.galleryId)||(o.value.galleryId=[o.value.galleryId]);try{const e=await ie(T,{id:U.value,...o.value});F("submitCallback",e),i.success("操作成功")}catch(e){i.error(e.message)}};return L({onFormSubmit:()=>{P()}}),(e,t)=>{const l=c("el-icon"),p=c("el-form-item"),Q=c("TigInput"),W=c("el-cascader"),C=c("el-button"),H=c("el-form");return b(),_("div",pe,[s("div",ce,[s("div",me,[r(H,{ref_key:"formRef",ref:I,model:a(o),"label-width":"auto"},{default:n(()=>[r(p,{prop:"videoUrl",label:"本地视频",rules:[{required:!0,message:"请上传本地视频!"}]},{default:n(()=>[s("div",null,[a(o).videoUrl?(b(),_("div",fe,[s("div",{class:"iconfont icon-cha1 btn-remove",onClick:D}),s("video",{src:a(J)(a(o).videoUrl),controls:"",class:"preview-video"},null,8,ve)])):(b(),_("div",ye,[r(a(te),{name:"file",ref_key:"uploadRef",ref:R,"file-list":m.value,"onUpdate:fileList":t[0]||(t[0]=d=>m.value=d),action:a(V).prefix+"/setting/galleryVideoInfo/uploadVideo",headers:a(V).headers(),showUploadList:f.value,onChange:A,"before-upload":O,progress:E,accept:".mp4,video/*"},{default:n(()=>[s("div",ge,[r(l,{size:"25"},{default:n(()=>[r(a(oe))]),_:1})])]),_:1},8,["file-list","action","headers","showUploadList"])])),s("div",_e,"视频大小不超过"+ae(a(v))+"MB，时长5秒-5分钟以内，建议时长15-190秒， 支持的视频文件类型 .mp4。",1)])]),_:1}),r(p,{prop:"videoName",label:"视频名称",rules:[{required:!0,validator:B}]},{default:n(()=>[r(Q,{classType:"tig-form-input",modelValue:a(o).videoName,"onUpdate:modelValue":t[1]||(t[1]=d=>a(o).videoName=d),placeholder:"20个字以内",maxlength:20},null,8,["modelValue"])]),_:1},8,["rules"]),r(p,{prop:"galleryId",label:"所在视频相册",rules:[{required:!0,message:"视频相册不能为空!"}]},{default:n(()=>[s("div",be,[r(W,{modelValue:a(o).galleryId,"onUpdate:modelValue":t[2]||(t[2]=d=>a(o).galleryId=d),options:k.value,props:j,clearable:""},null,8,["modelValue","options"]),s("div",xe,[r(a(ue),{params:{act:"add",parentId:0},path:"gallery/video/GalleryVideoEdit",title:"添加视频相册",width:"400px",onOkCallback:g},{default:n(()=>[r(C,{link:"",type:"primary"},{default:n(()=>[...t[5]||(t[5]=[S("添加相册",-1)])]),_:1})]),_:1}),t[7]||(t[7]=s("p",{class:"ml10 mr10",style:{"margin-bottom":"3px"}},"|",-1)),r(C,{link:"",type:"primary",loading:y.value,onClick:t[3]||(t[3]=d=>g(0))},{default:n(()=>[...t[6]||(t[6]=[S("刷新",-1)])]),_:1},8,["loading"])])])]),_:1}),r(p,{prop:"videoCover",label:"视频封面"},{default:n(()=>[r(a(K),{photo:a(o).videoCover,"onUpdate:photo":t[4]||(t[4]=d=>a(o).videoCover=d)},null,8,["photo"]),t[8]||(t[8]=s("div",{class:"extra"}," 建议尺寸：800*800px，支持.jpg，.gif，.png格式，大小不超过10MB。如果不添加封面， 系统会默认截取视频的第一个画面作为封面。 ",-1))]),_:1})]),_:1},8,["model"])])])])}}}),Fe=le(he,[["__scopeId","data-v-e523be5a"]]);export{Fe as default};

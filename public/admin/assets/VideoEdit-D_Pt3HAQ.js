import"./index-DpgvsnVO.js";import{i as J}from"./format-DdZABYp4.js";import{F as P}from"./UploadAvatar.vue_vue_type_style_index_0_scoped_3ec2e0ca_lang-DfcXXcrS.js";import"./vuedraggable.umd-OAFqtEpj.js";import{d as Q,r as u,x as X,a0 as Y,o as Z,K as d,e as p,f as _,g as v,h as i,z as r,l as n,i as l,dl as ee,dk as L,dm as te,t as oe,F as le,m as ae,j as re,L as I,_ as se}from"./index-BLXOA87U.js";import{h as ie,n as ne,o as de}from"./gallery-FWj2DHMt.js";import{b as ue}from"./time-DX2Q3n6c.js";import{_ as pe}from"./DialogForm.vue_vue_type_script_setup_true_lang-6GHo9HCV.js";import"./index-B16C4gX_.js";import"./Image.vue_vue_type_script_setup_true_lang-BK00jvUw.js";import"./BusinessImg-C3Ug8bC9.js";import"./currencyManagement-ZKRxsK3T.js";import"./version-hjn5tnxG.js";const ce={class:"container"},me={class:"content_wrapper"},fe={class:"lyecs-form-table"},ve={key:0,class:"video-preview"},_e=["src"],ge={key:1,style:{width:"400px"}},ye={class:"gallery-add-item flex flex-justify-center flex-align-center"},be={class:"extra mt10"},xe={class:"flex flex-justify-between"},he={class:"con-btn ml10 flex flex-align-center flex-justify-center"},ke=Q({__name:"VideoEdit",props:{id:{type:Number,default:0},parentId:{type:Number,default:0},act:{type:String,default:""},isDialog:Boolean},emits:["submitCallback","okType","callback"],setup(N,{expose:S,emit:z}){const j=u(),x=X();x.updateConfig();const g=x.config.uploadMaxSize,m=u([]),f=u(!0),F={strokeWidth:5,format:e=>`${parseFloat((e??"0").toString())}%`},R=N,{id:h,act:k}=Y(R),B=k.value=="add"?"create":"update",E=(e,t,a)=>{if(t)if(t.length>20){a(new Error("视频名称不能超过20个字"));return}else a();else{a(new Error("视频名称不能为空"));return}},U=z,V=u();let o=u({videoUrl:"",videoName:"",videoCover:"",format:"",duration:"",size:""});Z(()=>{k.value==="detail"&&T(),b(0)});const w=u([]),y=u(!1),b=async e=>{y.value=!0;try{const t=await ie();w.value=t.records,e>0&&(o.value.galleryId=e,U("callback",0))}catch(t){d.error(t.message)}finally{setTimeout(()=>{y.value=!1},200)}},T=async()=>{try{const e=await ne({id:h.value});o.value=e}catch(e){d.error(e.message)}},M={".mp4":"video/mp4"},$=e=>{f.value=!0;const t="."+e.name.split(".").pop().toLowerCase();if(!Object.keys(M).includes(t))return d.error(`不支持 ${t} 格式的视频文件`),!1;const a=e.size/1024/1024<Number(g);return a||d.error(`只能上传${g}M以内的视频`),G(e),a},G=e=>{const t=URL.createObjectURL(e),a=document.createElement("video");a.src=t,a.onloadedmetadata=()=>{const c=a.duration;o.value.duration=ue(c),a.currentTime=.1},a.onerror=()=>{d.error("视频文件损坏或无法读取"),URL.revokeObjectURL(t)}},O=e=>{e.file.status||(f.value=!1,m.value=[]),e.file.status=="uploading",e.file.status,e.file.status==="done"?e.file.response.code!==0?(e.file.status="error",d.error(e.file.response.message)):(m.value=[e.file],o.value.size=e.file&&e.file.size?`${(e.file.size/1024/1024).toFixed(2)}MB`:"",Object.assign(o.value,e.file.response.data),d.success("视频上传成功！"),f.value=!1):e.file.status==="error"&&d.error(`${e.file.name} 视频上传失败！`)},q=()=>{o.value.videoUrl="",o.value.videoName="",o.value.duration="",m.value=[],f.value=!0},D=async()=>{await V.value.validate();try{const e=await de(B,{id:h.value,...o.value});U("submitCallback",e),d.success("操作成功")}catch(e){d.error(e.message)}};return S({onFormSubmit:()=>{D()}}),(e,t)=>{const a=p("el-icon"),c=p("el-form-item"),A=p("TigInput"),K=p("el-option"),W=p("el-select"),C=p("el-button"),H=p("el-form");return v(),_("div",ce,[i("div",me,[i("div",fe,[r(H,{ref_key:"formRef",ref:V,model:l(o),"label-width":"auto"},{default:n(()=>[r(c,{prop:"videoUrl",label:"本地视频",rules:[{required:!0,message:"请上传本地视频!"}]},{default:n(()=>[i("div",null,[l(o).videoUrl?(v(),_("div",ve,[i("div",{class:"iconfont icon-cha1 btn-remove",onClick:q}),i("video",{src:l(J)(l(o).videoUrl),controls:"",class:"preview-video"},null,8,_e)])):(v(),_("div",ge,[r(l(ee),{name:"file",ref_key:"uploadRef",ref:j,"file-list":m.value,"onUpdate:fileList":t[0]||(t[0]=s=>m.value=s),action:l(L).prefix+"/setting/galleryVideoInfo/uploadVideo",headers:l(L).headers(),showUploadList:f.value,onChange:O,"before-upload":$,progress:F,accept:".mp4,video/*"},{default:n(()=>[i("div",ye,[r(a,{size:"25"},{default:n(()=>[r(l(te))]),_:1})])]),_:1},8,["file-list","action","headers","showUploadList"])])),i("div",be," 视频大小不超过"+oe(l(g))+"MB，时长5秒-5分钟以内，建议时长15-190秒， 支持的视频文件类型 .mp4。 ",1)])]),_:1}),r(c,{prop:"videoName",label:"视频名称",rules:[{required:!0,validator:E}]},{default:n(()=>[r(A,{classType:"tig-form-input",modelValue:l(o).videoName,"onUpdate:modelValue":t[1]||(t[1]=s=>l(o).videoName=s),placeholder:"20个字以内",maxlength:20},null,8,["modelValue"])]),_:1},8,["rules"]),r(c,{prop:"galleryId",label:"所在视频相册",rules:[{required:!0,message:"视频相册不能为空!"}]},{default:n(()=>[i("div",xe,[r(W,{modelValue:l(o).galleryId,"onUpdate:modelValue":t[2]||(t[2]=s=>l(o).galleryId=s),placeholder:"请选择",style:{flex:"1"}},{default:n(()=>[(v(!0),_(le,null,ae(w.value,s=>(v(),re(K,{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),i("div",he,[r(l(pe),{params:{act:"add",parentId:0},path:"gallery/video/GalleryVideoEdit",title:"添加视频相册",width:"600px",onOkCallback:b},{default:n(()=>[r(C,{link:"",type:"primary"},{default:n(()=>t[5]||(t[5]=[I("添加相册",-1)])),_:1,__:[5]})]),_:1}),t[7]||(t[7]=i("p",{class:"ml10 mr10",style:{"margin-bottom":"3px"}},"|",-1)),r(C,{link:"",type:"primary",loading:y.value,onClick:t[3]||(t[3]=s=>b(0))},{default:n(()=>t[6]||(t[6]=[I("刷新",-1)])),_:1,__:[6]},8,["loading"])])])]),_:1}),r(c,{prop:"videoCover",label:"视频封面"},{default:n(()=>[r(l(P),{photo:l(o).videoCover,"onUpdate:photo":t[4]||(t[4]=s=>l(o).videoCover=s)},null,8,["photo"]),t[8]||(t[8]=i("div",{class:"extra"}," 建议尺寸：800*800px，支持.jpg，.gif，.png格式，大小不超过10MB。如果不添加封面， 系统会默认截取视频的第一个画面作为封面。 ",-1))]),_:1,__:[8]})]),_:1},8,["model"])])])])}}}),Te=se(ke,[["__scopeId","data-v-d781874d"]]);export{Te as default};

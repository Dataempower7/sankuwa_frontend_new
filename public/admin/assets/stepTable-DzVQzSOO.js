import{d as Q,x as F,ab as G,as as q,o as H,f as _,g as c,h as p,z as t,m as a,i as o,j as k,dw as J,Q as v,t as b,l as y,k as N,dA as W,av as X,dK as Y,_ as Z}from"./index-B52YIGC0.js";import $ from"./popover-7bp81uKc.js";const ee={class:"lyecs-form-table"},te={class:"flex mb10"},ae={class:"flex"},ne={class:"flex flex-align-center"},oe={class:"condition"},le={class:"flex flex-align-center"},se={style:{"min-width":"110px"}},ie={key:0},de={key:1,style:{"min-width":"110px"}},re={key:0},ue={key:1},pe={key:2},ce={key:2,style:{"min-width":"110px"}},me={key:1},fe={class:"flex flex-align-center"},_e={style:{width:"450px"}},ye={class:"rate-item"},ve={class:"inp"},he={class:"rate-item mt20"},ge={class:"inp"},be={key:0,class:"btn"},De={key:1,class:"btn"},ke=Q({__name:"stepTable",props:{distributionLevel:{type:Number,default:1},typeData:{type:Array,default:[]}},setup(x,{expose:T}){const A=F(),z=x,D=G(),l=q({typeData:z.typeData}),L=(u,e,d,r)=>{let s=l.typeData[r].condition;if(r>0){if(s.salesAmount.checked&&s.salesAmount.value<=0){d(new Error("请设置升级条件"));return}if(s.salesInviteUsers.checked&&s.salesInviteUsers.value<=0){d(new Error("请设置升级条件"));return}if(s.selfBuyAmount.checked&&s.selfBuyAmount.value<=0){d(new Error("请设置升级条件"));return}if(!s.salesAmount.checked&&!s.salesInviteUsers.checked&&!s.selfBuyAmount.checked){d(new Error("请设置升级条件"));return}d()}else d()},h=q({name:[{required:!0,message:"请输入等级名",trigger:"blur"},{validator:(u,e,d)=>{const r=l.typeData.findIndex(m=>m.name===e);l.typeData.some((m,g)=>m.name===e&&g!==r)?d(new Error("等级名不能重复")):d()},trigger:"blur"}],condition:[{required:!0,validator:(u,e,d)=>{const r=/\.(\d+)\./,m=(u==null?void 0:u.field.match(r))[1];L(u,e,d,m)},trigger:"blur"}],rate:[{required:!0,message:"请输入",trigger:"blur"}],downSalesmanRate:[{required:!0,message:"请输入",trigger:"blur"}]}),w=async()=>{await D.value.validate(),l.typeData.length<=10&&(l.typeData.push({id:l.typeData.length+1,name:"",rate:0,downSalesmanRate:0,condition:{selfBuyAmount:{checked:!1,disabled:!1,value:0,title:"自购金额",unit:A.get("amountUnit")??"元"},salesAmount:{checked:!1,disabled:!1,value:0,title:"推广金额",unit:A.get("amountUnit")??"元"},salesInviteUsers:{checked:!1,disabled:!1,value:0,title:"发展客户数",unit:"人"}}}),await D.value.validate())},j=u=>{l.typeData.splice(u,1)},K=u=>{let e=u.index;l.typeData[e].condition=u.conditionsOpts};return H(()=>{l.typeData.length<1&&w()}),T({formRef:D,form:l}),(u,e)=>{const d=_("el-button"),r=_("el-form-item"),s=_("el-table-column"),m=_("TigInput"),g=_("el-icon"),M=_("el-tooltip"),O=_("el-table"),P=_("el-form");return p(),c("div",ee,[t(P,{ref_key:"formRef",ref:D,rules:h,model:l,"label-width":"auto"},{default:a(()=>[t(r,{prop:"typeData"},{default:a(()=>[o("div",te,[o("div",ae,[t(d,{type:"primary",icon:k(J),link:"",onClick:w,disabled:l.typeData.length>=10},{default:a(()=>[v(b(l.typeData.length>=10?"最多添加10级":`添加等级(${l.typeData.length}/10)`),1)]),_:1},8,["icon","disabled"])])])]),_:1}),t(r,{prop:"typeData"},{default:a(()=>[t(O,{data:l.typeData,style:{width:"100%"},border:""},{default:a(()=>[t(s,{label:"序号",width:"80"},{default:a(({$index:n})=>[v(b(n+1),1)]),_:1}),t(s,{label:"等级名",prop:"name",width:"130"},{default:a(({row:n,$index:i})=>[t(r,{prop:"typeData."+i+".name",rules:h.name},{default:a(()=>[o("div",ne,[t(m,{modelValue:n.name,"onUpdate:modelValue":f=>n.name=f,width:"100px"},null,8,["modelValue","onUpdate:modelValue"])])]),_:2},1032,["prop","rules"])]),_:1}),t(s,{label:"升级条件",prop:"condition",width:"170"},{default:a(({row:n,$index:i})=>[o("div",oe,[t(r,{prop:"typeData."+i+".condition",rules:h.condition},{default:a(()=>{var f,V,U,B,I,C,R,S,E;return[o("div",le,[o("div",se,[i===0?(p(),c("div",ie,[...e[0]||(e[0]=[o("p",null,"初始等级， 无需设置",-1)])])):y("",!0),i>0&&n.condition?(p(),c("div",de,[(f=n.condition.selfBuyAmount)!=null&&f.checked&&((V=n.condition.selfBuyAmount)==null?void 0:V.value)>0?(p(),c("p",re," 自购金额满"+b((U=n.condition.selfBuyAmount)==null?void 0:U.value)+"元 ",1)):y("",!0),(B=n.condition.salesAmount)!=null&&B.checked&&((I=n.condition.salesAmount)==null?void 0:I.value)>0?(p(),c("p",ue," 推广金额满"+b((C=n.condition.salesAmount)==null?void 0:C.value)+"元 ",1)):y("",!0),(R=n.condition.salesInviteUsers)!=null&&R.checked&&((S=n.condition.salesInviteUsers)==null?void 0:S.value)>0?(p(),c("p",pe," 发展客户数满"+b((E=n.condition.salesInviteUsers)==null?void 0:E.value)+"人 ",1)):y("",!0)])):y("",!0),i>0&&!n.condition?(p(),c("div",ce,[...e[1]||(e[1]=[o("p",{class:"gray"},"未设置",-1)])])):y("",!0)]),t($,{index:i,conditionsData:n.condition,superiorData:i>1?l.typeData[i-1].condition:null,onSubmitCallback:K},{default:a(()=>[i>0?(p(),N(g,{key:0,size:"15",color:"#333"},{default:a(()=>[t(k(W))]),_:1})):(p(),c("span",me))]),_:2},1032,["index","conditionsData","superiorData"])])]}),_:2},1032,["prop","rules"])])]),_:1}),t(s,{prop:"rate",width:"300"},{header:a(()=>[o("div",fe,[e[7]||(e[7]=o("p",null,"佣金比例",-1)),t(M,{placement:"top-end",effect:"light"},{content:a(()=>[o("div",_e,[o("p",null,[t(g,{size:"12",color:"#155bd4"},{default:a(()=>[t(k(Y))]),_:1}),e[2]||(e[2]=v(" 修改后的比例只影响之后升级的佣金发放 ",-1))]),e[3]||(e[3]=o("p",null,"商品佣金比例：分销员推广商品后获得的商品佣金=商品佣金比例*商品实付金额（扣除运费、税费和附加费）。",-1)),e[4]||(e[4]=o("p",null," 下级分销员邀请奖励比例：下级分销员推广后，上级分销员获得邀请奖励=下级分销员邀请奖励比例*商品实付金额（扣除运费、税费和附加费）。 ",-1)),e[5]||(e[5]=o("p",null,"举例：B是A发展的分销员，B成功推广商品后，B可获得商品佣金，A可获得邀请奖励。",-1)),e[6]||(e[6]=o("p",null,"当分销员升至对应等级即会发放对应佣金，降级时不发放，频繁调整分销员等级会导致佣金多次发放。",-1))])]),default:a(()=>[t(g,{size:"14",color:"#969799"},{default:a(()=>[t(k(X))]),_:1})]),_:1})])]),default:a(({row:n,$index:i})=>[o("div",null,[t(r,{class:"rate",prop:"typeData."+i+".rate",rules:h.rate},{default:a(()=>[o("div",ye,[e[9]||(e[9]=o("div",{class:"tit"},"商品佣金",-1)),o("div",ve,[t(m,{type:"decimal",modelValue:n.rate,"onUpdate:modelValue":f=>n.rate=f,style:{width:"120px"},min:0},{append:a(()=>[...e[8]||(e[8]=[v("%",-1)])]),_:1},8,["modelValue","onUpdate:modelValue"])])])]),_:2},1032,["prop","rules"]),x.distributionLevel==2?(p(),N(r,{key:0,class:"down_salesman_rate",prop:"typeData."+i+".downSalesmanRate",rules:h.downSalesmanRate},{default:a(()=>[o("div",he,[e[11]||(e[11]=o("div",{class:"tit"},"下级分销员邀请奖励",-1)),o("div",ge,[t(m,{type:"decimal",modelValue:n.downSalesmanRate,"onUpdate:modelValue":f=>n.downSalesmanRate=f,style:{width:"120px"},min:0},{append:a(()=>[...e[10]||(e[10]=[v("%",-1)])]),_:1},8,["modelValue","onUpdate:modelValue"])])])]),_:2},1032,["prop","rules"])):y("",!0)])]),_:1}),t(s,{label:"操作",fixed:"right",width:"100",align:"center"},{default:a(({row:n,$index:i})=>[i>0&&l.typeData.length>1?(p(),c("div",be,[t(d,{type:"primary",link:"",onClick:f=>j(i)},{default:a(()=>[...e[12]||(e[12]=[v("删除",-1)])]),_:1},8,["onClick"])])):(p(),c("div",De,"-"))]),_:1})]),_:1},8,["data"])]),_:1})]),_:1},8,["rules","model"])])}}}),we=Z(ke,[["__scopeId","data-v-eb509c1d"]]);export{we as default};

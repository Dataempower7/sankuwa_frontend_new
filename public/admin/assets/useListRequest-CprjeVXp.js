import{x as p,r,as as w,c as C,P as i,j as z}from"./index-B52YIGC0.js";function B(o,g=[]){const f=p(),h=o.getPageSize?o.getPageSize():f.get("pageSize"),v=o.idKey||"id",c={page:1,size:h,...o.defaultParams},u=r([]),l=r(!1),d=r(0),n=r([]),a=w({...c}),y=C(()=>{const e=z(o.apiFunction);return typeof e=="function"?e:()=>Promise.reject("API function is invalid")}),S=()=>{if(g.length==0)Object.assign(a,c);else for(let e in c)g.includes(e)||(a[e]=c[e]);s()},s=async()=>{l.value=!0;try{a.keyword&&(a.keyword=a.keyword.trim(),console.log(a.keyword,"：没用？"));const e=await y.value(a);u.value=e.records,d.value=e.total}catch(e){i.error(e.message||"请求失败")}finally{l.value=!1}};return{listData:u,loading:l,total:d,selectedIds:n,filterParams:a,loadData:s,onSearchSubmit:()=>{a.page=1,s()},onSortChange:({prop:e,order:t})=>{a.sortField=e,a.sortOrder=t==="ascending"?"asc":t==="descending"?"desc":"",s()},onPageChange:(e,t)=>{a.page=e,a.size=t,s()},onSelectChange:e=>{console.log(e,9999),n.value=e.map(t=>t[v]),console.log(n.value)},onBatchAction:async(e,t,m)=>{if(n.value.length===0){i.warning("请至少选择一项");return}try{await t(e,{ids:n.value,...m}),i.success("操作成功"),s(),n.value=[]}catch(P){i.error(P.message||"操作失败")}},resetParams:S}}export{B as u};

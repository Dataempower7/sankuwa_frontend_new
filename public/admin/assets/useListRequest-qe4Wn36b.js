import{x as y,r as c,ah as P,c as p,i as w,K as r}from"./index-BLXOA87U.js";function K(s){const d=y(),f=s.getPageSize?s.getPageSize():d.get("pageSize"),h=s.idKey||"id",l={page:1,size:f,...s.defaultParams},g=c([]),i=c(!1),u=c(0),o=c([]),a=P({...l}),m=p(()=>{const e=w(s.apiFunction);return typeof e=="function"?e:()=>Promise.reject("API function is invalid")}),S=()=>{Object.assign(a,l),n()},n=async()=>{i.value=!0;try{a.keyword&&(a.keyword=a.keyword.trim(),console.log(a.keyword,"：没用？"));const e=await m.value(a);g.value=e.records,u.value=e.total}catch(e){r.error(e.message||"请求失败")}finally{i.value=!1}};return{listData:g,loading:i,total:u,selectedIds:o,filterParams:a,loadData:n,onSearchSubmit:()=>{a.page=1,n()},onSortChange:({prop:e,order:t})=>{a.sortField=e,a.sortOrder=t==="ascending"?"asc":t==="descending"?"desc":"",n()},onPageChange:(e,t)=>{a.page=e,a.size=t,n()},onSelectChange:e=>{o.value=e.map(t=>t[h])},onBatchAction:async(e,t)=>{if(o.value.length===0){r.warning("请至少选择一项");return}try{await t(e,{ids:o.value}),r.success("操作成功"),n(),o.value=[]}catch(v){r.error(v.message||"操作失败")}},resetParams:S}}export{K as u};

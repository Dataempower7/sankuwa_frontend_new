import{d as o,L as e,r as t,aM as a,aY as s,b6 as l,R as n,M as r,b7 as u,aE as i,aD as d,ae as c,b8 as p,aQ as m,b9 as g,C as f,F as h,c as v,b as y,i as I,w as _,e as w,I as P,ba as T,O as F,f as V,h as C,t as b,_ as x,l as S,m as R,a as $,G as k,H as j,az as B,V as E,k as N,bb as q}from"./index-BZxHr1FI.js";import{_ as z}from"./tig-layout.DTz8E-sj.js";import{a as G}from"./groupon.CM2aLW4Q.js";import{_ as U}from"./uni-transition.COpRW9Ft.js";const D=x(o({__name:"poster",props:{modelValue:{type:Boolean},productId:{},productInfo:{},grouponPromotionId:{},grouponPromotionRecordId:{},productPrice:{}},emits:["update:modelValue"],setup(o,{emit:x}){const{t:S}=e(),R=m(),$=o;t({endTime:"",grouponExplain:"",grouponImage:"",startTime:"",shopId:0,shopTitle:""});const k=t({grouponPromotionRecordId:0,productId:0,productName:"",joinType:0,joinStatus:0,minGroupNum:0,groupNum:0,shopId:0,shopTitle:"",grouponImage:"",minGrouponPrice:0,grouponPrice:0,productPrice:0,picThumb:"",joinNumCount:0,joinUsers:[],skuId:0,startTime:"",endTime:"",grouponPromotionId:0}),j=t(""),B=t(!1),E=t(0),N=t(900);a(async()=>{const{windowWidth:o}=s();E.value=o/375;const e=await G($.grouponPromotionRecordId);e&&(k.value=e),await q(),D()});const q=async()=>{try{const o=`${location.origin}/mobile/pages/product/groupBuying?grouponPromotionRecordId=${$.grouponPromotionRecordId}`,e=await l(o);j.value=e,n({title:S("正在生成海报，请稍后"),icon:"none",duration:1e3})}catch(o){console.error(o),n({title:o.message,icon:"none"})}},U=o=>{const e=new Date(o);return`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`},D=async()=>{r("userInfo"),u();try{const o=30,e=120,t=130,a=40,s=220,l=100,n=i(500),r=i(o),u=i(e),m=i(t),g=i(a),f=i(s),h=i(l),v=await d(c(k.value.grouponImage)),y=n-2*r,I=y,_=g+I+f,w=u+_+m;N.value=w;let P=p("myCanvas",R);P.clearRect(0,0,n,w),P.draw(),P.setFillStyle("red"),P.fillRect(0,0,n,w);const T=P.createLinearGradient(0,0,0,w);T.addColorStop(0,"#F2F2F6"),T.addColorStop(1,"#E6E6EE"),P.setFillStyle(T),P.fillRect(0,0,n,w),P.setFontSize(i(30)),P.setFillStyle("#333"),P.fillText(S("拼团"),n/2-i(30),u/2+i(16));const F=r,V=u,C=y,b=_,x=i(20),$=0,B=i(20);P.save(),P.shadowColor="rgba(0, 0, 0, 0.1)",P.shadowBlur=x,P.shadowOffsetX=$,P.shadowOffsetY=B;const E=i(30);P.beginPath(),P.moveTo(F+E,V),P.lineTo(F+C-E,V),P.quadraticCurveTo(F+C,V,F+C,V+E),P.lineTo(F+C,V+b-E),P.quadraticCurveTo(F+C,V+b,F+C-E,V+b),P.lineTo(F+E,V+b),P.quadraticCurveTo(F,V+b,F,V+b-E),P.lineTo(F,V+E),P.quadraticCurveTo(F,V,F+E,V),P.closePath(),P.fillStyle="#FFFFFF",P.fill(),P.restore();const q=V+g+I,z=F+i(20),G=q+f-h-i(50);M(k.value.productName,z,G,P);const D=q+f-i(30);P.setFontSize(i(18)),P.setFillStyle("#888"),P.fillText(U(k.value.startTime)+"~"+U(k.value.endTime),z,D),P.save();const O=F+C-h-i(20),X=q+f-h-i(50);P.setFontSize(i(16)),P.setFillStyle("#666"),P.fillText(S("长按识别查看"),O+i(4),D),P.restore(),P.draw(!0,async()=>{P.save(),((o,e,t,a,s,l)=>{const{width:n,height:r,path:u}=e,i=Math.min(s/n,l/r),d=n*i,c=r*i,p=t+(s-d)/2,m=a+(l-c)/2;o.drawImage(u,p,m,d,c)})(P,v,F,V+g,y,I),P.draw(!0,()=>{P.drawImage(j.value,O,X,h,h),P.draw(!0,()=>{L()})})})}catch(o){console.error(o)}},M=(o,e,t,a)=>{let s=[];for(let l=0,n=o.length;l<n/11;l++){let e=o.slice(11*l,11*(l+1));s.push(e)}s.forEach((o,s)=>{s>3||(t+=20,a.setFontSize(i(28)),a.setFillStyle("#333333"),a.fillText(o,e,t))})},O=t(""),L=()=>{g({fileType:"jpg",canvasId:"myCanvas",quality:1,success:function(o){O.value=o.tempFilePath,B.value=!0},fail:o=>{n({title:JSON.stringify(o),icon:"none",duration:3e3}),B.value=!1,console.log(o)}},R)},X=()=>{};return(o,e)=>{const t=T,a=V,s=I,l=f(h("tig-popup"),z);return y(),v(s,null,{default:_(()=>[w(t,{id:"myCanvas",class:"canvas-content","canvas-id":"myCanvas",style:P({height:N.value+"px"})},null,8,["style"]),w(l,{show:B.value,"onUpdate:show":e[1]||(e[1]=o=>B.value=o),"background-color":"transparent",position:"center","show-close":!1,onClose:e[2]||(e[2]=e=>o.$emit("update:modelValue",!1))},{default:_(()=>[w(s,{class:"poster-box",onTouchmove:e[0]||(e[0]=F(()=>{},["stop","prevent"])),onLongpress:F(X,["stop"]),style:P({height:N.value+"px"})},{default:_(()=>[w(a,{src:O.value,style:{height:"100%",width:"100%"},mode:"aspectFit"},null,8,["src"])]),_:1},8,["style"]),w(s,{class:"canvas-tip"},{default:_(()=>[C(b(o.$t("长按可保存海报")),1)]),_:1})]),_:1},8,["show"])]),_:1})}}}),[["__scopeId","data-v-27123b17"]]),M=x(o({__name:"guide",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(o,{emit:e}){const a=S(),s=e,l=t({justifyContent:"center",alignItems:"center",flexDirection:"column",width:"100vw",height:"auto"});return R(()=>a.menuButtonInfo),(e,t)=>{const a=V,n=I,r=f(h("uni-transition"),U);return o.modelValue?(y(),v(n,{key:0,class:"guide-box",onClick:t[0]||(t[0]=o=>s("update:modelValue",!1))},{default:_(()=>[w(r,{ref:"ani","custom-class":"transition","mode-class":["fade","slide-top"],styles:l.value,show:o.modelValue},{default:_(()=>[w(n,{class:"guide-content"},{default:_(()=>[w(n,{class:"guide-img-box"},{default:_(()=>[w(a,{class:"guide-img",src:k(j)("common/share_arrow.png")},null,8,["src"])]),_:1}),w(n,{class:"guide-text"},{default:_(()=>[C(b(e.$t("立即分享给好友吧")),1)]),_:1}),w(n,null,{default:_(()=>[C(b(e.$t("点击屏幕右上角将本页面分享给好友")),1)]),_:1})]),_:1})]),_:1},8,["styles","show"])]),_:1})):$("",!0)}}}),[["__scopeId","data-v-e2963b69"]]),O=x(o({__name:"grouponShare",props:{modelValue:{type:Boolean},productId:{},productInfo:{},productPrice:{},grouponPromotionId:{},grouponPromotionRecordId:{}},emits:["update:modelValue"],setup(o,{emit:a}){const{t:s}=e(),l=S();B();const r=o,u=a,i=t(r.productInfo);E(()=>r.productInfo,o=>{i.value=o});const d=R({get:()=>r.modelValue,set(o){u("update:modelValue",o)}}),c=t(!1),p=()=>{u("update:modelValue",!1),c.value=!0},m=()=>{u("update:modelValue",!1),g()},g=()=>{const o=`${location.origin}/mobile/pages/product/groupBuying?grouponPromotionRecordId=${r.grouponPromotionRecordId}`;q(o,()=>{n({title:s("复制成功"),icon:"none"})})},P=R(()=>"miniProgram"===l.XClientType||"wechat"===l.XClientType),T=t(!1),F=()=>{u("update:modelValue",!1),T.value=!0};return(o,e)=>{const t=I,a=N,s=f(h("tig-popup"),z);return y(),v(t,{class:"share"},{default:_(()=>[w(s,{show:d.value,"onUpdate:show":e[0]||(e[0]=o=>d.value=o),position:"bottom"},{default:_(()=>[w(t,{class:"share-title"},{default:_(()=>[C(b(o.$t("分享")),1)]),_:1}),w(t,{class:"share-content"},{default:_(()=>[P.value?(y(),v(t,{key:0,class:"share-item",onClick:F},{default:_(()=>[w(a,{class:"iconfont-h5 icon-haoyou"}),w(a,{class:"share-item-text"},{default:_(()=>[C(b(o.$t("分享给好友")),1)]),_:1})]),_:1})):$("",!0),w(t,{class:"share-item",onClick:m},{default:_(()=>[w(a,{class:"iconfont-h5 icon-link"}),w(a,{class:"share-item-text"},{default:_(()=>[C(b(o.$t("复制链接")),1)]),_:1})]),_:1}),w(t,{class:"share-item",onClick:p},{default:_(()=>[w(a,{class:"iconfont-h5 icon-tupian"}),w(a,{class:"share-item-text"},{default:_(()=>[C(b(o.$t("生成商品海报")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["show"]),c.value?(y(),v(D,{key:0,modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=o=>c.value=o),"product-id":o.productId,"product-info":i.value,"product-price":o.productPrice,grouponPromotionId:o.grouponPromotionId,grouponPromotionRecordId:o.grouponPromotionRecordId},null,8,["modelValue","product-id","product-info","product-price","grouponPromotionId","grouponPromotionRecordId"])):$("",!0),w(M,{modelValue:T.value,"onUpdate:modelValue":e[2]||(e[2]=o=>T.value=o)},null,8,["modelValue"])]),_:1})}}}),[["__scopeId","data-v-c9a6ef9c"]]);export{O as g};

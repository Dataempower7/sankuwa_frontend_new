import{d as e,L as a,r as l,V as i,C as t,bR as u,F as s,c as r,b as p,i as o,w as m,a as c,aB as n,bS as d,bT as f,M as h,ad as y,R as b,ae as g,bU as v,ai as V}from"./index-BZxHr1FI.js";const U=e({__name:"index",props:{limit:{type:Number,default:1},apiUrl:{type:String,default:"user/user/uploadImg"},modelValue:{type:[Array,Object],default:()=>[]},isValueArray:{type:Boolean,default:!1},isCustom:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:U}){const{t:x}=a(),A=e,N=U,T=async()=>{console.log("check")},j=l([]);i(()=>A.modelValue,e=>{if(0===e.length&&(j.value=[]),!(j.value.length>0)&&e){if("object"==typeof e){if(Array.isArray(e)&&0===e.length)return;if(0===Object.values(e).length||!Object.values(e)[0])return}V(()=>{uni.$u.test.object(e)?j.value.push({...e,url:g(e.picUrl)}):(j.value=e.map(e=>({...e,url:g(e.picUrl)})),k.value=e)})}},{immediate:!0,deep:!0});const k=l([]),C=async e=>{1===e.file.length||1===A.limit?O(e.file[0]):e.file.forEach(e=>{O(e)})},_=e=>{j.value.splice(e.index,1),A.limit>1||A.isValueArray?(k.value.splice(e.index,1),N("update:modelValue",k.value)):N("update:modelValue",{picName:"",picThumb:"",picUrl:""})},O=e=>{let a;console.log(e,"filePath"),d({url:v+"/api/"+A.apiUrl,filePath:e.url,name:"file",header:{Authorization:h("token"),Secret:f()},success:e=>{y();const{data:l}=JSON.parse(e.data);a=l.picThumb,j.value.push({url:g(a)}),A.limit>1||A.isValueArray?(k.value.push({picName:l.picName,picThumb:l.picThumb,picUrl:l.picUrl}),N("update:modelValue",k.value)):N("update:modelValue",{picName:l.picName,picThumb:l.picThumb,picUrl:l.picUrl}),b({title:x("图片上传成功")})},fail:e=>{y(),b({title:x("图片上传失败"),icon:"none"})}})};return(a,l)=>{const i=t(s("up-upload"),u),d=o;return p(),r(d,{onClick:T},{default:m(()=>[e.isCustom?c("",!0):(p(),r(i,{key:0,"preview-full-image":!0,"file-list":j.value,name:"1",multiple:"","max-count":e.limit,"size-type":["original","compressed"],onAfterRead:C,onDelete:_},null,8,["file-list","max-count"])),e.isCustom?(p(),r(i,{key:1,"preview-full-image":!0,"file-list":j.value,name:"1",multiple:"","max-count":e.limit,"size-type":["original","compressed"],onAfterRead:C,onDelete:_},{trigger:m(()=>[n(a.$slots,"trigger")]),_:3},8,["file-list","max-count"])):c("",!0)]),_:3})}}});export{U as _};

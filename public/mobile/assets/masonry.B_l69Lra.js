import{d as e,m as t,C as a,F as s,aa as i,c as o,b as l,i as c,w as n,e as r,a as u,h as d,t as m,k as p,J as f,K as y,P as h,f as g,G as k,H as v,O as _,a1 as x,_ as I,r as b,V as S,aB as C,j as $,ai as j,aP as L,aQ as w,bt as z}from"./index-BZxHr1FI.js";import{s as Y}from"./specification.C71VpZ8P.js";import{T as M}from"./tig-lazy-image.BPOhG_XX.js";import{_ as O}from"./format-price.BrXrBVy6.js";import{a as H}from"./activityCard.DE1HAQr9.js";import{d as V}from"./dayjs.min.BETqfnlQ.js";const D=I(e({__name:"product-item",props:{item:{},promotionList:{},type:{default:""}},emits:["click-item","click-buy","click-shop"],setup(e,{emit:I}){const b=e,S=I,C=t(()=>1==b.item.isSeckill?0==b.item.seckillStock:0==b.item.productStock),$=t(()=>{const e=b.promotionList[b.item.productId];return(null==e?void 0:e.activityInfo)||[]}),j=t(()=>Object.keys(b.promotionList).length>0&&$.value.length>0),L=t(()=>{const e=$.value.find(e=>7===e.type);return!!e&&!(e.startTime>V().format("YYYY-MM-DD HH:mm:ss")||e.endTime<V().format("YYYY-MM-DD HH:mm:ss"))});return(e,t)=>{const I=a(s("tig-lazy-image"),M),b=c,w=p,z=a(s("format-price"),O),Y=g,V=a(s("up-loading-icon"),i);return l(),o(b,{class:"item-li",onClick:t[2]||(t[2]=t=>{return a=e.item,void S("click-item",a);var a})},{default:n(()=>[r(b,{class:"photo"},{default:n(()=>[r(I,{src:e.item.picUrl,mode:"widthFix"},null,8,["src"]),C.value?(l(),o(b,{key:0,class:"product-status-box"},{default:n(()=>[r(b,{class:"outsale"},{default:n(()=>[d(m(e.$t("已售罄")),1)]),_:1})]),_:1})):u("",!0)]),_:1}),r(b,{class:"info"},{default:n(()=>[r(b,{class:"detail"},{default:n(()=>[L.value?(l(),o(b,{key:0,class:"groupon-tag"},{default:n(()=>[r(w,{class:"groupon-tag-text"},{default:n(()=>[d("拼")]),_:1})]),_:1})):u("",!0),d(" "+m(e.item.productName),1)]),_:1}),j.value?(l(),o(b,{key:0,class:"flex activity-box"},{default:n(()=>[(l(!0),f(y,null,h($.value,e=>(l(),o(H,{key:e.promotionId,"activity-info":e},null,8,["activity-info"]))),128))]),_:1})):u("",!0),r(b,{class:"action"},{default:n(()=>[r(b,{class:"pricenum"},{default:n(()=>["exchange"===e.type?(l(),o(b,{key:0,class:"exchange-box"},{default:n(()=>[r(z,{"font-style":{fontSize:"32rpx"},"currency-style":{fontSize:"22rpx"},"decimals-style":{fontSize:"25rpx"},"price-data":e.item.discountsPrice},null,8,["price-data"]),r(w,{class:"exchange-icon"},{default:n(()=>[d("+")]),_:1}),r(Y,{class:"exchange-img",src:k(v)("exchange/exchange.png")},null,8,["src"]),r(w,{class:"exchange-text"},{default:n(()=>[d(m(e.item.exchangeIntegral),1)]),_:1})]),_:1})):(l(),o(z,{key:1,"font-style":{fontSize:"32rpx"},"currency-style":{fontSize:"22rpx"},"decimals-style":{fontSize:"25rpx"},"price-data":e.item.price},null,8,["price-data"]))]),_:1}),r(b,{class:"buy_btn",onClick:t[0]||(t[0]=_(t=>{return a=e.item,void S("click-buy",a);var a},["stop"]))},{default:n(()=>[e.item.isCheck?(l(),o(V,{key:0,size:"22",mode:"circle"})):"exchange"!==e.type?(l(),o(w,{key:1,class:"iconfont-h5 icon-gouwuche3 buy_btn_icon"})):u("",!0)]),_:1})]),_:1}),e.item.shop&&k(x)()?(l(),o(b,{key:1,class:"shop",onClick:t[1]||(t[1]=_(t=>{return a=e.item.shop.shopId,void S("click-shop",a);var a},["stop"]))},{default:n(()=>[r(b,{class:"shop-name"},{default:n(()=>[d(m(e.item.shop.shopTitle),1)]),_:1}),r(b,{class:"shop-btn"},{default:n(()=>[d(m(e.$t("进店"))+" ",1),r(w,{class:"iconfont-h5 icon-youjiantou"})]),_:1})]),_:1})):u("",!0)]),_:1})]),_:1})}}}),[["__scopeId","data-v-a4a61833"]]),P=I(e({__name:"masonry",props:{commodityList:{type:Array,default:()=>[]},promotionList:{type:Object,default:()=>({})},type:{type:String,default:""}},emits:["callback"],setup(e,{emit:a}){const s=e,i=a,u=()=>{i("callback")},d=w(),m=t(()=>{let e=[];return s.commodityList&&s.commodityList.length>0&&(e=g(s.commodityList)),e}),p=b([[],[]]),g=e=>JSON.parse(JSON.stringify(e));S(()=>m.value,async(e,t)=>{if(!e||0===e.length)return;const a=(null==t?void 0:t.length)||0,s=e.slice(a);if(0===s.length)return;const i=new Array(p.value.length).fill(0);0===a?p.value=[[],[]]:await j(async()=>{for(let t=0;t<p.value.length;t++)try{const e=await L(`#column-${t}`,d);i[t]=(null==e?void 0:e.height)||0}catch(e){console.error(`获取列 ${t} 高度失败:`,e),i[t]=0}});for(let o of s){const e=i.indexOf(Math.min(...i));p.value[e].push(o),await z(92),await j(async()=>{try{const t=await L(`#column-${e}`,d);t&&t.height&&(i[e]=t.height)}catch(t){console.error(t)}})}},{immediate:!0});const k=e=>{let t,a,i;if(t=s.promotionList[e.productId],t&&t.activityInfo&&t.activityInfo.length>0&&t.activityInfo[0].skuIds&&(a=t.activityInfo[0].skuIds[0]),"exchange"===s.type)i=`id=${e.id}&type=exchange`;else i=`id=${e.productId}`;i=a?`${i}&skuId=${a}`:i,$({url:"/pages/product/index?"+i})},v=e=>{$({url:`/pages/shop/index?shopId=${e}`})},_=b(0),x=b(),I=b({}),M=e=>{if(!e.isCheck){if("exchange"===s.type)_.value=e.id;else _.value=e.productId;e.isCheck=!0,I.value=e}},O=()=>{x.value.handleShowPopup(),I.value.isCheck=!1},H=()=>{_.value=0};return(t,a)=>{const s=c;return l(),f(y,null,[r(s,{class:"masonry"},{default:n(()=>[(l(!0),f(y,null,h(p.value,(a,i)=>(l(),o(s,{key:i,id:`column-${i}`,class:"masonry-item-column"},{default:n(()=>[(l(!0),f(y,null,h(a,a=>C(t.$slots,"product",{key:a.id,item:a},()=>[(l(),o(D,{key:a.id||a.productId,item:a,"promotion-list":e.promotionList,type:e.type,onClickItem:k,onClickBuy:M,onClickShop:v},null,8,["item","promotion-list","type"]))],!0)),128))]),_:2},1032,["id"]))),128))]),_:3}),r(Y,{ref_key:"specificationRef",ref:x,modelValue:_.value,"onUpdate:modelValue":a[0]||(a[0]=e=>_.value=e),type:e.type,onAddCardSucceed:u,onLoadEnd:O,onClose:H},null,8,["modelValue","type"])],64)}}}),[["__scopeId","data-v-14f26c77"]]);export{P as m};

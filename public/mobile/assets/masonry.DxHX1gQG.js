import{d as e,bu as a,r as t,U as s,aI as l,aX as o,aM as c,aQ as i,c as n,o as u,i as d,w as r,g as p,a as y,b as f,X as m,F as h,G as k,ac as g,_ as v,B as _,E as x,a8 as b,I,J as S,O as C,aF as z,f as L,t as $,h as j,N as w,$ as O,n as T,ah as N}from"./index-DDAlCzEE.js";import{_ as A}from"./format-price.9n-LYbxy.js";import{s as E}from"./specification.C_n32lme.js";import{a as F}from"./activityCard.A8E8ZyQf.js";const V=v(e({__name:"tig-lazy-image",props:{src:{type:String,default:"",required:!1},mode:{type:String,default:""}},emits:["error","load"],setup(e,{emit:v}){const _=e,x=a(),b=t(!1),I=t(!0),S=t(!1),C=v,z=t("");s(()=>_.src,e=>{e?(b.value=!1,I.value=!0,z.value=g(e)):(b.value=!0,I.value=!1,S.value=!0)},{immediate:!0});const L=e=>{I.value=!1,S.value=!0,b.value=!1,C("load",e)},$=e=>{b.value=!0,I.value=!1,S.value=!0,C("error",e)},j=c(),w=t(!1);let O;const T=()=>{O&&(O.disconnect(),O=null)};return l(()=>{O=o(j),O.relativeToViewport({top:0,bottom:10}).observe(`.base-image-box${x}`,e=>{w.value=e.intersectionRatio>0,e.intersectionRatio>0&&T()})}),i(()=>{T()}),(a,t)=>{const s=f,l=d;return u(),n(l,{class:"tig-lazy-image"},{default:r(()=>[p(l,{class:m("base-image-box base-image-box"+h(x))},{default:r(()=>[!b.value&&w.value?(u(),n(s,{key:0,class:m(["base-image",{"loading-end":!I.value}]),src:z.value,mode:e.mode,onError:$,onLoad:L},null,8,["class","src","mode"])):y("",!0),!I.value&&b.value?(u(),n(s,{key:1,class:"base-image empty",src:h(k)("common/empty-img-bg3.png"),mode:e.mode},null,8,["src","mode"])):y("",!0),S.value||b.value?y("",!0):(u(),n(l,{key:2,class:"base-skeleton shan"},{default:r(()=>[p(l,{class:"block"})]),_:1}))]),_:1},8,["class"])]),_:1})}}}),[["__scopeId","data-v-6b2953d8"]]),J=v(e({__name:"masonry",props:{commodityList:{type:Array,default:""},promotionList:{type:Object,default:{}},type:{type:String,default:""}},emits:["callback"],setup(e,{emit:a}){const l=e,o=a,c=()=>{o("callback")},i=t([]),m=t([]),g=t([]),v=async()=>{if(!i.value.length)return;let e=i.value[0];if(!e)return;let a=m.value.length,t=g.value.length;a<t?m.value.push(e):a>t?g.value.push(e):m.value.push(e),i.value.splice(0,1),i.value.length&&setTimeout(()=>{v()},50)};s(()=>l.commodityList,(e,a)=>{console.log("watch commodityList",e,a);let t=Array.isArray(a)&&a.length>0?a.length:0;var s;e&&(i.value=[...i.value,...(s=e.slice(t),JSON.parse(JSON.stringify(s)))],i.value.forEach(e=>{e.isCheck=!1}),N(()=>{v()}))},{immediate:!0});const J=e=>{let a,t,s;if(a=l.promotionList[e.productId],a&&a.activityInfo&&a.activityInfo.length>0&&a.activityInfo[0].skuIds&&(t=a.activityInfo[0].skuIds[0]),"exchange"===l.type)s=`id=${e.id}&type=exchange`;else s=`id=${e.productId}`;s=t?`${s}&skuId=${t}`:s,T({url:"/pages/product/index?"+s})},P=e=>{T({url:`/pages/shop/index?shopId=${e}`})},R=t(0),G=t(),U=t({}),X=e=>{if(!e.isCheck){if("exchange"===l.type)R.value=e.id;else R.value=e.productId;e.isCheck=!0,U.value=e}},q=()=>{G.value.handleShowPopup(),U.value.isCheck=!1},B=()=>{R.value=0};return(a,t)=>{const s=_(x("tig-lazy-image"),V),l=d,o=_(x("format-price"),A),i=j,v=f,T=_(x("up-loading-icon"),b);return u(),I(S,null,[p(l,{class:"masonry"},{default:r(()=>[p(l,{id:"left-item",class:"masonry-item"},{default:r(()=>[(u(!0),I(S,null,C(m.value,t=>z(a.$slots,"left",{key:t.id,item:t},()=>[p(l,{class:"item-li",onClick:e=>J(t)},{default:r(()=>[p(l,{class:"photo"},{default:r(()=>[p(s,{src:t.picThumb,mode:"widthFix"},null,8,["src"]),p(l,{class:"product-status-box"},{default:r(()=>[1==t.isSeckill?(u(),I(S,{key:0},[0==t.seckillStock?(u(),n(l,{key:0,class:"outsale"},{default:r(()=>[L($(a.$t("已售罄")),1)]),_:1})):y("",!0)],64)):(u(),I(S,{key:1},[t.productSku&&0===t.productSku.length&&0==t.productStock?(u(),n(l,{key:0,class:"outsale"},{default:r(()=>[L($(a.$t("已售罄")),1)]),_:1})):y("",!0)],64))]),_:2},1024)]),_:2},1024),p(l,{class:"info"},{default:r(()=>[p(l,{class:"detail"},{default:r(()=>[L($(t.productName),1)]),_:2},1024),Object.keys(e.promotionList).length>0?(u(),n(l,{key:0,class:"flex activity-box"},{default:r(()=>[e.promotionList[t.productId]&&e.promotionList[t.productId].activityInfo?(u(!0),I(S,{key:0},C(e.promotionList[t.productId].activityInfo,e=>(u(),n(F,{key:e.promotionId,"activity-info":e},null,8,["activity-info"]))),128)):y("",!0)]),_:2},1024)):y("",!0),p(l,{class:"action"},{default:r(()=>[p(l,{class:"pricenum"},{default:r(()=>["exchange"===e.type?(u(),n(l,{key:0,class:"exchange-box"},{default:r(()=>[p(o,{"font-style":{fontSize:"32rpx"},"currency-style":{fontSize:"22rpx"},"decimals-style":{fontSize:"25rpx"},"price-data":t.discountsPrice},null,8,["price-data"]),p(i,{class:"exchange-icon"},{default:r(()=>[L("+")]),_:1}),p(v,{class:"exchange-img",src:h(k)("exchange/exchange.png")},null,8,["src"]),p(i,{class:"exchange-text"},{default:r(()=>[L($(t.exchangeIntegral),1)]),_:2},1024)]),_:2},1024)):(u(),n(o,{key:1,"font-style":{fontSize:"32rpx"},"currency-style":{fontSize:"22rpx"},"decimals-style":{fontSize:"25rpx"},"price-data":t.price},null,8,["price-data"]))]),_:2},1024),p(l,{class:"buy_btn",onClick:w(e=>X(t),["stop"])},{default:r(()=>[t.isCheck?(u(),n(T,{key:0,size:"22",mode:"circle"})):(u(),I(S,{key:1},["exchange"===e.type?(u(),I(S,{key:0},[],64)):(u(),n(i,{key:1,class:"iconfont-h5 icon-gouwuche3 buy_btn_icon"}))],64))]),_:2},1032,["onClick"])]),_:2},1024),t.shop&&h(O)()?(u(),n(l,{key:1,class:"shop",onClick:w(e=>P(t.shop.shopId),["stop"])},{default:r(()=>[p(l,{class:"shop-name"},{default:r(()=>[L($(t.shop.shopTitle),1)]),_:2},1024),p(l,{class:"shop-btn"},{default:r(()=>[L($(a.$t("进店"))+" ",1),p(i,{class:"iconfont-h5 icon-youjiantou"})]),_:1})]),_:2},1032,["onClick"])):y("",!0)]),_:2},1024)]),_:2},1032,["onClick"])],!0)),128))]),_:3}),p(l,{id:"right-item",class:"masonry-item"},{default:r(()=>[(u(!0),I(S,null,C(g.value,t=>z(a.$slots,"right",{key:t.id,item:t},()=>[p(l,{class:"item-li",onClick:e=>J(t)},{default:r(()=>[p(l,{class:"photo"},{default:r(()=>[p(s,{src:t.picThumb,mode:"widthFix"},null,8,["src"]),p(l,{class:"product-status-box"},{default:r(()=>[t.productSku&&0===t.productSku.length&&0==t.productStock?(u(),n(l,{key:0,class:"outsale"},{default:r(()=>[L($(a.$t("已售罄")),1)]),_:1})):y("",!0)]),_:2},1024)]),_:2},1024),p(l,{class:"info"},{default:r(()=>[p(l,{class:"detail"},{default:r(()=>[L($(t.productName),1)]),_:2},1024),Object.keys(e.promotionList).length>0?(u(),n(l,{key:0,class:"flex activity-box"},{default:r(()=>[e.promotionList[t.productId]&&e.promotionList[t.productId].activityInfo?(u(!0),I(S,{key:0},C(e.promotionList[t.productId].activityInfo,e=>(u(),n(F,{key:e.promotionId,"activity-info":e},null,8,["activity-info"]))),128)):y("",!0)]),_:2},1024)):y("",!0),p(l,{class:"action"},{default:r(()=>[p(l,{class:"pricenum"},{default:r(()=>["exchange"===e.type?(u(),n(l,{key:0,class:"exchange-box"},{default:r(()=>[p(o,{"font-style":{fontSize:"32rpx"},"currency-style":{fontSize:"22rpx"},"decimals-style":{fontSize:"25rpx"},"price-data":t.discountsPrice},null,8,["price-data"]),p(i,{class:"exchange-icon"},{default:r(()=>[L("+")]),_:1}),p(v,{class:"exchange-img",src:h(k)("exchange/exchange.png")},null,8,["src"]),p(i,{class:"exchange-text"},{default:r(()=>[L($(t.exchangeIntegral),1)]),_:2},1024)]),_:2},1024)):(u(),n(o,{key:1,"font-style":{fontSize:"32rpx"},"currency-style":{fontSize:"22rpx"},"decimals-style":{fontSize:"25rpx"},"price-data":t.price},null,8,["price-data"]))]),_:2},1024),p(l,{class:"buy_btn",onClick:w(e=>X(t),["stop"])},{default:r(()=>[t.isCheck?(u(),n(T,{key:0,size:"22",mode:"circle"})):(u(),I(S,{key:1},["exchange"===e.type?(u(),I(S,{key:0},[],64)):(u(),n(i,{key:1,class:"iconfont-h5 icon-gouwuche3 buy_btn_icon"}))],64))]),_:2},1032,["onClick"])]),_:2},1024),t.shop&&h(O)()?(u(),n(l,{key:1,class:"shop",onClick:w(e=>P(t.shop.shopId),["stop"])},{default:r(()=>[p(l,{class:"shop-name"},{default:r(()=>[L($(t.shop.shopTitle),1)]),_:2},1024),p(l,{class:"shop-btn"},{default:r(()=>[L($(a.$t("进店"))+" ",1),p(i,{class:"iconfont-h5 icon-youjiantou"})]),_:1})]),_:2},1032,["onClick"])):y("",!0)]),_:2},1024)]),_:2},1032,["onClick"])],!0)),128))]),_:3})]),_:3}),p(E,{ref_key:"specificationRef",ref:G,modelValue:R.value,"onUpdate:modelValue":t[0]||(t[0]=e=>R.value=e),type:e.type,onAddCardSucceed:c,onLoadEnd:q,onClose:B},null,8,["modelValue","type"])],64)}}}),[["__scopeId","data-v-4c9267d6"]]);export{V as _,J as m};

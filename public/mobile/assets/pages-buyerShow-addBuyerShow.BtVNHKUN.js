import{d as e,c as a,b as t,i as l,w as o,a as s,aB as i,h as u,t as n,_ as r,a7 as d,a5 as c,m as p,C as m,cB as f,F as g,e as v,J as h,P as _,Z as y,K as b,j as k,L as w,r as L,aa as C,g as x,O as S,I as U,R as j,bS as A,bT as I,ad as V,ae as B,M as F,bU as P,b4 as T,l as M,V as O,a8 as $,n as z,ai as D,aP as E,aY as N,cC as R,aQ as H,bX as K,bi as Y,bY as G,G as J,a2 as W}from"./index-BZxHr1FI.js";import{_ as q}from"./tig-loadingpage.vue_vue_type_script_setup_true_lang.CErZUb08.js";import{_ as Q}from"./loading-box.D3Y7A2lC.js";import{d as X,T as Z,a as ee}from"./tig-layout.DTz8E-sj.js";import{T as ae}from"./tig-fixed-placeholder.BDsbIjoZ.js";import{T as te}from"./tig-lazy-image.BPOhG_XX.js";import{_ as le}from"./tig-image.CzXKqALH.js";import{_ as oe}from"./uni-icons.DMMn2oBg.js";import{g as se,d as ie,j as ue}from"./buyerShowCloseTip.CrtXzvBV.js";import{u as ne}from"./useList.cF42RyDa.js";import"./uni-transition.COpRW9Ft.js";import"./product.BH5dMQls.js";const re=r(e({__name:"SoldOut",props:{showOutsale:{type:Boolean,default:!1}},setup:e=>(r,d)=>{const c=l;return t(),a(c,{class:"sold-out-box"},{default:o(()=>[e.showOutsale?(t(),a(c,{key:0,class:"outsale"},{default:o(()=>[u(n(r.$t("已售罄")),1)]),_:1})):s("",!0),i(r.$slots,"default",{},void 0,!0)]),_:3})}}),[["__scopeId","data-v-d005e6cd"]]),de=r(e({__name:"ProductList",props:d({productListHeight:{type:Number,default:0}},{products:{},productsModifiers:{},total:{default:0},totalModifiers:{}}),emits:d(["scrolltolower"],["update:products","update:total"]),setup(e,{emit:i}){const r=c(e,"products"),d=c(e,"total"),w=i,L=()=>{w("scrolltolower")},C=p(()=>r.value?r.value.filter(e=>e.isChecked).length:0);return(i,c)=>{const p=l,w=m(g("up-list"),f);return d.value?(t(),a(p,{key:0,class:"productList"},{default:o(()=>[v(p,{class:"total"},{default:o(()=>[u(n(C.value)+"/"+n(d.value),1)]),_:1}),v(w,{height:e.productListHeight,onScrolltolower:L},{default:o(()=>[(t(!0),h(b,null,_(r.value,(e,l)=>(t(),a(p,{key:l,class:y([{active:e.isChecked},"productInfo"])},{default:o(()=>[v(re,{"show-outsale":0===e.storeProductStock,onClick:a=>(e=>{k({url:"/pages/product/index",param:{id:e.productId}})})(e)},{default:o(()=>[v(te,{src:e.picUrl,class:"image",mode:"aspectFit"},null,8,["src"])]),_:2},1032,["show-outsale","onClick"]),v(p,{class:"content"},{default:o(()=>[v(p,{class:"title"},{default:o(()=>[u(n(e.productName),1)]),_:2},1024),v(p,{class:"price"},{default:o(()=>[u("￥ "+n(e.productPrice),1)]),_:2},1024)]),_:2},1024),v(X,{checked:e.isChecked,"onUpdate:checked":a=>e.isChecked=a,size:"20",class:"check-item",disabled:e.isDisabled},null,8,["checked","onUpdate:checked","disabled"])]),_:2},1032,["class"]))),128))]),_:1},8,["height"])]),_:1})):s("",!0)}}}),[["__scopeId","data-v-4aa0cb16"]]),ce=r(e({__name:"UploadMedia",props:d({multiple:{type:Boolean,default:!0},maxCount:{default:9},cols:{default:3},imgApiUrl:{default:"user/user/uploadImg"},videoApiUrl:{default:"user/user/uploadVideo"}},{mediaList:{default:[]},mediaListModifiers:{}}),emits:["update:mediaList"],setup(e){const{t:i}=w(),r=e,d=c(e,"mediaList"),p=L(null),f=L({}),y=async()=>{k()},k=()=>{const e=document.createElement("input");e.type="file",e.accept="image/*,video/*",e.multiple=Boolean(r.multiple),e.style.display="none",e.onchange=a=>{const t=a.target;if(t.files&&t.files.length>0){const e=Array.from(t.files);M(e)}e.parentNode&&e.parentNode.removeChild(e)},document.body.appendChild(e),e.click()},M=e=>{const a=r.maxCount-d.value.length;if(a<=0)return void j({title:`限制上传${r.maxCount}个数`,icon:"none"});e.slice(0,a).forEach(e=>{const a=O(e.type);if("unknown"===a)return console.warn("不支持的文件类型:",e.type),void j({title:"不支持的文件类型",icon:"none"});const t=URL.createObjectURL(e);console.log(t,8888),$(t,a,e)})},O=e=>e.startsWith("image/")?"image":e.startsWith("video/")?"video":"unknown",$=(e,a,t)=>{"image"!==a||(null==t?void 0:t.type.match(/\/(png|jpe?g|gif|webp|tiff)$/i))?A({url:P+"/api/"+("image"===a?r.imgApiUrl:r.videoApiUrl),filePath:e,name:"file",header:{Authorization:"Bearer "+F("token"),Secret:I()},formData:{file:t},success:e=>{V();const{data:t,message:l}=JSON.parse(e.data);if(!t&&l)return d.value.pop(),void j({title:l,icon:"none"});d.value.push({...t,url:"image"===a?B(t.picThumb):t.videoUrl,type:a})},fail:e=>{j({title:e.errMsg||"上传失败",icon:"none"}),d.value.pop(),V()}}):j({title:"不支持上传此文件格式",icon:"none"})},z=e=>{e.detail.fullScreen||(p.value=null)},D=e=>{f.value[e]||(f.value[e]=T(`video-${e}`)),p.value=e,f.value[e].requestFullScreen(),f.value[e].play()};return(e,i)=>{const c=m(g("tig-image"),le),p=x,f=m(g("up-loading-icon"),C),k=l,w=m(g("uni-icons"),oe);return t(),a(k,{class:"upload-media"},{default:o(()=>[v(k,{class:"media-preview",style:U({"grid-template-columns":`repeat(${r.cols}, 1fr)`})},{default:o(()=>[(t(!0),h(b,null,_(d.value,(e,l)=>(t(),a(k,{key:l,class:"media-item"},{default:o(()=>["image"===e.type?(t(),a(c,{key:0,preview:"",src:e.url,class:"media-preview-image"},null,8,["src"])):"video"===e.type?(t(),a(p,{key:1,id:"video-"+l,src:e.url,controls:!0,class:"media-preview-video",onClick:S(e=>D(l),["stop"]),onPlay:e=>D(l),onFullscreenchange:z},null,8,["id","src","onClick","onPlay"])):s("",!0),e.progress?(t(),a(k,{key:2,class:"progress"},{default:o(()=>[v(f),v(k,{class:"progressText"},{default:o(()=>[u("上传中...")]),_:1})]),_:1})):s("",!0),v(w,{class:"delete-btn",type:"clear",size:"25",color:"#cccccc",onClick:e=>(e=>{d.value.splice(e,1)})(l)},null,8,["onClick"])]),_:2},1024))),128)),d.value.length<r.maxCount?(t(),a(k,{key:0,class:"fileBox",onClick:y},{default:o(()=>[v(k,{class:"iconfont-h5 icon-8tupian-1 icon"}),v(k,{class:"tip"},{default:o(()=>[u("上传图片/视频最多上传"+n(r.maxCount)+"张",1)]),_:1})]),_:1})):s("",!0)]),_:1},8,["style"])]),_:1})}}}),[["__scopeId","data-v-384d0678"]]),pe=r(e({__name:"addBuyerShow",setup(e){const s=M(),i=L(1);O(()=>s,e=>{e.initLoading&&(i.value=e.buyerShowEnabled)},{deep:!0,immediate:!0});const n={page:1,size:10},{data:r,isLoading:d,isLoadMore:c,total:p,reachBottom:f}=ne(se,{params:n,path:{dataKey:"records"},immediate:!0,needReachBottom:!1}),h=$(),_=[],y=L({content:"",fileList:[],rangeData:[]}),b=H(),w=L("");z(()=>{D(async()=>{const e=(await E(".formItem",b,!0)).reduce((e,a)=>e+a.height,0),a=N().screenHeight;w.value=R(a)-R(e)-s.navHeight-260+"rpx",console.log(w.value)})});const C=()=>{var e,a;if(y.value.rangeData=r.value.filter(e=>e.isChecked).map(e=>e.productId),!y.value.fileList.length)return void j({title:"请上传图片/视频",icon:"none"});if(!y.value.rangeData.length)return void j({title:"请选择已购买的商品",icon:"none"});if(!y.value.content)return void j({title:"请输入内容",icon:"none"});y.value.imgList=null==(e=y.value.fileList)?void 0:e.filter(e=>"image"===e.type),y.value.buyerShowVideoList=null==(a=y.value.fileList)?void 0:a.filter(e=>"video"===e.type);const t={...y.value};delete t.fileList,ue(t).then(()=>{j({title:"发布成功",icon:"none"}),k({url:"/pages/buyerShow/index"})})};return(e,s)=>{const b=m(g("up-form-item"),K),k=m(g("up-textarea"),Y),L=m(g("up-form"),G),x=l,S=m(g("tig-loadingpage"),q),U=m(g("loading-box"),Q);return 1===i.value?(t(),a(Z,{key:0,title:"新增买家秀"},{default:o(()=>[v(x,{class:"buyerShowForm"},{default:o(()=>[v(x,{class:"formBox"},{default:o(()=>[v(L,{ref_key:"formRef",ref:h,"label-position":"top",model:y.value,rules:_,"label-width":"auto"},{default:o(()=>[v(b,{class:"formItem",label:"上传图片/视频",prop:"fileList"},{default:o(()=>[v(ce,{"media-list":y.value.fileList,"onUpdate:mediaList":s[0]||(s[0]=e=>y.value.fileList=e)},null,8,["media-list"])]),_:1}),v(b,{class:"formItem",label:"内容",prop:"content"},{default:o(()=>[v(k,{modelValue:y.value.content,"onUpdate:modelValue":s[1]||(s[1]=e=>y.value.content=e),placeholder:"请输入内容（必填）",maxlength:"500",count:"","placeholder-style":{backgroundColor:"#FAFAFA",padding:"0",color:"#9A9A9A",fontSize:"24rpx"}},null,8,["modelValue"])]),_:1}),v(b,{label:"选择已购买的商品",prop:"rangeData"},{default:o(()=>[v(de,{products:J(r),"onUpdate:products":s[2]||(s[2]=e=>W(r)?r.value=e:null),total:J(p),"onUpdate:total":s[3]||(s[3]=e=>W(p)?p.value=e:null),"product-list-height":w.value,onScrolltolower:J(f)},null,8,["products","total","product-list-height","onScrolltolower"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),v(ae,{height:"120rpx","background-color":"#fff"},{default:o(()=>[v(x,{class:"footer"},{default:o(()=>[v(ee,{type:"error",onClick:C},{default:o(()=>[u("发布")]),_:1})]),_:1})]),_:1}),v(S,{modelValue:J(d),"onUpdate:modelValue":s[4]||(s[4]=e=>W(d)?d.value=e:null)},null,8,["modelValue"]),v(U,{modelValue:J(c),"onUpdate:modelValue":s[5]||(s[5]=e=>W(c)?c.value=e:null),page:n.page,length:J(r).length},null,8,["modelValue","page","length"])]),_:1})):(t(),a(Z,{key:1,title:"新增买家秀","show-left":!1,style:{height:"100vh"}},{default:o(()=>[v(ie,{buyerShowEnabled:i.value,"onUpdate:buyerShowEnabled":s[6]||(s[6]=e=>i.value=e)},null,8,["buyerShowEnabled"])]),_:1}))}}}),[["__scopeId","data-v-430c63cb"]]);export{pe as default};

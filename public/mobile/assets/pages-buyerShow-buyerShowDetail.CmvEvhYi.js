import{d as e,a7 as l,a5 as a,m as t,aM as s,c as o,b as u,i,w as n,J as c,a as r,P as d,e as m,k as p,h as v,t as f,Z as h,I as y,K as g,_,r as k,n as w,C as L,F as C,G as x,a2 as b,R as I,a8 as S,O as R,W as T,l as j,V as P,aD as z,aY as V,cy as B,cz as F,cA as N,bJ as U,g as E,j as M}from"./index-BZxHr1FI.js";import{_ as A}from"./tig-loadingpage.vue_vue_type_script_setup_true_lang.CErZUb08.js";import{T as D}from"./tig-layout.DTz8E-sj.js";import{_ as $}from"./tig-image.CzXKqALH.js";import{T as G}from"./tig-fixed-placeholder.BDsbIjoZ.js";import{e as K,f as O,h as W,d as J,i as Y,b as H}from"./buyerShowCloseTip.CrtXzvBV.js";import{_ as Z}from"./loading-box.D3Y7A2lC.js";import{u as q}from"./useList.cF42RyDa.js";import"./uni-transition.COpRW9Ft.js";import"./product.BH5dMQls.js";const Q=_(e({__name:"CommentList",props:l({loading:{type:Boolean,default:!1},hasMore:{type:Boolean,default:!0},maxLines:{default:3}},{comments:{default:()=>[]},commentsModifiers:{}}),emits:l(["like-reply","submit-reply","submit-reply-to","load-more","showReplyInput","getReplyList"],["update:comments"]),setup(e,{emit:l}){const _=a(e,"comments"),k=e,w=l,L=t(()=>!k.hasMore&&!k.loading),C=e=>Number(e.replyCount)>0;return s(()=>{_.value.forEach(e=>{var l;e.isLong=((null==(l=e.content)?void 0:l.match(/\n/g))||[]).length>=k.maxLines||e.content.length>100,e.expanded=!1,e.showReplyInput=!1,e.replyContent="",e.showAllReplies=!1,e.replies&&e.replies.forEach(e=>{e.isLike=e.isLike||!1})})}),(e,l)=>{const a=i,t=p;return u(),o(a,{class:"comment-list"},{default:n(()=>[(u(!0),c(g,null,d(_.value,(l,s)=>(u(),o(a,{key:s,class:"comment-item"},{default:n(()=>[m(a,{class:"comment-main"},{default:n(()=>[m(a,{class:"user-userPhoto"},{default:n(()=>[m($,{src:l.userPhoto,class:"userPhoto-img",mode:"aspectFill"},null,8,["src"])]),_:2},1024),m(a,{class:"comment-content"},{default:n(()=>[m(a,{class:"user-info"},{default:n(()=>[m(a,{class:"user-info-content"},{default:n(()=>[m(t,{class:"userName"},{default:n(()=>[v(f(l.userName),1)]),_:2},1024),1===l.isMe?(u(),o(t,{key:0,class:"writer-tag"},{default:n(()=>[v("我")]),_:1})):1===l.isAuthor?(u(),o(t,{key:1,class:"writer-tag"},{default:n(()=>[v("作者")]),_:1})):r("",!0)]),_:2},1024),m(a,{class:"action-item",onClick:e=>(e=>{w("like-comment",e)})(l)},{default:n(()=>[m(t,{class:h(["iconfont-h5",l.isLike?"icon-yiguanzhu":"icon-guanzhu"])},null,8,["class"]),m(t,{class:h(["like-count",{liked:l.isLike}])},{default:n(()=>[v(f(l.likeCount>0?l.likeCount:""),1)]),_:2},1032,["class"])]),_:2},1032,["onClick"])]),_:2},1024),m(a,{class:"comment-text"},{default:n(()=>[m(t,{class:h({"text-collapse":!l.expanded&&l.isLong}),style:y({"-webkit-line-clamp":l.expanded?"unset":e.maxLines})},{default:n(()=>[v(f(l.content),1)]),_:2},1032,["class","style"]),l.isLong?(u(),o(t,{key:0,class:"toggle-btn",onClick:e=>(e=>{e.expanded=!e.expanded})(l)},{default:n(()=>[v(f(l.expanded?"收起":"展开"),1)]),_:2},1032,["onClick"])):r("",!0)]),_:2},1024),m(a,{class:"comment-actions"},{default:n(()=>[m(a,{class:"action-item"},{default:n(()=>[m(t,{class:"time"},{default:n(()=>[v(f(l.addTime),1)]),_:2},1024),m(t,{class:"replyText",onClick:e=>(e=>{w("showReplyInput",e)})(l)},{default:n(()=>[v("回复")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),l.replies&&l.replies.length>0&&l.showAllReplies?(u(),o(a,{key:0,class:"replies-list"},{default:n(()=>[(u(!0),c(g,null,d(l.replies,(e,s)=>(u(),o(a,{key:s,class:"reply-item"},{default:n(()=>[m(a,{class:"reply-main"},{default:n(()=>[m(a,{class:"user-userPhoto"},{default:n(()=>[m($,{src:e.userPhoto,class:"userPhoto-img small",mode:"aspectFill"},null,8,["src"])]),_:2},1024),m(a,{class:"reply-content"},{default:n(()=>[m(a,{class:"user-info"},{default:n(()=>[m(a,{class:"user-info-content"},{default:n(()=>[m(t,{class:"userName"},{default:n(()=>[v(f(e.userName),1)]),_:2},1024),1===e.isMe?(u(),o(t,{key:0,class:"writer-tag"},{default:n(()=>[v("我")]),_:1})):1===e.isAuthor?(u(),o(t,{key:1,class:"writer-tag"},{default:n(()=>[v("作者")]),_:1})):r("",!0)]),_:2},1024),m(a,{class:"action-item",onClick:l=>((e,l)=>{w("like-reply",l)})(0,e)},{default:n(()=>[m(t,{class:h(["iconfont-h5",e.isLike?"icon-yiguanzhu":"icon-guanzhu"])},null,8,["class"]),m(t,{class:h(["like-count",{liked:e.isLike}])},{default:n(()=>[v(f(e.likeCount>0?e.likeCount:""),1)]),_:2},1032,["class"])]),_:2},1032,["onClick"])]),_:2},1024),m(a,{class:"reply-text"},{default:n(()=>[m(t,null,{default:n(()=>[v(f(e.content),1)]),_:2},1024)]),_:2},1024),m(a,null,{default:n(()=>[m(t,{class:"time"},{default:n(()=>[v(f(e.addTime),1)]),_:2},1024),m(t,{class:"replyText",onClick:e=>(e=>{w("showReplyInput",e)})(l)},{default:n(()=>[v("回复")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)):r("",!0),C(l)?(u(),o(a,{key:1,class:"view-more-replies",onClick:e=>((e,l)=>{e.showAllReplies="收起"!==e.toggleText,e.showAllReplies?w("getReplyList",{...e,index:l}):(e.toggleText=`展开${e.replyCount}条回复`,e.page=1,e.replies=[])})(l,s)},{default:n(()=>[m(t,null,{default:n(()=>[v(f(l.toggleText||(l.showAllReplies?"收起回复":`展开${l.replyCount}条回复`)),1)]),_:2},1024)]),_:2},1032,["onClick"])):r("",!0)]),_:2},1024))),128)),e.loading?(u(),o(a,{key:0,class:"loading-more"},{default:n(()=>[m(t,null,{default:n(()=>[v("加载中...")]),_:1})]),_:1})):r("",!0),L.value&&_.value.length>0?(u(),o(a,{key:1,class:"no-more"},{default:n(()=>[m(t,null,{default:n(()=>[v("没有更多评论了")]),_:1})]),_:1})):r("",!0)]),_:1})}}}),[["__scopeId","data-v-03510690"]]),X=e({__name:"comments",emits:["showReplyInput","getCommentList"],setup(e,{expose:l,emit:a}){const t=a,s=k(""),c=k({page:1,size:10,parentId:0}),r=k({page:1,size:3,parentId:0}),{getList:d,data:p,isLoading:h,isLoadMore:y,total:g}=q(K,{params:c,path:{dataKey:"records"},immediate:!1}),{getList:_,data:S}=q(K,{params:r,path:{dataKey:"records"},immediate:!1,needReachBottom:!1});l({getList:d,total:g}),w(e=>{s.value=e.buyerShowId,s.value&&d({buyerShowId:s.value,parentId:0})});const R=e=>{t("showReplyInput",e)},T=async e=>{const l=await _({buyerShowId:s.value,parentId:e.buyerShowCommentId,size:3,page:Number(e.page||1)});p.value[e.index].replies=S.value,p.value[e.index].page=(e.page||1)+1,l.current*l.size<l.total?(p.value[e.index].toggleText=`展开${l.total-l.current*l.size}条回复`,console.log(p.value[e.index],"buyerShowCommentListData.value[comment.index]")):p.value[e.index].toggleText="收起"},j=k(!1),P=k(!0),z=e=>{B({...e,level:1})},V=e=>{B({...e,level:2})},B=async e=>{try{if(await O({buyerShowCommentId:e.buyerShowCommentId,isLike:e.isLike?0:1}),I({title:e.isLike?"取消点赞":"点赞成功",icon:"none"}),1===e.level){const l=p.value.findIndex(l=>l.buyerShowCommentId===e.buyerShowCommentId);if(-1===l)return;p.value[l].isLike=!e.isLike,p.value[l].likeCount=e.isLike?e.likeCount-1:e.likeCount+1}else{const l=S.value.findIndex(l=>l.buyerShowCommentId===e.buyerShowCommentId);if(-1===l)return;S.value[l].isLike=!e.isLike,S.value[l].likeCount=e.isLike?e.likeCount-1:e.likeCount+1}}catch(l){I({title:null==l?void 0:l.message})}},F=(e,l)=>{e.replies||(e.replies=[]),e.replies.push({id:Date.now(),username:"当前用户",content:l,createTime:Date.now(),likeCount:0,isLiked:!1})},N=(e,l,a)=>{e.replies||(e.replies=[]),e.replies.push({id:Date.now(),username:"当前用户",content:a,createTime:Date.now(),likeCount:0,isLiked:!1,replyTo:l.username})},U=()=>{!j.value&&P.value&&(j.value=!0,setTimeout(()=>{j.value=!1},1e3))};return(e,l)=>{const a=i,t=L(C("tig-loadingpage"),A),s=L(C("loading-box"),Z);return u(),o(a,null,{default:n(()=>[m(a,{class:"commentsTotal"},{default:n(()=>[v("共"+f(x(g))+"条评论",1)]),_:1}),m(Q,{comments:x(p),"onUpdate:comments":l[0]||(l[0]=e=>b(p)?p.value=e:null),"reply-list-data":x(S),"onUpdate:replyListData":l[1]||(l[1]=e=>b(S)?S.value=e:null),loading:j.value,"has-more":P.value,onLikeComment:z,onLikeReply:V,onSubmitReply:F,onSubmitReplyTo:N,onLoadMore:U,onShowReplyInput:R,onGetReplyList:T},null,8,["comments","reply-list-data","loading","has-more"]),m(t,{modelValue:x(h),"onUpdate:modelValue":l[2]||(l[2]=e=>b(h)?h.value=e:null)},null,8,["modelValue"]),m(s,{modelValue:x(y),"onUpdate:modelValue":l[3]||(l[3]=e=>b(y)?y.value=e:null),page:c.value.page,length:x(p).length},null,8,["modelValue","page","length"])]),_:1})}}}),ee=_(e({__name:"emojiPicker",emits:["insertEmoji","closeEmojiPicker"],setup(e,{expose:l,emit:a}){const t=a,s=S();l({inputFocus:()=>{s.value.doFocus()}});const r=k([]);(()=>{const e=[];for(let l=0;l<80;l++)e.push(String.fromCodePoint(128512+l));r.value=e})();return(e,l)=>{const a=p,s=i,h=T;return u(),o(s,{class:"emoji-picker"},{default:n(()=>[m(h,{"scroll-x":"true",class:"emoji-picker-box"},{default:n(()=>[m(s,{class:"emoji-content"},{default:n(()=>[(u(!0),c(g,null,d(r.value,(e,l)=>(u(),o(a,{key:l,class:"emoji-item",onTouchend:R(l=>(e=>{console.log(e,222),t("insertEmoji",e)})(e),["prevent","stop"])},{default:n(()=>[v(f(e),1)]),_:2},1032,["onTouchend"]))),128))]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-10287501"]]),le=_(e({__name:"buyerShowDetail",setup(e){const l=j(),a=k(1);P(()=>l,e=>{e.initLoading&&(a.value=e.buyerShowEnabled)},{deep:!0,immediate:!0});const s=S(),p=S(),_=S(),b=k(null),K=k({videoList:[],imgList:[]}),O=k(!1),Z=t(()=>{var e,l;const a=[...(null==(e=K.value)?void 0:e.videoList)??[],...(null==(l=K.value)?void 0:l.imgList)??[]].filter(Boolean);return a.forEach(e=>{e.videoCover?(e.type="video",e.image=e.videoUrl,e.poster=e.videoCover):(e.type="image",e.image=e.picUrl)}),a||[]}),q=k(0),Q=k("300rpx"),le=()=>{const e=9*V().windowWidth/16;Q.value=e+"px"},ae=k(""),te=()=>{O.value=!0,W({buyerShowId:b.value}).then(e=>{K.value=e,O.value=!1,(async()=>{if(Z.value.length>0)try{const e=(await Promise.all(Z.value.map(async e=>await z((null==e?void 0:e.poster)||(null==e?void 0:e.image))))).reduce((e,l)=>e.height>l.height?e:l),l=V().windowWidth*e.height/e.width;Q.value=l>600?"600px":l+"px"}catch(e){le()}else le()})()}).catch(e=>{O.value=!1,I({title:e.message,icon:"error"})})},se=async()=>{ae.value?Y({buyerShowId:b.value,content:ae.value,parentId:re.value.buyerShowCommentId||0}).then(()=>{ae.value="",I({title:"评论成功"}),s.value.getList({buyerShowId:b.value}),K.value.commentCount=K.value.commentCount+1,re.value={}}).catch(e=>{I({title:e.message,icon:"error"})}):I({title:"评论不能为空",icon:"none"})},oe=k(!1),ue=()=>{oe.value=!0},ie=()=>{oe.value=!1},ne=e=>{var l;oe.value=!0,ae.value+=e,null==(l=p.value)||l.onFocus()},ce=async()=>{try{await H({buyerShowId:K.value.buyerShowId,isLike:K.value.isLike?0:1}),I({title:K.value.isLike?"取消点赞":"点赞成功",icon:"none"}),K.value.isLike=!K.value.isLike;const e=K.value.likeCount||0;K.value.likeCount=e+(K.value.isLike?1:-1)}catch(e){I({title:null==e?void 0:e.message})}},re=k({}),de=e=>{re.value=e,p.value.onFocus()};return w(e=>{b.value=e.buyerShowId,b.value&&te()}),(e,t)=>{const k=E,w=i,I=L(C("up-swiper"),B),S=L(C("up-image"),F),j=T,P=L(C("up-divider"),N),z=L(C("up-input"),U),V=L(C("tig-loadingpage"),A);return 1===a.value?(u(),o(D,{key:0,title:"详情"},{default:n(()=>[m(I,{class:"swiperBox","key-name":"image",list:Z.value,indicator:"",autoplay:!1,"indicator-mode":"dot","indicator-active-color":"#FF4444",style:y({height:Q.value,minHeight:"300px"}),onChange:t[0]||(t[0]=e=>q.value=e.current)},{default:n(({item:e})=>["image"===e.type?(u(),o($,{key:0,preview:"",src:e.image,class:"media-preview-image",mode:"aspectFit"},null,8,["src"])):"video"===e.type?(u(),o(k,{key:1,id:"video-",src:e.image,controls:!0,autoplay:!0,muted:!0,class:"media-preview-video"},null,8,["src"])):r("",!0)]),indicator:n(()=>[Z.value.length>1?(u(),o(w,{key:0},{default:n(()=>[m(w,{class:"indicator"},{default:n(()=>[(u(!0),c(g,null,d(Z.value,(e,l)=>(u(),o(w,{key:l,class:h(["indicator__dot",[l===q.value&&"indicator__dot--active"]])},null,8,["class"]))),128))]),_:1})]),_:1})):r("",!0)]),_:1},8,["list","style"]),m(w,{class:"container"},{default:n(()=>[m(w,{class:"userBox"},{default:n(()=>[m(w,{class:"photo"},{default:n(()=>[m($,{src:K.value.buyerPhoto,class:"content-image",mode:"wid"},null,8,["src"])]),_:1}),m(w,{class:"userName"},{default:n(()=>[v(f(K.value.buyerName),1)]),_:1})]),_:1}),m(w,{class:"content"},{default:n(()=>[v(f(K.value.content),1)]),_:1}),m(w,{class:"addTime"},{default:n(()=>[v("发布于"+f(K.value.addTime),1)]),_:1}),m(j,{"scroll-x":!0},{default:n(()=>[m(w,{class:"productListBox"},{default:n(()=>[(u(!0),c(g,null,d(K.value.productList,(l,a)=>(u(),o(w,{key:a,class:"productList",onClick:e=>(e=>{M({url:"/pages/product/index",param:{id:e.productId}})})(l)},{default:n(()=>[m(w,{class:"productListInfo"},{default:n(()=>[m(w,{class:"productImg"},{default:n(()=>[0===l.storeProductStock?(u(),o(w,{key:0,class:"outsale"},{default:n(()=>[v(f(e.$t("已售罄")),1)]),_:1})):r("",!0),m(S,{src:l.picUrl,width:"200rpx",height:"200rpx"},null,8,["src"])]),_:2},1024),m(w,{class:"productRight"},{default:n(()=>[m(w,{class:"title"},{default:n(()=>[v(f(l.productName),1)]),_:2},1024),l.productPrice?(u(),o(w,{key:0,class:"price"},{default:n(()=>[v("¥"+f(l.productPrice),1)]),_:2},1024)):r("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),m(P,{text:""}),m(w,{class:"comments"},{default:n(()=>[m(X,{ref_key:"commentsRef",ref:s,"buyer-show-id":b.value,"onUpdate:buyerShowId":t[1]||(t[1]=e=>b.value=e),onShowReplyInput:de},null,8,["buyer-show-id"])]),_:1})]),_:1}),m(G,{height:oe.value?"200rpx":"100rpx","background-color":"#fff"},{default:n(()=>[m(w,{class:"footer"},{default:n(()=>[m(z,{ref_key:"inputRef",ref:p,modelValue:ae.value,"onUpdate:modelValue":t[2]||(t[2]=e=>ae.value=e),class:"input",shape:"circle",placeholder:x(l).buyerShowGuidanceContent,"placeholder-style":{fontSize:"26rpx"},focus:oe.value,border:"surround","auto-blur":"","cursor-spacing":60,"hold-keyboard":!0,onFocus:ue,onConfirm:se,onBlur:ie},null,8,["modelValue","placeholder","focus"]),m(w,{class:"countBox"},{default:n(()=>[m(w,{class:"LikeBox",onClick:R(ce,["stop"])},{default:n(()=>[m(w,{class:h(["iconfont-h5",K.value.isLike?"icon-yiguanzhu":"icon-guanzhu"])},null,8,["class"]),m(w,{class:h(["likes",{liked:K.value.isLike}])},{default:n(()=>[v(f(Number(K.value.likeCount)>0?K.value.likeCount:0),1)]),_:1},8,["class"])]),_:1}),m(w,{class:"LikeBox"},{default:n(()=>[m(w,{class:"iconfont-h5 icon-pinglun"}),m(w,{class:"numberOfMessages"},{default:n(()=>[v(f(K.value.commentCount||0),1)]),_:1})]),_:1})]),_:1})]),_:1}),oe.value?(u(),o(ee,{key:0,ref_key:"emojiPickerRef",ref:_,onInsertEmoji:ne},null,512)):r("",!0)]),_:1},8,["height"]),m(V,{modelValue:O.value,"onUpdate:modelValue":t[3]||(t[3]=e=>O.value=e)},null,8,["modelValue"])]),_:1})):(u(),o(D,{key:1,title:"详情","show-left":!1,style:{height:"100vh"}},{default:n(()=>[m(J,{"buyer-show-enabled":a.value,"onUpdate:buyerShowEnabled":t[4]||(t[4]=e=>a.value=e)},null,8,["buyer-show-enabled"])]),_:1}))}}}),[["__scopeId","data-v-8613ea20"]]);export{le as default};

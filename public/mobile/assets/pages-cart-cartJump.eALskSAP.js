import{d as t,L as a,l as e,ab as l,r as s,v as c,y as o,M as i,ac as u,ad as n,m as r,c as d,w as f,C as h,F as p,b as k,J as m,e as _,K as v,a as y,i as g,h as b,t as x,k as C,P as $,Z as I,a6 as w,f as j,G as D,ae as S,af as V,I as A,ag as z,X as T,R as U,_ as E}from"./index-BZxHr1FI.js";import{T as P,c as W,d as O}from"./tig-layout.DTz8E-sj.js";import{_ as q}from"./format-price.BrXrBVy6.js";import{_ as B}from"./specification.C71VpZ8P.js";import{_ as L,a as N}from"./uni-swipe-action.B_W9HPBU.js";import{a as J}from"./activityCard.DE1HAQr9.js";import{d as F}from"./discountInfo.Cqr9E45_.js";import{r as G}from"./index.CtwwUC20.js";import{c as K,t as M,d as R}from"./cartEmpty.CB52AilM.js";import{g as Q,u as X,c as Z,r as H,a as Y}from"./cart.DsRk4QKk.js";import{u as tt}from"./product.BH5dMQls.js";import"./currency.Dn5A4d7X.js";import"./tig-image.CzXKqALH.js";import"./uni-icons.DMMn2oBg.js";import"./uni-number-box.DKxM8QIH.js";import"./masonry.B_l69Lra.js";import"./tig-lazy-image.BPOhG_XX.js";import"./dayjs.min.BETqfnlQ.js";import"./useList.cF42RyDa.js";const at=E(t({__name:"cartJump",setup(t){const{t:E}=a(),at=e(),et=l(),lt=s([]),st=s({checkedCount:0,discountAfter:0,discountCouponAmount:0,discountProductPromotionAmount:0,discountSeckillAmount:0,discountTimeDiscountAmount:0,discounts:0,productAmount:0,totalCount:0}),ct=s(!1),ot=s(!1),it=()=>{lt.value.forEach(t=>{t.carts.forEach(t=>{t.isDisabled||(t.isChecked=ot.value)})}),rt(),dt()},ut=()=>{ot.value=!ot.value,it()},nt=()=>{rt(),dt()},rt=()=>{lt.value.forEach(t=>{const a=t.carts.filter(t=>!t.isDisabled);t.isChecked=a.every(t=>!0===t.isChecked)}),ot.value=lt.value.every(t=>!0===t.isChecked)},dt=async()=>{const t=[];lt.value.forEach(a=>{a.carts.forEach(a=>{t.push({cartId:a.cartId,isChecked:a.isChecked?1:0})})});try{await X({data:t}),kt()}catch(a){console.error(a)}},ft=()=>{kt()};c(()=>{o(),kt()});const ht=s(!0),pt=s(!i("token")),kt=async()=>{u({title:E("加载中")});try{const t=await Q();console.log(t),st.value=t.total,lt.value=t.cartList,pt.value=!1,rt()}catch(t){console.error(t),401===t.code&&(pt.value=!0)}finally{ht.value=!1,n()}};let mt=null;const _t=t=>{t&&"minus"===t&&uni.$u.toast(E("商品数量不能小于1")),t&&"plus"===t&&uni.$u.toast(E("库存不足"))},vt=async(t,a)=>{((t,a)=>{mt&&clearTimeout(mt),mt=setTimeout(()=>{yt(t,a)},300)})(t,a)},yt=async(t,a)=>{try{await Y({cartId:t,data:{quantity:a}}),kt()}catch(e){console.error(e),U({title:e.message,icon:"none",duration:800}),setTimeout(()=>{kt()},800)}},gt=()=>{ct.value=!ct.value},bt=()=>{z({title:E("提示"),content:E("确认要清空购物车吗？"),success:async t=>{t.confirm&&(await Z(),kt())}})},xt=r(()=>{const t=[];return lt.value.forEach(a=>{a.carts.forEach(a=>{a.isChecked&&t.push(a.cartId)})}),t||[]}),Ct=()=>{if(0==xt.value.length)return uni.$u.toast(E("请选择要删除的商品"));z({title:E("提示"),content:E("确认要删除指定的商品吗？"),success:async t=>{if(t.confirm)try{await H({cartIds:xt.value}),kt()}catch(a){console.error(a)}}})},$t=()=>{if(0!=st.value.checkedCount)return 1===at.closeOrder?uni.$u.toast(E("商城已关闭下单")):void T({url:"/pages/order/check"})},It=t=>{const a=[],e=t.filter(t=>2===t.type),l=t.filter(t=>2!==t.type);return l.length>0&&a.push(l[0]),e.length>0&&a.push(e[0]),a},wt=s(!1),jt=s({}),Dt=s(!1),St=()=>{wt.value&&(wt.value=!1),Dt.value=!Dt.value},Vt=r(()=>({bottom:et.currentActiveValue>-1?"var(--tabbar-height)":"0",paddingBottom:et.currentActiveValue>-1?"0":"var(--safe-bottom)",height:et.currentActiveValue>-1?"var(--checkOutBar-height)":"calc(var(--checkOutBar-height) + var(--safe-bottom))"}));return(t,a)=>{const e=h(p("tig-navbar"),W),l=C,s=g,c=h(p("tig-checkbox"),O),o=j,i=w,u=h(p("format-price"),q),n=h(p("tig-number-box"),B),r=h(p("uni-swipe-action-item"),L),U=h(p("uni-swipe-action"),N),Q=h(p("tig-layout"),P);return k(),d(Q,{onLoginSuccess:ft},{default:f(()=>[pt.value?(k(),d(M,{key:1})):(k(),m(v,{key:0},[_(e,{"show-left":!0,title:"购物车"}),ht.value?y("",!0):(k(),d(s,{key:0,class:"cart-box shoppingCart"},{default:f(()=>[lt.value.length>0?(k(),m(v,{key:0},[_(s,{class:"top-text"},{default:f(()=>[_(s,{class:"fl"},{default:f(()=>[b(x(t.$t("已选商品"))+" ",1),_(l,{class:"select-num"},{default:f(()=>[b(x(st.value.checkedCount),1)]),_:1}),b(" "+x(t.$t("件")),1)]),_:1}),_(s,{class:"fr administrate acea-row row-center-wrapper",onClick:gt},{default:f(()=>[_(l,{class:"manage-btn"},{default:f(()=>[b(x(ct.value?t.$t("完成"):t.$t("管理")),1)]),_:1})]),_:1})]),_:1}),_(s,{class:"cart_list_wrap"},{default:f(()=>[(k(!0),m(v,null,$(lt.value,(a,e)=>(k(),d(s,{key:a.cartId,class:"cart_table"},{default:f(()=>[_(s,{class:"cart_store_title noborder"},{default:f(()=>[_(c,{checked:a.isChecked,"onUpdate:checked":t=>a.isChecked=t,size:"20",onChange:t=>(t=>{const a=lt.value[t];a.carts.forEach(t=>{t.isDisabled||(t.isChecked=a.isChecked)}),rt(),dt()})(e)},null,8,["checked","onUpdate:checked","onChange"]),_(s,{class:"store_label",onClick:t=>{var e;0!==(e=a.shopId)&&T({url:`/pages/shop/index?shopId=${e}`})}},{default:f(()=>[b(x(a.shopTitle?a.shopTitle:t.$t("自营")),1)]),_:2},1032,["onClick"])]),_:2},1024),_(s,{class:"goods-list-cart"},{default:f(()=>[_(U,null,{default:f(()=>[(k(!0),m(v,null,$(a.carts,(a,e)=>(k(),d(s,{key:a.productId,class:"cart_item"},{default:f(()=>[_(r,{threshold:0,"auto-close":""},{right:f(()=>[_(s,{class:"cart-move-box"},{default:f(()=>[_(s,{class:"btn-collect",onClick:t=>(async(t,a)=>{try{await tt({productId:t})}catch(e){console.error(e)}finally{await H({cartIds:[a]}),kt()}})(a.productId,a.cartId)},{default:f(()=>[_(l,null,{default:f(()=>[b(x(t.$t("移入收藏")),1)]),_:1})]),_:2},1032,["onClick"]),_(s,{class:"btn-del",onClick:t=>{return e=a.cartId,void z({title:E("提示"),content:E("确认要删除该的商品吗？"),success:async t=>{if(t.confirm)try{await H({cartIds:[e]}),kt()}catch(a){console.error(a)}}});var e}},{default:f(()=>[_(l,null,{default:f(()=>[b(x(t.$t("删除")),1)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),default:f(()=>[_(s,{class:I(["cart_list_con",{cartItemDisabled:a.isDisabled}])},{default:f(()=>[_(c,{checked:a.isChecked,"onUpdate:checked":t=>a.isChecked=t,size:"20",class:"check-item",disabled:a.isDisabled,onChange:nt},null,8,["checked","onUpdate:checked","disabled"]),_(i,{url:`/pages/product/index?id=${a.productId}${a.skuId>0?`&sku_id=${a.skuId}`:""}`,class:"photo"},{default:f(()=>[_(s,{class:"photo-img"},{default:f(()=>[_(o,{src:D(S)(a.picThumb)},null,8,["src"]),0===a.stock?(k(),d(s,{key:0,class:"cart-notice-row"},{default:f(()=>[b(x(t.$t("已售罄")),1)]),_:1})):y("",!0),0===a.productStatus?(k(),d(s,{key:1,class:"cart-notice-row"},{default:f(()=>[b(x(t.$t("已下架")),1)]),_:1})):y("",!0)]),_:2},1024)]),_:2},1032,["url"]),_(s,{class:"cart-row"},{default:f(()=>[_(i,{target:"_blank",url:`/pages/product/index?id=${a.productId}${a.skuId>0?`&sku_id=${a.skuId}`:""}`},{default:f(()=>[_(s,{class:"name"},{default:f(()=>[b(x(a.productName),1)]),_:2},1024)]),_:2},1032,["url"]),_(s,{class:"sku-card-box"},{default:f(()=>[a.skuData&&a.skuData.length>0?(k(),d(s,{key:0,class:"sku-card"},{default:f(()=>[(k(!0),m(v,null,$(a.skuData,(t,a)=>(k(),d(s,{key:t,class:"sku-item line1"},{default:f(()=>[b(x(t.value),1)]),_:2},1024))),128))]),_:2},1024)):y("",!0)]),_:2},1024),a.activityInfo?(k(),d(s,{key:0,class:"activity-box"},{default:f(()=>[(k(!0),m(v,null,$(It(a.activityInfo),t=>(k(),d(J,{key:t.promotionId,"activity-info":t,"card-type":"sub"},null,8,["activity-info"]))),128))]),_:2},1024)):y("",!0),_(s,{class:I(["cart-price",{"cart-price-margin":!(a.skuData&&0!==a.skuData.length||a.activityInfo)}])},{default:f(()=>[_(s,{class:"price-one"},{default:f(()=>[_(u,{"show-text":!1,"font-style":{fontWeight:"bold"},"decimals-style":{fontSize:"22rpx",fontWeight:"bold"},"currency-style":{fontSize:"23rpx",fontWeight:"bold"},"price-data":a.originPrice&&a.originPrice!==a.price?a.originPrice:a.price},null,8,["price-data"])]),_:2},1024),_(s,{class:"cart-num-box"},{default:f(()=>[_(n,{modelValue:a.quantity,"onUpdate:modelValue":t=>a.quantity=t,disabled:a.isDisabled||0===a.stock,min:1,"button-width":30,max:a.stock,"input-width":"30","button-size":"30",onChange:t=>vt(a.cartId,a.quantity),onOverlimit:_t},null,8,["modelValue","onUpdate:modelValue","disabled","max","onChange"])]),_:2},1024)]),_:2},1032,["class"]),a.price&&a.originPrice!==a.price?(k(),d(s,{key:1,class:"origin-price"},{default:f(()=>[b(x(t.$t("每件预计到手"))+" ",1),_(u,{"show-text":!1,"is-bottom":!1,"price-data":a.price},null,8,["price-data"])]),_:2},1024)):y("",!0),a.extraSkuData&&a.extraSkuData.length?(k(),d(s,{key:2,class:"extraskudata",onClick:t=>(t=>{wt.value=!0,jt.value=t})(a)},{default:f(()=>[1===a.extraSkuData.length?(k(!0),m(v,{key:0},$(a.extraSkuData,t=>(k(),d(s,{key:t,class:"extraskudata-item"},{default:f(()=>[_(s,{class:"title line1"},{default:f(()=>[b(x(t.attrName),1)]),_:2},1024),_(s,{class:"line-box"},{default:f(()=>[_(s,{class:"line"})]),_:1}),_(s,{class:"content"},{default:f(()=>[_(l,{class:"line1 content-text"},{default:f(()=>[b(x(t.attrValue),1)]),_:2},1024),_(u,{"show-text":!1,class:"price","price-data":t.totalAttrPrice},null,8,["price-data"]),_(l,{class:"iconfont-h5 icon-xiajiantou1-copy"})]),_:2},1024)]),_:2},1024))),128)):(k(),d(s,{key:1,class:"extraskudata-item"},{default:f(()=>[_(s,{class:"title"},{default:f(()=>[b(x(t.$t("附加")),1)]),_:1}),_(s,{class:"line-box"},{default:f(()=>[_(s,{class:"line"})]),_:1}),_(s,{class:"content"},{default:f(()=>[D(V)()?(k(),d(l,{key:0,class:"line1 content-text"},{default:f(()=>[b(x(t.$t("已选{0}项",a.extraSkuData.length))+" ",1),_(u,{"show-text":!1,class:"price","price-data":a.extraSkuData[0].attrPrice},null,8,["price-data"])]),_:2},1024)):(k(),d(l,{key:1,class:"line1 content-text"},{default:f(()=>[b(x(`已选${a.extraSkuData.length}项`)+" ",1),_(u,{"show-text":!1,class:"price","price-data":a.serviceFee},null,8,["price-data"])]),_:2},1024)),_(l,{class:"iconfont-h5 icon-xiajiantou1-copy"})]),_:2},1024)]),_:2},1024))]),_:2},1032,["onClick"])):y("",!0)]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024),a.gift.length>0?(k(),d(s,{key:0,class:"gift-box"},{default:f(()=>[_(s,{class:"gift-title"},{default:f(()=>[b(x(t.$t("赠品")),1)]),_:1}),_(s,{class:"gift-content"},{default:f(()=>[(k(!0),m(v,null,$(a.gift,t=>(k(),d(s,{key:t.giftId,class:"gift-content-item"},{default:f(()=>[_(s,{class:"gift-item-left"},{default:f(()=>[_(o,{src:D(S)(t.picThumb)},null,8,["src"])]),_:2},1024),_(s,{class:"gift-item-right"},{default:f(()=>[_(s,{class:"gift-item-name line1"},{default:f(()=>[b(x(t.productName),1)]),_:2},1024),t.skuData.length>0?(k(),d(s,{key:0,class:"sku-card"},{default:f(()=>[(k(!0),m(v,null,$(t.skuData,(t,a)=>(k(),d(s,{key:a,class:"sku-item"},{default:f(()=>[b(x(t.value),1)]),_:2},1024))),128))]),_:2},1024)):y("",!0),_(s,{class:"gift-item-num"},{default:f(()=>[b("x"+x(t.num),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)):y("",!0)]),_:2},1024))),128))]),_:1}),_(s,{class:"checkOutBar",style:A(Vt.value)},{default:f(()=>[_(s,{class:"bar-check"},{default:f(()=>[_(s,{class:"checkbox-pad"},{default:f(()=>[_(c,{checked:ot.value,"onUpdate:checked":a[0]||(a[0]=t=>ot.value=t),size:"20",onChange:it},null,8,["checked"]),_(l,{class:"checkbox-text",onClick:ut},{default:f(()=>[b(x(t.$t("全选")),1)]),_:1})]),_:1})]),_:1}),ct.value?(k(),d(s,{key:0,class:"edit-cart-action"},{default:f(()=>[_(s,{class:"l_a_tool lt_delete",onClick:bt},{default:f(()=>[b(x(t.$t("清空购物车")),1)]),_:1}),_(s,{class:I(["l_a_tool",{ltDisable:0===xt.value.length}]),onClick:Ct},{default:f(()=>[b(x(t.$t("删除勾选商品")),1)]),_:1},8,["class"])]),_:1})):y("",!0),ct.value?y("",!0):(k(),d(s,{key:1,class:"cart-total-box"},{default:f(()=>[_(s,{class:"cart-total"},{default:f(()=>[_(s,{class:I("btn-checkout "+(0==st.value.checkedCount?"unable_btn":"")),onClick:$t},{default:f(()=>[b(x(t.$t("去结算")),1)]),_:1},8,["class"]),_(s,{class:"item-total"},{default:f(()=>[_(s,{class:"item-total-amount"},{default:f(()=>[_(l,{class:"txt"},{default:f(()=>[b(x(t.$t("合计"))+"：",1)]),_:1}),_(u,{"show-text":!1,"price-data":st.value.discountAfter,"font-style":{fontWeight:"bold",fontSize:"30rpx"},"currency-style":{fontSize:"22rpx",fontWeight:"bold"},"decimals-style":{fontSize:"22rpx",fontWeight:"bold"}},null,8,["price-data"])]),_:1}),_(s,{class:"item-total-desc"},{default:f(()=>[_(s,{class:""},{default:f(()=>[b(x(t.$t("共优惠"))+"：",1),_(u,{"show-text":!1,"is-bottom":!1,"price-data":st.value.discounts},null,8,["price-data"])]),_:1}),_(s,{class:"discounts-btn",onClick:St},{default:f(()=>[b(x(t.$t("优惠明细"))+" ",1),_(l,{class:I(["iconfont-h5 icon-xiajiantou1-copy",{"icon-active":Dt.value}])},null,8,["class"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))]),_:1},8,["style"])],64)):y("",!0),0!==lt.value.length||ht.value?y("",!0):(k(),d(K,{key:1})),_(G,{onCallback:kt})]),_:1}))],64)),_(F,{modelValue:Dt.value,"onUpdate:modelValue":a[1]||(a[1]=t=>Dt.value=t),total:st.value},null,8,["modelValue","total"]),_(R,{modelValue:wt.value,"onUpdate:modelValue":a[2]||(a[2]=t=>wt.value=t),detail:jt.value},null,8,["modelValue","detail"])]),_:1})}}}),[["__scopeId","data-v-b484b379"]]);export{at as default};

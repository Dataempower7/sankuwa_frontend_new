import{d as e,L as a,r as l,m as t,n as o,an as s,Y as u,p as c,ao as n,v as r,R as i,s as d,c as p,w as f,ac as v,ad as m,C as y,F as _,a9 as b,H as k,aa as g,b as h,J as x,a as $,K as C,e as j,i as N,f as S,G as z,h as w,t as I,af as D,Z as M,k as T,P as A,$ as P,a0 as O,X as R,j as q,_ as E}from"./index-BZxHr1FI.js";import{_ as U}from"./format-price.BrXrBVy6.js";import{_ as V}from"./tig-image.CzXKqALH.js";import{_ as Z}from"./empty-box.vue_vue_type_script_setup_true_lang.DDT9sx90.js";import{T as F}from"./tig-fixed-placeholder.BDsbIjoZ.js";import{_ as G}from"./tig-back-top.vue_vue_type_script_setup_true_lang.YtcOxsPs.js";import{u as H,T as K}from"./tig-layout.DTz8E-sj.js";import{c as L,d as W,a as X}from"./coupon.PECFoAaQ.js";import{g as J}from"./search.DqVGFqMH.js";import{s as Q}from"./specification.C71VpZ8P.js";import"./currency.Dn5A4d7X.js";import"./uni-icons.DMMn2oBg.js";import"./uni-number-box.DKxM8QIH.js";import"./product.BH5dMQls.js";const Y=E(e({__name:"detail",setup(e){b(e=>({"4daab760":ke.value}));const{t:E}=a(),{scrollTop:Y}=H(),B=l({}),ee=l(),ae=l(),le=async()=>{v({title:E("加载中")});try{if(ee.value){const e=await W({id:ee.value});B.value=e}}catch(e){console.error(e)}finally{m()}},te=t(()=>0===B.value.limitNum?1===B.value.isReceive?"已领取":"马上领":0===B.value.isReceive?"马上领":B.value.receiveNum>=B.value.limitNum?"已领取":"再次领取");o(e=>{s("coupon-search-return",e=>{se.keyword=e,se.keyword=e,ne(),pe()}),e&&(e.id&&(ee.value=Number(e.id),se.couponId=ee.value),e.shopId&&(se.shopId=Number(e.shopId)),pe())}),c(()=>{n("coupon-search-return")}),r(()=>{ee.value&&(le(),ye())});const oe=async()=>{if("已领取"===te.value)return i({title:E("已领取"),icon:"none",duration:1500});try{ee.value&&(await X({couponId:ee.value}),le(),i({title:E("领取成功"),duration:1500}))}catch(e){i({title:e.message,icon:"none",duration:1500}),console.error(e)}},se=u({page:1,size:20,sort:"",order:"asc",keyword:"",couponId:0}),ue=l("default"),ce=l([{label:"默认",value:"default"},{label:"销量",value:"sale"},{label:"价格",value:"price",order:"desc"}]),ne=()=>{de.value=[],se.page=1},re=l(0),ie=l(!0),de=l([]),pe=async()=>{try{const e=await J({...se});re.value=e.total,e.records.forEach(e=>e.isCheck=!1),de.value=[...de.value,...e.records]}catch(e){i({title:e.message,icon:"none"})}finally{ie.value=!1}},fe=()=>{R({url:"/pages/coupon/search"})},ve=l({minOrderAmount:"0",couponMoney:"0",productPrice:"0",discountMoney:"0",couponUnit:0,quantityCount:0}),me=t(()=>{let e="";return e=0==Number(ve.value.productPrice)?E("快去选购商品参与优惠活动"):1===ve.value.couponUnit?Number(ve.value.productPrice)>Number(ve.value.minOrderAmount)?`已满足优惠条件，用券下单立减${ve.value.discountMoney}元`:`还需${Number(ve.value.minOrderAmount)-Number(ve.value.productPrice)}元，即可用券下单立减${ve.value.discountMoney}元，快去选购商品参与优惠活动`:Number(ve.value.quantityCount)>=Number(ve.value.minOrderAmount)?`已满足优惠条件，用券下单立减${ve.value.discountMoney}元`:`还差${Number(ve.value.minOrderAmount)-Number(ve.value.quantityCount)}件，即可用券下单立减${ve.value.discountMoney}元，快去选购商品参与优惠活动`,e}),ye=async()=>{try{const e=await L(ee.value);ve.value=e}catch(e){i({title:e.message,icon:"none"}),console.error(e)}},_e=()=>{q({url:"/pages/cart/index"})},be=e=>{R({url:`/pages/product/index?id=${e}`})},ke=t(()=>`url(${k("coupon/coupon-bg2.png")})`);d(()=>{se.page<Math.ceil(re.value/se.size)&&(se.page++,pe())});const ge=l(0),he=l(),xe=l({}),$e=()=>{he.value.handleShowPopup(),xe.value.isCheck=!1},Ce=()=>{ge.value=0},je=()=>{ye()};return(e,a)=>{const l=S,t=N,o=y(_("format-price"),U),s=T,u=y(_("tig-image"),V),c=y(_("up-loading-icon"),g),n=y(_("empty-box"),Z),r=y(_("tig-fixed-placeholder"),F),i=y(_("tig-back-top"),G),d=y(_("tig-layout"),K);return h(),p(d,{ref_key:"layoutRef",ref:ae},{default:f(()=>[B.value?(h(),x(C,{key:0},[j(t,{class:"coupon-detail-title"},{default:f(()=>[j(t,{class:"detail-title-box"},{default:f(()=>[ae.value&&ae.value.isZh?(h(),p(l,{key:0,class:"img-box",src:z(k)("coupon/coupon-bg1.png")},null,8,["src"])):(h(),p(t,{key:1,class:"img-box-con"},{default:f(()=>[j(l,{class:"img-box",src:z(k)("coupon/overseas-coupon-bg.png")},null,8,["src"]),j(t,{class:"img-box-text"},{default:f(()=>[w(I(e.$t("用券买 更划算")),1)]),_:1})]),_:1})),j(t,{class:"coupon-box"},{default:f(()=>[j(t,{class:"coupon-item"},{default:f(()=>[j(t,{class:"left"},{default:f(()=>[2===B.value.couponType?(h(),p(t,{key:0,class:"zhekou-box"},{default:f(()=>[j(t,{class:"zhekou"},{default:f(()=>[w(I(B.value.couponDiscount),1)]),_:1}),j(t,{class:"zhe"},{default:f(()=>[w(I(e.$t("折")),1)]),_:1})]),_:1})):(h(),p(o,{key:1,"show-text":!1,"currency-style":{selfAlign:"end",fontSize:"24rpx"},"decimals-style":{selfAlign:"end",fontSize:"28rpx"},"font-style":{fontSize:"48rpx",lineHeight:1},"price-data":B.value.couponMoney},null,8,["price-data"])),j(t,{class:"left-name line1"},{default:f(()=>[w(I(B.value.couponName),1)]),_:1})]),_:1}),j(t,{class:"middle"},{default:f(()=>[j(t,{class:"middle-title"},{default:f(()=>[w(I(e.$t("优惠券")),1)]),_:1}),1===B.value.sendType?(h(),p(t,{key:0,class:"sub"},{default:f(()=>[w(I(e.$t("有效期"))+"："+I(B.value.useEndDate),1)]),_:1})):$("",!0),0===B.value.sendType&&B.value.delayDay>0?(h(),p(t,{key:1,class:"sub"},{default:f(()=>[z(D)()?(h(),x(C,{key:0},[w(I(e.$t("领券{0}天后生效，有效期{1}天",[B.value.delayDay,B.value.useDay])),1)],64)):(h(),x(C,{key:1},[w(I(`领券${B.value.delayDay}天后生效，有效期${B.value.useDay}天`),1)],64))]),_:1})):$("",!0),0===B.value.sendType&&0===B.value.delayDay?(h(),p(t,{key:2,class:"sub"},{default:f(()=>[z(D)()?(h(),x(C,{key:0},[w(I(e.$t("领券当日起{0}天内可用",[B.value.useDay])),1)],64)):(h(),x(C,{key:1},[w(I(`领券当日起${B.value.useDay}天内可用`),1)],64))]),_:1})):$("",!0)]),_:1}),j(t,{class:M(["coupon-btn",{disabled:"已领取"===te.value}]),onClick:oe},{default:f(()=>[w(I(e.$t(te.value)),1)]),_:1},8,["class"])]),_:1})]),_:1})]),_:1})]),_:1}),j(t,{class:"sticky"},{default:f(()=>[j(t,{class:"coupon-menu"},{default:f(()=>[j(t,{class:"coupon-search",onClick:fe},{default:f(()=>[j(t,{class:"coupon-search-box"},{default:f(()=>[se.keyword?(h(),p(t,{key:1,class:"search-text is-value"},{default:f(()=>[j(s,{class:"iconfont-h5 icon-sousuo sousuo-icon"}),w(I(se.keyword),1)]),_:1})):(h(),p(t,{key:0,class:"search-text"},{default:f(()=>[j(s,{class:"iconfont-h5 icon-sousuo sousuo-icon"}),w(I(e.$t("搜索")),1)]),_:1}))]),_:1})]),_:1}),j(t,{class:"coupon-content"},{default:f(()=>[(h(!0),x(C,null,A(ce.value,(a,l)=>(h(),p(t,{key:l,class:M(["coupon-item",{active:ue.value===a.value}]),onClick:e=>(e=>{"price"==e.value?e.order="desc"===e.order?"asc":"desc":e.order="",ue.value=e.value,se.sort=e.value,se.order=e.order,ne(),pe()})(a)},{default:f(()=>[j(s,null,{default:f(()=>[w(I(e.$t(a.label)),1)]),_:2},1024),P(j(t,{class:"price-ico-box flex flex-column"},{default:f(()=>[j(s,{class:M(["iconfont-h5 icon-shangjiantou price-icon",{order:"price"===ue.value&&"asc"===a.order}])},null,8,["class"]),j(s,{class:M(["iconfont-h5 icon-xiajiantou price-icon",{order:"price"===ue.value&&"desc"===a.order}])},null,8,["class"])]),_:2},1536),[[O,"price"===a.value]])]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1})]),_:1}),de.value.length>0?(h(),p(t,{key:0,class:"product-list"},{default:f(()=>[(h(!0),x(C,null,A(de.value,a=>(h(),p(t,{key:a.productId,class:"product-item"},{default:f(()=>[j(t,{class:"item-left",onClick:e=>be(a.productId)},{default:f(()=>[j(u,{src:a.picThumb},null,8,["src"]),j(t,{class:"product-status-box"},{default:f(()=>[0==a.productStock||0==a.productStatus?(h(),p(t,{key:0,class:"outsale"},{default:f(()=>[w(I(0==a.productStock?e.$t("已售罄"):e.$t("已下架")),1)]),_:2},1024)):$("",!0)]),_:2},1024)]),_:2},1032,["onClick"]),j(t,{class:"item-right"},{default:f(()=>[j(t,{class:"item-right-title line2",onClick:e=>be(a.productId)},{default:f(()=>[w(I(a.productName),1)]),_:2},1032,["onClick"]),j(t,{class:"item-right-price"},{default:f(()=>[j(o,{"decimals-style":{fontSize:"24rpx",fontWeight:"bold"},"currency-style":{fontSize:"23rpx",fontWeight:"bold"},"font-style":{fontSize:"32rpx"},"price-data":a.price},null,8,["price-data"])]),_:2},1024),j(t,{class:"buy_icon"},{default:f(()=>[j(t,{class:"buy_btn",onClick:e=>(e=>{e.isCheck||(ge.value=e.productId,e.isCheck=!0,xe.value=e)})(a)},{default:f(()=>[a.isCheck?(h(),p(c,{key:0,mode:"circle"})):(h(),p(s,{key:1,class:"iconfont-h5 icon-gouwuche3 buy_btn_icon"}))]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):$("",!0),ie.value||0!==re.value?$("",!0):(h(),p(n,{key:1,text:"好狠的筛选条件啊，把相关的商品都埋没了！"})),j(r,{"background-color":"#fff"},{default:f(()=>[j(t,{class:"btn-box"},{default:f(()=>[j(t,{class:"btn-box-left"},{default:f(()=>[j(t,{class:"left-text"},{default:f(()=>[w(I(e.$t("合计"))+"： ",1)]),_:1}),j(t,{class:"total-money"},{default:f(()=>[j(o,{"decimals-style":{fontSize:"26rpx"},"currency-style":{fontSize:"23rpx"},"font-style":{fontSize:"36rpx"},"price-data":ve.value.productPrice.toString()},null,8,["price-data"])]),_:1})]),_:1}),j(t,{class:"btn-box-right",onClick:_e},{default:f(()=>[w(I(e.$t("去购物车")),1)]),_:1}),j(t,{class:"tip line2"},{default:f(()=>[w(I(me.value),1)]),_:1})]),_:1})]),_:1}),j(Q,{ref_key:"specificationRef",ref:he,modelValue:ge.value,"onUpdate:modelValue":a[0]||(a[0]=e=>ge.value=e),onAddCardSucceed:je,onLoadEnd:$e,onClose:Ce},null,8,["modelValue"]),j(i,{"scroll-top":z(Y),bottom:90},null,8,["scroll-top"])],64)):$("",!0)]),_:1},512)}}}),[["__scopeId","data-v-f0dc49b3"]]);export{Y as default};

import{_ as e,c as t,b as a,w as s,aB as l,h as o,t as u,i as c,d as n,L as i,r as d,Y as p,n as r,v as f,s as y,ac as _,ad as m,C as h,F as g,a as v,J as k,K as x,P as b,e as $,Z as D,f as I,G as N,H as z,R as j,X as T}from"./index-BZxHr1FI.js";import{_ as w}from"./format-price.BrXrBVy6.js";import{T as C,a as S}from"./tig-layout.DTz8E-sj.js";import{g as R,b as M,a as B}from"./coupon.PECFoAaQ.js";import"./currency.Dn5A4d7X.js";const E=e({},[["render",function(e,n){const i=c;return a(),t(i,{class:"tag"},{default:s(()=>[l(e.$slots,"default",{},()=>[o(u(e.$t("已过期")),1)],!0)]),_:3})}],["__scopeId","data-v-659b4d16"]]),G=e(n({__name:"index",setup(e){const{t:l}=i(),n=d("优惠券"),G=p({page:1,size:10}),J=d(1),U=d(0),F=d([]),H=d(!0),K=async()=>{_({title:l("加载中")});try{let e={};e=1==J.value?await R(G):await M(G),F.value=[...F.value,...e.records],U.value=e.total}catch(e){console.error(e)}finally{m(),H.value=!1}},L=(e,t,a)=>0===t?1===e?"已领取":a>0?"再次领取":l("马上领"):0===e?"马上领":a>=t?"已领取":"再次领取";return r(e=>{e&&(e.type&&(J.value=e.type,2==e.type&&(n.value="我的优惠券")),e.shopId&&(G.shopId=e.shopId,n.value="店铺优惠券"))}),f(()=>{G.page=1,F.value=[],K()}),y(()=>{G.page<Math.ceil(U.value/G.size)&&(G.page++,K())}),(e,i)=>{const d=c,p=h(g("format-price"),w),r=h(g("tig-button"),S),f=I,y=h(g("tig-layout"),C);return a(),t(y,{title:n.value},{default:s(()=>[F.value&&F.value.length?(a(),t(d,{key:0,class:"tmcscoupon-list"},{default:s(()=>[1==J.value?(a(),t(d,{key:0,class:"coupon-box"},{default:s(()=>[(a(!0),k(x,null,b(F.value,(c,n)=>(a(),t(d,{key:n,class:"coupon-item"},{default:s(()=>[$(d,{class:"left"},{default:s(()=>[$(d,{class:"col-1"},{default:s(()=>[$(d,{class:"title line2"},{default:s(()=>[o(u(c.couponName),1)]),_:2},1024)]),_:2},1024),c.couponDesc?(a(),t(d,{key:0,class:"col-2"},{default:s(()=>[o(u(c.couponDesc),1)]),_:2},1024)):v("",!0),1===c.sendType?(a(),t(d,{key:1,class:"col-3"},{default:s(()=>[o(u(e.$t("有效期"))+"："+u(c.useEndDate),1)]),_:2},1024)):v("",!0),0===c.sendType&&c.delayDay>0?(a(),t(d,{key:2,class:"col-3"},{default:s(()=>[o(u(`领券${c.delayDay}天后生效，有效期${c.useDay}天`),1)]),_:2},1024)):v("",!0),0===c.sendType&&0===c.delayDay?(a(),t(d,{key:3,class:"col-3"},{default:s(()=>[o(u(`领券当日起${c.useDay}天内可用`),1)]),_:2},1024)):v("",!0)]),_:2},1024),$(d,{class:"right"},{default:s(()=>[$(d,{class:"right-1"},{default:s(()=>[2===c.couponType?(a(),k(x,{key:0},[$(d,{class:"zhekou"},{default:s(()=>[o(u(c.couponDiscount),1)]),_:2},1024),$(d,{class:"zhe"},{default:s(()=>[o(u(e.$t("折")),1)]),_:1})],64)):(a(),t(p,{key:1,"show-text":!1,"currency-style":{"justify-content":"flex-end",fontSize:"24rpx","padding-bottom":"8rpx"},"is-bottom":!1,"font-style":{fontSize:"48rpx"},"price-data":c.couponMoney},null,8,["price-data"]))]),_:2},1024),$(d,{class:"right-2"},{default:s(()=>[$(d,null,{default:s(()=>[$(r,{"custom-style":{height:"55rpx"},"plain-main-color":"",disabled:"已领取"===L(c.isReceive,c.limitNum,c.receiveNum),onClick:e=>(async e=>{if(_({title:l("加载中")}),"已领取"!==L(e.isReceive,e.limitNum,e.receiveNum))try{await B({couponId:e.couponId}),j({title:l("领取成功"),duration:1500}),setTimeout(()=>{G.page=1,F.value=[],K()},1e3)}catch(t){console.error(t),j({title:t.message,icon:"none",duration:1500})}finally{m()}else j({title:l("已领取"),icon:"none",duration:1500})})(c)},{default:s(()=>[o(u(e.$t(L(c.isReceive,c.limitNum,c.receiveNum))),1)]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024),$(d,{class:"dotted-line"})]),_:2},1024))),128))]),_:1})):v("",!0),2==J.value?(a(),t(d,{key:1,class:"coupon-box"},{default:s(()=>[(a(!0),k(x,null,b(F.value,(l,c)=>(a(),t(d,{key:c,class:D([{grayScaleDiv:1!=l.status&&2!=l.status&&3!=l.status,pastDue:5===l.status,haveBeenUsed:4===l.status,comingIntoEffect:3===l.status},"coupon-item"])},{default:s(()=>[1!=l.status&&2!=l.status&&3!=l.status?(a(),t(d,{key:0,class:"tag-box"},{default:s(()=>[5===l.status?(a(),t(E,{key:0})):(a(),t(E,{key:1},{default:s(()=>[o(u(3===l.status?e.$t("即将生效"):e.$t("已使用")),1)]),_:2},1024))]),_:2},1024)):v("",!0),$(d,{class:"left"},{default:s(()=>[$(d,{class:"col-1"},{default:s(()=>[$(d,{class:"title line2"},{default:s(()=>[o(u(l.couponName),1)]),_:2},1024)]),_:2},1024),l.couponDesc?(a(),t(d,{key:0,class:"col-2"},{default:s(()=>[o(u(l.couponDesc),1)]),_:2},1024)):v("",!0),$(d,{class:"col-3"},{default:s(()=>[o(u(e.$t("有效期"))+"："+u(l.endDate),1)]),_:2},1024)]),_:2},1024),$(d,{class:"right"},{default:s(()=>[$(d,{class:"right-1"},{default:s(()=>[2===l.couponType?(a(),k(x,{key:0},[$(d,{class:"zhekou"},{default:s(()=>[o(u(l.couponDiscount),1)]),_:2},1024),$(d,{class:"zhe"},{default:s(()=>[o(u(e.$t("折")),1)]),_:1})],64)):(a(),t(p,{key:1,"show-text":!1,"currency-style":{"justify-content":"flex-end",fontSize:"24rpx","padding-bottom":"8rpx"},"is-bottom":!1,"font-style":{fontSize:"48rpx"},"price-data":l.couponMoney},null,8,["price-data"]))]),_:2},1024),$(d,{class:"right-2"},{default:s(()=>[$(d,null,{default:s(()=>[1===l.status||2===l.status?(a(),t(r,{key:0,"custom-style":{height:"55rpx"},onClick:e=>(e=>{const t={couponId:e.couponId,couponName:e.couponName};T({url:"/pages/search/result?couponInfo="+encodeURIComponent(JSON.stringify(t))})})(l)},{default:s(()=>[o(u(e.$t("立即使用")),1)]),_:2},1032,["onClick"])):v("",!0),3===l.status?(a(),t(r,{key:1,disabled:!0,"custom-style":{height:"55rpx"}},{default:s(()=>[o(u(e.$t("即将生效")),1)]),_:1})):v("",!0),4===l.status?(a(),t(r,{key:2,disabled:!0,"custom-style":{height:"55rpx"}},{default:s(()=>[o(u(e.$t("已使用")),1)]),_:1})):v("",!0),5===l.status?(a(),t(r,{key:3,disabled:!0,"custom-style":{height:"55rpx"}},{default:s(()=>[o(u(e.$t("已过期")),1)]),_:1})):v("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024),$(d,{class:"dotted-line"})]),_:2},1032,["class"]))),128))]),_:1})):v("",!0)]),_:1})):v("",!0),H.value||0!==U.value?v("",!0):(a(),t(d,{key:1,class:"empty-box"},{default:s(()=>[$(d,{class:"pictrue"},{default:s(()=>[$(f,{"lazy-load":"",src:N(z)("common/data_empty.png")},null,8,["src"])]),_:1}),$(d,{class:"txt"},{default:s(()=>[o(u(e.$t("暂无优惠券！")),1)]),_:1})]),_:1}))]),_:1},8,["title"])}}}),[["__scopeId","data-v-8bf543a2"]]);export{G as default};

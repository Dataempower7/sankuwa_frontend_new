import{d as e,r as a,o as l,c as t,a as s,i as o,w as r,b as u,e as i,f as d,g as n,h as c,t as p,j as v,u as m,_ as y,k as g,l as _,m as f,n as k,p as j,q as x,s as b,v as I,x as T,y as w,z as h,A as U,B as M,C as $,D as z,E as C,F as L,G as F,H as G,I as S,J as E,K as H}from"./index-BZxHr1FI.js";import{_ as J}from"./tig-back-top.vue_vue_type_script_setup_true_lang.YtcOxsPs.js";import{u as K,T as N}from"./tig-layout.DTz8E-sj.js";import{g as R,a as V,b as W}from"./home.CvZhmv3n.js";import{u as q,m as A}from"./index.DW-rifyO.js";import{m as B}from"./masonry.B_l69Lra.js";import"./tig-image.CzXKqALH.js";import"./index.D3BfwkNA.js";import"./format-price.BrXrBVy6.js";import"./currency.Dn5A4d7X.js";import"./tig-fixed-placeholder.BDsbIjoZ.js";import"./tig-countdown.vue_vue_type_script_setup_true_lang.GPPLpHfs.js";import"./specification.C71VpZ8P.js";import"./uni-icons.DMMn2oBg.js";import"./uni-number-box.DKxM8QIH.js";import"./product.BH5dMQls.js";import"./tig-lazy-image.BPOhG_XX.js";import"./activityCard.DE1HAQr9.js";import"./dayjs.min.BETqfnlQ.js";const D=y(e({__name:"index",props:{adType:{},adUrl:{},duration:{},redirectType:{},redirectUrl:{}},emits:["close"],setup(e,{emit:y}){const g=e,_=a(!0),f=a(!1),k=a(Number(g.duration)||3);let j=null;const x=y,b=()=>{_.value=!1,clearInterval(j),x("close")},I=()=>{"1"==g.redirectType&&(v({url:m(g.redirectUrl)||"/pages/index/index"}),clearInterval(j),x("close"))},T=()=>{f.value=!0,j=setInterval(()=>{k.value--,k.value<=0&&b()},1e3)};return l(()=>{j&&clearInterval(j)}),(e,a)=>{const l=d,v=n,m=o;return _.value?(u(),t(m,{key:0,class:"splash-ad"},{default:r(()=>[i(m,{onClick:I},{default:r(()=>["image"===e.adType?(u(),t(l,{key:0,src:e.adUrl,class:"ad-img",mode:"aspectFill",onLoad:T},null,8,["src"])):"video"===e.adType?(u(),t(v,{key:1,src:e.adUrl,class:"ad-video",autoplay:!0,controls:!1,muted:!0,loop:!0,onEnded:b,onLoadedmetadata:T},null,8,["src"])):s("",!0)]),_:1}),f.value?(u(),t(m,{key:0,class:"close-btn",onClick:b},{default:r(()=>[c(p(k.value)+" 跳过",1)]),_:1})):s("",!0)]),_:1})):s("",!0)}}}),[["__scopeId","data-v-26949653"]]);const O=y({},[["render",function(e,a){const l=g,s=o;return u(),t(s,null,{default:r(()=>[i(s,{class:"preview-box"},{default:r(()=>[i(s,null,{default:r(()=>[c(p(e.$t("预览"))+"：  ",1),i(l,null,{default:r(()=>[c(p(e.$t("移动端")),1)]),_:1})]),_:1})]),_:1}),i(s,{class:"placeholder"})]),_:1})}],["__scopeId","data-v-7a64340e"]]),P=y(e({__name:"index",setup(e){const{scrollTop:l}=K(z),n=_(),c=a("image"),p=a(""),v=a(0),m=a(!1),y=a(""),g=a(""),P=a(0),Q=a(!1),X=a([]),Y=a({}),Z=a(0),ee=a(1),ae=a(!1),le=a(!0),te=a([]),se=f(()=>{var e,a,l,t;return{"background-color":`${null==(e=n.pageModules)?void 0:e.backgroundColor}`,"background-image":`url("${null==(a=n.pageModules.backgroundImage)?void 0:a.picUrl}")`,"background-size":`${oe(null==(l=n.pageModules)?void 0:l.backgroundSize)}`,"background-repeat":`${re(null==(t=null==n?void 0:n.pageModules)?void 0:t.backgroundRepeat)}`}}),oe=e=>({1:"100% auto",2:"auto 100%",3:"100% 100%"}[e]),re=e=>({1:"no-repeat",2:"repeat",3:"repeat-x",4:"repeat-y"}[e]),ue=e=>{Z.value=e,0!==Z.value&&(ee.value=1,ae.value=!1,te.value=[],ie())},ie=async()=>{le.value=!0;try{const e=await R({categoryId:Z.value,page:ee.value,size:10});e.records&&e.records.length>0?(te.value=[...te.value,...e.records],ae.value=!1):ae.value=!0}catch(e){console.error(e)}finally{le.value=!1}},de=async()=>{Q.value=!0;try{const e=await V(n.previewId);X.value=e.moduleList,Y.value=e.pageModule,n.pageModules=e.pageModule,P.value=1,M()}catch(e){console.error(e)}finally{Q.value=!1}},ne=()=>{m.value=!1};k(async e=>{e&&e.previewId&&(n.previewId=e.previewId),ce.reset(),await(async()=>{try{const e=await W();if(!e)return;m.value=1==e.state,c.value=0==e.materialType?"image":"video",p.value=0==e.materialType?e.materialImg:e.materialVideo[0].videoUrl,y.value=String(e.redirectType),g.value=e.redirectUrl,v.value=e.maxWaitTime}catch(e){console.error("获取开屏广告失败:",e)}})(),de()}),j(()=>{ce.reset()});const ce=q();return x(()=>{Z.value=0,ce.reset(),de()}),b(()=>{Z.value>0&&!Q.value&&!ae.value&&(ee.value++,ie())}),I(()=>{l.value>0&&setTimeout(()=>{T({scrollTop:l.value,duration:0})},20),w()}),h(e=>({title:n.baseInfo.shopTitle})),U(()=>({title:n.baseInfo.shopTitle})),(e,a)=>{const _=d,f=o,k=$(L("up-empty"),C),j=$(L("tig-back-top"),J),x=$(L("tig-layout"),N);return m.value?(u(),t(D,{key:0,"ad-type":c.value,"ad-url":p.value,duration:v.value,"redirect-type":y.value,"redirect-url":g.value,onClose:ne},null,8,["ad-type","ad-url","duration","redirect-type","redirect-url"])):(u(),t(x,{key:1},{default:r(()=>[F(n).previewId>0?(u(),t(O,{key:0})):s("",!0),Q.value?(u(),t(f,{key:1,class:"index_empty"},{default:r(()=>[i(_,{"lazy-load":"",src:F(G)("common/index_empty.png"),mode:"widthFix"},null,8,["src"])]),_:1})):(u(),t(f,{key:2,class:"index"},{default:r(()=>[i(f,{class:"decorate-page-window",style:S({...se.value})},{default:r(()=>[i(A,{modules:X.value,"page-modles":Y.value,"scroll-top":F(l),onLoadGoodsList:ue},null,8,["modules","page-modles","scroll-top"]),Z.value>0?(u(),E(H,{key:0},[te.value.length>0?(u(),t(B,{key:0,"commodity-list":te.value},null,8,["commodity-list"])):s("",!0),le.value||0!==te.value.length?s("",!0):(u(),t(f,{key:1,class:"empty-box"},{default:r(()=>[i(k,{icon:F(G)("salesman/no_order.png"),text:e.$t("暂无数据")},null,8,["icon","text"])]),_:1}))],64)):s("",!0)]),_:1},8,["style"])]),_:1})),i(j,{"scroll-top":F(l)},null,8,["scroll-top"])]),_:1}))}}}),[["__scopeId","data-v-06a93039"]]);export{P as default};

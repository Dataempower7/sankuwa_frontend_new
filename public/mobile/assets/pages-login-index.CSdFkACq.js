import{d as e,K as l,j as a,ay as t,a3 as o,r as s,k as u,B as i,E as n,I as c,o as d,g as r,w as p,i as v,f,t as _,a as g,c as h,J as k,F as y,M as m,aj as x,X as b,a4 as w,h as C,N as T,S as $,Q as U,az as E,L as A,R as I,ag as R,n as L,_ as O,a5 as S,aA as D,O as M,b as V,G as j,P as F,aB as q,aC as z,l as P,s as N,ad as W}from"./index-DDAlCzEE.js";import{_ as B}from"./tig-mobile-areacode.D2lD97W7.js";import{a as G,e as X,_ as J,d as K}from"./tig-layout.Dp_86RM-.js";import{V as Q,a as Y}from"./index.Bw-iif0R.js";var H={};const Z=O(e({__name:"baseLogin",props:{loginType:{},loginTypeModifiers:{}},emits:["update:loginType"],setup(e){const{t:O}=l(),S=a(),D=t(),M=o(e,"loginType"),V=s(""),j=s(""),F=s(H.VITE_DEFAULT_USER_NAME||""),q=s(H.VITE_DEFAULT_USER_PASSWORD||""),z=s(!1),P=s(""),N=s(!1),W=s(),K=s("86"),Z=u(()=>"password"===M.value?!F.value||!q.value:!V.value||!j.value||!P.value),ee=e=>{e&&$({url:e})},le=e=>{V.value=e.detail.value},ae=e=>{j.value=e.detail.value},te=e=>{U({title:e,duration:1500,icon:"none"})},oe=()=>{if(!z.value)return U({title:O("请先同意用户协议"),duration:1500,icon:"none"});ue()},se=()=>{M.value="mobile"===M.value?"password":"mobile",F.value=H.VITE_DEFAULT_USER_NAME||"",q.value=H.VITE_DEFAULT_USER_PASSWORD||"",V.value="",j.value="",P.value="",z.value=!1},ue=async()=>{try{N.value=!0;const e={loginType:M.value,username:F.value,password:q.value,mobile:"",mobileCode:"",verifyToken:P.value};"mobile"===M.value&&(e.mobile=S.isOpenMobileAreaCode?K.value+V.value:V.value,e.mobileCode=j.value);const l=await E(e);D.setToken(l.token),D.getUserInfo(),U({title:O("登录成功"),duration:1e3});const a=A("URL");setTimeout(()=>{a?$({url:a,success:()=>{I("URL")}}):R({url:"/pages/index/index"})},800)}catch(e){1002==e.code&&W.value?W.value.show():e.code>0&&(U({title:e.message,duration:1500,icon:"none"}),j.value="")}finally{N.value=!1}},ie=e=>{P.value=e.verifyToken,ue()},ne=s("password"),ce=()=>{ne.value="password"===ne.value?"text":"password"},de=e=>{F.value=e.detail.value},re=e=>{q.value=e.detail.value},pe=()=>{L({url:"/pages/reset/index"})};return(e,l)=>{const a=v,t=i(n("tig-mobile-areacode"),B),o=m,s=i(n("tig-button"),G),u=w,$=C,U=i(n("tig-checkbox"),X),E=i(n("tig-layout"),J);return d(),c(k,null,[r(E,{title:"登录"},{default:p(()=>[r(a,{class:"login-box"},{default:p(()=>[r(a,{class:"wechat-login-warp"},{default:p(()=>[r(a,{class:"plr-40"},{default:p(()=>[r(a,{class:"h1_tit"},{default:p(()=>[f(_(e.$t("mobile"===M.value?"手机登录":"账号登录")),1)]),_:1}),r(a,{class:"form-box"},{default:p(()=>[r(a,{class:"form"},{default:p(()=>["mobile"===M.value?(d(),c(k,{key:0},[r(a,{class:"item"},{default:p(()=>[r(a,{class:"text mobileareacode-box"},{default:p(()=>[y(S).isOpenMobileAreaCode?(d(),h(t,{key:0,modelValue:K.value,"onUpdate:modelValue":l[0]||(l[0]=e=>K.value=e)},null,8,["modelValue"])):g("",!0),r(o,{type:"text",value:V.value,placeholder:e.$t("请输入手机号"),"placeholder-class":"placeholder",class:"mobile-text","adjust-position":!1,onInput:le},null,8,["value","placeholder"])]),_:1})]),_:1}),r(a,{class:"item mobile_code_text"},{default:p(()=>[r(a,{style:{width:"68%","margin-right":"10rpx"}},{default:p(()=>[r(o,{type:"text",placeholder:e.$t("手机短信验证码"),"placeholder-class":"placeholder",value:j.value,name:"mobile_code","adjust-position":!1,class:"text",onInput:ae},null,8,["placeholder","value"])]),_:1}),r(Q,{"is-checked":z.value,"onUpdate:isChecked":l[1]||(l[1]=e=>z.value=e),"verify-token-data":P.value,"onUpdate:verifyTokenData":l[2]||(l[2]=e=>P.value=e),style:{height:"65rpx"},mobile:y(S).isOpenMobileAreaCode?K.value+V.value:V.value,"request-api":y(x),onMobileErrorCallback:te},null,8,["is-checked","verify-token-data","mobile","request-api"])]),_:1})],64)):g("",!0),"password"===M.value?(d(),c(k,{key:1},[r(a,{class:"item"},{default:p(()=>[r(o,{type:"text",placeholder:e.$t(1===y(S).openEmailRegister?"用户名/手机/邮箱":"用户名/手机号"),"placeholder-class":"placeholder",class:"text username-text",value:F.value,"adjust-position":!1,onInput:de},null,8,["placeholder","value"])]),_:1}),"password"==ne.value?(d(),h(a,{key:0,class:"item"},{default:p(()=>[r(o,{type:"password",placeholder:e.$t("请输入密码"),"placeholder-class":"placeholder",class:"text password-text",value:q.value,"adjust-position":!1,onInput:re},null,8,["placeholder","value"]),r(a,{class:"password_show_hide iconfont icon-yincang",onClick:ce})]),_:1})):g("",!0),"text"==ne.value?(d(),h(a,{key:1,class:"item"},{default:p(()=>[r(o,{type:"text",placeholder:e.$t("请输入密码"),"placeholder-class":"placeholder",class:"text password-text",value:q.value,"adjust-position":!1,onInput:re},null,8,["placeholder","value"]),r(a,{class:"password_show_hide iconfont icon-xianshi",onClick:ce})]),_:1})):g("",!0)],64)):g("",!0),r(a,{class:"btn2-css3"},{default:p(()=>[r(s,{"loading-text":e.$t("登录中"),loading:N.value,disabled:Z.value,onClick:oe},{default:p(()=>[f(_(e.$t("确 认")),1)]),_:1},8,["loading-text","loading","disabled"])]),_:1}),r(a,{class:b(["desc-box",{flex:"password"===M.value}])},{default:p(()=>["password"===M.value?(d(),h(a,{key:0,class:"",onClick:pe},{default:p(()=>[f(_(e.$t("忘记密码"))+"?",1)]),_:1})):g("",!0)]),_:1},8,["class"]),0===y(S).shopRegClosed?(d(),h(a,{key:2,class:"register"},{default:p(()=>[f(_(e.$t("没有账号"))+"？ ",1),r(u,{"open-type":"redirect",url:"/pages/register/index",class:"special-color"},{default:p(()=>[f(_(e.$t("立即注册")),1)]),_:1})]),_:1})):g("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),r(a,{class:"btns-box"},{default:p(()=>[r(a,{class:"quick-login"},{default:p(()=>[r(a,{class:"login-dtit"},{default:p(()=>[r($,{class:"tit"},{default:p(()=>[f(_(e.$t("其他登录方式")),1)]),_:1}),r($,{class:"line1 line"}),r($,{class:"line2 line"})]),_:1}),r(a,{class:"quick-type-box"},{default:p(()=>["password"===M.value?(d(),h(a,{key:0,class:"quick-type",onClick:se},{default:p(()=>[r(a,{class:"go-link icon-mobile"}),r(a,{class:"text"},{default:p(()=>[f(_(e.$t("手机号登录")),1)]),_:1})]),_:1})):g("",!0),"mobile"===M.value?(d(),h(a,{key:1,class:"quick-type",onClick:se},{default:p(()=>[r(a,{class:"go-link icon-userlogin"}),r(a,{class:"text"},{default:p(()=>[f(_(e.$t("账号登入")),1)]),_:1})]),_:1})):g("",!0)]),_:1})]),_:1}),r(a,{class:"rule-text",onClick:l[6]||(l[6]=e=>z.value=!z.value)},{default:p(()=>[r(U,{checked:z.value,"onUpdate:checked":l[3]||(l[3]=e=>z.value=e)},null,8,["checked"]),r(a,{class:"rule-xieyi"},{default:p(()=>[r($,null,{default:p(()=>[f(_(e.$t("我已阅读并同意")),1)]),_:1}),r($,{class:"special-color",onClick:l[4]||(l[4]=T(e=>ee("/pages/login/mallAgreement?articleSn=fwxy"),["stop"]))},{default:p(()=>[f(" 《"+_(e.$t("服务协议"))+"》 ",1)]),_:1}),r($,null,{default:p(()=>[f(_(e.$t("和")),1)]),_:1}),r($,{class:"special-color",onClick:l[5]||(l[5]=T(e=>ee("/pages/login/mallAgreement?articleSn=ysxy"),["stop"]))},{default:p(()=>[f(" 《"+_(e.$t("隐私协议"))+"》 ",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),r(Y,{ref_key:"verifyRef",ref:W,mode:"pop","captcha-type":"blockPuzzle","img-size":{width:"310px",height:"155px"},onOkCallback:ie},null,512)],64)}}}),[["__scopeId","data-v-499a79a0"]]);var ee={};const le=O(e({__name:"overseasLogin",props:S({oauthCallbackData:{type:Object}},{loginType:{},loginTypeModifiers:{}}),emits:["update:loginType"],setup(e){const w=e,{t:R}=l(),L=a(),O=t(),S=o(e,"loginType"),P=s("86"),N=s(""),W=s(""),H=s(ee.VITE_DEFAULT_USER_NAME||""),Z=s(ee.VITE_DEFAULT_USER_PASSWORD||""),le=s(!1),ae=s(""),te=s(!1),oe=s(),se=[{name:R("账号登录"),value:"password"},{name:R("验证码登录"),value:"mobile"}],ue=u(()=>"password"===S.value?!H.value||!Z.value:!N.value||!W.value||!ae.value),ie=s("password"),ne=()=>{ie.value="password"===ie.value?"text":"password"},ce=e=>{H.value=e.detail.value},de=e=>{Z.value=e.detail.value},re=e=>{N.value=e.detail.value},pe=e=>{W.value=e.detail.value},ve=e=>{U({title:e,duration:1500,icon:"none"})},fe=()=>{if(!le.value)return U({title:R("请先同意用户协议"),duration:1500,icon:"none"});ge()},_e=()=>{const e=A("URL");setTimeout(()=>{$({url:e||"/pages/index/index",mode:"redirectTo",success:()=>{I("URL")}})},800)},ge=async()=>{try{te.value=!0;const e={loginType:S.value,username:H.value,password:Z.value,mobile:"",mobileCode:"",verifyToken:ae.value};"mobile"===S.value&&(e.mobile=L.isOpenMobileAreaCode?P.value+N.value:N.value,e.mobileCode=W.value);const l=await E(e);O.setToken(l.token),O.getUserInfo(),U({title:R("登录成功"),duration:1e3}),_e()}catch(e){1002==e.code&&oe.value?oe.value.show():e.code>0&&(U({title:e.message,duration:1500,icon:"none"}),W.value="")}finally{te.value=!1}},he=e=>{ae.value=e.verifyToken,ge()},ke=e=>{e&&$({url:e})},ye=async e=>{F("oauthPath",e);try{const l=await q(e,window.location.href.split("?")[0]);window.open(l)}catch(l){console.error(l)}};return w.oauthCallbackData&&w.oauthCallbackData.code&&(async()=>{try{const e=await z(A("oauthPath"),window.location.href.split("?")[0],w.oauthCallbackData);O.setToken(e.token),O.getUserInfo(),U({title:R("授权成功"),duration:1e3}),_e()}catch(e){console.error(e),U({title:R("授权失败"),duration:1500,icon:"none"})}})(),(e,l)=>{const a=i(n("tig-navbar"),K),t=v,o=i(n("tig-mobile-areacode"),B),s=m,u=i(n("tig-button"),G),w=C,U=i(n("up-divider"),D),E=V,A=i(n("tig-checkbox"),X),I=i(n("tig-layout"),J);return d(),h(I,null,{default:p(()=>[r(a),r(t,{class:"login-page"},{default:p(()=>[r(t,{class:"tab-row"},{default:p(()=>[(d(),c(k,null,M(se,e=>r(t,{key:e.value,class:b({active:S.value===e.value}),onClick:l=>{return a=e.value,void(S.value=a);var a}},{default:p(()=>[f(_(e.name),1)]),_:2},1032,["class","onClick"])),64))]),_:1}),r(t,{class:"form-box"},{default:p(()=>["mobile"===S.value?(d(),c(k,{key:0},[r(t,{class:"item"},{default:p(()=>[y(L).isOpenMobileAreaCode?(d(),h(o,{key:0,modelValue:P.value,"onUpdate:modelValue":l[0]||(l[0]=e=>P.value=e),style:{width:"90rpx"}},null,8,["modelValue"])):g("",!0),r(s,{value:N.value,type:"text",placeholder:e.$t("请输入手机号"),"placeholder-class":"placeholder",class:"mobile-text",onInput:re},null,8,["value","placeholder"])]),_:1}),r(t,{class:"item"},{default:p(()=>[r(t,{style:{flex:"1","margin-right":"10rpx"}},{default:p(()=>[r(s,{type:"text",placeholder:e.$t("手机短信验证码"),"placeholder-class":"placeholder",name:"mobile_code",class:"text",value:W.value,onInput:pe},null,8,["placeholder","value"])]),_:1}),r(Q,{"is-checked":le.value,"onUpdate:isChecked":l[1]||(l[1]=e=>le.value=e),"verify-token-data":ae.value,"onUpdate:verifyTokenData":l[2]||(l[2]=e=>ae.value=e),mobile:y(L).isOpenMobileAreaCode?P.value+N.value:N.value,"btn-type":"text","request-api":y(x),onMobileErrorCallback:ve},null,8,["is-checked","verify-token-data","mobile","request-api"])]),_:1})],64)):g("",!0),"password"===S.value?(d(),c(k,{key:1},[r(t,{class:"item"},{default:p(()=>[r(s,{value:H.value,type:"text",placeholder:e.$t(1===y(L).openEmailRegister?"用户名/手机/邮箱":"用户名/手机号"),"placeholder-class":"placeholder",class:"text",onInput:ce},null,8,["value","placeholder"])]),_:1}),"password"==ie.value?(d(),h(t,{key:0,class:"item"},{default:p(()=>[r(s,{type:"password",placeholder:e.$t("请输入密码"),"placeholder-class":"placeholder",class:"text password-text",value:Z.value,onInput:de},null,8,["placeholder","value"]),r(t,{class:"password_show_hide iconfont icon-yincang",onClick:ne})]),_:1})):g("",!0),"text"==ie.value?(d(),h(t,{key:1,class:"item"},{default:p(()=>[r(s,{type:"text",placeholder:e.$t("请输入密码"),"placeholder-class":"placeholder",class:"text password-text",value:Z.value,onInput:de},null,8,["placeholder","value"]),r(t,{class:"password_show_hide iconfont icon-xianshi",onClick:ne})]),_:1})):g("",!0)],64)):g("",!0)]),_:1}),r(t,{class:"btn2-css3"},{default:p(()=>[r(u,{"loading-text":e.$t("登录中"),loading:te.value,disabled:ue.value,size:"normal",type:ue.value?"info":"primary",onClick:fe},{default:p(()=>[f(_(e.$t("登录")),1)]),_:1},8,["loading-text","loading","disabled","type"])]),_:1}),"password"===S.value?(d(),h(t,{key:0,class:"other-row"},{default:p(()=>[r(t,{class:"item",onClick:l[3]||(l[3]=e=>ke("/pages/reset/index"))},{default:p(()=>[f(_(e.$t("忘记密码")),1)]),_:1}),0===y(L).shopRegClosed?(d(),h(t,{key:0,class:"item flex"},{default:p(()=>[f(_(e.$t("新用户")),1),r(w,{class:"special-color",onClick:l[4]||(l[4]=e=>y($)({url:"/pages/register/index"}))},{default:p(()=>[f(_(e.$t("注册")),1)]),_:1})]),_:1})):g("",!0)]),_:1})):g("",!0),"mobile"===S.value?(d(),h(t,{key:1,class:"other-row"},{default:p(()=>[r(t,{class:"tips"},{default:p(()=>[f(_(e.$t("未注册过的账号将自动注册账号")),1)]),_:1})]),_:1})):g("",!0),r(t,{class:"footer-row"},{default:p(()=>[y(L).googleLoginOn||y(L).facebookLoginOn?(d(),c(k,{key:0},[r(U,{text:y(R)("其他登录方式")},null,8,["text"]),r(t,{class:"login-other"},{default:p(()=>[y(L).googleLoginOn?(d(),h(t,{key:0,class:"item",onClick:l[5]||(l[5]=e=>ye("google"))},{default:p(()=>[r(E,{src:y(j)("login/google.png"),class:"icon",mode:"widthFix"},null,8,["src"]),r(t,null,{default:p(()=>[f(_(e.$t("Google登录")),1)]),_:1})]),_:1})):g("",!0),y(L).facebookLoginOn?(d(),h(t,{key:1,class:"item",onClick:l[6]||(l[6]=e=>ye("facebook"))},{default:p(()=>[r(E,{src:y(j)("login/facebook.png"),class:"icon",mode:"widthFix"},null,8,["src"]),r(t,null,{default:p(()=>[f(_(e.$t("Facebook登录")),1)]),_:1})]),_:1})):g("",!0)]),_:1})],64)):g("",!0),r(t,{class:"desc-box"},{default:p(()=>[r(t,{class:"rule-text flex",onClick:l[10]||(l[10]=e=>le.value=!le.value)},{default:p(()=>[r(A,{checked:le.value,"onUpdate:checked":l[7]||(l[7]=e=>le.value=e),"active-color":"#333333"},null,8,["checked"]),r(t,{class:"rule-xieyi"},{default:p(()=>[r(w,null,{default:p(()=>[f(_(e.$t("我已阅读并同意")),1)]),_:1}),r(w,{class:"special-color",onClick:l[8]||(l[8]=T(e=>ke("/pages/login/mallAgreement?articleSn=fwxy"),["stop"]))},{default:p(()=>[f(" 《"+_(e.$t("服务协议"))+"》 ",1)]),_:1}),r(w,null,{default:p(()=>[f(_(e.$t("和")),1)]),_:1}),r(w,{class:"special-color",onClick:l[9]||(l[9]=T(e=>ke("/pages/login/mallAgreement?articleSn=ysxy"),["stop"]))},{default:p(()=>[f(" 《"+_(e.$t("隐私协议"))+"》 ",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),r(Y,{ref_key:"verifyRef",ref:oe,mode:"pop","captcha-type":"blockPuzzle","img-size":{width:"310px",height:"155px"},onOkCallback:he},null,512)]),_:1})}}}),[["__scopeId","data-v-9587b2e0"]]),ae=O(e({__name:"index",setup(e){const l=t(),a=s("password"),o=s({});return P(e=>{e&&(e.loginType&&(a.value=e.loginType),e.url&&F("URL",e.url),e.code&&(o.value=e))}),N(()=>{(A("token")||l.token)&&R({url:"/pages/index/index"})}),(e,l)=>{const t=v;return d(),h(t,null,{default:p(()=>[y(W)()?(d(),h(le,{key:0,"login-type":a.value,"onUpdate:loginType":l[0]||(l[0]=e=>a.value=e),"oauth-callback-data":o.value},null,8,["login-type","oauth-callback-data"])):(d(),h(Z,{key:1,"login-type":a.value,"onUpdate:loginType":l[1]||(l[1]=e=>a.value=e)},null,8,["login-type"]))]),_:1})}}}),[["__scopeId","data-v-7ef620d4"]]);export{ae as default};

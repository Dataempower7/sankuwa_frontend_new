import{d as e,a9 as a,G as l,l as s,L as t,az as o,a5 as u,r as i,m as n,C as d,F as c,J as r,b as p,e as v,w as _,i as f,h as m,t as g,a as y,c as k,K as x,N as h,ak as b,Z as w,a6 as T,k as C,O as $,j as U,R as E,aG as R,M as A,S as I,T as S,X as j,aH as L,_ as M,n as V,Q as D,v as F}from"./index-BZxHr1FI.js";import{_ as O}from"./tig-mobile-areacode.D-ev-Dkx.js";import{a as q,d as z,T as G}from"./tig-layout.DTz8E-sj.js";import{V as N,a as P}from"./index.DfptdAaC.js";var H={};const W=M(e({__name:"baseLogin",props:{loginType:{},loginTypeModifiers:{}},emits:["update:loginType"],setup(e){a(e=>({b5daf112:l(V).windowInfo.windowHeight+"px"}));const{t:M}=t(),V=s(),D=o(),F=u(e,"loginType"),W=i(""),X=i(""),J=i(H.VITE_DEFAULT_USER_NAME||""),K=i(H.VITE_DEFAULT_USER_PASSWORD||""),Q=i(!1),Z=i(""),B=i(!1),Y=i(),ee=i("86"),ae=n(()=>"password"===F.value?!J.value||!K.value:!W.value||!X.value||!Z.value),le=i(""),se=e=>{e&&U({url:e})},te=e=>{W.value=e.detail.value},oe=e=>{X.value=e.detail.value},ue=e=>{E({title:e,duration:1500,icon:"none"})},ie=()=>{if(!Q.value)return E({title:M("请先同意用户协议"),duration:1500,icon:"none"});de()},ne=()=>{F.value="mobile"===F.value?"password":"mobile",J.value=H.VITE_DEFAULT_USER_NAME||"",K.value=H.VITE_DEFAULT_USER_PASSWORD||"",W.value="",X.value="",Z.value="",Q.value=!1},de=async()=>{try{await(async()=>{try{const e=await L();le.value=e}catch(e){console.error("获取CSRF Token失败:",e)}})(),B.value=!0;const e={loginType:F.value,username:J.value,password:K.value,mobile:"",mobileCode:"",verifyToken:Z.value};"mobile"===F.value&&(e.mobile=V.isOpenMobileAreaCode?ee.value+W.value:W.value,e.mobileCode=X.value);const a=await R(e,{"X-CSRF-Token":le.value});D.setToken(a.token),D.getUserInfo(),E({title:M("登录成功"),duration:1e3});const l=A("URL");setTimeout(()=>{l?U({url:l,success:()=>{I("URL")}}):S({url:"/pages/index/index"})},800)}catch(e){1002==e.code&&Y.value?Y.value.show():e.code>0&&(E({title:e.message,duration:1500,icon:"none"}),X.value="")}finally{B.value=!1}},ce=e=>{Z.value=e.verifyToken,de()},re=i("password"),pe=()=>{re.value="password"===re.value?"text":"password"},ve=e=>{J.value=e.detail.value},_e=e=>{K.value=e.detail.value},fe=()=>{j({url:"/pages/reset/index"})};return(e,a)=>{const s=f,t=d(c("tig-mobile-areacode"),O),o=h,u=d(c("tig-button"),q),i=T,n=C,U=d(c("tig-checkbox"),z),E=d(c("tig-layout"),G);return p(),r(x,null,[v(E,{title:"登录"},{default:_(()=>[v(s,{class:"login-box"},{default:_(()=>[v(s,{class:"wechat-login-warp"},{default:_(()=>[v(s,{class:"plr-40"},{default:_(()=>[v(s,{class:"h1_tit"},{default:_(()=>[m(g(e.$t("mobile"===F.value?"手机登录":"账号登录")),1)]),_:1}),v(s,{class:"form-box"},{default:_(()=>[v(s,{class:"form"},{default:_(()=>["mobile"===F.value?(p(),r(x,{key:0},[v(s,{class:"item"},{default:_(()=>[v(s,{class:"text mobileareacode-box"},{default:_(()=>[l(V).isOpenMobileAreaCode?(p(),k(t,{key:0,modelValue:ee.value,"onUpdate:modelValue":a[0]||(a[0]=e=>ee.value=e)},null,8,["modelValue"])):y("",!0),v(o,{type:"text",value:W.value,placeholder:e.$t("请输入手机号"),"placeholder-class":"placeholder",class:"mobile-text","adjust-position":!1,onInput:te},null,8,["value","placeholder"])]),_:1})]),_:1}),v(s,{class:"item mobile_code_text"},{default:_(()=>[v(s,{style:{width:"68%","margin-right":"10rpx"}},{default:_(()=>[v(o,{type:"text",placeholder:e.$t("手机短信验证码"),"placeholder-class":"placeholder",value:X.value,name:"mobile_code","adjust-position":!1,class:"text",onInput:oe},null,8,["placeholder","value"])]),_:1}),v(N,{"is-checked":Q.value,"onUpdate:isChecked":a[1]||(a[1]=e=>Q.value=e),"verify-token-data":Z.value,"onUpdate:verifyTokenData":a[2]||(a[2]=e=>Z.value=e),style:{height:"65rpx"},mobile:l(V).isOpenMobileAreaCode?ee.value+W.value:W.value,"request-api":l(b),onMobileErrorCallback:ue},null,8,["is-checked","verify-token-data","mobile","request-api"])]),_:1})],64)):y("",!0),"password"===F.value?(p(),r(x,{key:1},[v(s,{class:"item"},{default:_(()=>[v(o,{type:"text",placeholder:e.$t(1===l(V).openEmailRegister?"用户名/手机/邮箱":"用户名/手机号"),"placeholder-class":"placeholder",class:"text username-text",value:J.value,"adjust-position":!1,onInput:ve},null,8,["placeholder","value"])]),_:1}),"password"==re.value?(p(),k(s,{key:0,class:"item"},{default:_(()=>[v(o,{type:"password",password:!0,placeholder:e.$t("请输入密码"),"placeholder-class":"placeholder",class:"text password-text",value:K.value,"adjust-position":!1,onInput:_e},null,8,["placeholder","value"]),v(s,{class:"password_show_hide iconfont icon-yincang",onClick:pe})]),_:1})):y("",!0),"text"==re.value?(p(),k(s,{key:1,class:"item"},{default:_(()=>[v(o,{type:"text",placeholder:e.$t("请输入密码"),"placeholder-class":"placeholder",class:"text password-text",value:K.value,"adjust-position":!1,onInput:_e},null,8,["placeholder","value"]),v(s,{class:"password_show_hide iconfont icon-xianshi",onClick:pe})]),_:1})):y("",!0)],64)):y("",!0),v(s,{class:"btn2-css3"},{default:_(()=>[v(u,{"loading-text":e.$t("登录中"),loading:B.value,disabled:ae.value,onClick:ie},{default:_(()=>[m(g(e.$t("确 认")),1)]),_:1},8,["loading-text","loading","disabled"])]),_:1}),v(s,{class:w(["desc-box",{flex:"password"===F.value}])},{default:_(()=>["password"===F.value?(p(),k(s,{key:0,class:"",onClick:fe},{default:_(()=>[m(g(e.$t("忘记密码"))+"?",1)]),_:1})):y("",!0)]),_:1},8,["class"]),0===l(V).shopRegClosed?(p(),k(s,{key:2,class:"register"},{default:_(()=>[m(g(e.$t("没有账号"))+"？ ",1),v(i,{"open-type":"redirect",url:"/pages/register/index",class:"special-color"},{default:_(()=>[m(g(e.$t("立即注册")),1)]),_:1})]),_:1})):y("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),v(s,{class:"bottom-box"},{default:_(()=>[v(s,{class:"bottom"},{default:_(()=>[v(s,{class:"btns-box"},{default:_(()=>[v(s,{class:"quick-login"},{default:_(()=>[v(s,{class:"login-dtit"},{default:_(()=>[v(n,{class:"tit"},{default:_(()=>[m(g(e.$t("其他登录方式")),1)]),_:1}),v(n,{class:"line1 line"}),v(n,{class:"line2 line"})]),_:1}),v(s,{class:"quick-type-box"},{default:_(()=>["password"===F.value?(p(),k(s,{key:0,class:"quick-type",onClick:ne},{default:_(()=>[v(s,{class:"go-link icon-mobile"}),v(s,{class:"text"},{default:_(()=>[m(g(e.$t("手机号登录")),1)]),_:1})]),_:1})):y("",!0),"mobile"===F.value?(p(),k(s,{key:1,class:"quick-type",onClick:ne},{default:_(()=>[v(s,{class:"go-link icon-userlogin"}),v(s,{class:"text"},{default:_(()=>[m(g(e.$t("账号登入")),1)]),_:1})]),_:1})):y("",!0)]),_:1})]),_:1}),v(s,{class:"rule-text",onClick:a[6]||(a[6]=e=>Q.value=!Q.value)},{default:_(()=>[v(U,{checked:Q.value,"onUpdate:checked":a[3]||(a[3]=e=>Q.value=e)},null,8,["checked"]),v(s,{class:"rule-xieyi"},{default:_(()=>[v(n,null,{default:_(()=>[m(g(e.$t("我已阅读并同意")),1)]),_:1}),v(n,{class:"special-color",onClick:a[4]||(a[4]=$(e=>se("/pages/login/mallAgreement?articleSn=fwxy"),["stop"]))},{default:_(()=>[m(" 《"+g(e.$t("服务协议"))+"》 ",1)]),_:1}),v(n,null,{default:_(()=>[m(g(e.$t("和")),1)]),_:1}),v(n,{class:"special-color",onClick:a[5]||(a[5]=$(e=>se("/pages/login/mallAgreement?articleSn=ysxy"),["stop"]))},{default:_(()=>[m(" 《"+g(e.$t("隐私协议"))+"》 ",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),v(P,{ref_key:"verifyRef",ref:Y,mode:"pop","captcha-type":"blockPuzzle","img-size":{width:"310px",height:"155px"},onOkCallback:ce},null,512)],64)}}}),[["__scopeId","data-v-8345f116"]]),X=M(e({__name:"index",setup(e){const a=o(),l=i("password"),s=i({});return V(e=>{e&&(e.loginType&&(l.value=e.loginType),e.url&&D("URL",e.url),e.code&&(s.value=e))}),F(()=>{(A("token")||a.token)&&S({url:"/pages/index/index"})}),(e,a)=>{const s=f;return p(),k(s,null,{default:_(()=>[v(W,{"login-type":l.value,"onUpdate:loginType":a[0]||(a[0]=e=>l.value=e)},null,8,["login-type"])]),_:1})}}}),[["__scopeId","data-v-2d64358e"]]);export{X as default};

import{a2 as e,d as a,c as t,o as l,i as o,w as s,g as n,I as u,f as c,t as i,J as d,n as r,_ as p,K as m,r as f,U as y,B as v,E as _,b as h,F as g,G as b,a as k,O as I,X as x,Q as C,k as T,H as $,h as P,N as V,ad as w,j as A,W as N,bE as S,V as U,ao as D,ap as j,bF as B,bG as z,ay as L,s as O,aa as M,S as E,ab as q,aQ as W,R as F,l as R,L as J,P as G}from"./index-DDAlCzEE.js";import{_ as H}from"./format-price.9n-LYbxy.js";import{a as K,c as Q,e as X,_ as Y}from"./tig-layout.Dp_86RM-.js";import{_ as Z}from"./tig-fixed-placeholder.BwC6eLvS.js";import{g as ee}from"./address.BRf_08oi.js";import{_ as ae}from"./tig-image.CxOKkXKh.js";import{a as te}from"./activityCard.A8E8ZyQf.js";import{_ as le}from"./uni-easyinput.naLj-1jX.js";import{_ as oe,a as se}from"./uni-forms.MUFzpXZ0.js";import{u as ne}from"./useCurrency.BJDkABBv.js";import{g as ue,a as ce}from"./invoice.DBXq5n8F.js";import{d as ie}from"./discountInfo.DKO-ewmH.js";import"./uni-icons.piUs7f0e.js";const de=p(a({__name:"addressInfo",props:{data:{type:Object,default:()=>[]}},setup(e){const a=()=>{r({url:"/pages/address/list"})};return(r,p)=>{const m=o;return l(),t(m,{class:"address-info"},{default:s(()=>[n(m,{class:"address-content",onClick:a},{default:s(()=>[n(m,{class:"address-box"},{default:s(()=>[e.data&&Object.keys(e.data).length>0?(l(),u(d,{key:0},[n(m,{class:"user-info"},{default:s(()=>[n(m,{class:"name"},{default:s(()=>[c(i(e.data.consignee+" "+e.data.mobile),1)]),_:1})]),_:1}),n(m,{class:"address"},{default:s(()=>[c(i(e.data.regionName)+" "+i(e.data.address),1)]),_:1})],64)):(l(),t(m,{key:1,class:"user-info"},{default:s(()=>[n(m,{class:"name"},{default:s(()=>[c("请选择收货地址")]),_:1})]),_:1}))]),_:1}),n(m,{class:"iconfont icon-jiantou arrow_ico"})]),_:1})]),_:1})}}}),[["__scopeId","data-v-edff46dc"]]),re=p(a({__name:"paymentMode",props:{availablePaymentType:{},payTypeId:{}},emits:["update:payTypeId","change"],setup(e,{emit:a}){const{t:r}=m(),p=e,T=a,$=f([]),P=f(""),V=()=>{$.value=JSON.parse(JSON.stringify(p.availablePaymentType)),w.value=!0;const e=p.availablePaymentType.findIndex(e=>e.typeId===p.payTypeId);e>=0&&(A.value=e)};y(()=>$,()=>{const e=$.value.filter(e=>e.disabled);e[0]&&e[0].typeId===p.payTypeId&&(T("update:payTypeId",0),A.value=null,P.value=e[0].disabledDesc,C({title:e[0].disabledDesc,duration:1500,icon:"none"}))});const w=f(!1),A=f(null),N=(e,a)=>null!==A.value&&void 0!==A.value&&A.value>=0?A.value===e:a===p.payTypeId,S=()=>{null!==A.value&&A.value>=0?(P.value=$.value[A.value].typeName,T("update:payTypeId",$.value[A.value].typeId),T("change"),w.value=!1):C({title:r("请选择付款方式"),duration:1500,icon:"none"})};return(e,a)=>{const r=o,m=h,f=v(_("tig-button"),K),y=v(_("tig-fixed-placeholder"),Z),C=v(_("tig-popup"),Q);return l(),t(r,null,{default:s(()=>[n(r,{class:"payment"},{default:s(()=>[n(r,{class:"payment-title"},{default:s(()=>[c(i(e.$t("支付方式")),1)]),_:1}),n(r,{class:"payment-content",onClick:V},{default:s(()=>[n(r,{class:"payment-text"},{default:s(()=>[c(i(P.value?P.value:p.availablePaymentType[0].typeName),1)]),_:1}),n(m,{"lazy-load":"",class:"more-ico",src:g(b)("common/more.png")},null,8,["src"])]),_:1})]),_:1}),n(C,{show:w.value,"onUpdate:show":a[0]||(a[0]=e=>w.value=e)},{default:s(()=>[n(r,{class:"payment-popup"},{default:s(()=>[n(r,{class:"popup-title title"},{default:s(()=>[c(i(e.$t("选择支付方式")),1)]),_:1}),n(r,{class:"payment-btn"},{default:s(()=>[(l(!0),u(d,null,I($.value,(e,a)=>(l(),u(d,{key:e.typeId},[e.isShow?(l(),t(r,{key:0,class:x(["payment-btn-item",{active:N(a,e.typeId),disabled:e.disabled}]),onClick:t=>((e,a)=>{a||(A.value=e)})(a,e.disabled)},{default:s(()=>[c(i(null==e?void 0:e.typeName),1)]),_:2},1032,["class","onClick"])):k("",!0)],64))),128))]),_:1}),null!==A.value?(l(),t(r,{key:0,class:"payment-desc"},{default:s(()=>[n(r,{class:"payment-desc-title"},{default:s(()=>{var e;return[c(i(null==(e=$.value[A.value])?void 0:e.typeName),1)]}),_:1}),n(r,{class:"payment-desc-text"},{default:s(()=>{var a;return[c(i("在线支付"===(null==(a=$.value[A.value])?void 0:a.typeName)?e.$t("支持微信即时到账（绝大数银行借记卡及部分银行信用卡）"):e.$t("支持银行和企业账户汇款")),1)]}),_:1})]),_:1})):k("",!0),n(y,{"background-color":"#fff"},{default:s(()=>[n(r,{class:"btn-box"},{default:s(()=>[n(f,{onClick:S},{default:s(()=>[c(i(e.$t("提交")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])]),_:1})}}}),[["__scopeId","data-v-2505edb5"]]),pe=p(a({__name:"storeCard",props:{cartList:{},shippingTypeList:{},shippingType:{}},emits:["update:shippingType","change","changeProductExtra"],setup(e,{emit:a}){const{t:p}=m(),y=e,h=a,b=f(!1),A=f(0),N=T(()=>y.shippingTypeList&&y.shippingTypeList[A.value]&&y.shippingTypeList[A.value][S.value]?y.shippingTypeList[A.value][S.value]:null),S=f(0),U=f(),D=()=>{const e=JSON.parse(JSON.stringify(y.shippingType)),{shippingTypeId:a,shippingTypeName:t}=y.shippingTypeList[A.value][S.value];e[A.value].shopId=A.value,e[A.value].typeId=a,e[A.value].typeName=t,h("update:shippingType",e),h("change"),b.value=!1},j=e=>e.filter(e=>1===e.type||6===e.type),B=(e,a)=>{0!==a&&r({url:e+a})},z=f(!1),L=f({}),O=f([]),M=()=>{h("changeProductExtra",{cartId:L.value.cartId,extraAttrIds:O.value.filter(e=>!!e).join(",")}),z.value=!1};return(e,a)=>{const r=o,m=v(_("tig-image"),ae),f=v(_("format-price"),H),h=P,T=v(_("tig-button"),K),E=v(_("tig-fixed-placeholder"),Z),q=v(_("tig-popup"),Q);return l(),u(d,null,[(l(!0),u(d,null,I(e.cartList,(a,o)=>(l(),t(r,{key:o,class:"store-card"},{default:s(()=>[n(r,{class:"store-card-item"},{default:s(()=>[n(r,{class:"store-card-item-title",onClick:e=>B("/pages/shop/index?shopId=",a.shopId)},{default:s(()=>[0===a.shopId?(l(),t(r,{key:0,class:"store-card-item-label"},{default:s(()=>[c(i(e.$t("自营")),1)]),_:1})):k("",!0),n(r,{class:"store-card-item-name"},{default:s(()=>[c(i(0===a.shopId?e.$t("自营"):a.shopTitle),1)]),_:2},1024)]),_:2},1032,["onClick"]),(l(!0),u(d,null,I(a.carts,(a,o)=>(l(),u(d,{key:o},[n(r,{class:"store-card-item-content"},{default:s(()=>[n(r,{class:"content-item",onClick:e=>B("/pages/product/index?id=",a.productId)},{default:s(()=>[n(r,{class:"store-card-item-content-left"},{default:s(()=>[n(m,{class:"store-card-item-img",src:a.picThumb},null,8,["src"])]),_:2},1024),n(r,{class:"store-card-item-content-right"},{default:s(()=>{return[n(r,{class:"store-card-item-content-right-title line2"},{default:s(()=>[c(i(a.productName),1)]),_:2},1024),a.skuData.length>0?(l(),t(r,{key:0,class:"sku-card"},{default:s(()=>[(l(!0),u(d,null,I(a.skuData,(e,a)=>(l(),t(r,{key:a,class:"sku-item"},{default:s(()=>[c(i(e.value),1)]),_:2},1024))),128))]),_:2},1024)):k("",!0),a.activityInfo&&j(a.activityInfo).length>0?(l(),t(r,{key:1,class:"activity-box"},{default:s(()=>[(l(!0),u(d,null,I(j(a.activityInfo),(e,a)=>(l(),t(te,{key:a,"font-size":"22rpx","activity-info":e,"card-type":"sub"},null,8,["activity-info"]))),128))]),_:2},1024)):k("",!0),n(r,{class:"right-price-box",style:$({marginTop:(e=a,(e.skuData.length>0&&e.activityInfo&&j(e.activityInfo).length>0?0:0!==e.skuData.length||e.activityInfo&&0!==j(e.activityInfo).length?10:55)+"rpx")})},{default:s(()=>[n(r,{class:"store-card-item-content-right-price"},{default:s(()=>[n(f,{"font-style":{fontWeight:"bold"},"decimals-style":{fontSize:"20rpx",fontWeight:"bold"},"currency-style":{fontSize:"20rpx",fontWeight:"bold"},"price-data":a.price},null,8,["price-data"]),a.originPrice&&a.originPrice!==a.price?(l(),t(f,{key:0,"font-style":{fontWeight:"400",textDecoration:"line-through",fontSize:"19rpx",color:"#969799",position:"relative",bottom:"-2px",left:"5px"},"is-bottom":!1,"price-data":a.originPrice},null,8,["price-data"])):k("",!0)]),_:2},1024),n(r,{class:"store-card-item-content-right-num"},{default:s(()=>[c(" x"+i(a.quantity),1)]),_:2},1024)]),_:2},1032,["style"])];var e}),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024),a.extraSkuAllData&&a.extraSkuAllData.extra&&a.extraSkuAllData.extra.length?(l(),t(r,{key:0,class:"attr-box",onClick:e=>(e=>{L.value=e,O.value=e.extraSkuData.length?e.extraSkuData.map(e=>e.attributesId):[],z.value=!0})(a)},{default:s(()=>[n(r,{class:"attr-label"},{default:s(()=>[c("附加")]),_:1}),a.extraSkuData&&a.extraSkuData.length?(l(),t(r,{key:0,class:"attr-list"},{default:s(()=>[(l(!0),u(d,null,I(a.extraSkuData,(e,o)=>(l(),t(r,{key:o,class:"attr-item"},{default:s(()=>[n(r,{class:"item-content"},{default:s(()=>[n(h,{class:"line1 content-text"},{default:s(()=>[c(i(e.attrValue),1)]),_:2},1024),n(r,{class:"right"},{default:s(()=>[n(f,{class:"price","price-data":e.attrPrice},null,8,["price-data"]),n(r,{class:"num"},{default:s(()=>[c("x"+i(a.quantity),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)):(l(),t(r,{key:1},{default:s(()=>[c(i(e.$t("可选附加规格")),1)]),_:1})),n(h,{class:"iconfont-h5 icon-xiajiantou1-copy"})]),_:2},1032,["onClick"])):k("",!0)],64))),128)),a.gift&&a.gift.length>0?(l(),t(r,{key:0,class:"gift-box"},{default:s(()=>[n(r,{class:"gift-title"},{default:s(()=>[c(i(e.$t("赠品")),1)]),_:1}),n(r,{class:"gift-content"},{default:s(()=>[(l(!0),u(d,null,I(a.gift,(e,a)=>(l(),t(r,{key:a,class:"gift-content-item"},{default:s(()=>[n(r,{class:"gift-item-left"},{default:s(()=>[n(m,{src:e.picThumb,class:"gift-img"},null,8,["src"])]),_:2},1024),n(r,{class:"gift-item-right"},{default:s(()=>[n(r,{class:"gift-item-name line1"},{default:s(()=>[c(i(e.productName),1)]),_:2},1024),e.skuData.length>0?(l(),t(r,{key:0,class:"sku-card"},{default:s(()=>[(l(!0),u(d,null,I(e.skuData,(e,a)=>(l(),t(r,{key:a,class:"sku-item"},{default:s(()=>[c(i(e.value),1)]),_:2},1024))),128))]),_:2},1024)):k("",!0),n(r,{class:"gift-item-num"},{default:s(()=>[c("x"+i(e.num),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)):k("",!0),n(r,{class:"payment"},{default:s(()=>[n(r,{class:"payment-title"},{default:s(()=>[c(i(e.$t("配送方式")),1)]),_:1}),n(r,{class:"payment-content",onClick:e=>{return t=a.shopId,1===a.noShipping?C({title:p("无需配送"),duration:1500,icon:"none"}):y.shippingTypeList[t]&&0!==y.shippingTypeList[t].length?void 0:C({title:p("该收货地址不支持配送"),duration:1500,icon:"none"});var t}},{default:s(()=>[n(r,{class:"payment-text"},{default:s(()=>{return[c(i((e=a.shopId,t=a.noShipping,1===t?p("无需配送"):y.shippingType&&y.shippingType[e]&&y.shippingType[e].typeName||p("该收货地址不支持配送"))),1)];var e,t}),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),n(q,{show:b.value,"onUpdate:show":a[0]||(a[0]=e=>b.value=e)},{default:s(()=>[n(r,{class:"payment-popup"},{default:s(()=>[n(r,{class:"popup-title title"},{default:s(()=>[c(i(e.$t("选择配送方式")),1)]),_:1}),n(r,{class:"payment-btn"},{default:s(()=>[(l(!0),u(d,null,I(e.shippingTypeList[A.value],(a,o)=>{return l(),t(r,{key:o,class:x(["payment-btn-item",{active:(n=a.shippingTypeId,U.value?U.value===n:(null==(u=y.shippingType[A.value])?void 0:u.typeId)===n)}]),onClick:e=>((e,a)=>{S.value=e,U.value=a})(o,a.shippingTypeId)},{default:s(()=>[c(i(e.$t(null==a?void 0:a.shippingTypeName)),1)]),_:2},1032,["class","onClick"]);var n,u}),128))]),_:1}),n(r,{class:"payment-desc"},{default:s(()=>[n(r,{class:"payment-desc-title"},{default:s(()=>{var a;return[c(i(e.$t((null==(a=N.value)?void 0:a.shippingTypeName)||"")),1)]}),_:1}),n(r,{class:"payment-desc-text"},{default:s(()=>{var a;return[c(i(e.$t((null==(a=N.value)?void 0:a.shippingTimeDesc)||"")),1)]}),_:1})]),_:1}),n(E,{"background-color":"#fff"},{default:s(()=>[n(r,{class:"btn-box"},{default:s(()=>[n(T,{onClick:D},{default:s(()=>[c(i(e.$t("提交")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show"]),n(q,{show:z.value,"onUpdate:show":a[1]||(a[1]=e=>z.value=e)},{default:s(()=>[n(r,{class:"attribute"},{default:s(()=>[n(r,{class:"popup-title title"},{default:s(()=>[c(i(e.$t("附加")),1)]),_:1}),n(r,{class:"attribute-list"},{default:s(()=>{var e;return[(l(!0),u(d,null,I(null==(e=L.value.extraSkuAllData)?void 0:e.extra,(e,a)=>(l(),t(r,{key:a,class:"attribute-item"},{default:s(()=>[n(r,{class:"item-title"},{default:s(()=>[c(i(e.attrName),1)]),_:2},1024),n(r,{class:"item-content"},{default:s(()=>[(l(!0),u(d,null,I(e.attrList,e=>(l(),t(r,{key:e.attributesId,class:"item-attr-box"},{default:s(()=>[n(r,{class:x(["item-attr",{checked:O.value[a]===e.attributesId}]),onClick:V(t=>((e,a)=>{O.value[e]&&O.value[e]===a?O.value[e]=null:O.value[e]=a})(a,e.attributesId),["stop"])},{default:s(()=>[n(r,{class:"label"},{default:s(()=>[c(i(e.attrValue),1)]),_:2},1024),n(r,{class:"line-box"}),n(f,{class:"value","price-data":e.attrPrice},null,8,["price-data"])]),_:2},1032,["class","onClick"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024))),128))]}),_:1}),n(E,{"background-color":"#fff"},{default:s(()=>[n(r,{class:"attribute-btn"},{default:s(()=>[n(r,{class:"desc"},{default:s(()=>[c(i(g(w)()?e.$t("已选择{0}种",O.value.length):`已选择${O.value.length}种`),1)]),_:1}),n(r,{class:""},{default:s(()=>[n(T,{style:{width:"400rpx",height:"80rpx"},onClick:M},{default:s(()=>[c(i(e.$t("确定")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])],64)}}}),[["__scopeId","data-v-fd6fbad2"]]),me=p(a({__name:"couponInfo",props:{couponList:{},useCouponIds:{},selectUserCouponIds:{},couponAmount:{},balance:{},points:{},availablePoints:{},pointsAmount:{},usePoint:{},flowType:{}},emits:["update:useCouponIds","sendBalanceStatus","change","update:usePoint","update:selectUserCouponIds"],setup(e,{expose:a,emit:p}){const{t:T}=m(),$=A(),{currency:V}=ne(),D=e,j=p,B=f([]),z=f({enableCoupons:[],disableCoupons:[]});y(()=>z,e=>{B.value=e.value.enableCoupons.filter(e=>e.selected)},{deep:!0,immediate:!0});const L=f(!1),O=f(!1),M=f("可用优惠券"),E=e=>{M.value=e},q=()=>{z.value=JSON.parse(JSON.stringify(D.couponList)),L.value=!0},W=e=>{if(B.value.findIndex(a=>a.shopId===e.shopId)>-1)R(e.shopId),G(e.shopId,e.userCouponId,!1);else{B.value.findIndex(a=>a.id===e.id)>-1?(J(e.id),Y(e.id,e.userCouponId,!1)):B.value.push(e),B.value.push(e)}},F=e=>{B.value=B.value.filter(({id:a})=>a!==e.id)},R=e=>{B.value=B.value.filter(a=>a.shopId!==e)},J=e=>{B.value=B.value.filter(a=>a.id!==e)},G=(e,a,t)=>{z.value.enableCoupons.forEach(l=>{l.shopId===e&&l.userCouponId!==a&&(l.selected=t)})},Y=(e,a,t)=>{z.value.enableCoupons.forEach(l=>{l.id===e&&l.userCouponId!==a&&(l.selected=t)})},ee=()=>{let e=[],a=[];B.value.length>0&&(e=B.value.map(({id:e})=>e),a=B.value.map(({userCouponId:e})=>e)),j("update:useCouponIds",e),j("update:selectUserCouponIds",a),j("change"),L.value=!1},ae=f(!1),te=N({usePoints:0}),ue=f(),ce={usePoints:{rules:[{required:!0,errorMessage:T("请输入积分")},{validateFunction:function(e,a,t,l){return a>D.availablePoints&&l(T("积分不能大于可用积分")),a<0&&l(T("积分不能小于0")),!0}}]}};y(ae,e=>{e&&setTimeout(()=>{ue.value.setRules(ce)},1e3)});const ie=()=>{if(0===D.points&&0===D.pointsAmount)return C({title:T("暂无可用积分"),duration:1500,icon:"none"});ae.value=!0,te.usePoints=D.usePoint},de=()=>{ue.value.validate().then(e=>{te.usePoints||(te.usePoints=0),j("update:usePoint",Number(te.usePoints)),j("change"),ae.value=!1}).catch(e=>{console.log("表单错误信息：",e)})},re=()=>{O.value=!O.value,j("sendBalanceStatus",O.value)},pe=()=>{r({url:"/pages/user/account/index"})};return a({isBalance:O}),(e,a)=>{const r=o,p=h,m=P,f=S,y=v(_("format-price"),H),C=v(_("tig-checkbox"),X),T=v(_("tig-button"),K),A=v(_("tig-fixed-placeholder"),Z),N=U,D=v(_("tig-popup"),Q),j=v(_("uni-easyinput"),le),B=v(_("uni-forms-item"),oe),R=v(_("uni-forms"),se);return l(),u(d,null,[n(r,{class:"coupon-info"},{default:s(()=>[3!=e.flowType?(l(),u(d,{key:0},[1==g($).useCoupon?(l(),t(r,{key:0,class:"coupon"},{default:s(()=>[n(r,{class:"coupon-title"},{default:s(()=>[c(i(e.$t("优惠券")),1)]),_:1}),n(r,{class:"coupon-content",onClick:q},{default:s(()=>[n(r,{class:"coupon-text"},{default:s(()=>[c(i(e.$t("优惠")+g(V)+e.couponAmount),1)]),_:1}),n(p,{"lazy-load":"",class:"more-ico",src:g(b)("common/more.png")},null,8,["src"])]),_:1})]),_:1})):k("",!0),1==g($).usePoints?(l(),t(r,{key:1,class:"points"},{default:s(()=>[n(r,{class:"points-title"},{default:s(()=>[c(i(e.$t("积分"))+" ",1),n(r,{class:"points-text"},{default:s(()=>[c(i(e.$t("当前账户积分"))+"：",1),n(m,{class:"special-text"},{default:s(()=>[c(i(e.points),1)]),_:1})]),_:1})]),_:1}),n(r,{class:"points-content",onClick:ie},{default:s(()=>[e.pointsAmount>0?(l(),t(r,{key:0,class:"points-text"},{default:s(()=>[c(i(e.$t("共抵扣："))+i(g(V)+e.pointsAmount),1)]),_:1})):0===e.points&&0===e.pointsAmount?(l(),t(r,{key:1,class:"points-text"},{default:s(()=>[c(i(e.$t("暂无可用积分")),1)]),_:1})):(l(),t(r,{key:2,class:"points-text"},{default:s(()=>[c(i(g(w)()?e.$t("最多可用{0}积分",[e.availablePoints]):`最多可用${e.availablePoints}积分`),1)]),_:1})),n(p,{"lazy-load":"",class:"more-ico",src:g(b)("common/more.png")},null,8,["src"])]),_:1})]),_:1})):k("",!0)],64)):k("",!0),1==g($).useSurplus?(l(),t(r,{key:1,class:"balance"},{default:s(()=>[n(r,{class:"balance-title",onClick:pe},{default:s(()=>[c(i(e.$t("余额"))+" ",1),n(r,{class:"balance-text"},{default:s(()=>[c(i(e.$t("当前账户余额"))+"：",1),n(m,{class:"special-text"},{default:s(()=>[c(i(e.balance),1)]),_:1})]),_:1})]),_:1}),n(f,{checked:O.value,color:"var(--general)",style:{transform:"scale(0.8)"},onChange:re},null,8,["checked"])]),_:1})):k("",!0)]),_:1}),n(D,{show:L.value,"onUpdate:show":a[2]||(a[2]=e=>L.value=e),"background-color":"#fff"},{default:s(()=>[n(N,{"scroll-y":"true",class:"coupon-container"},{default:s(()=>[n(r,{class:"popup-title"},{default:s(()=>[c(i(e.$t("优惠券")),1)]),_:1}),n(r,{class:"coupon-menu"},{default:s(()=>[n(r,{class:x(["coupon-menu-item",{active:"可用优惠券"===M.value}]),onClick:a[0]||(a[0]=e=>E("可用优惠券"))},{default:s(()=>[c(i(e.$t("可用优惠券"))+"("+i(z.value.enableCoupons.length)+")",1)]),_:1},8,["class"]),n(r,{class:x(["coupon-menu-item",{active:"不可用优惠券"===M.value}]),onClick:a[1]||(a[1]=e=>E("不可用优惠券"))},{default:s(()=>[c(i(e.$t("不可用优惠券"))+"("+i(z.value.disableCoupons.length)+")",1)]),_:1},8,["class"])]),_:1}),n(r,{class:"coupon-container-content"},{default:s(()=>["可用优惠券"===M.value?(l(),u(d,{key:0},[n(r,{class:"coupon-box"},{default:s(()=>[(l(!0),u(d,null,I(z.value.enableCoupons,(a,o)=>(l(),t(r,{key:o,class:"coupon-item",onClick:e=>(e=>{console.log("handleCheck",e),e.selected=!e.selected,e.selected?W(e):F(e)})(a)},{default:s(()=>[n(r,{class:"coupon-click-area"}),n(r,{class:"left"},{default:s(()=>[n(r,{class:"col-1"},{default:s(()=>[n(r,{class:"title"},{default:s(()=>[c(i(a.couponName),1)]),_:2},1024)]),_:2},1024),a.couponDesc?(l(),t(r,{key:0,class:"col-2"},{default:s(()=>[c(i(a.couponDesc),1)]),_:2},1024)):k("",!0),n(r,{class:x(["col-3",{"special-col":!a.couponDesc}])},{default:s(()=>[c(i(e.$t("有效期："))+i(a.endDate),1)]),_:2},1032,["class"])]),_:2},1024),n(r,{class:"right"},{default:s(()=>[n(r,{class:"right-1"},{default:s(()=>[2===a.couponType?(l(),u(d,{key:0},[n(r,{class:"zhekou"},{default:s(()=>[c(i(a.couponDiscount),1)]),_:2},1024),n(r,{class:"zhe"},{default:s(()=>[c(i(e.$t("折")),1)]),_:1})],64)):(l(),t(y,{key:1,"font-style":{fontSize:"48rpx",lineHeight:1},"currency-style":{selfAlign:"end",fontSize:"24rpx"},"price-data":a.couponMoney},null,8,["price-data"]))]),_:2},1024),n(r,{class:"right-2"},{default:s(()=>[n(C,{checked:a.selected},null,8,["checked"])]),_:2},1024)]),_:2},1024),n(r,{class:"dotted-line"})]),_:2},1032,["onClick"]))),128))]),_:1}),0===z.value.enableCoupons.length?(l(),t(r,{key:0,class:"coupon-empty"},{default:s(()=>[c(i(e.$t("暂无优惠券")),1)]),_:1})):k("",!0)],64)):k("",!0),"不可用优惠券"===M.value?(l(),u(d,{key:1},[n(r,{class:"coupon-box"},{default:s(()=>[(l(!0),u(d,null,I(z.value.disableCoupons,(a,o)=>(l(),t(r,{key:o,class:"coupon-item grayScaleDiv"},{default:s(()=>[n(r,{class:"left"},{default:s(()=>[n(r,{class:"col-1"},{default:s(()=>[n(r,{class:"title"},{default:s(()=>[c(i(a.couponName),1)]),_:2},1024)]),_:2},1024),a.disableReason?(l(),t(r,{key:0,class:"col-2"},{default:s(()=>[c(i(a.disableReason),1)]),_:2},1024)):k("",!0),n(r,{class:x(["col-3",{"special-col":!a.couponDesc}])},{default:s(()=>[c(i(e.$t("有效期："))+i(a.endDate),1)]),_:2},1032,["class"])]),_:2},1024),n(r,{class:"right"},{default:s(()=>[n(r,{class:"right-1"},{default:s(()=>[2===a.couponType?(l(),u(d,{key:0},[n(r,{class:"zhekou"},{default:s(()=>[c(i(a.couponDiscount),1)]),_:2},1024),n(r,{class:"zhe"},{default:s(()=>[c(i(e.$t("折")),1)]),_:1})],64)):(l(),t(y,{key:1,"font-style":{fontSize:"48rpx",lineHeight:1},"currency-style":{selfAlign:"end",fontSize:"24rpx"},"price-data":a.couponMoney},null,8,["price-data"]))]),_:2},1024),n(r,{class:"right-2"},{default:s(()=>[n(C,{checked:a.selected,"onUpdate:checked":e=>a.selected=e,disabled:!0},null,8,["checked","onUpdate:checked"])]),_:2},1024)]),_:2},1024),n(r,{class:"dotted-line"})]),_:2},1024))),128))]),_:1}),0===z.value.disableCoupons.length?(l(),t(r,{key:0,class:"coupon-empty"},{default:s(()=>[c(i(e.$t("暂无优惠券")),1)]),_:1})):k("",!0)],64)):k("",!0)]),_:1}),n(A,{"background-color":"#fff"},{default:s(()=>[n(r,{class:"btn-box"},{default:s(()=>[n(T,{onClick:ee},{default:s(()=>[c(i(e.$t("确定")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show"]),n(D,{show:ae.value,"onUpdate:show":a[4]||(a[4]=e=>ae.value=e),"background-color":"#f5f5f5"},{default:s(()=>[n(r,{class:"points-popup"},{default:s(()=>[n(r,{class:"popup-title"},{default:s(()=>[c(i(e.$t("积分")),1)]),_:1}),n(r,{class:"form-usePoints"},{default:s(()=>[n(R,{ref_key:"pointsForm",ref:ue,"model-value":te},{default:s(()=>[n(B,{"label-width":"80",label:e.$t("使用积分"),name:"usePoints"},{default:s(()=>[n(j,{modelValue:te.usePoints,"onUpdate:modelValue":a[3]||(a[3]=e=>te.usePoints=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,type:"number",placeholder:e.$t("请输入积分")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model-value"])]),_:1}),n(A,{"background-color":"#fff"},{default:s(()=>[n(r,{class:"btn-box"},{default:s(()=>[n(T,{onClick:de},{default:s(()=>[c(i(e.$t("确定")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])],64)}}}),[["__scopeId","data-v-ff08dcc1"]]),fe=p(a({__name:"invoiceInfo",props:{getAddressInfo:{type:Object,default:()=>{}},invoiceInfo:{type:Object,default:()=>{}}},emits:["update:invoiceInfo","change"],setup(e,{emit:a}){const{t:p}=m(),I=A(),C=e,$=a,V=T(()=>{switch(C.invoiceInfo.invoiceType){case 1:return"普通发票";case 2:return"增值税专用发票";default:return"不开发票"}}),w={companyCode:{rules:[{required:!0,errorMessage:p("纳税人识号不能为空!")}]},companyAddress:{rules:[{required:!0,errorMessage:p("单位地址不能为空!")}]},companyPhone:{rules:[{required:!0,errorMessage:p("单位电话不能为空!")}]},companyBank:{rules:[{required:!0,errorMessage:p("开户银行不能为空!")}]},companyAccount:{rules:[{required:!0,errorMessage:p("银行账户不能为空!")}]},mobile:{rules:[{required:!0,errorMessage:p("手机不能为空!")}]}},S=()=>{z(),E()},B=N({titleType:1,invoiceType:1,companyName:"",mobile:"",email:"",companyCode:"",companyAddress:"",companyPhone:"",companyBank:"",companyAccount:""}),z=()=>{B.companyName="",B.mobile="",B.email="",B.companyCode="",B.companyAddress="",B.companyPhone="",B.companyBank="",B.companyAccount=""},L=f(!1),O=f(!1),M=async()=>{try{const e=await ce();e&&Object.keys(e).length>0?(L.value=!0,2===B.invoiceType&&(B.companyCode=e.companyCode,B.companyAddress=e.companyAddress,B.companyPhone=e.companyPhone,B.companyBank=e.companyBank,B.companyAccount=e.companyAccount)):L.value=!1}catch(e){console.error(e)}},E=async()=>{try{const e=await ue({invoiceType:B.invoiceType,titleType:B.titleType});e?(1===B.invoiceType&&1===B.titleType?(B.companyName=e.companyName,B.mobile=e.mobile,B.email=e.email):(B.companyCode=e.companyCode,B.companyName=e.companyName,B.companyAddress=e.companyAddress,B.companyPhone=e.companyPhone,B.companyBank=e.companyBank,B.companyAccount=e.companyAccount),B.mobile=e.mobile,B.email=e.email):1===B.titleType&&(B.companyName=C.getAddressInfo.consignee,B.mobile=C.getAddressInfo.mobile,B.email=C.getAddressInfo.email)}catch(e){console.error(e)}};y(O,e=>{var a;e&&(M(),0==(null==(a=Object.keys(C.invoiceInfo))?void 0:a.length)&&E())});const q=()=>{O.value=!0},W=e=>{B.invoiceType=e,z(),1==e?E():M()},F=f(),R=()=>{O.value=!1,$("update:invoiceInfo",{})},J=()=>{F.value.validate().then(()=>{$("update:invoiceInfo",B),O.value=!1}).catch(e=>{console.log("表单错误信息：",e)})},G=()=>{r({url:"/pages/user/invoiceManagement/index?type=invoice"})};return(e,a)=>{const r=o,p=h,m=P,f=v(_("up-radio"),D),y=v(_("up-radio-group"),j),C=v(_("uni-forms-item"),oe),T=v(_("uni-easyinput"),le),$=v(_("uni-forms"),se),A=v(_("tig-button"),K),N=v(_("tig-fixed-placeholder"),Z),z=U,M=v(_("tig-popup"),Q);return l(),t(r,{class:"invoice-info"},{default:s(()=>[n(r,{class:"invoice"},{default:s(()=>[n(r,{class:"invoice-title"},{default:s(()=>[c(i(e.$t("发票")),1)]),_:1}),n(r,{class:"invoice-content",onClick:q},{default:s(()=>[n(r,{class:"invoice-text"},{default:s(()=>[c(i(e.$t(V.value||"")),1)]),_:1}),n(p,{"lazy-load":"",class:"more-ico",src:g(b)("common/more.png")},null,8,["src"])]),_:1})]),_:1}),n(M,{show:O.value,"onUpdate:show":a[14]||(a[14]=e=>O.value=e)},{default:s(()=>[n(z,{"scroll-y":"true",class:"invoice-popup-content"},{default:s(()=>[n(r,{class:"invoice-popup-box"},{default:s(()=>[n(r,{class:"popup-title title"},{default:s(()=>[c(i(e.$t("发票")),1)]),_:1}),n(r,{class:"invoice-typemenu"},{default:s(()=>[n(r,{class:x(["invoice-typemenu-item",{active:1===B.invoiceType}]),onClick:a[0]||(a[0]=e=>W(1))},{default:s(()=>[c("普通发票")]),_:1},8,["class"]),1==g(I).invoiceAdded?(l(),t(r,{key:0,class:x(["invoice-typemenu-item",{active:2===B.invoiceType}]),onClick:a[1]||(a[1]=e=>W(2))},{default:s(()=>[c("增值税专用发票")]),_:1},8,["class"])):k("",!0),n(r,{class:"invoice-explain"},{default:s(()=>[c(" 我公司依法开具发票，请您按照税法规定使用发票。根据现行税收政策，部分公司提供数电票, 数电（专用发票）法律效力与现有增值税专用发票相同;如商品由第三方卖家销售，发票类型和内容将由该卖家决定，发票由卖家开具并提供。如您为企业采购，需要多单合并开具或批量提交发票可注册企业用户；"),n(m,{class:"special-text"},{default:s(()=>[c("使用礼品卡支付部分的金额，不支持开发票")]),_:1})]),_:1})]),_:1}),n(r,{class:"invoice-formState"},{default:s(()=>[n($,{ref_key:"formRef",ref:F,"model-value":B,rules:w,"label-width":"170rpx"},{default:s(()=>[1===B.invoiceType?(l(),u(d,{key:0},[n(C,{label:e.$t("发票抬头"),name:"name"},{default:s(()=>[n(r,{class:"item-layout",onChange:S},{default:s(()=>[n(y,{modelValue:B.titleType,"onUpdate:modelValue":a[2]||(a[2]=e=>B.titleType=e),placement:"row"},{default:s(()=>[n(f,{"custom-style":{marginRight:"22rpx"},name:1,"active-color":"var(--general)",label:e.$t("个人")},null,8,["label"]),n(f,{name:2,"active-color":"var(--general)",label:e.$t("企业")},null,8,["label"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["label"]),1==B.titleType?(l(),t(C,{key:0,label:e.$t("个人名称"),name:"companyName",rules:[{required:!0,errorMessage:e.$t("个人名称不能为空")}]},{default:s(()=>[n(T,{modelValue:B.companyName,"onUpdate:modelValue":a[3]||(a[3]=e=>B.companyName=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入个人名称")},null,8,["modelValue","placeholder"])]),_:1},8,["label","rules"])):(l(),u(d,{key:1},[n(C,{label:e.$t("企业名称"),name:"companyName",rules:[{required:!0,errorMessage:e.$t("企业名称不能为空")}]},{default:s(()=>[n(T,{modelValue:B.companyName,"onUpdate:modelValue":a[4]||(a[4]=e=>B.companyName=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入企业名称")},null,8,["modelValue","placeholder"])]),_:1},8,["label","rules"]),n(C,{label:e.$t("纳税人识号"),name:"companyCode"},{default:s(()=>[n(T,{modelValue:B.companyCode,"onUpdate:modelValue":a[5]||(a[5]=e=>B.companyCode=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入纳税人识号")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(C,{label:e.$t("单位地址"),name:"companyAddress"},{default:s(()=>[n(T,{modelValue:B.companyAddress,"onUpdate:modelValue":a[6]||(a[6]=e=>B.companyAddress=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入单位地址")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(C,{label:e.$t("单位电话"),name:"companyPhone"},{default:s(()=>[n(T,{modelValue:B.companyPhone,"onUpdate:modelValue":a[7]||(a[7]=e=>B.companyPhone=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入单位电话")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(C,{label:e.$t("开户银行"),name:"companyBank"},{default:s(()=>[n(T,{modelValue:B.companyBank,"onUpdate:modelValue":a[8]||(a[8]=e=>B.companyBank=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入开户银行")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(C,{label:e.$t("银行账户"),name:"companyAccount"},{default:s(()=>[n(T,{modelValue:B.companyAccount,"onUpdate:modelValue":a[9]||(a[9]=e=>B.companyAccount=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入银行账户")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])],64)),n(C,{label:e.$t("收票人手机"),name:"mobile"},{default:s(()=>[n(T,{modelValue:B.mobile,"onUpdate:modelValue":a[10]||(a[10]=e=>B.mobile=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入收票人手机")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(C,{label:e.$t("收票人邮箱"),name:"email"},{default:s(()=>[n(T,{modelValue:B.email,"onUpdate:modelValue":a[11]||(a[11]=e=>B.email=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入收票人邮箱")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])],64)):2===B.invoiceType&&L.value?(l(),u(d,{key:1},[n(r,{class:"invoiceInfo-content-item"},{default:s(()=>[n(r,{class:"item-label"},{default:s(()=>[c(i(e.$t("纳税人识号")),1)]),_:1}),n(r,{class:"item-value"},{default:s(()=>[c(i(B.companyCode),1)]),_:1})]),_:1}),n(r,{class:"invoiceInfo-content-item"},{default:s(()=>[n(r,{class:"item-label"},{default:s(()=>[c(i(e.$t("单位地址")),1)]),_:1}),n(r,{class:"item-value"},{default:s(()=>[c(i(B.companyAddress),1)]),_:1})]),_:1}),n(r,{class:"invoiceInfo-content-item"},{default:s(()=>[n(r,{class:"item-label"},{default:s(()=>[c(i(e.$t("单位电话")),1)]),_:1}),n(r,{class:"item-value"},{default:s(()=>[c(i(B.companyPhone),1)]),_:1})]),_:1}),n(r,{class:"invoiceInfo-content-item"},{default:s(()=>[n(r,{class:"item-label"},{default:s(()=>[c(i(e.$t("开户银行")),1)]),_:1}),n(r,{class:"item-value"},{default:s(()=>[c(i(B.companyBank),1)]),_:1})]),_:1}),n(r,{class:"invoiceInfo-content-item"},{default:s(()=>[n(r,{class:"item-label"},{default:s(()=>[c(i(e.$t("银行账户")),1)]),_:1}),n(r,{class:"item-value"},{default:s(()=>[c(i(B.companyAccount),1)]),_:1})]),_:1}),n(C,{label:e.$t("收票人手机"),name:"mobile"},{default:s(()=>[n(T,{modelValue:B.mobile,"onUpdate:modelValue":a[12]||(a[12]=e=>B.mobile=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入收票人手机")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(C,{label:e.$t("收票人邮箱"),name:"email"},{default:s(()=>[n(T,{modelValue:B.email,"onUpdate:modelValue":a[13]||(a[13]=e=>B.email=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入收票人邮箱")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])],64)):(l(),t(r,{key:2,class:"notPass"},{default:s(()=>[n(r,null,{default:s(()=>[c(i(e.$t("您还未通过增票资质申请，暂时无法开具增值税专用发票"))+" ",1),n(m,{class:"notPassBtn",onClick:G},{default:s(()=>[c(i(e.$t("去申请")),1)]),_:1})]),_:1})]),_:1}))]),_:1},8,["model-value"])]),_:1}),n(N,{"background-color":"#fff"},{default:s(()=>[n(r,{class:"btn-box"},{default:s(()=>[n(A,{class:"btn",plain:"",disabled:2===B.invoiceType&&!L.value,onClick:R},{default:s(()=>[c(i(e.$t("暂不开票")),1)]),_:1},8,["disabled"]),n(A,{class:"btn",disabled:2===B.invoiceType&&!L.value,onClick:J},{default:s(()=>[c(i(e.$t("提交")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])]),_:1})}}}),[["__scopeId","data-v-322121b9"]]),ye=p(a({__name:"remark",props:{modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(e,{emit:a}){const u=e,d=a,r=T({get:()=>u.modelValue,set(e){d("update:modelValue",e)}});return(e,a)=>{const u=o,d=v(_("up-input"),B);return l(),t(u,{class:"remark"},{default:s(()=>[n(u,{class:"remark-title"},{default:s(()=>[c(i(e.$t("备注")),1)]),_:1}),n(u,{class:"remark-content"},{default:s(()=>[n(d,{modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=e=>r.value=e),placeholder:e.$t("备注建议提前协商（250字以内）"),border:"none","input-align":"right",maxlength:"250",clearable:!0},null,8,["modelValue","placeholder"])]),_:1})]),_:1})}}}),[["__scopeId","data-v-f6ca286c"]]),ve=p(a({__name:"totalCard",props:{total:{type:Object,default:()=>({})},cartList:{type:Array,default:()=>[]},flowType:{type:Number}},setup(e){f(!1);const a=f(!1),u=()=>{a.value=!a.value};return(d,r)=>{const p=o,m=v(_("format-price"),H),f=v(_("up-icon"),z),y=P;return l(),t(p,{class:"total-card"},{default:s(()=>[n(p,null,{default:s(()=>[n(p,{class:"total-card-item"},{default:s(()=>[n(p,{class:"total-card-item-left"},{default:s(()=>[c(i(d.$t("商品总价")),1)]),_:1}),n(p,{class:"total-card-item-right"},{default:s(()=>[n(m,{"is-bottom":!1,"price-data":e.total.productAmount},null,8,["price-data"])]),_:1})]),_:1}),e.total.serviceFee&&e.total.serviceFee>0?(l(),t(p,{key:0,class:"total-card-item"},{default:s(()=>[n(p,{class:"total-card-item-left"},{default:s(()=>[c(i(d.$t("附加费用")),1)]),_:1}),n(p,{class:"total-card-item-right"},{default:s(()=>[n(m,{"is-bottom":!1,"price-data":e.total.serviceFee},null,8,["price-data"])]),_:1})]),_:1})):k("",!0),e.total.shippingFee>0?(l(),t(p,{key:1,class:"total-card-item"},{default:s(()=>[n(p,{class:"total-card-item-left"},{default:s(()=>[c(i(d.$t("配送费用")),1)]),_:1}),n(p,{class:"total-card-item-right special-text"},{default:s(()=>[n(m,{"is-bottom":!1,"price-data":e.total.shippingFee},null,8,["price-data"])]),_:1})]),_:1})):k("",!0),e.total.balance>0?(l(),t(p,{key:2,class:"total-card-item"},{default:s(()=>[n(p,{class:"total-card-item-left"},{default:s(()=>[c(i(d.$t("使用余额")),1)]),_:1}),n(p,{class:"total-card-item-right"},{default:s(()=>[c("- "),n(m,{"is-bottom":!1,"price-data":e.total.balance},null,8,["price-data"])]),_:1})]),_:1})):k("",!0),e.total.pointsAmount>0&&3!=e.flowType?(l(),t(p,{key:3,class:"total-card-item"},{default:s(()=>[n(p,{class:"total-card-item-left"},{default:s(()=>[c(i(d.$t("积分减免")),1)]),_:1}),n(p,{class:"total-card-item-right"},{default:s(()=>[c("- "),n(m,{"is-bottom":!1,"price-data":e.total.pointsAmount},null,8,["price-data"])]),_:1})]),_:1})):k("",!0),e.total.discounts>0?(l(),t(p,{key:4,class:"total-card-item"},{default:s(()=>[n(p,{class:"total-card-item-left",onClick:u},{default:s(()=>[c(i(d.$t("共优惠"))+" ",1),n(f,{style:{"padding-left":"4rpx"},size:"16",color:"#969799",name:"info-circle"})]),_:1}),n(p,{class:"total-card-item-right"},{default:s(()=>[n(p,null,{default:s(()=>[c(" - "),n(m,{"is-bottom":!1,"price-data":e.total.discounts},null,8,["price-data"])]),_:1})]),_:1})]),_:1})):k("",!0),e.total.orderSendPoint&&e.total.orderSendPoint>0?(l(),t(p,{key:5,class:"total-card-tig"},{default:s(()=>[c(" * "+i(d.$t("该订单完成后，您将预计获得"))+" ",1),n(y,{class:"special-text"},{default:s(()=>[c(i(e.total.orderSendPoint),1)]),_:1}),c(" "+i(d.$t("积分")),1)]),_:1})):k("",!0)]),_:1}),n(ie,{modelValue:a.value,"onUpdate:modelValue":r[0]||(r[0]=e=>a.value=e),total:e.total,"discount-type":"order"},null,8,["modelValue","total"])]),_:1})}}}),[["__scopeId","data-v-5add14e7"]]),_e=p(a({__name:"check",setup(a){const{t:u}=m(),d=A(),p=L(),y=N({addressId:0,shippingType:{},payTypeId:0,usePoint:0,useBalance:0,useCouponIds:[],selectUserCouponIds:[],buyerNote:"",invoiceData:{},productExtra:{}}),h=f([]),b=f({}),I=async()=>{try{const e=await ee({page:1,size:99}),a=J("link");if(0===e.records.length&&!a)return r({url:"/pages/address/list"});e.records.length>0&&(b.value=e.records[0],y.addressId=e.records[0].addressId,h.value=e.records)}catch(e){console.error(e)}},x=f([]),$=async()=>{try{const a=await e({url:"order/check/getAvailablePaymentType",method:"GET"});y.payTypeId=a[0].typeId,x.value=a}catch(a){console.log(a)}},P=f({}),V=async()=>{try{const t=await(a={flowType:B.value},e({url:"order/check/getStoreShippingType",method:"GET",params:a}));P.value=t;for(const e in t)t[e]&&t[e].length>0&&(y.shippingType[e]={typeId:t[e][0].shippingTypeId,shopId:t[e][0].shopId,typeName:t[e][0].shippingTypeName})}catch(t){console.log(t)}var a},S=f([]),U=f(),D=f([]),j=f([]),B=f(1),z=f(0),Q=async()=>{try{const t=await(a={flowType:B.value,...y},e({url:"order/check/index",method:"post",data:a})),{cartList:l,total:o,couponList:s,tmplIds:n,item:u,useCouponIds:c,selectUserCouponIds:i}=t;Object.assign(y,u),S.value=l,U.value=o,D.value=s,j.value=n,z.value=t.availablePoints,c&&c.length>0&&(y.useCouponIds=c),i&&i.length>0&&(y.selectUserCouponIds=i)}catch(t){console.error(t)}var a},X=async e=>{y.productExtra=e;const a=await ae();a&&(S.value=a.cartList)},ae=async()=>{M({title:u("加载中")});try{const t=await(a={flowType:B.value,...y},e({url:"order/check/update",method:"post",data:a}));return Object.assign(y,t.item),U.value=t.total,z.value=t.availablePoints,t}catch(t){C({title:t.message,duration:1500})}finally{q()}var a},te=async()=>{M({title:u("加载中")});try{const t=await(a=y,e({url:"order/check/updateCoupon",method:"post",data:a}));return D.value=t.couponList,U.value=t.total,S.value=t.cartList,y.useCouponIds=t.useCouponIds,y.selectUserCouponIds=t.selectUserCouponIds,t}catch(t){console.error(t)}finally{q()}var a},le=e=>{y.useBalance=e?p.userInfo.balance:0,ae()},oe=T(()=>{if(!y.shippingType)return!0;for(const e of S.value)if(0===e.noShipping&&!y.shippingType[e.shopId])return!0;return!1}),se=f(!1),ne=async()=>{if(!se.value)return 0===y.payTypeId?C({title:u("请选择付款方式"),icon:"none"}):void(oe.value||se.value||(se.value=!0,ue()))},ue=async()=>{try{const t=await(a=y,e({url:"order/check/submit",method:"post",data:a}));2===t.returnType?E({url:`/pages/order/payStatus?id=${t.orderId}`,mode:"redirectTo"}):E({url:`/pages/order/pay?orderId=${t.orderId}`,mode:"redirectTo"})}catch(t){if(console.error(t),"wechat"===d.XClientType&&5002===t.code)return G("bindWechatFlowType",B.value),E({url:`/pages/user/profile/index?bindWechat=true&flowType=${B.value}`});C({title:t.message,icon:"none"}),setTimeout(()=>{E({url:"/pages/cart/index",mode:"redirectTo"})},1500)}finally{se.value=!1}var a},ce=f();O(async()=>{ie(),(null==ce?void 0:ce.value)&&(ce.value.isBalance=!1,y.useBalance=0)});const ie=async()=>{try{M({title:u("加载中")}),await Promise.all([I(),$(),V(),p.getUserInfo()]),await Q()}catch(e){console.error(e),C({title:e.message,icon:"none"}),setTimeout(()=>{E({url:"/pages/cart/index",mode:"redirectTo"})},1500)}finally{q()}};return W(()=>{F("link")}),R(e=>{e&&e.flowType&&(B.value=e.flowType)}),(e,a)=>{const u=o,r=v(_("format-price"),H),m=v(_("tig-button"),K),f=v(_("tig-fixed-placeholder"),Z),h=v(_("tig-layout"),Y);return l(),t(h,{title:"提交订单"},{default:s(()=>{var o,v;return[n(de,{data:b.value},null,8,["data"]),x.value.length>0?(l(),t(re,{key:0,"pay-type-id":y.payTypeId,"onUpdate:payTypeId":a[0]||(a[0]=e=>y.payTypeId=e),"available-payment-type":x.value,onChange:ae},null,8,["pay-type-id","available-payment-type"])):k("",!0),n(pe,{"shipping-type":y.shippingType,"onUpdate:shippingType":a[1]||(a[1]=e=>y.shippingType=e),"cart-list":S.value,"shipping-type-list":P.value,onChange:ae,onChangeProductExtra:X},null,8,["shipping-type","cart-list","shipping-type-list"]),n(ye,{modelValue:y.buyerNote,"onUpdate:modelValue":a[2]||(a[2]=e=>y.buyerNote=e)},null,8,["modelValue"]),1==g(d).useCoupon||1==g(d).usePoints||1==g(d).useSurplus?(l(),t(me,{key:1,ref_key:"couponInfoRef",ref:ce,"use-coupon-ids":y.useCouponIds,"onUpdate:useCouponIds":a[3]||(a[3]=e=>y.useCouponIds=e),"select-user-coupon-ids":y.selectUserCouponIds,"onUpdate:selectUserCouponIds":a[4]||(a[4]=e=>y.selectUserCouponIds=e),"use-point":y.usePoint,"onUpdate:usePoint":a[5]||(a[5]=e=>y.usePoint=e),balance:g(p).userInfo.balance??0,points:g(p).userInfo.points,"available-points":z.value,"points-amount":Number(null==(o=U.value)?void 0:o.pointsAmount)??0,"coupon-amount":Number(null==(v=U.value)?void 0:v.discountCouponAmount)??0,"coupon-list":D.value,"flow-type":B.value,onSendBalanceStatus:le,onChange:te},null,8,["use-coupon-ids","select-user-coupon-ids","use-point","balance","points","available-points","points-amount","coupon-amount","coupon-list","flow-type"])):k("",!0),1!==g(d).canInvoice||g(w)()?k("",!0):(l(),t(fe,{key:2,"invoice-info":y.invoiceData,"onUpdate:invoiceInfo":a[6]||(a[6]=e=>y.invoiceData=e),"get-address-info":b.value},null,8,["invoice-info","get-address-info"])),n(ve,{total:U.value,"cart-list":S.value,"flow-type":B.value},null,8,["total","cart-list","flow-type"]),n(f,{"background-color":"#fff"},{default:s(()=>[n(u,{class:"submit-btn-box"},{default:s(()=>[n(u,{class:"submit-btn-price"},{default:s(()=>{var a;return[n(u,{class:"price-text"},{default:s(()=>[c(i(e.$t("应付"))+":",1)]),_:1}),3==B.value?(l(),t(u,{key:0,class:"points-box"},{default:s(()=>[n(u,{class:"points-value"},{default:s(()=>{var a;return[c(i(null==(a=U.value)?void 0:a.exchangePoints)+" ",1),n(u,{class:"points-text"},{default:s(()=>[c(i(e.$t("积分")),1)]),_:1})]}),_:1}),n(u,{class:"symbol"},{default:s(()=>[c("+")]),_:1})]),_:1})):k("",!0),n(r,{"font-style":{fontWeight:"bold",fontSize:"34rpx"},"decimals-style":{fontSize:"24rpx",fontWeight:"bold"},"currency-style":{fontSize:"23rpx",fontWeight:"bold"},"price-data":null==(a=U.value)?void 0:a.unpaidAmount},null,8,["price-data"])]}),_:1}),n(u,null,{default:s(()=>[n(m,{class:"btn",disabled:oe.value,onClick:ne},{default:s(()=>[c(i(e.$t("提交订单")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]}),_:1})}}}),[["__scopeId","data-v-a0faaeec"]]);export{_e as default};

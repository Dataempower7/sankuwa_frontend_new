import{a4 as e,d as a,c as t,b as l,i as o,w as s,e as n,J as u,h as c,t as i,K as d,X as r,_ as p,L as m,r as f,V as y,C as v,F as _,f as g,G as h,H as b,a as k,P as I,Z as $,R as T,m as x,I as C,k as N,O as P,af as V,l as w,Y as A,bI as S,W as U,ap as D,aq as j,bJ as z,bK as B,az as L,v as O,ac as M,j as q,ad as R,aT as W,S as E,n as F,M as J,Q as G}from"./index-BZxHr1FI.js";import{_ as H}from"./format-price.BrXrBVy6.js";import{a as K,_ as X,d as Q,T as Y}from"./tig-layout.DTz8E-sj.js";import{T as Z}from"./tig-fixed-placeholder.BDsbIjoZ.js";import{g as ee}from"./address.CA-6xUbG.js";import{_ as ae}from"./tig-image.CzXKqALH.js";import{a as te}from"./activityCard.DE1HAQr9.js";import{_ as le}from"./uni-easyinput.DHFPvsdC.js";import{_ as oe,a as se}from"./uni-forms.QWcIXEX3.js";import{u as ne}from"./useCurrency.293Veihs.js";import{g as ue,a as ce}from"./invoice.Cqx4EiZW.js";import{d as ie}from"./discountInfo.Cqr9E45_.js";import"./currency.Dn5A4d7X.js";import"./uni-icons.DMMn2oBg.js";const de=p(a({__name:"addressInfo",props:{data:{type:Object,default:()=>[]}},setup(e){const a=()=>{r({url:"/pages/address/list"})};return(r,p)=>{const m=o;return l(),t(m,{class:"address-info"},{default:s(()=>[n(m,{class:"address-content",onClick:a},{default:s(()=>[n(m,{class:"address-box"},{default:s(()=>[e.data&&Object.keys(e.data).length>0?(l(),u(d,{key:0},[n(m,{class:"user-info"},{default:s(()=>[n(m,{class:"name"},{default:s(()=>[c(i(e.data.consignee+" "+e.data.mobile),1)]),_:1})]),_:1}),n(m,{class:"address"},{default:s(()=>[c(i(e.data.regionName)+" "+i(e.data.address),1)]),_:1})],64)):(l(),t(m,{key:1,class:"user-info"},{default:s(()=>[n(m,{class:"name"},{default:s(()=>[c("请选择收货地址")]),_:1})]),_:1}))]),_:1}),n(m,{class:"iconfont icon-jiantou arrow_ico"})]),_:1})]),_:1})}}}),[["__scopeId","data-v-edff46dc"]]),re=p(a({__name:"paymentMode",props:{availablePaymentType:{},payTypeId:{}},emits:["update:payTypeId","change"],setup(e,{emit:a}){const{t:r}=m(),p=e,x=a,C=f([]),N=f(""),P=()=>{C.value=JSON.parse(JSON.stringify(p.availablePaymentType)),V.value=!0;const e=p.availablePaymentType.findIndex(e=>e.typeId===p.payTypeId);e>=0&&(w.value=e)};y(()=>C,()=>{const e=C.value.filter(e=>e.disabled);e[0]&&e[0].typeId===p.payTypeId&&(x("update:payTypeId",0),w.value=null,N.value=e[0].disabledDesc,T({title:e[0].disabledDesc,duration:1500,icon:"none"}))});const V=f(!1),w=f(null),A=(e,a)=>null!==w.value&&void 0!==w.value&&w.value>=0?w.value===e:a===p.payTypeId,S=()=>{null!==w.value&&w.value>=0?(N.value=C.value[w.value].typeName,x("update:payTypeId",C.value[w.value].typeId),x("change"),V.value=!1):T({title:r("请选择付款方式"),duration:1500,icon:"none"})};return(e,a)=>{const r=o,m=g,f=v(_("tig-button"),K),y=v(_("tig-fixed-placeholder"),Z),T=v(_("tig-popup"),X);return l(),t(r,null,{default:s(()=>[n(r,{class:"payment"},{default:s(()=>[n(r,{class:"payment-title"},{default:s(()=>[c(i(e.$t("支付方式")),1)]),_:1}),n(r,{class:"payment-content",onClick:P},{default:s(()=>[n(r,{class:"payment-text"},{default:s(()=>[c(i(N.value?N.value:p.availablePaymentType[0].typeName),1)]),_:1}),n(m,{"lazy-load":"",class:"more-ico",src:h(b)("common/more.png")},null,8,["src"])]),_:1})]),_:1}),n(T,{show:V.value,"onUpdate:show":a[0]||(a[0]=e=>V.value=e)},{default:s(()=>[n(r,{class:"payment-popup"},{default:s(()=>[n(r,{class:"popup-title title"},{default:s(()=>[c(i(e.$t("选择支付方式")),1)]),_:1}),n(r,{class:"payment-btn"},{default:s(()=>[(l(!0),u(d,null,I(C.value,(e,a)=>(l(),u(d,{key:e.typeId},[e.isShow?(l(),t(r,{key:0,class:$(["payment-btn-item",{active:A(a,e.typeId),disabled:e.disabled}]),onClick:t=>((e,a)=>{a||(w.value=e)})(a,e.disabled)},{default:s(()=>[c(i(null==e?void 0:e.typeName),1)]),_:2},1032,["class","onClick"])):k("",!0)],64))),128))]),_:1}),null!==w.value?(l(),t(r,{key:0,class:"payment-desc"},{default:s(()=>[n(r,{class:"payment-desc-title"},{default:s(()=>{var e;return[c(i(null==(e=C.value[w.value])?void 0:e.typeName),1)]}),_:1}),n(r,{class:"payment-desc-text"},{default:s(()=>{var a;return[c(i("在线支付"===(null==(a=C.value[w.value])?void 0:a.typeName)?e.$t("支持微信即时到账（绝大数银行借记卡及部分银行信用卡）"):e.$t("支持银行和企业账户汇款")),1)]}),_:1})]),_:1})):k("",!0),n(y,{"background-color":"#fff"},{default:s(()=>[n(r,{class:"btn-box"},{default:s(()=>[n(f,{onClick:S},{default:s(()=>[c(i(e.$t("提交")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])]),_:1})}}}),[["__scopeId","data-v-2505edb5"]]),pe=p(a({__name:"storeCard",props:{cartList:{},shippingTypeList:{},shippingType:{}},emits:["update:shippingType","change","changeProductExtra"],setup(e,{emit:a}){const{t:p}=m(),y=e,g=a,b=f(!1),w=f(0),A=x(()=>y.shippingTypeList&&y.shippingTypeList[w.value]&&y.shippingTypeList[w.value][S.value]?y.shippingTypeList[w.value][S.value]:null),S=f(0),U=f(),D=()=>{const e=JSON.parse(JSON.stringify(y.shippingType)),{shippingTypeId:a,shippingTypeName:t}=y.shippingTypeList[w.value][S.value];e[w.value].shopId=w.value,e[w.value].typeId=a,e[w.value].typeName=t,g("update:shippingType",e),g("change"),b.value=!1},j=e=>e.filter(e=>1===e.type||6===e.type),z=(e,a)=>{0!==a&&r({url:e+a})},B=f(!1),L=f({}),O=f([]),M=()=>{g("changeProductExtra",{cartId:L.value.cartId,extraAttrIds:O.value.filter(e=>!!e).join(",")}),B.value=!1};return(e,a)=>{const r=o,m=v(_("tig-image"),ae),f=v(_("format-price"),H),g=N,x=v(_("tig-button"),K),q=v(_("tig-fixed-placeholder"),Z),R=v(_("tig-popup"),X);return l(),u(d,null,[(l(!0),u(d,null,I(e.cartList,(a,o)=>(l(),t(r,{key:o,class:"store-card"},{default:s(()=>[n(r,{class:"store-card-item"},{default:s(()=>[n(r,{class:"store-card-item-title",onClick:e=>z("/pages/shop/index?shopId=",a.shopId)},{default:s(()=>[0===a.shopId?(l(),t(r,{key:0,class:"store-card-item-label"},{default:s(()=>[c(i(e.$t("自营")),1)]),_:1})):k("",!0),n(r,{class:"store-card-item-name"},{default:s(()=>[c(i(0===a.shopId?e.$t("自营"):a.shopTitle),1)]),_:2},1024)]),_:2},1032,["onClick"]),(l(!0),u(d,null,I(a.carts,(a,o)=>(l(),u(d,{key:o},[n(r,{class:"store-card-item-content"},{default:s(()=>[n(r,{class:"content-item",onClick:e=>z("/pages/product/index?id=",a.productId)},{default:s(()=>[n(r,{class:"store-card-item-content-left"},{default:s(()=>[n(m,{class:"store-card-item-img",src:a.picThumb},null,8,["src"])]),_:2},1024),n(r,{class:"store-card-item-content-right"},{default:s(()=>{return[n(r,{class:"store-card-item-content-right-title line2"},{default:s(()=>[c(i(a.productName),1)]),_:2},1024),a.skuData.length>0?(l(),t(r,{key:0,class:"sku-card"},{default:s(()=>[(l(!0),u(d,null,I(a.skuData,(e,a)=>(l(),t(r,{key:a,class:"sku-item"},{default:s(()=>[c(i(e.value),1)]),_:2},1024))),128))]),_:2},1024)):k("",!0),a.activityInfo&&j(a.activityInfo).length>0?(l(),t(r,{key:1,class:"activity-box"},{default:s(()=>[(l(!0),u(d,null,I(j(a.activityInfo),(e,a)=>(l(),t(te,{key:a,"font-size":"22rpx","activity-info":e,"card-type":"sub"},null,8,["activity-info"]))),128))]),_:2},1024)):k("",!0),n(r,{class:"right-price-box",style:C({marginTop:(e=a,(e.skuData.length>0&&e.activityInfo&&j(e.activityInfo).length>0?0:0!==e.skuData.length||e.activityInfo&&0!==j(e.activityInfo).length?10:55)+"rpx")})},{default:s(()=>[n(r,{class:"store-card-item-content-right-price"},{default:s(()=>[n(f,{"font-style":{fontWeight:"bold"},"decimals-style":{fontSize:"20rpx",fontWeight:"bold"},"currency-style":{fontSize:"20rpx",fontWeight:"bold"},"price-data":a.price},null,8,["price-data"]),a.originPrice&&a.originPrice!==a.price?(l(),t(f,{key:0,"font-style":{fontWeight:"400",textDecoration:"line-through",fontSize:"19rpx",color:"#969799",position:"relative",bottom:"-2px",left:"5px"},"is-bottom":!1,"price-data":a.originPrice},null,8,["price-data"])):k("",!0)]),_:2},1024),n(r,{class:"store-card-item-content-right-num"},{default:s(()=>[c(" x"+i(a.quantity),1)]),_:2},1024)]),_:2},1032,["style"])];var e}),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024),a.extraSkuAllData&&a.extraSkuAllData.extra&&a.extraSkuAllData.extra.length?(l(),t(r,{key:0,class:"attr-box",onClick:e=>(e=>{L.value=e,O.value=e.extraSkuData.length?e.extraSkuData.map(e=>e.attributesId):[],B.value=!0})(a)},{default:s(()=>[n(r,{class:"attr-label"},{default:s(()=>[c("附加")]),_:1}),a.extraSkuData&&a.extraSkuData.length?(l(),t(r,{key:0,class:"attr-list"},{default:s(()=>[(l(!0),u(d,null,I(a.extraSkuData,(e,o)=>(l(),t(r,{key:o,class:"attr-item"},{default:s(()=>[n(r,{class:"item-content"},{default:s(()=>[n(g,{class:"line1 content-text"},{default:s(()=>[c(i(e.attrValue),1)]),_:2},1024),n(r,{class:"right"},{default:s(()=>[n(f,{class:"price","price-data":e.attrPrice},null,8,["price-data"]),n(r,{class:"num"},{default:s(()=>[c("x"+i(a.quantity),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)):(l(),t(r,{key:1},{default:s(()=>[c(i(e.$t("可选附加规格")),1)]),_:1})),n(g,{class:"iconfont-h5 icon-xiajiantou1-copy"})]),_:2},1032,["onClick"])):k("",!0)],64))),128)),a.gift&&a.gift.length>0?(l(),t(r,{key:0,class:"gift-box"},{default:s(()=>[n(r,{class:"gift-title"},{default:s(()=>[c(i(e.$t("赠品")),1)]),_:1}),n(r,{class:"gift-content"},{default:s(()=>[(l(!0),u(d,null,I(a.gift,(e,a)=>(l(),t(r,{key:a,class:"gift-content-item"},{default:s(()=>[n(r,{class:"gift-item-left"},{default:s(()=>[n(m,{src:e.picThumb,class:"gift-img"},null,8,["src"])]),_:2},1024),n(r,{class:"gift-item-right"},{default:s(()=>[n(r,{class:"gift-item-name line1"},{default:s(()=>[c(i(e.productName),1)]),_:2},1024),e.skuData.length>0?(l(),t(r,{key:0,class:"sku-card"},{default:s(()=>[(l(!0),u(d,null,I(e.skuData,(e,a)=>(l(),t(r,{key:a,class:"sku-item"},{default:s(()=>[c(i(e.value),1)]),_:2},1024))),128))]),_:2},1024)):k("",!0),n(r,{class:"gift-item-num"},{default:s(()=>[c("x"+i(e.num),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)):k("",!0),n(r,{class:"payment"},{default:s(()=>[n(r,{class:"payment-title"},{default:s(()=>[c(i(e.$t("配送方式")),1)]),_:1}),n(r,{class:"payment-content",onClick:e=>{return t=a.shopId,1===a.noShipping?T({title:p("无需配送"),duration:1500,icon:"none"}):y.shippingTypeList[t]&&0!==y.shippingTypeList[t].length?void 0:T({title:p("该收货地址不支持配送"),duration:1500,icon:"none"});var t}},{default:s(()=>[n(r,{class:"payment-text"},{default:s(()=>{return[c(i((e=a.shopId,t=a.noShipping,1===t?p("无需配送"):y.shippingType&&y.shippingType[e]&&y.shippingType[e].typeName||p("该收货地址不支持配送"))),1)];var e,t}),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),n(R,{show:b.value,"onUpdate:show":a[0]||(a[0]=e=>b.value=e)},{default:s(()=>[n(r,{class:"payment-popup"},{default:s(()=>[n(r,{class:"popup-title title"},{default:s(()=>[c(i(e.$t("选择配送方式")),1)]),_:1}),n(r,{class:"payment-btn"},{default:s(()=>[(l(!0),u(d,null,I(e.shippingTypeList[w.value],(a,o)=>{return l(),t(r,{key:o,class:$(["payment-btn-item",{active:(n=a.shippingTypeId,U.value?U.value===n:(null==(u=y.shippingType[w.value])?void 0:u.typeId)===n)}]),onClick:e=>((e,a)=>{S.value=e,U.value=a})(o,a.shippingTypeId)},{default:s(()=>[c(i(e.$t(null==a?void 0:a.shippingTypeName)),1)]),_:2},1032,["class","onClick"]);var n,u}),128))]),_:1}),n(r,{class:"payment-desc"},{default:s(()=>[n(r,{class:"payment-desc-title"},{default:s(()=>{var a;return[c(i(e.$t((null==(a=A.value)?void 0:a.shippingTypeName)||"")),1)]}),_:1}),n(r,{class:"payment-desc-text"},{default:s(()=>{var a;return[c(i(e.$t((null==(a=A.value)?void 0:a.shippingTimeDesc)||"")),1)]}),_:1})]),_:1}),n(q,{"background-color":"#fff"},{default:s(()=>[n(r,{class:"btn-box"},{default:s(()=>[n(x,{onClick:D},{default:s(()=>[c(i(e.$t("提交")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show"]),n(R,{show:B.value,"onUpdate:show":a[1]||(a[1]=e=>B.value=e)},{default:s(()=>[n(r,{class:"attribute"},{default:s(()=>[n(r,{class:"popup-title title"},{default:s(()=>[c(i(e.$t("附加")),1)]),_:1}),n(r,{class:"attribute-list"},{default:s(()=>{var e;return[(l(!0),u(d,null,I(null==(e=L.value.extraSkuAllData)?void 0:e.extra,(e,a)=>(l(),t(r,{key:a,class:"attribute-item"},{default:s(()=>[n(r,{class:"item-title"},{default:s(()=>[c(i(e.attrName),1)]),_:2},1024),n(r,{class:"item-content"},{default:s(()=>[(l(!0),u(d,null,I(e.attrList,e=>(l(),t(r,{key:e.attributesId,class:"item-attr-box"},{default:s(()=>[n(r,{class:$(["item-attr",{checked:O.value[a]===e.attributesId}]),onClick:P(t=>((e,a)=>{O.value[e]&&O.value[e]===a?O.value[e]=null:O.value[e]=a})(a,e.attributesId),["stop"])},{default:s(()=>[n(r,{class:"label"},{default:s(()=>[c(i(e.attrValue),1)]),_:2},1024),n(r,{class:"line-box"}),n(f,{class:"value","price-data":e.attrPrice},null,8,["price-data"])]),_:2},1032,["class","onClick"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024))),128))]}),_:1}),n(q,{"background-color":"#fff"},{default:s(()=>[n(r,{class:"attribute-btn"},{default:s(()=>[n(r,{class:"desc"},{default:s(()=>[c(i(h(V)()?e.$t("已选择{0}种",O.value.length):`已选择${O.value.length}种`),1)]),_:1}),n(r,{class:""},{default:s(()=>[n(x,{style:{width:"400rpx",height:"80rpx"},onClick:M},{default:s(()=>[c(i(e.$t("确定")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])],64)}}}),[["__scopeId","data-v-fd6fbad2"]]),me=p(a({__name:"couponInfo",props:{couponList:{},useCouponIds:{},selectUserCouponIds:{},couponAmount:{},balance:{},points:{},availablePoints:{},pointsAmount:{},usePoint:{},flowType:{}},emits:["update:useCouponIds","sendBalanceStatus","change","update:usePoint","update:selectUserCouponIds"],setup(e,{expose:a,emit:p}){const{t:x}=m(),C=w(),{currency:P}=ne(),D=e,j=p,z=f([]),B=f({enableCoupons:[],disableCoupons:[]});y(()=>B,e=>{z.value=e.value.enableCoupons.filter(e=>e.selected)},{deep:!0,immediate:!0});const L=f(!1),O=f(!1),M=f("可用优惠券"),q=e=>{M.value=e},R=()=>{B.value=JSON.parse(JSON.stringify(D.couponList)),L.value=!0},W=e=>{if(z.value.findIndex(a=>a.shopId===e.shopId)>-1)F(e.shopId),G(e.shopId,e.userCouponId,!1);else{z.value.findIndex(a=>a.id===e.id)>-1?(J(e.id),Y(e.id,e.userCouponId,!1)):z.value.push(e),z.value.push(e)}},E=e=>{z.value=z.value.filter(({id:a})=>a!==e.id)},F=e=>{z.value=z.value.filter(a=>a.shopId!==e)},J=e=>{z.value=z.value.filter(a=>a.id!==e)},G=(e,a,t)=>{B.value.enableCoupons.forEach(l=>{l.shopId===e&&l.userCouponId!==a&&(l.selected=t)})},Y=(e,a,t)=>{B.value.enableCoupons.forEach(l=>{l.id===e&&l.userCouponId!==a&&(l.selected=t)})},ee=()=>{let e=[],a=[];z.value.length>0&&(e=z.value.map(({id:e})=>e),a=z.value.map(({userCouponId:e})=>e)),j("update:useCouponIds",e),j("update:selectUserCouponIds",a),j("change"),L.value=!1},ae=f(!1),te=A({usePoints:0}),ue=f(),ce={usePoints:{rules:[{required:!0,errorMessage:x(`请输入${C.integralName}`)},{validateFunction:function(e,a,t,l){return a>D.availablePoints&&l(x(`${C.integralName}不能大于可用${C.integralName}`)),a<0&&l(x(`${C.integralName}不能小于0`)),!0}}]}};y(ae,e=>{e&&setTimeout(()=>{ue.value.setRules(ce)},1e3)});const ie=()=>{if(0===D.points&&0===D.pointsAmount)return T({title:x(`暂无可用${C.integralName}`),duration:1500,icon:"none"});ae.value=!0,te.usePoints=D.usePoint},de=()=>{ue.value.validate().then(e=>{te.usePoints||(te.usePoints=0),j("update:usePoint",Number(te.usePoints)),j("change"),ae.value=!1}).catch(e=>{console.log("表单错误信息：",e)})},re=()=>{O.value=!O.value,j("sendBalanceStatus",O.value)},pe=()=>{r({url:"/pages/user/account/index"})};return a({isBalance:O}),(e,a)=>{const r=o,p=g,m=N,f=S,y=v(_("format-price"),H),T=v(_("tig-checkbox"),Q),x=v(_("tig-button"),K),w=v(_("tig-fixed-placeholder"),Z),A=U,D=v(_("tig-popup"),X),j=v(_("uni-easyinput"),le),z=v(_("uni-forms-item"),oe),F=v(_("uni-forms"),se);return l(),u(d,null,[n(r,{class:"coupon-info"},{default:s(()=>[3!=e.flowType?(l(),u(d,{key:0},[1==h(C).useCoupon?(l(),t(r,{key:0,class:"coupon"},{default:s(()=>[n(r,{class:"coupon-title"},{default:s(()=>[c(i(e.$t("优惠券")),1)]),_:1}),n(r,{class:"coupon-content",onClick:R},{default:s(()=>[n(r,{class:"coupon-text"},{default:s(()=>[c(i(e.$t("优惠")+h(P)+e.couponAmount),1)]),_:1}),n(p,{"lazy-load":"",class:"more-ico",src:h(b)("common/more.png")},null,8,["src"])]),_:1})]),_:1})):k("",!0),1==h(C).usePoints?(l(),t(r,{key:1,class:"points"},{default:s(()=>[n(r,{class:"points-title"},{default:s(()=>[c(i(e.$t(h(C).integralName))+" ",1),n(r,{class:"points-text"},{default:s(()=>[c(i(e.$t(`当前账户${h(C).integralName}`))+"：",1),n(m,{class:"special-text"},{default:s(()=>[c(i(e.points),1)]),_:1})]),_:1})]),_:1}),n(r,{class:"points-content",onClick:ie},{default:s(()=>[e.pointsAmount>0?(l(),t(r,{key:0,class:"points-text"},{default:s(()=>[c(i(e.$t("共抵扣："))+i(h(P)+e.pointsAmount),1)]),_:1})):0===e.points&&0===e.pointsAmount?(l(),t(r,{key:1,class:"points-text"},{default:s(()=>[c(i(e.$t(`暂无可用${h(C).integralName}`)),1)]),_:1})):(l(),t(r,{key:2,class:"points-text"},{default:s(()=>[c(i(h(V)()?e.$t(`最多可用{0}${h(C).integralName}`,[e.availablePoints]):`最多可用${e.availablePoints}${h(C).integralName}`),1)]),_:1})),n(p,{"lazy-load":"",class:"more-ico",src:h(b)("common/more.png")},null,8,["src"])]),_:1})]),_:1})):k("",!0)],64)):k("",!0),1==h(C).useSurplus?(l(),t(r,{key:1,class:"balance"},{default:s(()=>[n(r,{class:"balance-title",onClick:pe},{default:s(()=>[c(i(e.$t("余额"))+" ",1),n(r,{class:"balance-text"},{default:s(()=>[c(i(e.$t("当前账户余额"))+"：",1),n(m,{class:"special-text"},{default:s(()=>[c(i(e.balance),1)]),_:1})]),_:1})]),_:1}),n(f,{checked:O.value,color:"var(--general)",style:{transform:"scale(0.8)"},onChange:re},null,8,["checked"])]),_:1})):k("",!0)]),_:1}),n(D,{show:L.value,"onUpdate:show":a[2]||(a[2]=e=>L.value=e),"background-color":"#fff"},{default:s(()=>[n(A,{"scroll-y":"true",class:"coupon-container"},{default:s(()=>[n(r,{class:"popup-title"},{default:s(()=>[c(i(e.$t("优惠券")),1)]),_:1}),n(r,{class:"coupon-menu"},{default:s(()=>[n(r,{class:$(["coupon-menu-item",{active:"可用优惠券"===M.value}]),onClick:a[0]||(a[0]=e=>q("可用优惠券"))},{default:s(()=>[c(i(e.$t("可用优惠券"))+"("+i(B.value.enableCoupons.length)+")",1)]),_:1},8,["class"]),n(r,{class:$(["coupon-menu-item",{active:"不可用优惠券"===M.value}]),onClick:a[1]||(a[1]=e=>q("不可用优惠券"))},{default:s(()=>[c(i(e.$t("不可用优惠券"))+"("+i(B.value.disableCoupons.length)+")",1)]),_:1},8,["class"])]),_:1}),n(r,{class:"coupon-container-content"},{default:s(()=>["可用优惠券"===M.value?(l(),u(d,{key:0},[n(r,{class:"coupon-box"},{default:s(()=>[(l(!0),u(d,null,I(B.value.enableCoupons,(a,o)=>(l(),t(r,{key:o,class:"coupon-item",onClick:e=>(e=>{e.selected=!e.selected,e.selected?W(e):E(e)})(a)},{default:s(()=>[n(r,{class:"coupon-click-area"}),n(r,{class:"left"},{default:s(()=>[n(r,{class:"col-1"},{default:s(()=>[n(r,{class:"title"},{default:s(()=>[c(i(a.couponName),1)]),_:2},1024)]),_:2},1024),a.couponDesc?(l(),t(r,{key:0,class:"col-2"},{default:s(()=>[c(i(a.couponDesc),1)]),_:2},1024)):k("",!0),n(r,{class:$(["col-3",{"special-col":!a.couponDesc}])},{default:s(()=>[c(i(e.$t("有效期："))+i(a.endDate),1)]),_:2},1032,["class"])]),_:2},1024),n(r,{class:"right"},{default:s(()=>[n(r,{class:"right-1"},{default:s(()=>[2===a.couponType?(l(),u(d,{key:0},[n(r,{class:"zhekou"},{default:s(()=>[c(i(a.couponDiscount),1)]),_:2},1024),n(r,{class:"zhe"},{default:s(()=>[c(i(e.$t("折")),1)]),_:1})],64)):(l(),t(y,{key:1,"font-style":{fontSize:"48rpx",lineHeight:1},"currency-style":{selfAlign:"end",fontSize:"24rpx"},"price-data":a.couponMoney},null,8,["price-data"]))]),_:2},1024),n(r,{class:"right-2"},{default:s(()=>[n(T,{checked:a.selected},null,8,["checked"])]),_:2},1024)]),_:2},1024),n(r,{class:"dotted-line"})]),_:2},1032,["onClick"]))),128))]),_:1}),0===B.value.enableCoupons.length?(l(),t(r,{key:0,class:"coupon-empty"},{default:s(()=>[c(i(e.$t("暂无优惠券")),1)]),_:1})):k("",!0)],64)):k("",!0),"不可用优惠券"===M.value?(l(),u(d,{key:1},[n(r,{class:"coupon-box"},{default:s(()=>[(l(!0),u(d,null,I(B.value.disableCoupons,(a,o)=>(l(),t(r,{key:o,class:"coupon-item grayScaleDiv"},{default:s(()=>[n(r,{class:"left"},{default:s(()=>[n(r,{class:"col-1"},{default:s(()=>[n(r,{class:"title"},{default:s(()=>[c(i(a.couponName),1)]),_:2},1024)]),_:2},1024),a.disableReason?(l(),t(r,{key:0,class:"col-2"},{default:s(()=>[c(i(a.disableReason),1)]),_:2},1024)):k("",!0),n(r,{class:$(["col-3",{"special-col":!a.couponDesc}])},{default:s(()=>[c(i(e.$t("有效期："))+i(a.endDate),1)]),_:2},1032,["class"])]),_:2},1024),n(r,{class:"right"},{default:s(()=>[n(r,{class:"right-1"},{default:s(()=>[2===a.couponType?(l(),u(d,{key:0},[n(r,{class:"zhekou"},{default:s(()=>[c(i(a.couponDiscount),1)]),_:2},1024),n(r,{class:"zhe"},{default:s(()=>[c(i(e.$t("折")),1)]),_:1})],64)):(l(),t(y,{key:1,"font-style":{fontSize:"48rpx",lineHeight:1},"currency-style":{selfAlign:"end",fontSize:"24rpx"},"price-data":a.couponMoney},null,8,["price-data"]))]),_:2},1024),n(r,{class:"right-2"},{default:s(()=>[n(T,{checked:a.selected,"onUpdate:checked":e=>a.selected=e,disabled:!0},null,8,["checked","onUpdate:checked"])]),_:2},1024)]),_:2},1024),n(r,{class:"dotted-line"})]),_:2},1024))),128))]),_:1}),0===B.value.disableCoupons.length?(l(),t(r,{key:0,class:"coupon-empty"},{default:s(()=>[c(i(e.$t("暂无优惠券")),1)]),_:1})):k("",!0)],64)):k("",!0)]),_:1}),n(w,{"background-color":"#fff"},{default:s(()=>[n(r,{class:"btn-box"},{default:s(()=>[n(x,{onClick:ee},{default:s(()=>[c(i(e.$t("确定")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show"]),n(D,{show:ae.value,"onUpdate:show":a[4]||(a[4]=e=>ae.value=e),"background-color":"#f5f5f5"},{default:s(()=>[n(r,{class:"points-popup"},{default:s(()=>[n(r,{class:"popup-title"},{default:s(()=>[c(i(e.$t(h(C).integralName)),1)]),_:1}),n(r,{class:"form-usePoints"},{default:s(()=>[n(F,{ref_key:"pointsForm",ref:ue,"model-value":te},{default:s(()=>[n(z,{"label-width":"80",label:e.$t(`使用${h(C).integralName}`),name:"usePoints"},{default:s(()=>[n(j,{modelValue:te.usePoints,"onUpdate:modelValue":a[3]||(a[3]=e=>te.usePoints=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,type:"number",placeholder:e.$t(`请输入${h(C).integralName}`)},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model-value"])]),_:1}),n(w,{"background-color":"#fff"},{default:s(()=>[n(r,{class:"btn-box"},{default:s(()=>[n(x,{onClick:de},{default:s(()=>[c(i(e.$t("确定")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])],64)}}}),[["__scopeId","data-v-f9345859"]]),fe=p(a({__name:"invoiceInfo",props:{getAddressInfo:{type:Object,default:()=>{}},invoiceInfo:{type:Object,default:()=>{}}},emits:["update:invoiceInfo","change"],setup(e,{emit:a}){const{t:p}=m(),I=w(),T=e,C=a,P=x(()=>{switch(T.invoiceInfo.invoiceType){case 1:return"普通发票";case 2:return"增值税专用发票";default:return"不开发票"}}),V={companyCode:{rules:[{required:!0,errorMessage:p("纳税人识号不能为空!")}]},companyAddress:{rules:[{required:!0,errorMessage:p("单位地址不能为空!")}]},companyPhone:{rules:[{required:!0,errorMessage:p("单位电话不能为空!")}]},companyBank:{rules:[{required:!0,errorMessage:p("开户银行不能为空!")}]},companyAccount:{rules:[{required:!0,errorMessage:p("银行账户不能为空!")}]},mobile:{rules:[{required:!0,errorMessage:p("手机不能为空!")}]}},S=()=>{B(),q()},z=A({titleType:1,invoiceType:1,companyName:"",mobile:"",email:"",companyCode:"",companyAddress:"",companyPhone:"",companyBank:"",companyAccount:""}),B=()=>{z.companyName="",z.mobile="",z.email="",z.companyCode="",z.companyAddress="",z.companyPhone="",z.companyBank="",z.companyAccount=""},L=f(!1),O=f(!1),M=async()=>{try{const e=await ce();e&&Object.keys(e).length>0?(L.value=!0,2===z.invoiceType&&(z.companyCode=e.companyCode,z.companyAddress=e.companyAddress,z.companyPhone=e.companyPhone,z.companyBank=e.companyBank,z.companyAccount=e.companyAccount)):L.value=!1}catch(e){console.error(e)}},q=async()=>{try{const e=await ue({invoiceType:z.invoiceType,titleType:z.titleType});e?(1===z.invoiceType&&1===z.titleType?(z.companyName=e.companyName,z.mobile=e.mobile,z.email=e.email):(z.companyCode=e.companyCode,z.companyName=e.companyName,z.companyAddress=e.companyAddress,z.companyPhone=e.companyPhone,z.companyBank=e.companyBank,z.companyAccount=e.companyAccount),z.mobile=e.mobile,z.email=e.email):1===z.titleType&&(z.companyName=T.getAddressInfo.consignee,z.mobile=T.getAddressInfo.mobile,z.email=T.getAddressInfo.email)}catch(e){console.error(e)}};y(O,e=>{var a;e&&(M(),0==(null==(a=Object.keys(T.invoiceInfo))?void 0:a.length)&&q())});const R=()=>{O.value=!0},W=e=>{z.invoiceType=e,B(),1==e?q():M()},E=f(),F=()=>{O.value=!1,C("update:invoiceInfo",{})},J=()=>{E.value.validate().then(()=>{C("update:invoiceInfo",z),O.value=!1}).catch(e=>{console.log("表单错误信息：",e)})},G=()=>{r({url:"/pages/user/invoiceManagement/index?type=invoice"})};return(e,a)=>{const r=o,p=g,m=N,f=v(_("up-radio"),D),y=v(_("up-radio-group"),j),T=v(_("uni-forms-item"),oe),x=v(_("uni-easyinput"),le),C=v(_("uni-forms"),se),w=v(_("tig-button"),K),A=v(_("tig-fixed-placeholder"),Z),B=U,M=v(_("tig-popup"),X);return l(),t(r,{class:"invoice-info"},{default:s(()=>[n(r,{class:"invoice"},{default:s(()=>[n(r,{class:"invoice-title"},{default:s(()=>[c(i(e.$t("发票")),1)]),_:1}),n(r,{class:"invoice-content",onClick:R},{default:s(()=>[n(r,{class:"invoice-text"},{default:s(()=>[c(i(e.$t(P.value||"")),1)]),_:1}),n(p,{"lazy-load":"",class:"more-ico",src:h(b)("common/more.png")},null,8,["src"])]),_:1})]),_:1}),n(M,{show:O.value,"onUpdate:show":a[14]||(a[14]=e=>O.value=e)},{default:s(()=>[n(B,{"scroll-y":"true",class:"invoice-popup-content"},{default:s(()=>[n(r,{class:"invoice-popup-box"},{default:s(()=>[n(r,{class:"popup-title title"},{default:s(()=>[c(i(e.$t("发票")),1)]),_:1}),n(r,{class:"invoice-typemenu"},{default:s(()=>[n(r,{class:$(["invoice-typemenu-item",{active:1===z.invoiceType}]),onClick:a[0]||(a[0]=e=>W(1))},{default:s(()=>[c("普通发票")]),_:1},8,["class"]),1==h(I).invoiceAdded?(l(),t(r,{key:0,class:$(["invoice-typemenu-item",{active:2===z.invoiceType}]),onClick:a[1]||(a[1]=e=>W(2))},{default:s(()=>[c("增值税专用发票")]),_:1},8,["class"])):k("",!0),n(r,{class:"invoice-explain"},{default:s(()=>[c(" 我公司依法开具发票，请您按照税法规定使用发票。根据现行税收政策，部分公司提供数电票, 数电（专用发票）法律效力与现有增值税专用发票相同;如商品由第三方卖家销售，发票类型和内容将由该卖家决定，发票由卖家开具并提供。如您为企业采购，需要多单合并开具或批量提交发票可注册企业用户；"),n(m,{class:"special-text"},{default:s(()=>[c("使用礼品卡支付部分的金额，不支持开发票")]),_:1})]),_:1})]),_:1}),n(r,{class:"invoice-formState"},{default:s(()=>[n(C,{ref_key:"formRef",ref:E,"model-value":z,rules:V,"label-width":"170rpx"},{default:s(()=>[1===z.invoiceType?(l(),u(d,{key:0},[n(T,{label:e.$t("发票抬头"),name:"name"},{default:s(()=>[n(r,{class:"item-layout",onChange:S},{default:s(()=>[n(y,{modelValue:z.titleType,"onUpdate:modelValue":a[2]||(a[2]=e=>z.titleType=e),placement:"row"},{default:s(()=>[n(f,{"custom-style":{marginRight:"22rpx"},name:1,"active-color":"var(--general)",label:e.$t("个人")},null,8,["label"]),n(f,{name:2,"active-color":"var(--general)",label:e.$t("企业")},null,8,["label"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["label"]),1==z.titleType?(l(),t(T,{key:0,label:e.$t("个人名称"),name:"companyName",rules:[{required:!0,errorMessage:e.$t("个人名称不能为空")}]},{default:s(()=>[n(x,{modelValue:z.companyName,"onUpdate:modelValue":a[3]||(a[3]=e=>z.companyName=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入个人名称")},null,8,["modelValue","placeholder"])]),_:1},8,["label","rules"])):(l(),u(d,{key:1},[n(T,{label:e.$t("企业名称"),name:"companyName",rules:[{required:!0,errorMessage:e.$t("企业名称不能为空")}]},{default:s(()=>[n(x,{modelValue:z.companyName,"onUpdate:modelValue":a[4]||(a[4]=e=>z.companyName=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入企业名称")},null,8,["modelValue","placeholder"])]),_:1},8,["label","rules"]),n(T,{label:e.$t("纳税人识号"),name:"companyCode"},{default:s(()=>[n(x,{modelValue:z.companyCode,"onUpdate:modelValue":a[5]||(a[5]=e=>z.companyCode=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入纳税人识号")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(T,{label:e.$t("单位地址"),name:"companyAddress"},{default:s(()=>[n(x,{modelValue:z.companyAddress,"onUpdate:modelValue":a[6]||(a[6]=e=>z.companyAddress=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入单位地址")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(T,{label:e.$t("单位电话"),name:"companyPhone"},{default:s(()=>[n(x,{modelValue:z.companyPhone,"onUpdate:modelValue":a[7]||(a[7]=e=>z.companyPhone=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入单位电话")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(T,{label:e.$t("开户银行"),name:"companyBank"},{default:s(()=>[n(x,{modelValue:z.companyBank,"onUpdate:modelValue":a[8]||(a[8]=e=>z.companyBank=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入开户银行")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(T,{label:e.$t("银行账户"),name:"companyAccount"},{default:s(()=>[n(x,{modelValue:z.companyAccount,"onUpdate:modelValue":a[9]||(a[9]=e=>z.companyAccount=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入银行账户")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])],64)),n(T,{label:e.$t("收票人手机"),name:"mobile"},{default:s(()=>[n(x,{modelValue:z.mobile,"onUpdate:modelValue":a[10]||(a[10]=e=>z.mobile=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入收票人手机")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(T,{label:e.$t("收票人邮箱"),name:"email"},{default:s(()=>[n(x,{modelValue:z.email,"onUpdate:modelValue":a[11]||(a[11]=e=>z.email=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入收票人邮箱")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])],64)):2===z.invoiceType&&L.value?(l(),u(d,{key:1},[n(r,{class:"invoiceInfo-content-item"},{default:s(()=>[n(r,{class:"item-label"},{default:s(()=>[c(i(e.$t("纳税人识号")),1)]),_:1}),n(r,{class:"item-value"},{default:s(()=>[c(i(z.companyCode),1)]),_:1})]),_:1}),n(r,{class:"invoiceInfo-content-item"},{default:s(()=>[n(r,{class:"item-label"},{default:s(()=>[c(i(e.$t("单位地址")),1)]),_:1}),n(r,{class:"item-value"},{default:s(()=>[c(i(z.companyAddress),1)]),_:1})]),_:1}),n(r,{class:"invoiceInfo-content-item"},{default:s(()=>[n(r,{class:"item-label"},{default:s(()=>[c(i(e.$t("单位电话")),1)]),_:1}),n(r,{class:"item-value"},{default:s(()=>[c(i(z.companyPhone),1)]),_:1})]),_:1}),n(r,{class:"invoiceInfo-content-item"},{default:s(()=>[n(r,{class:"item-label"},{default:s(()=>[c(i(e.$t("开户银行")),1)]),_:1}),n(r,{class:"item-value"},{default:s(()=>[c(i(z.companyBank),1)]),_:1})]),_:1}),n(r,{class:"invoiceInfo-content-item"},{default:s(()=>[n(r,{class:"item-label"},{default:s(()=>[c(i(e.$t("银行账户")),1)]),_:1}),n(r,{class:"item-value"},{default:s(()=>[c(i(z.companyAccount),1)]),_:1})]),_:1}),n(T,{label:e.$t("收票人手机"),name:"mobile"},{default:s(()=>[n(x,{modelValue:z.mobile,"onUpdate:modelValue":a[12]||(a[12]=e=>z.mobile=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入收票人手机")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(T,{label:e.$t("收票人邮箱"),name:"email"},{default:s(()=>[n(x,{modelValue:z.email,"onUpdate:modelValue":a[13]||(a[13]=e=>z.email=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入收票人邮箱")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])],64)):(l(),t(r,{key:2,class:"notPass"},{default:s(()=>[n(r,null,{default:s(()=>[c(i(e.$t("您还未通过增票资质申请，暂时无法开具增值税专用发票"))+" ",1),n(m,{class:"notPassBtn",onClick:G},{default:s(()=>[c(i(e.$t("去申请")),1)]),_:1})]),_:1})]),_:1}))]),_:1},8,["model-value"])]),_:1}),n(A,{"background-color":"#fff"},{default:s(()=>[n(r,{class:"btn-box"},{default:s(()=>[n(w,{class:"btn",plain:"",disabled:2===z.invoiceType&&!L.value,onClick:F},{default:s(()=>[c(i(e.$t("暂不开票")),1)]),_:1},8,["disabled"]),n(w,{class:"btn",disabled:2===z.invoiceType&&!L.value,onClick:J},{default:s(()=>[c(i(e.$t("提交")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])]),_:1})}}}),[["__scopeId","data-v-322121b9"]]),ye=p(a({__name:"remark",props:{modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(e,{emit:a}){const u=e,d=a,r=x({get:()=>u.modelValue,set(e){d("update:modelValue",e)}});return(e,a)=>{const u=o,d=v(_("up-input"),z);return l(),t(u,{class:"remark"},{default:s(()=>[n(u,{class:"remark-title"},{default:s(()=>[c(i(e.$t("备注")),1)]),_:1}),n(u,{class:"remark-content"},{default:s(()=>[n(d,{modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=e=>r.value=e),placeholder:e.$t("备注建议提前协商（250字以内）"),border:"none","input-align":"right",maxlength:"250",clearable:!0},null,8,["modelValue","placeholder"])]),_:1})]),_:1})}}}),[["__scopeId","data-v-f6ca286c"]]),ve=p(a({__name:"totalCard",props:{total:{type:Object,default:()=>({})},cartList:{type:Array,default:()=>[]},flowType:{type:Number}},setup(e){const a=w(),u=f(!1),d=()=>{u.value=!u.value};return(r,p)=>{const m=o,f=v(_("format-price"),H),y=v(_("up-icon"),B),g=N;return l(),t(m,{class:"total-card"},{default:s(()=>[n(m,null,{default:s(()=>[n(m,{class:"total-card-item"},{default:s(()=>[n(m,{class:"total-card-item-left"},{default:s(()=>[c(i(r.$t("商品总价")),1)]),_:1}),n(m,{class:"total-card-item-right"},{default:s(()=>[n(f,{"is-bottom":!1,"price-data":e.total.productAmount},null,8,["price-data"])]),_:1})]),_:1}),e.total.serviceFee&&e.total.serviceFee>0?(l(),t(m,{key:0,class:"total-card-item"},{default:s(()=>[n(m,{class:"total-card-item-left"},{default:s(()=>[c(i(r.$t("附加费用")),1)]),_:1}),n(m,{class:"total-card-item-right"},{default:s(()=>[n(f,{"is-bottom":!1,"price-data":e.total.serviceFee},null,8,["price-data"])]),_:1})]),_:1})):k("",!0),e.total.shippingFee>0?(l(),t(m,{key:1,class:"total-card-item"},{default:s(()=>[n(m,{class:"total-card-item-left"},{default:s(()=>[c(i(r.$t("配送费用")),1)]),_:1}),n(m,{class:"total-card-item-right special-text"},{default:s(()=>[n(f,{"is-bottom":!1,"price-data":e.total.shippingFee},null,8,["price-data"])]),_:1})]),_:1})):k("",!0),e.total.balance>0?(l(),t(m,{key:2,class:"total-card-item"},{default:s(()=>[n(m,{class:"total-card-item-left"},{default:s(()=>[c(i(r.$t("使用余额")),1)]),_:1}),n(m,{class:"total-card-item-right"},{default:s(()=>[c("- "),n(f,{"is-bottom":!1,"price-data":e.total.balance},null,8,["price-data"])]),_:1})]),_:1})):k("",!0),e.total.pointsAmount>0&&3!=e.flowType?(l(),t(m,{key:3,class:"total-card-item"},{default:s(()=>[n(m,{class:"total-card-item-left"},{default:s(()=>[c(i(r.$t(`${h(a).integralName}减免`)),1)]),_:1}),n(m,{class:"total-card-item-right"},{default:s(()=>[c("- "),n(f,{"is-bottom":!1,"price-data":e.total.pointsAmount},null,8,["price-data"])]),_:1})]),_:1})):k("",!0),e.total.discounts>0?(l(),t(m,{key:4,class:"total-card-item"},{default:s(()=>[n(m,{class:"total-card-item-left",onClick:d},{default:s(()=>[c(i(r.$t("共优惠"))+" ",1),n(y,{style:{"padding-left":"4rpx"},size:"16",color:"#969799",name:"info-circle"})]),_:1}),n(m,{class:"total-card-item-right"},{default:s(()=>[n(m,null,{default:s(()=>[c(" - "),n(f,{"is-bottom":!1,"price-data":e.total.discounts},null,8,["price-data"])]),_:1})]),_:1})]),_:1})):k("",!0),e.total.orderSendPoint&&e.total.orderSendPoint>0?(l(),t(m,{key:5,class:"total-card-tig"},{default:s(()=>[c(" * "+i(r.$t("该订单完成后，您将预计获得"))+" ",1),n(g,{class:"special-text"},{default:s(()=>[c(i(e.total.orderSendPoint),1)]),_:1}),c(" "+i(r.$t(h(a).integralName)),1)]),_:1})):k("",!0)]),_:1}),n(ie,{modelValue:u.value,"onUpdate:modelValue":p[0]||(p[0]=e=>u.value=e),total:e.total,"discount-type":"order"},null,8,["modelValue","total"])]),_:1})}}}),[["__scopeId","data-v-774f31be"]]),_e=p(a({__name:"check",setup(a){const{t:u}=m(),d=w(),p=L(),y=A({addressId:0,shippingType:{},payTypeId:0,usePoint:0,useBalance:0,useCouponIds:[],selectUserCouponIds:[],buyerNote:"",invoiceData:{},productExtra:{}}),g=f([]),b=f({}),I=async()=>{try{const e=await ee({page:1,size:99}),a=J("link");if(0===e.records.length&&!a)return r({url:"/pages/address/list"});e.records.length>0&&(b.value=e.records[0],y.addressId=e.records[0].addressId,g.value=e.records)}catch(e){console.error(e)}},$=f([]),C=async()=>{try{const a=await e({url:"order/check/getAvailablePaymentType",method:"GET"});y.payTypeId=a[0].typeId,$.value=a}catch(a){console.log(a)}},N=f({}),P=async()=>{try{const t=await(a={flowType:z.value},e({url:"order/check/getStoreShippingType",method:"GET",params:a}));N.value=t;for(const e in t)t[e]&&t[e].length>0&&(y.shippingType[e]={typeId:t[e][0].shippingTypeId,shopId:t[e][0].shopId,typeName:t[e][0].shippingTypeName})}catch(t){console.log(t)}var a},S=f([]),U=f(),D=f([]),j=f([]),z=f(1),B=f(0),X=async()=>{try{const t=await(a={flowType:z.value,...y},e({url:"order/check/index",method:"post",data:a})),{cartList:l,total:o,couponList:s,tmplIds:n,item:u,useCouponIds:c,selectUserCouponIds:i}=t;Object.assign(y,u),S.value=l,U.value=o,D.value=s,j.value=n,B.value=t.availablePoints,c&&c.length>0&&(y.useCouponIds=c),i&&i.length>0&&(y.selectUserCouponIds=i)}catch(t){console.error(t)}var a},Q=async e=>{y.productExtra=e;const a=await ae();a&&(S.value=a.cartList)},ae=async()=>{M({title:u("加载中")});try{const t=await(a={flowType:z.value,...y},e({url:"order/check/update",method:"post",data:a}));return Object.assign(y,t.item),U.value=t.total,B.value=t.availablePoints,t}catch(t){T({title:t.message,duration:1500})}finally{R()}var a},te=async()=>{M({title:u("加载中")});try{const t=await(a=y,e({url:"order/check/updateCoupon",method:"post",data:a}));return D.value=t.couponList,U.value=t.total,S.value=t.cartList,y.useCouponIds=t.useCouponIds,y.selectUserCouponIds=t.selectUserCouponIds,t}catch(t){console.error(t)}finally{R()}var a},le=e=>{y.useBalance=e?p.userInfo.balance:0,ae()},oe=x(()=>{if(!y.shippingType)return!0;for(const e of S.value)if(0===e.noShipping&&!y.shippingType[e.shopId])return!0;return!1}),se=f(!1),ne=async()=>{if(!se.value)return 0===y.payTypeId?T({title:u("请选择付款方式"),icon:"none"}):void(oe.value||se.value||(se.value=!0,ue()))},ue=async()=>{try{const t=await(a=y,e({url:"order/check/submit",method:"post",data:a}));2===t.returnType?t.grouponPromotionRecordId?q({url:`/pages/product/groupBuying?grouponPromotionRecordId=${t.grouponPromotionRecordId}`,mode:"redirectTo"}):q({url:`/pages/order/payStatus?id=${t.orderId}`,mode:"redirectTo"}):q({url:`/pages/order/pay?orderId=${t.orderId}`,mode:"redirectTo"})}catch(t){if(console.error(t),"wechat"===d.XClientType&&5002===t.code)return G("bindWechatFlowType",z.value),q({url:`/pages/user/profile/index?bindWechat=true&flowType=${z.value}`});T({title:t.message,icon:"none"}),setTimeout(()=>{q({url:"/pages/cart/index",mode:"redirectTo"})},1500)}finally{se.value=!1}var a},ce=f();O(async()=>{ie(),(null==ce?void 0:ce.value)&&(ce.value.isBalance=!1,y.useBalance=0)});const ie=async()=>{try{M({title:u("加载中")}),await Promise.all([I(),C(),P(),p.getUserInfo()]),await X()}catch(e){console.error(e),T({title:e.message,icon:"none"}),setTimeout(()=>{q({url:"/pages/cart/index",mode:"redirectTo"})},1500)}finally{R()}};return W(()=>{E("link")}),F(e=>{e&&e.flowType&&(z.value=e.flowType)}),(e,a)=>{const u=o,r=v(_("format-price"),H),m=v(_("tig-button"),K),f=v(_("tig-fixed-placeholder"),Z),g=v(_("tig-layout"),Y);return l(),t(g,{title:"提交订单"},{default:s(()=>{var o,v;return[n(de,{data:b.value},null,8,["data"]),$.value.length>0?(l(),t(re,{key:0,"pay-type-id":y.payTypeId,"onUpdate:payTypeId":a[0]||(a[0]=e=>y.payTypeId=e),"available-payment-type":$.value,onChange:ae},null,8,["pay-type-id","available-payment-type"])):k("",!0),n(pe,{"shipping-type":y.shippingType,"onUpdate:shippingType":a[1]||(a[1]=e=>y.shippingType=e),"cart-list":S.value,"shipping-type-list":N.value,onChange:ae,onChangeProductExtra:Q},null,8,["shipping-type","cart-list","shipping-type-list"]),n(ye,{modelValue:y.buyerNote,"onUpdate:modelValue":a[2]||(a[2]=e=>y.buyerNote=e)},null,8,["modelValue"]),1==h(d).useCoupon||1==h(d).usePoints||1==h(d).useSurplus?(l(),t(me,{key:1,ref_key:"couponInfoRef",ref:ce,"use-coupon-ids":y.useCouponIds,"onUpdate:useCouponIds":a[3]||(a[3]=e=>y.useCouponIds=e),"select-user-coupon-ids":y.selectUserCouponIds,"onUpdate:selectUserCouponIds":a[4]||(a[4]=e=>y.selectUserCouponIds=e),"use-point":y.usePoint,"onUpdate:usePoint":a[5]||(a[5]=e=>y.usePoint=e),balance:h(p).userInfo.balance??0,points:h(p).userInfo.points,"available-points":B.value,"points-amount":Number(null==(o=U.value)?void 0:o.pointsAmount)??0,"coupon-amount":Number(null==(v=U.value)?void 0:v.discountCouponAmount)??0,"coupon-list":D.value,"flow-type":z.value,onSendBalanceStatus:le,onChange:te},null,8,["use-coupon-ids","select-user-coupon-ids","use-point","balance","points","available-points","points-amount","coupon-amount","coupon-list","flow-type"])):k("",!0),1!==h(d).canInvoice||h(V)()?k("",!0):(l(),t(fe,{key:2,"invoice-info":y.invoiceData,"onUpdate:invoiceInfo":a[6]||(a[6]=e=>y.invoiceData=e),"get-address-info":b.value},null,8,["invoice-info","get-address-info"])),n(ve,{total:U.value,"cart-list":S.value,"flow-type":z.value},null,8,["total","cart-list","flow-type"]),n(f,{"background-color":"#fff"},{default:s(()=>[n(u,{class:"submit-btn-box"},{default:s(()=>[n(u,{class:"submit-btn-price"},{default:s(()=>{var a;return[n(u,{class:"price-text"},{default:s(()=>[c(i(e.$t("应付"))+":",1)]),_:1}),3==z.value?(l(),t(u,{key:0,class:"points-box"},{default:s(()=>[n(u,{class:"points-value"},{default:s(()=>{var a;return[c(i(null==(a=U.value)?void 0:a.exchangePoints)+" ",1),n(u,{class:"points-text"},{default:s(()=>[c(i(e.$t(h(d).integralName)),1)]),_:1})]}),_:1}),n(u,{class:"symbol"},{default:s(()=>[c("+")]),_:1})]),_:1})):k("",!0),n(r,{"font-style":{fontWeight:"bold",fontSize:"34rpx"},"decimals-style":{fontSize:"24rpx",fontWeight:"bold"},"currency-style":{fontSize:"23rpx",fontWeight:"bold"},"price-data":null==(a=U.value)?void 0:a.unpaidAmount},null,8,["price-data"])]}),_:1}),n(u,null,{default:s(()=>[n(m,{class:"btn",disabled:oe.value,onClick:ne},{default:s(()=>[c(i(e.$t("提交订单")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]}),_:1})}}}),[["__scopeId","data-v-f20cf08d"]]);export{_e as default};

import{d as e,c as a,b as t,i as l,w as n,e as o,bL as r,J as u,P as i,a as s,f as d,G as c,H as p,h as y,t as f,bM as m,K as v,_ as g,r as _,Z as h,al as I,L as T,l as w,n as k,j as b,R as P,X as x,o as C,C as S,F as $,aL as L,k as j}from"./index-BZxHr1FI.js";import{T as V,c as X,a as W}from"./tig-layout.DTz8E-sj.js";import{_ as A}from"./format-price.BrXrBVy6.js";import{T as R}from"./tig-fixed-placeholder.BDsbIjoZ.js";import{o as q,r as B,c as M,a as U,b as G,d as H}from"./pay.BqVkFc1p.js";import"./currency.Dn5A4d7X.js";const J=g(e({__name:"payment",props:{paymentList:{},modelValue:{}},emits:["update:modelValue"],setup(e,{emit:g}){const _=g,h={wechat:"微信支付",alipay:"支付宝支付",paypal:"PayPal支付",offline:"线下支付",yabanpayWechat:"微信支付",yabanpayAlipay:"支付宝支付",yunpayWechat:"微信支付",yunpayAlipay:"支付宝支付",yunpayYunshanfu:"云闪付"},I=e=>{_("update:modelValue",e.detail.value)};return(e,g)=>{const _=d,T=l,w=m,k=r;return t(),a(T,{class:"paymentType"},{default:n(()=>[o(T,{class:"pay-list"},{default:n(()=>[o(k,{class:"radio-group",onChange:I},{default:n(()=>[(t(!0),u(v,null,i(e.paymentList,(l,r)=>(t(),a(T,{key:r,class:"item"},{default:n(()=>[o(T,{class:"payment-info"},{default:n(()=>["offline"!==l?(t(),a(_,{key:0,class:"payment-info-img",src:c(p)("payment/pay_"+l+".png")},null,8,["src"])):s("",!0),o(T,{class:"payment-info-text"},{default:n(()=>[y(f(e.$t(h[l])),1)]),_:2},1024)]),_:2},1024),o(w,{value:l,"active-background-color":"var(--general)",checked:l===e.modelValue,style:{"margin-right":"20rpx",transform:"scale(0.9)"}},null,8,["value","checked"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-0edb26df"]]),N=g(e({__name:"offline",props:{offlinePaymentList:{}},setup(e){const r=e=>{u.value=e},u=_("银行汇款");return(e,i)=>{const d=l,c=I;return t(),a(d,{class:"offline-warp"},{default:n(()=>[o(d,{class:"offline-menu"},{default:n(()=>[o(d,{class:h(["offline-menu-item",{active:"银行汇款"===u.value}]),onClick:i[0]||(i[0]=e=>r("银行汇款"))},{default:n(()=>[y(f(e.$t("银行汇款")),1)]),_:1},8,["class"]),o(d,{class:h(["offline-menu-item",{active:"企业汇款"===u.value}]),onClick:i[1]||(i[1]=e=>r("企业汇款"))},{default:n(()=>[y(f(e.$t("企业汇款")),1)]),_:1},8,["class"])]),_:1}),"银行汇款"===u.value?(t(),a(d,{key:0,class:"offline-content"},{default:n(()=>{var a;return[o(c,{nodes:null==(a=e.offlinePaymentList)?void 0:a.offlinePayBank},null,8,["nodes"])]}),_:1})):s("",!0),"企业汇款"===u.value?(t(),a(d,{key:1,class:"offline-content"},{default:n(()=>{var a;return[o(c,{nodes:null==(a=e.offlinePaymentList)?void 0:a.offlinePayCompany},null,8,["nodes"])]}),_:1})):s("",!0)]),_:1})}}}),[["__scopeId","data-v-4ba0db91"]]),Y=g(e({__name:"pay",setup(e){const{t:r}=T(),u=w(),i=_("订单支付"),d=_(!1),c=_([]),p=_(!1),m=_({}),v=_(""),g=_(),h=_(null),I=_(""),Y=_(""),F=_(null);k(e=>{e&&e.orderId&&(e.type?(I.value=e.type,i.value="充值支付",O(e.orderId)):K(e.orderId))});const K=async e=>{d.value=!0;try{const a=await q(e);g.value=a.order,c.value=a.paymentList,v.value=c.value[0],m.value=a.offlinePaymentList,F.value=a.order.orderId,Y.value=3===a.order.payTypeId?"线下支付":"在线支付",(null==a?void 0:a.grouponPromotionRecordId)&&b({url:`/pages/product/groupBuying?grouponPromotionRecordId=${a.grouponPromotionRecordId}`,mode:"redirectTo"})}catch(a){P({title:a.message,duration:1500,icon:"none"}),setTimeout(function(){b({url:"/pages/user/order/list",mode:"redirectTo"})},1500)}finally{d.value=!1}},O=async e=>{try{const a=await B({orderId:e});g.value=a.order,c.value=a.paymentList,v.value=c.value[0],F.value=a.order.orderId}catch(a){P({title:a.message,duration:1500,icon:"none"}),setTimeout(function(){x({url:"/pages/user/account/index"})},1500)}finally{d.value=!1}};let Z=null;const z=_(0),D=async()=>{if(p.value=!0,""===v.value)return P({title:r("请选择支付方式"),duration:1500,icon:"none"}),void(p.value=!1);try{if(F.value){let e;e="recharge"===I.value?await E():await Q(),e&&("alipay"===v.value&&("h5"===u.XClientType&&ne(e.payInfo.html),"app"===u.XClientType&&ue(e.payInfo)),"wechat"!==v.value&&"yunpayWechat"!==v.value||("h5"===u.XClientType&&window.open(e.payInfo.url,"_blank"),"miniProgram"===u.XClientType&&oe(e.payInfo),"wechat"===u.XClientType&&re(e.payInfo),"app"===u.XClientType&&ue(e.payInfo)),"yabanpayWechat"===v.value&&(window.location.href=e.payInfo.url),"yabanpayAlipay"===v.value&&(window.location.href=e.payInfo.url),"paypal"===v.value&&(window.location.href=e.payInfo.url),"yunpayAlipay"===v.value&&(window.location.href=e.payInfo.codeUrl),"yunpayYunshanfu"===v.value&&(window.location.href=e.payInfo.codeUrl),Z=setInterval(()=>{"recharge"===I.value?le():te(),z.value++,50===z.value&&(clearInterval(Z),P({title:r("支付已超时"),duration:1500,icon:"none"}),"recharge"===I.value?b({url:"/pages/user/account/index",mode:"redirectTo"}):b({url:"/pages/user/order/list",mode:"redirectTo"}))},2e3))}}catch(e){P({title:e.message,duration:1500,icon:"none"})}finally{p.value=!1}},E=async()=>{let e;return e=await ae(),e},Q=async()=>{let e;return e=await ee(),e},ee=async e=>{let a;try{const e={id:F.value,type:v.value};a=await M(e)}catch(t){P({title:t.message,duration:1500,icon:"none"})}finally{return a}},ae=async e=>{let a;try{const e={id:F.value,type:v.value};a=await U(e)}catch(t){P({title:t.message,duration:1500,icon:"none"})}finally{return a}},te=async()=>{try{1==await G({id:F.value})&&(clearInterval(Z),setTimeout(function(){b({url:`/pages/order/payStatus?id=${F.value}`,mode:"redirectTo"})},1500))}catch(e){}},le=async()=>{try{1==await H({id:F.value})&&(clearInterval(Z),P({title:r("支付成功"),duration:1500,icon:"none"}),setTimeout(function(){b({url:"/pages/user/account/index",mode:"redirectTo"})},1500))}catch(e){}},ne=e=>{if(h.value){h.value.innerHTML=e;const a=document.forms;a&&a[0].submit()}},oe=e=>{wx.requestPayment({timeStamp:String(e.timeStamp),nonceStr:e.nonceStr,package:e.package,signType:e.signType,paySign:e.paySign,success(e){P({title:r("支付成功"),duration:1500}),setTimeout(function(){"recharge"===I.value?b({url:"/pages/user/account/index",mode:"redirectTo"}):b({url:`/pages/order/payStatus?id=${F.value}`,mode:"redirectTo"})},1500)},fail(e){P({title:r("支付失败"),duration:1500,icon:"none"}),setTimeout(()=>{"recharge"===I.value?b({url:"/pages/user/account/index",mode:"redirectTo"}):b({url:"/pages/user/order/list",mode:"redirectTo"})},1500)}})},re=e=>{WeixinJSBridge.invoke("getBrandWCPayRequest",{...e},function(e){e.errMsg})},ue=e=>{"wechat"!==v.value?uni.requestPayment({provider:e.provider,orderInfo:e.orderInfo,success(){P({title:r("支付成功"),duration:1500,icon:"none"})},fail(){P({title:r("支付失败"),duration:1500,icon:"none"}),Z&&clearInterval(Z)},complete(){}}):uni.requestPayment({provider:"wxpay",orderInfo:{appid:e.appId,noncestr:e.nonceStr,package:e.package,partnerid:String(e.partnerId),prepayid:e.prepayId,timestamp:e.timeStamp,sign:e.sign},success(){P({title:r("支付成功"),duration:1500,icon:"none"})},fail(){P({title:r("支付失败"),duration:1500,icon:"none"}),Z&&clearInterval(Z)},complete(){}})};return C(()=>{I.value="",clearInterval(Z)}),(e,r)=>{const u=S($("tig-navbar"),X),_=l,T=S($("format-price"),A),w=j,k=S($("tig-button"),W),b=S($("tig-fixed-placeholder"),R),P=S($("tig-layout"),V);return t(),a(P,null,{default:n(()=>[o(u,{title:i.value},null,8,["title"]),d.value?(t(),a(_,{key:0,class:"page-loading"},{default:n(()=>[o(_,{class:"ico"})]),_:1})):s("",!0),g.value?(t(),a(_,{key:1,class:"order-pay-warp"},{default:n(()=>[o(_,{class:"order_infos"},{default:n(()=>[o(_,{class:"order_amount"},{default:n(()=>["recharge"!==I.value?(t(),a(T,{key:0,"is-bootom":!1,"price-data":g.value.unpaidAmount},null,8,["price-data"])):(t(),a(T,{key:1,"is-bootom":!1,"price-data":g.value.amount},null,8,["price-data"]))]),_:1}),"recharge"!==I.value?(t(),a(_,{key:0,class:"order_sn"},{default:n(()=>[y(f(e.$t("订单号"))+"： ",1),o(w,null,{default:n(()=>[y(f(g.value.orderSn),1)]),_:1})]),_:1})):s("",!0)]),_:1}),3!==g.value.payTypeId&&c.value.length>0?(t(),a(J,{key:0,modelValue:v.value,"onUpdate:modelValue":r[0]||(r[0]=e=>v.value=e),"payment-list":c.value},null,8,["modelValue","payment-list"])):s("",!0),3===g.value.payTypeId?(t(),a(N,{key:1,"offline-payment-list":m.value},null,8,["offline-payment-list"])):s("",!0),"recharge"!==I.value?(t(),a(_,{key:2,class:"other-info"},{default:n(()=>[o(_,{class:"tit"},{default:n(()=>[y(f(e.$t("其它信息")),1)]),_:1}),o(_,{class:"item"},{default:n(()=>[y(f(e.$t("支付方式："))+" ",1),o(w,null,{default:n(()=>[y(f(e.$t(Y.value)),1)]),_:1})]),_:1}),o(_,{class:"item"},{default:n(()=>[y(f(e.$t("配送方式"))+"： ",1),o(w,null,{default:n(()=>[y(f(g.value.shippingTypeName||e.$t("专线物流")),1)]),_:1})]),_:1}),o(_,{class:"item"},{default:n(()=>[y(f(e.$t("下单时间"))+"： ",1),o(w,null,{default:n(()=>[y(f(g.value.addTime),1)]),_:1})]),_:1})]),_:1})):s("",!0),3!==g.value.payTypeId?(t(),a(b,{key:3,"background-color":"#fff"},{default:n(()=>[o(_,{class:"btn-box"},{default:n(()=>[o(k,{disabled:p.value,onClick:D},{default:n(()=>[y(f(e.$t("立即支付")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})):s("",!0)]),_:1})):s("",!0),L("div",{ref_key:"formContainer",ref:h},null,512)]),_:1})}}}),[["__scopeId","data-v-397120a7"]]);export{Y as default};

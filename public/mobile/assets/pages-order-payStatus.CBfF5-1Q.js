import{d as e,b7 as a,r as t,m as s,aM as l,aT as r,c as o,b as i,ba as u,aP as n,aQ as c,b8 as v,_ as m,l as p,n as d,j as h,w as y,C as f,F as g,a9 as _,a as x,e as b,i as j,h as k,t as w,G as P}from"./index-BZxHr1FI.js";import{_ as S}from"./format-price.BrXrBVy6.js";import{_ as C}from"./tig-loadingpage.vue_vue_type_script_setup_true_lang.CErZUb08.js";import{T as M}from"./tig-layout.DTz8E-sj.js";import{g as T}from"./pay.BqVkFc1p.js";import{r as A}from"./index.CtwwUC20.js";import"./currency.Dn5A4d7X.js";import"./masonry.B_l69Lra.js";import"./specification.C71VpZ8P.js";import"./tig-image.CzXKqALH.js";import"./uni-icons.DMMn2oBg.js";import"./uni-number-box.DKxM8QIH.js";import"./product.BH5dMQls.js";import"./tig-lazy-image.BPOhG_XX.js";import"./activityCard.DE1HAQr9.js";import"./dayjs.min.BETqfnlQ.js";import"./useList.cF42RyDa.js";const L=m(e({__name:"animation",setup(e,{expose:m}){const p=.03,d=.08,h=.04,y=.06,f=1.1,g=1,_=16,x=.75,b=.2,j=.2,k={SCALE_UP:50,CHECK_MARK:25},w=c(),P=a(),S=t(0),C=t(0),M=t(0),T=t({step:0,progress:0,scale:1,checkProgress:0}),A=s(()=>[{x:.3*-M.value,y:0},{x:0,y:.3*M.value},{x:.6*M.value,y:.3*-M.value}]),L=s(()=>({width:2*S.value,height:2*C.value})),E=s(()=>4!==T.value.step);let I=null,R=null;const K=e=>Math.ceil(e),$=()=>{!R&&I&&V()},z=()=>{R&&(clearTimeout(R),R=null)},G=()=>{const{step:e,scale:a}=T.value,t=(s=a,Math.round(1e3*s)/1e3);var s;t<f&&1===e?T.value.scale+=d:t>=f&&1===e&&(T.value.step=2),2===e&&(T.value.scale-=h,t<=g&&(T.value.scale=g,setTimeout(()=>{T.value.step=3},k.CHECK_MARK))),I.save(),I.translate(S.value,C.value),1===e&&I.scale(T.value.scale,T.value.scale),I.beginPath(),I.arc(0,0,M.value,0,2*Math.PI,!1),I.setFillStyle(P.themeStyle["--general"]),I.fill(),I.restore()},U=()=>{I.save(),I.translate(S.value,C.value),I.beginPath(),I.arc(0,0,M.value,0,2*Math.PI,!1),I.setFillStyle(P.themeStyle["--general"]),I.fill(),I.restore(),I.save(),I.translate(.9*S.value,C.value),I.setStrokeStyle("#fff"),I.setLineWidth(M.value*j),I.setLineCap("round"),(()=>{const{checkProgress:e}=T.value,a=A.value,t=Math.hypot(a[1].x-a[0].x,a[1].y-a[0].y),s=Math.hypot(a[2].x-a[1].x,a[2].y-a[1].y),l=(t+s)*e;if(I.beginPath(),I.moveTo(a[0].x,a[0].y),l<=t){const e=l/t;I.lineTo(a[0].x+(a[1].x-a[0].x)*e,a[0].y+(a[1].y-a[0].y)*e)}else{I.lineTo(a[1].x,a[1].y);const e=(l-t)/s;I.lineTo(a[1].x+(a[2].x-a[1].x)*e,a[1].y+(a[2].y-a[1].y)*e)}})(),I.stroke(),I.restore(),T.value.checkProgress+=y,T.value.checkProgress>=1&&(T.value.checkProgress=1,T.value.step=4)},V=()=>{if(I){switch(I.clearRect(0,0,L.value.width,L.value.height),T.value.step){case 0:(()=>{const{progress:e}=T.value;I.save(),I.beginPath(),I.arc(S.value,C.value,M.value,-Math.PI/2,-Math.PI/2+2*Math.PI*e,!1),I.setStrokeStyle(P.themeStyle["--general"]),I.setLineWidth(M.value*b),I.setLineCap("round"),I.stroke(),I.restore(),T.value.progress+=p,T.value.progress>=1&&(T.value.progress=1,setTimeout(()=>{T.value.step=1},k.SCALE_UP))})();break;case 1:case 2:G();break;case 3:U();break;case 4:return void z();default:return void console.warn("未知动画步骤",T.value.step)}I.draw(!0),E.value&&(R=setTimeout(V,_))}else console.error("画布上下文未初始化")},W=e=>{console.error(e),z()},F=async()=>{try{const e=await n(".canvas-content",w);if(!e||!e.width||!e.height)throw new Error("无法获取画布尺寸");if(S.value=K(e.width/2),C.value=K(e.height/2),M.value=K(Math.min(e.width,e.height)/2)*x,I=v("myCanvas",w),!I)throw new Error("无法创建画布上下文");$()}catch(e){(e=>{console.error("动画初始化失败",e),z()})(e)}};return l(async()=>{setTimeout(()=>{F()},300)}),r(()=>{z()}),m({resetAnimation:()=>{z(),T.value={step:0,progress:0,scale:1,checkProgress:0},I&&L.value.width>0&&(I.clearRect(0,0,L.value.width,L.value.height),I.draw(!0))},startAnimation:$,stopAnimation:z}),(e,a)=>{const t=u;return i(),o(t,{id:"myCanvas",class:"canvas-content",hidpi:"","canvas-id":"myCanvas",onError:W})}}}),[["__scopeId","data-v-6720319c"]]),E=m(e({__name:"payStatus",setup(e){_(e=>({"23fef97d":v.value}));const l=p();d(e=>{e&&e.id?(r.value=!0,n(Number(e.id))):h({url:"/pages/index/index"})});const r=t(!1),u=t({}),n=async e=>{try{const a=await T({id:e});u.value=a}catch(a){console.error(a)}finally{r.value=!1}},c=a(),v=s(()=>c.hexToRgba(c.themeStyle["--general"],.1));return(e,a)=>{const t=j,s=f(g("format-price"),S),n=f(g("tig-loadingpage"),C),c=f(g("tig-layout"),M);return i(),o(c,null,{default:y(()=>[r.value?x("",!0):(i(),o(t,{key:0,class:"pay-status"},{default:y(()=>[b(t,{class:"pay-status-content"},{default:y(()=>[b(t,{class:"status-content"},{default:y(()=>[b(L),b(t,{class:"status-text"},{default:y(()=>[k(w(e.$t("支付成功")),1)]),_:1})]),_:1}),b(t,{class:"money"},{default:y(()=>[b(t,{class:"money-text"},{default:y(()=>[k(w(e.$t("实付")),1)]),_:1}),b(t,{class:"money-value"},{default:y(()=>[b(s,{"font-style":{fontSize:"38rpx"},"currency-style":{fontSize:"30rpx"},"decimals-style":{fontSize:"26rpx",fontWeight:"400"},"is-bootom":!0,"price-data":u.value.orderAmount},null,8,["price-data"])]),_:1})]),_:1}),b(t,{class:"status-btns"},{default:y(()=>[b(t,{class:"btn-item",onClick:a[0]||(a[0]=e=>P(h)({url:"/pages/user/order/list"}))},{default:y(()=>[k(w(e.$t("查看订单")),1)]),_:1}),b(t,{class:"btn-item primary",onClick:a[1]||(a[1]=e=>P(h)({url:"/pages/index/index"}))},{default:y(()=>[k(w(e.$t("继续逛逛")),1)]),_:1})]),_:1})]),_:1}),P(l).isGuestLikeGoods?(i(),o(t,{key:0,class:"recommend"},{default:y(()=>[b(t,{class:"recommend-mask"}),b(t,{class:"recommend-content"},{default:y(()=>[b(A,{"title-bg":"#fff"})]),_:1})]),_:1})):x("",!0)]),_:1})),b(n,{modelValue:r.value,"onUpdate:modelValue":a[2]||(a[2]=e=>r.value=e)},null,8,["modelValue"])]),_:1})}}}),[["__scopeId","data-v-e64b3fdf"]]);export{E as default};

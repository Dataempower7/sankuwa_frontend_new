import{d as a,L as e,r as l,n as t,s,c as u,w as o,R as c,ac as d,ad as i,C as n,F as r,bi as f,b as p,e as m,a as v,i as _,f as g,G as y,ae as b,h,t as k,J as x,K as w,P as j,k as C,aB as T,H as $,ai as z,_ as I}from"./index-BZxHr1FI.js";import{_ as N}from"./format-price.BrXrBVy6.js";import{T as P,a as V,_ as A}from"./tig-layout.DTz8E-sj.js";import{T as G}from"./tig-fixed-placeholder.BDsbIjoZ.js";import{g as L,e as M,i as S}from"./product.BH5dMQls.js";import"./currency.Dn5A4d7X.js";const U=I(a({__name:"consult",setup(a){const{t:I}=e(),U=l({productId:0,productStock:0}),B=l(!1),F=l(1),H=l(10),J=l(0),K=l(!1),O=l(!1),Q=l(""),R=l([]),q=l(0),D=l(!1),E=async()=>{F.value>1&&(K.value=!0),d({title:I("加载中")}),R.value=[];try{const a=await M({productId:W.value,page:F.value,size:H.value});R.value=[...R.value,...a.records],q.value=a.total}catch(a){c({title:a.message,icon:"none"})}finally{K.value=!1,i()}},W=l("");t(a=>{if(a){const{id:e}=a;e&&(W.value=e,(async a=>{try{let e=await L(a);U.value=e.item}catch(e){c({title:e.message,icon:"none"})}})(e),E())}});const X=()=>{O.value=!0,z(()=>{setTimeout(()=>{D.value=!0},100)})},Y=async()=>{if(Q.value.trim())try{await S({productId:W.value,content:Q.value,type:2}),Q.value="",O.value=!1,c({title:I("请您耐心等待客服人员的回复，您可在会员中心查看留言回复消息动态")}),E()}catch(a){c({title:a.message,icon:"none"})}else c({title:I("请输入咨询内容"),icon:"none"})},Z=()=>{O.value=!1};return s(()=>{F.value<Math.ceil(J.value/H.value)&&(F.value++,E())}),(a,e)=>{const l=g,t=_,s=n(r("format-price"),N),c=C,d=n(r("tig-button"),V),i=n(r("tig-fixed-placeholder"),G),z=n(r("up-textarea"),f),I=n(r("tig-popup"),A),L=n(r("tig-layout"),P);return p(),u(L,{title:"商品咨询"},{default:o(()=>[m(t,{class:"product-info flex"},{default:o(()=>[m(t,{class:"product-info-img"},{default:o(()=>[m(l,{"lazy-load":"",class:"product-img",src:y(b)(U.value.picThumb||"")},null,8,["src"])]),_:1}),m(t,{class:"product-info-right"},{default:o(()=>[m(t,{class:"product-info-title line2"},{default:o(()=>[h(k(U.value.productName),1)]),_:1}),U.value.marketPrice&&Number(U.value.marketPrice)>0?(p(),u(t,{key:0,class:"product-info-price"},{default:o(()=>[m(s,{"is-bottom":!1,"price-data":U.value.marketPrice},null,8,["price-data"])]),_:1})):v("",!0)]),_:1})]),_:1}),m(t,{class:"product-consult-card"},{default:o(()=>[(p(!0),x(w,null,j(R.value,(a,e)=>(p(),u(t,{key:e,class:"consult-item"},{default:o(()=>[m(t,{class:"consult-item-tit flex justify-between"},{default:o(()=>[m(t,{class:"time"},{default:o(()=>[h(k(a.addTime),1)]),_:2},1024),m(t,{class:"name"},{default:o(()=>[h(k(a.username),1)]),_:2},1024)]),_:2},1024),m(t,{class:"consult-con line1"},{default:o(()=>[m(c,null,{default:o(()=>[h("Q")]),_:1}),h(" "+k(a.content),1)]),_:2},1024),a.reply?(p(),u(t,{key:0,class:"consult-con line1 reply"},{default:o(()=>[m(c,null,{default:o(()=>[h("A")]),_:1}),h(" "+k(a.reply.content),1)]),_:2},1024)):v("",!0)]),_:2},1024))),128))]),_:1}),m(i,{"background-color":"#fff"},{default:o(()=>[m(t,{class:"btn-box"},{default:o(()=>[m(d,{class:"btn",onClick:X},{default:o(()=>[h(k(a.$t("咨询客服")),1)]),_:1})]),_:1})]),_:1}),m(I,{show:O.value,"onUpdate:show":e[1]||(e[1]=a=>O.value=a),round:20,showClose:!1},{default:o(()=>[m(t,{class:"popup-content"},{default:o(()=>[m(t,{class:"popup-header"},{default:o(()=>[m(t,{class:"flex"},{default:o(()=>[m(t,{class:"product-Slot"},{default:o(()=>[T(a.$slots,"left",{},()=>[m(t,{class:"iconfont icon-houtui",onClick:Z})],!0)]),_:3}),m(t,{class:"product-info-img"},{default:o(()=>[m(l,{"lazy-load":"",class:"product-img",src:y(b)(U.value.picThumb||"")},null,8,["src"])]),_:1}),m(t,{class:"product-info-title"},{default:o(()=>[h(k(U.value.productName),1)]),_:1})]),_:3}),m(t,{class:"popup-footer"},{default:o(()=>[m(d,{class:"btn",disabled:!Q.value.trim(),"custom-style":{background:Q.value.trim()?"#C3A769":"#e6e6e6",color:Q.value.trim()?"#fff":"#f7f7f7",borderColor:"transparent"},onClick:Y},{default:o(()=>[h(k(a.$t("提交")),1)]),_:1},8,["disabled","custom-style"])]),_:1})]),_:3}),m(t,{class:"popup-body"},{default:o(()=>[m(t,{class:"popup-item"},{default:o(()=>[m(t,{class:"popup-item-title"},{default:o(()=>[h(k(a.$t("咨询内容"))+":",1)]),_:1}),m(z,{modelValue:Q.value,"onUpdate:modelValue":e[0]||(e[0]=a=>Q.value=a),"input-align":"right",height:"120",placeholder:a.$t("您可以对商品包装、规格、支付、发票、退换货和物流配送类的问题咨询客服"),border:"none",maxlength:"200",style:{background:"#f5f5f5"},focus:D.value},null,8,["modelValue","placeholder","focus"]),m(t,{class:"popup-item-footer"},{default:o(()=>[h(k(Q.value.length)+"/200 ",1)]),_:1})]),_:1})]),_:1})]),_:3})]),_:3},8,["show"]),F.value>1?(p(),u(t,{key:0,class:"loading-box"},{default:o(()=>[B.value?(p(),u(t,{key:0,class:"bottomLoading"},{default:o(()=>[m(l,{"lazy-load":"",class:"loading",src:y($)("common/loading.gif")},null,8,["src"])]),_:1})):v("",!0)]),_:1})):v("",!0),m(t,{class:"loading-box"},{default:o(()=>[R.value.length<1?(p(),u(t,{key:0,class:"empty-box"},{default:o(()=>[m(t,{class:"pictrue"},{default:o(()=>[m(l,{src:y($)("common/data_empty.png")},null,8,["src"])]),_:1}),m(t,{class:"txt"},{default:o(()=>[h(k(a.$t("暂无咨询")),1)]),_:1})]),_:1})):v("",!0)]),_:1})]),_:3})}}}),[["__scopeId","data-v-a691860e"]]);export{U as default};

import{d as a,K as l,r as e,l as t,q as s,c as u,w as o,Q as c,aa as d,ab as i,B as n,E as r,bj as f,o as p,g as m,a as _,i as v,b as g,F as y,ac as b,f as h,t as k,I as x,J as w,O as j,h as $,aF as C,G as I,ah as z,_ as T}from"./index-DDAlCzEE.js";import{_ as N}from"./format-price.9n-LYbxy.js";import{_ as P,a as V,c as A}from"./tig-layout.Dp_86RM-.js";import{_ as E}from"./tig-fixed-placeholder.BwC6eLvS.js";import{h as F,c as J,i as Q}from"./product.CwGVjSIm.js";const S=T(a({__name:"consult",setup(a){const{t:T}=l(),S=e({productId:0,productStock:0}),U=e(!1),q=e(1),B=e(10),D=e(0),G=e(!1),K=e(!1),L=e(""),M=e([]),O=e(0),H=e(!1),R=async()=>{q.value>1&&(G.value=!0),d({title:T("加载中")}),M.value=[];try{const a=await J({productId:W.value,page:q.value,size:B.value});M.value=[...M.value,...a.records],O.value=a.total}catch(a){c({title:a.message,icon:"none"})}finally{G.value=!1,i()}},W=e("");t(a=>{if(a){const{id:l}=a;l&&(W.value=l,(async a=>{try{let l=await F(a);S.value=l.item}catch(l){c({title:l.message,icon:"none"})}})(l),R())}});const X=()=>{K.value=!0,z(()=>{setTimeout(()=>{H.value=!0},100)})},Y=async()=>{if(L.value.trim())try{await Q({productId:W.value,content:L.value,type:2}),L.value="",K.value=!1,c({title:T("请您耐心等待客服人员的回复，您可在会员中心查看留言回复消息动态")}),R()}catch(a){c({title:a.message,icon:"none"})}else c({title:T("请输入咨询内容"),icon:"none"})},Z=()=>{K.value=!1};return s(()=>{q.value<Math.ceil(D.value/B.value)&&(q.value++,R())}),(a,l)=>{const e=g,t=v,s=n(r("format-price"),N),c=$,d=n(r("tig-button"),V),i=n(r("tig-fixed-placeholder"),E),z=n(r("up-textarea"),f),T=n(r("tig-popup"),A),F=n(r("tig-layout"),P);return p(),u(F,{title:"商品咨询"},{default:o(()=>[m(t,{class:"product-info flex"},{default:o(()=>[m(t,{class:"product-info-img"},{default:o(()=>[m(e,{"lazy-load":"",class:"product-img",src:y(b)(S.value.picThumb||"")},null,8,["src"])]),_:1}),m(t,null,{default:o(()=>[m(t,{class:"product-info-title line2"},{default:o(()=>[h(k(S.value.productName),1)]),_:1}),S.value.marketPrice&&Number(S.value.marketPrice)>0?(p(),u(t,{key:0,class:"product-info-price"},{default:o(()=>[m(s,{"is-bottom":!1,"price-data":S.value.marketPrice},null,8,["price-data"])]),_:1})):_("",!0)]),_:1})]),_:1}),m(t,{class:"product-consult-card"},{default:o(()=>[(p(!0),x(w,null,j(M.value,(a,l)=>(p(),u(t,{key:l,class:"consult-item"},{default:o(()=>[m(t,{class:"consult-item-tit flex justify-between"},{default:o(()=>[m(t,{class:"time"},{default:o(()=>[h(k(a.addTime),1)]),_:2},1024),m(t,{class:"name"},{default:o(()=>[h(k(a.username),1)]),_:2},1024)]),_:2},1024),m(t,{class:"consult-con line1"},{default:o(()=>[m(c,null,{default:o(()=>[h("Q")]),_:1}),h(" "+k(a.content),1)]),_:2},1024),a.reply?(p(),u(t,{key:0,class:"consult-con line1 reply"},{default:o(()=>[m(c,null,{default:o(()=>[h("A")]),_:1}),h(" "+k(a.reply.content),1)]),_:2},1024)):_("",!0)]),_:2},1024))),128))]),_:1}),m(i,{"background-color":"#fff"},{default:o(()=>[m(t,{class:"btn-box"},{default:o(()=>[m(d,{class:"btn",onClick:X},{default:o(()=>[h(k(a.$t("咨询客服")),1)]),_:1})]),_:1})]),_:1}),m(T,{show:K.value,"onUpdate:show":l[1]||(l[1]=a=>K.value=a),round:20,showClose:!1},{default:o(()=>[m(t,{class:"popup-content"},{default:o(()=>[m(t,{class:"popup-header"},{default:o(()=>[m(t,{class:"flex"},{default:o(()=>[m(t,{class:"product-Slot"},{default:o(()=>[C(a.$slots,"left",{},()=>[m(t,{class:"iconfont icon-houtui",onClick:Z})],!0)]),_:3}),m(t,{class:"product-info-img"},{default:o(()=>[m(e,{"lazy-load":"",class:"product-img",src:y(b)(S.value.picThumb||"")},null,8,["src"])]),_:1}),m(t,{class:"product-info-title"},{default:o(()=>[h(k(a.$t(S.value.productName)),1)]),_:1})]),_:3}),m(t,{class:"popup-footer"},{default:o(()=>[m(d,{class:"btn",disabled:!L.value.trim(),"custom-style":{background:L.value.trim()?"#C3A769":"#e6e6e6",color:L.value.trim()?"#fff":"#f7f7f7",borderColor:"transparent"},onClick:Y},{default:o(()=>[h(k(a.$t("提交")),1)]),_:1},8,["disabled","custom-style"])]),_:1})]),_:3}),m(t,{class:"popup-body"},{default:o(()=>[m(t,{class:"popup-item"},{default:o(()=>[m(t,{class:"popup-item-title"},{default:o(()=>[h(k(a.$t("咨询内容"))+":",1)]),_:1}),m(z,{modelValue:L.value,"onUpdate:modelValue":l[0]||(l[0]=a=>L.value=a),"input-align":"right",height:"120",placeholder:a.$t("您可以对商品包装、规格、支付、发票、退换货和物流配送类的问题咨询客服"),border:"none",maxlength:"200",style:{background:"#f5f5f5"},focus:H.value},null,8,["modelValue","placeholder","focus"]),m(t,{class:"popup-item-footer"},{default:o(()=>[h(k(L.value.length)+"/200 ",1)]),_:1})]),_:1})]),_:1})]),_:3})]),_:3},8,["show"]),q.value>1?(p(),u(t,{key:0,class:"loading-box"},{default:o(()=>[U.value?(p(),u(t,{key:0,class:"bottomLoading"},{default:o(()=>[m(e,{"lazy-load":"",class:"loading",src:y(I)("common/loading.gif")},null,8,["src"])]),_:1})):_("",!0)]),_:1})):_("",!0),m(t,{class:"loading-box"},{default:o(()=>[M.value.length<1?(p(),u(t,{key:0,class:"empty-box"},{default:o(()=>[m(t,{class:"pictrue"},{default:o(()=>[m(e,{src:y(I)("common/data_empty.png")},null,8,["src"])]),_:1}),m(t,{class:"txt"},{default:o(()=>[h(k(a.$t("暂无咨询")),1)]),_:1})]),_:1})):_("",!0)]),_:1})]),_:3})}}}),[["__scopeId","data-v-8cc5455a"]]);export{S as default};

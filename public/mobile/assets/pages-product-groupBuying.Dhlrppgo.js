import{d as e,L as a,az as l,r as t,l as s,m as u,n as o,c as r,w as c,i as d,ai as n,C as i,F as p,b as f,e as m,$ as v,J as _,a as g,k as y,h as b,t as k,W as h,K as j,P as I,G as x,ae as $,b3 as S,f as P,H as C,I as w,O as N,a0 as R,j as T,X as V,R as G,_ as z}from"./index-BZxHr1FI.js";import{_ as U}from"./tig-image.CzXKqALH.js";import{_ as L}from"./format-price.BrXrBVy6.js";import{_ as A}from"./tig-countdown.vue_vue_type_script_setup_true_lang.GPPLpHfs.js";import{T as B}from"./tig-layout.DTz8E-sj.js";import{_ as D}from"./tig-loadingpage.vue_vue_type_script_setup_true_lang.CErZUb08.js";import{_ as F,a as J,b as K,e as O}from"./error.B-i8FOte.js";import{b as W,s as E}from"./shop.CnQQ4qvJ.js";import{g as H}from"./product.BH5dMQls.js";import{a as M}from"./groupon.CM2aLW4Q.js";import{s as Q}from"./specification.C71VpZ8P.js";import{g as X}from"./grouponShare.B6EudCI5.js";import{r as q}from"./index.CtwwUC20.js";import"./currency.Dn5A4d7X.js";import"./uni-icons.DMMn2oBg.js";import"./uni-number-box.DKxM8QIH.js";import"./uni-transition.COpRW9Ft.js";import"./masonry.B_l69Lra.js";import"./tig-lazy-image.BPOhG_XX.js";import"./activityCard.DE1HAQr9.js";import"./dayjs.min.BETqfnlQ.js";import"./useList.cF42RyDa.js";const Y=z(e({__name:"groupBuying",setup(e){const{t:z}=a(),Y=l(),Z=t(z("拼团")),ee=s(),ae=t({}),le=t(0),te=t({}),se=t({productId:0,productStock:0}),ue=t(10),oe=t(0),re=t(0),ce=t(!0),de=t(),ne=t({grouponPromotionRecordId:0,minGroupNum:0,skuId:0}),ie=Y.userInfo,pe=t(0),fe=t(!1),me=t(),ve=t(!0),_e=t(!1),ge=t("0"),ye=t("0"),be=t(1),ke=t(!1),he=t([]),je=e=>{ue.value=e.productStock,ge.value=e.productPrice,ye.value=e.productOriginPrice,be.value=e.productNumber},Ie=()=>{ve.value=!1},xe=u(()=>!!te.value&&te.value.joinUsers.some(e=>e.userId===ie.userId)),$e=u(()=>{if(1!==te.value.joinStatus)return!0;if(!te.value.endTime)return!0;return Se(te.value.endTime)<(new Date).getTime()}),Se=e=>{const a=e.split(" "),[l,t,s]=a[0].split("-"),[u,o,r]=a[1].split(":");return new Date(l,t-1,s,u,o,r).getTime()},Pe=async e=>{try{const a=await W(e);ae.value=a,ke.value=a.collectShop}catch(a){console.error(a)}},Ce=e=>{T({url:`/pages/product/index?id=${e}`})},we=()=>{ae.value.shopId&&V({url:`/pages/shop/index?shopId=${ae.value.shopId}`})},Ne=()=>{ne.value.grouponPromotionRecordId=te.value.grouponPromotionRecordId,ne.value.minGroupNum=te.value.minGroupNum,ne.value.skuId=te.value.skuId,ce.value=!0,de.value.handleShowPopup()},Re=u(()=>ke.value?z("取消收藏"):z("收藏店铺")),Te=async()=>{await E({shopId:ae.value.shopId}),G({title:ke.value?z("取消收藏成功"):z("收藏成功"),icon:"none"}),await Pe(ae.value.shopId)},Ve=()=>{Y.token?fe.value=!0:V({url:"/pages/login/index"})},Ge=async()=>{try{const e=await M(le.value);switch(te.value=e,he.value=e.joinUsers.sort((e,a)=>a.leader?1:-1),e.joinStatus){case 2:Z.value=z("拼团成功");break;case 3:Z.value=z("拼团失败");break;default:Z.value=z("拼团")}(async e=>{try{let a={};a=await H(e),ue.value=a.item.productStock,ge.value=a.item.productPrice||"0",oe.value=a.item.productId,pe.value=a.item.productId,se.value=a.item,a.item.shopId&&Pe(a.item.shopId),n(()=>{var e;null==(e=me.value)||e.handleLog()})}catch(a){console.error(a),_e.value=!0,ve.value=!1}})(e.productId),re.value=e.skuId,e.shopId&&await Pe(e.shopId)}catch(e){_e.value=!0,ve.value=!1,console.error(e)}},ze=()=>{de.value&&(ce.value=!1,de.value.handleShowPopup())},Ue=()=>{V({url:"/pages/search/result"})},Le=()=>{T({url:`/pages/groupon/list?id=${te.value.grouponPromotionId}`,mode:"redirectTo"})};return o(e=>{(null==e?void 0:e.grouponPromotionRecordId)?(le.value=Number(e.grouponPromotionRecordId),Ge()):(_e.value=!0,ve.value=!1)}),(e,a)=>{const l=i(p("tig-image"),U),t=d,s=y,u=i(p("format-price"),L),o=i(p("tig-countdown"),A),n=h,V=P,G=i(p("tig-layout"),B),z=i(p("tig-loadingpage"),D);return f(),r(t,null,{default:c(()=>[m(G,{ref_key:"layoutRef",ref:me,title:Z.value},{default:c(()=>[_e.value?(f(),_(j,{key:1},[m(O),m(q,{"title-bg":"#fff"})],64)):v((f(),r(t,{key:0,class:"groupon-info-container"},{default:c(()=>[m(t,{class:"card-box product-card"},{default:c(()=>[m(t,{class:"image",onClick:a[0]||(a[0]=e=>Ce(se.value.productId))},{default:c(()=>[m(l,{src:se.value.picThumb,mode:"heightFix"},null,8,["src"])]),_:1}),m(t,{class:"detail"},{default:c(()=>[m(t,{class:"header",onClick:a[1]||(a[1]=e=>Ce(se.value.productId))},{default:c(()=>[m(t,{class:"line2"},{default:c(()=>[m(s,{class:"detail-title"},{default:c(()=>[b(k(te.value.productName),1)]),_:1})]),_:1}),m(t,{class:"detail-group"},{default:c(()=>[m(s,{class:"btn"},{default:c(()=>[b(k(te.value.minGroupNum)+k(e.$t("人团")),1)]),_:1}),m(s,{class:"num"},{default:c(()=>[b(k(e.$t("已有")+te.value.joinNumCount+e.$t("人参团")),1)]),_:1})]),_:1})]),_:1}),m(t,{class:"flex"},{default:c(()=>[m(t,{class:"group-price"},{default:c(()=>[m(s,{class:"price-text"},{default:c(()=>[b(k(e.$t("拼团价"))+":",1)]),_:1}),m(u,{"currency-style":{fontSize:"23rpx"},"price-data":te.value.grouponPrice},null,8,["price-data"])]),_:1}),m(t,{class:"original-price"},{default:c(()=>[m(u,{"font-style":{"text-decoration":"line-through"},"currency-style":{fontSize:"23rpx"},"price-data":te.value.productPrice},null,8,["price-data"])]),_:1})]),_:1})]),_:1})]),_:1}),m(t,{class:"card-box group-card"},{default:c(()=>[m(t,{class:"group-sub-title"},{default:c(()=>[1===te.value.joinStatus?(f(),r(t,{key:0,class:"text"},{default:c(()=>[m(s,null,{default:c(()=>[b(k(e.$t("还差")),1)]),_:1}),m(s,{class:"num"},{default:c(()=>[b(k(te.value.joinNumCount>te.value.minGroupNum?0:te.value.minGroupNum-te.value.joinNumCount),1)]),_:1}),m(s,null,{default:c(()=>[b(k(e.$t("人成团")),1)]),_:1})]),_:1})):g("",!0),2===te.value.joinStatus?(f(),r(t,{key:1,class:"flex align-center"},{default:c(()=>[m(s,{class:"text"},{default:c(()=>[b(k(e.$t("拼团成功")),1)]),_:1}),m(s,{class:"msg"},{default:c(()=>[b(k(e.$t("商家会尽快发货")),1)]),_:1})]),_:1})):g("",!0),3===te.value.joinStatus?(f(),r(t,{key:2,class:"flex align-center"},{default:c(()=>[m(s,{class:"text"},{default:c(()=>[b(k(e.$t("拼团失败")),1)]),_:1}),m(s,{class:"msg"},{default:c(()=>[b(k(e.$t("超时未成团，系统将原路退款")),1)]),_:1})]),_:1})):g("",!0),$e.value?g("",!0):(f(),r(t,{key:3,class:"group-end-info flex align-center"},{default:c(()=>[m(t,{class:"countdown-title"},{default:c(()=>[b(k(e.$t("距结束")),1)]),_:1}),m(o,{style:{"font-size":"24rpx"},"background-color":"var(--primary-light-9)","splitor-color":"#1A1A1A",color:"var(--ump-price)","end-time":te.value.endTime,"font-size":11},null,8,["end-time"])]),_:1}))]),_:1}),m(n,{class:"join-users","scroll-x":"true","show-scrollbar":"false"},{default:c(()=>[m(t,{class:"userinfo-container"},{default:c(()=>[(f(!0),_(j,null,I(he.value,a=>(f(),r(t,{class:"userinfo"},{default:c(()=>[m(t,{class:"userinfo-avatar"},{default:c(()=>[m(t,{class:"image"},{default:c(()=>[m(l,{src:x($)((null==a?void 0:a.avatar)||x(ee).defaultAvatar)},null,8,["src"])]),_:2},1024),a.leader?(f(),r(t,{key:0,class:"image-leader"},{default:c(()=>[b(k(e.$t("团长")),1)]),_:1})):g("",!0)]),_:2},1024),m(s,{class:"name"},{default:c(()=>[b(k(x(S)(a.username||"")),1)]),_:2},1024)]),_:2},1024))),256)),1===te.value.joinStatus&&te.value.joinNumCount<te.value.minGroupNum?(f(),r(t,{key:0,class:"userinfo"},{default:c(()=>[m(t,{class:"userinfo-avatar"},{default:c(()=>[m(t,{class:"image"},{default:c(()=>[m(t,{class:"btn-add"},{default:c(()=>[m(t,{class:"iconfont-h5 icon-zengjia"})]),_:1})]),_:1})]),_:1}),m(s,{class:"name"},{default:c(()=>[b(k(e.$t("无")),1)]),_:1})]),_:1})):g("",!0)]),_:1})]),_:1})]),_:1}),m(t,{class:"card-box process-card"},{default:c(()=>[m(t,{class:"sub-title"},{default:c(()=>[m(s,null,{default:c(()=>[b(k(e.$t("拼团流程")),1)]),_:1})]),_:1}),m(t,{class:"process"},{default:c(()=>[m(t,{class:"process-item"},{default:c(()=>[m(V,{class:"process-image",src:F}),m(t,{class:"step-name"},{default:c(()=>[m(s,null,{default:c(()=>[b(k(e.$t("1.开团/参加")),1)]),_:1})]),_:1})]),_:1}),m(t,{class:"process-line"},{default:c(()=>[(f(),_(j,null,I(3,e=>m(t,{key:e,class:"process-line-item"})),64))]),_:1}),m(t,{class:"process-item"},{default:c(()=>[m(V,{class:"process-image",src:J}),m(t,{class:"step-name"},{default:c(()=>[m(s,null,{default:c(()=>[b(k(e.$t("2.邀友参团")),1)]),_:1})]),_:1})]),_:1}),m(t,{class:"process-line"},{default:c(()=>[(f(),_(j,null,I(3,e=>m(t,{key:e,class:"process-line-item"})),64))]),_:1}),m(t,{class:"process-item"},{default:c(()=>[m(V,{class:"process-image",src:K}),m(t,{class:"step-name"},{default:c(()=>[m(s,null,{default:c(()=>[b(k(e.$t("3.人满成团")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),ae.value.shopId?(f(),r(t,{key:0,class:"card-box store-card"},{default:c(()=>[m(t,{class:"shop-info"},{default:c(()=>[m(l,{class:"shop-image",src:x($)(ae.value.shopLogo||"")},null,8,["src"]),m(s,{class:"shop-title"},{default:c(()=>[b(k(ae.value.shopTitle),1)]),_:1})]),_:1}),m(t,{class:"store"},{default:c(()=>[m(t,{class:"btn",onClick:Te},{default:c(()=>[m(s,null,{default:c(()=>[b(k(Re.value),1)]),_:1})]),_:1}),m(t,{class:"btn"},{default:c(()=>[m(V,{src:x(C)("product/shop.png"),class:"img"},null,8,["src"]),m(s,null,{default:c(()=>[b(k(e.$t("进店逛逛")),1)]),_:1})]),_:1})]),_:1})]),_:1})):g("",!0),m(t,{class:"footer"},{default:c(()=>[m(t,{style:w({"padding-bottom":x(ee).safeBottom+"rpx"}),class:"bottom-bar-box"},{default:c(()=>[m(t,{class:"bottom-bar flex align-center"},{default:c(()=>[m(t,{class:"icon-box"},{default:c(()=>[m(t,{class:"label my-groupon",onClick:a[2]||(a[2]=N(e=>{T({url:"/pages/groupon/mylist"})},["stop"]))},{default:c(()=>[m(t,null,{default:c(()=>[m(V,{src:"/mobile/static/images/groupon/groupon.png",class:"img"})]),_:1}),m(t,{class:"label-text"},{default:c(()=>[m(s,{class:"my-group-text"},{default:c(()=>[b(k(e.$t("我的拼团")),1)]),_:1})]),_:1})]),_:1}),ae.value.shopId?(f(),r(t,{key:0,class:"label",onClick:we},{default:c(()=>[m(t,null,{default:c(()=>[m(V,{src:x(C)("product/shop.png"),class:"img"},null,8,["src"])]),_:1}),m(t,{class:"label-text"},{default:c(()=>[m(s,null,{default:c(()=>[b(k(e.$t("店铺")),1)]),_:1})]),_:1})]),_:1})):g("",!0)]),_:1}),m(t,{class:"btn-box"},{default:c(()=>[0===se.value.productStatus||0===ue.value?(f(),r(t,{key:0,class:"other-products-btn",onClick:Ue},{default:c(()=>[b(k(e.$t("查看其他商品")),1)]),_:1})):(f(),_(j,{key:1},[1===se.value.productType?(f(),_(j,{key:0},[1===te.value.joinStatus?(f(),_(j,{key:0},[xe.value?(f(),r(t,{key:1,class:"other-products-btn",onClick:Ve},{default:c(()=>[b(k(e.$t("邀请好友参团")),1)]),_:1})):(f(),r(t,{key:0,class:"other-products-btn",onClick:Ne},{default:c(()=>[b(k(e.$t("去参团")),1)]),_:1}))],64)):2===te.value.joinStatus?(f(),r(t,{key:1,class:"other-products-btn",onClick:Le},{default:c(()=>[b(k(e.$t("更多拼团")),1)]),_:1})):3===te.value.joinStatus?(f(),r(t,{key:2,class:"other-products-btn",onClick:ze},{default:c(()=>[b(k(e.$t("原价购买")),1)]),_:1})):g("",!0)],64)):(f(),r(t,{key:1,class:"other-products-btn",onClick:ze},{default:c(()=>[b(k(e.$t("立即购买")),1)]),_:1}))],64))]),_:1}),0===se.value.productStatus||0===ue.value?(f(),r(t,{key:0,class:"product-status"},{default:c(()=>[b(k(e.$t(0===se.value.productStatus?"商品已下架":"商品已售罄")),1)]),_:1})):g("",!0)]),_:1})]),_:1},8,["style"])]),_:1}),m(X,{modelValue:fe.value,"onUpdate:modelValue":a[3]||(a[3]=e=>fe.value=e),"product-id":Number(pe.value),"product-info":se.value,"product-price":ge.value,grouponPromotionId:te.value.grouponPromotionId,grouponPromotionRecordId:le.value},null,8,["modelValue","product-id","product-info","product-price","grouponPromotionId","grouponPromotionRecordId"]),m(Q,{ref_key:"specificationRef",ref:de,modelValue:oe.value,"onUpdate:modelValue":a[4]||(a[4]=e=>oe.value=e),"sku-id":re.value,"onUpdate:skuId":a[5]||(a[5]=e=>re.value=e),"groupon-enable":ce.value,grouponRecordInfo:ne.value,onLoadEnd:Ie,onSendValue:je},null,8,["modelValue","sku-id","groupon-enable","grouponRecordInfo"])]),_:1},512)),[[R,!ve.value]])]),_:1},8,["title"]),m(z,{modelValue:ve.value,"onUpdate:modelValue":a[6]||(a[6]=e=>ve.value=e)},null,8,["modelValue"])]),_:1})}}}),[["__scopeId","data-v-fb0db9f1"]]);export{Y as default};

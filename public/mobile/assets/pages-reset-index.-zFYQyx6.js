import{d as e,a5 as a,l,L as t,r as o,m as s,C as i,F as u,J as n,b as d,c as r,e as c,i as v,w as p,a as m,G as f,N as y,ak as b,aj as h,h as _,t as g,K as x,R as k,aw as w,ax as $,X as C,_ as T,a4 as K,Z as U,ay as I}from"./index-BZxHr1FI.js";import{a as M,T as j}from"./tig-layout.DTz8E-sj.js";import{_ as A}from"./tig-mobile-areacode.D-ev-Dkx.js";import{V as q}from"./index.DfptdAaC.js";const O=T(e({__name:"stepOne",props:{mobileKey:{},mobileKeyModifiers:{},step:{},stepModifiers:{}},emits:["update:mobileKey","update:step"],setup(e){const T=a(e,"mobileKey"),K=a(e,"step"),U=l(),{t:I}=t(),j=o("86"),O=o(!0),V=o(""),E=o(""),P=o(""),Z=e=>{E.value=e.detail.value},z=e=>{P.value=e.detail.value},D=o(""),G=e=>{D.value=e.detail.value},R=o(""),F=e=>{R.value=e.detail.value},J=e=>{k({title:e,duration:1500,icon:"none"})},L=o({registType:"mobile"}),N=o(!1);s(()=>!D.value||!R.value||N.value);const W=async()=>{if("email"===L.value.registType){if(!E.value)return k({title:I("请输入邮箱"),duration:1500,icon:"none"});if(!P.value)return k({title:I("请输入邮箱验证码"),duration:1500,icon:"none"})}else{if(!D.value)return k({title:I("请输入手机号"),duration:1500,icon:"none"});if(!R.value)return k({title:I("请输入手机验证码"),duration:1500,icon:"none"})}N.value=!0;try{let e,a={mobile:U.isOpenMobileAreaCode?j.value+D.value:D.value,code:R.value},l={email:E.value,code:P.value};e="email"===L.value.registType?await w(l):await $(a),T.value=(L.value.registType,e),K.value=2}catch(e){console.error(e),k({title:e.message,duration:1500,icon:"none"})}finally{N.value=!1}},X=()=>{C({url:"/pages/login/index"})};return(e,a)=>{const l=i(u("tig-mobile-areacode"),A),t=y,o=v,s=i(u("tig-button"),M);return d(),n(x,null,["mobile"===L.value.registType?(d(),r(o,{key:0},{default:p(()=>[c(o,{class:"item"},{default:p(()=>[c(o,{class:"text mobileareacode-box"},{default:p(()=>[f(U).isOpenMobileAreaCode?(d(),r(l,{key:0,modelValue:j.value,"onUpdate:modelValue":a[0]||(a[0]=e=>j.value=e)},null,8,["modelValue"])):m("",!0),c(t,{type:"text",value:D.value,placeholder:e.$t("请输入手机号"),"placeholder-class":"placeholder",class:"mobile-text",onInput:G},null,8,["value","placeholder"])]),_:1})]),_:1}),c(o,{class:"item mobile_code_text"},{default:p(()=>[c(o,{style:{flex:"1","margin-right":"10rpx"}},{default:p(()=>[c(t,{type:"text",placeholder:e.$t("手机短信验证码"),"placeholder-class":"placeholder",value:R.value,name:"mobile_code",class:"text",onInput:F},null,8,["placeholder","value"])]),_:1}),c(q,{"is-checked":O.value,"onUpdate:isChecked":a[1]||(a[1]=e=>O.value=e),"verify-token-data":V.value,"onUpdate:verifyTokenData":a[2]||(a[2]=e=>V.value=e),style:{height:"65rpx"},mobile:f(U).isOpenMobileAreaCode?j.value+D.value:D.value,event:"forgetPassword","request-api":f(b),onMobileErrorCallback:J},null,8,["is-checked","verify-token-data","mobile","request-api"])]),_:1})]),_:1})):(d(),r(o,{key:1},{default:p(()=>[c(o,{class:"item"},{default:p(()=>[c(o,{class:"text mobileareacode-box"},{default:p(()=>[c(t,{type:"text",placeholder:e.$t("请输入邮箱"),"placeholder-class":"placeholder",value:E.value,name:"mobile_code",class:"mobile-text",onInput:Z},null,8,["placeholder","value"])]),_:1})]),_:1}),c(o,{class:"item mobile_code_text"},{default:p(()=>[c(o,{style:{flex:"1","margin-right":"10rpx"}},{default:p(()=>[c(t,{type:"text",placeholder:e.$t("邮箱验证码"),"placeholder-class":"placeholder",value:P.value,name:"mobile_code",class:"text",onInput:z},null,8,["placeholder","value"])]),_:1}),c(q,{"is-checked":O.value,"onUpdate:isChecked":a[3]||(a[3]=e=>O.value=e),email:E.value,"onUpdate:email":a[4]||(a[4]=e=>E.value=e),"verify-token-data":V.value,"onUpdate:verifyTokenData":a[5]||(a[5]=e=>V.value=e),event:"forgetPassword",style:{height:"65rpx"},"request-api":f(h),onMobileErrorCallback:J},null,8,["is-checked","email","verify-token-data","request-api"])]),_:1})]),_:1})),c(o,{class:"btn2-css3"},{default:p(()=>[c(s,{"loading-text":e.$t("下 一 步"),loading:N.value,onClick:W},{default:p(()=>[_(g(e.$t("下 一 步")),1)]),_:1},8,["loading-text","loading"])]),_:1}),c(o,{class:"bottom-bar"},{default:p(()=>[1===f(U).openEmailRegister?(d(),r(o,{key:0,class:"change-btn",onClick:a[6]||(a[6]=e=>{return a="email"===L.value.registType?"mobile":"email",L.value.registType=a,void("email"===a?(E.value="",P.value=""):(D.value="",R.value="",j.value="86"));var a})},{default:p(()=>[_(g("email"===L.value.registType?e.$t("手机号找回"):e.$t("邮箱找回")),1)]),_:1})):m("",!0),c(o,{class:"login-text",onClick:X},{default:p(()=>[_(g(e.$t("立即登录")),1)]),_:1})]),_:1})],64)}}}),[["__scopeId","data-v-6ed2d2f2"]]),V=T(e({__name:"stepTow.",props:{mobileKey:{},mobileKeyModifiers:{},step:{},stepModifiers:{}},emits:["update:mobileKey","update:step"],setup(e){const{t:l}=t(),r=a(e,"mobileKey"),m=a(e,"step"),f=o(["password","password"]),b=e=>{f.value[e]="password"==f.value[e]?"text":"password"},h=o(""),w=e=>{h.value=e.detail.value},$=o(""),T=e=>{$.value=e.detail.value},I=o(!1),j=s(()=>!h.value||!$.value||I.value),A=e=>e?e.length>20||e.length<6?l("密码应为6-20位字符"):/\s/.test(e)?l("密码中不允许有空格"):/^\d+$/.test(e)?l("密码不能全为数字"):/^(?=.*[\d\W]).+$/.test(e)?/^(?=.*[a-zA-Z0-9]).+$/.test(e)?/^(?!([a-zA-Z0-9])\1*$).+$/.test(e)?void 0:l("密码不能全为相同字符或数字"):l("密码不能全为符号"):l("密码不能全为字母"):l("密码不能为空"),q=async()=>{if(A(h.value))return k({title:A(h.value),duration:1500,icon:"none"});if(h.value!=$.value)return k({title:l("两次密码输入不一致"),duration:1500,icon:"none"});try{I.value=!0;await(e={mobileKey:r.value,password:h.value},K({url:"user/login/forgetPassword",method:"post",data:e}));k({title:l("重置密码成功"),duration:1500,icon:"none"}),setTimeout(()=>{C({url:"/pages/login/index?loginType=password"})},1500)}catch(a){console.error(a),k({title:a.message,duration:1500,icon:"none"}),m.value=1,r.value="",h.value="",$.value=""}finally{I.value=!1}var e},O=()=>{C({url:"/pages/login/index"})};return(e,a)=>{const l=y,t=v,o=i(u("tig-button"),M);return d(),n(x,null,[c(t,{class:"item"},{default:p(()=>[c(l,{type:f.value[0],placeholder:e.$t("请输入新密码"),"placeholder-class":"placeholder",class:"text password-text",value:h.value,onInput:w},null,8,["type","placeholder","value"]),c(t,{class:U("password_show_hide iconfont "+("text"==f.value[0]?"icon-xianshi":"icon-yincang")),onClick:a[0]||(a[0]=e=>b(0))},null,8,["class"])]),_:1}),c(t,{class:"item"},{default:p(()=>[c(l,{type:f.value[1],placeholder:e.$t("请再次确认新密码"),"placeholder-class":"placeholder",class:"text password-text",value:$.value,onInput:T},null,8,["type","placeholder","value"]),c(t,{class:U("password_show_hide iconfont "+("text"==f.value[1]?"icon-xianshi":"icon-yincang")),onClick:a[1]||(a[1]=e=>b(1))},null,8,["class"])]),_:1}),c(t,{class:"btn2-css3"},{default:p(()=>[c(o,{"loading-text":e.$t("确 认"),loading:I.value,disabled:j.value,onClick:q},{default:p(()=>[_(g(e.$t("确 认")),1)]),_:1},8,["loading-text","loading","disabled"])]),_:1}),c(t,{class:"login-text",onClick:O},{default:p(()=>[_(g(e.$t("立即登录")),1)]),_:1})],64)}}}),[["__scopeId","data-v-d23baac3"]]),E=T(e({__name:"index",setup(e){const a=o(1),l=o("");return(e,t)=>{const o=v,s=i(u("up-transition"),I),n=i(u("tig-layout"),j);return d(),r(o,null,{default:p(()=>[c(n,null,{default:p(()=>[c(o,{class:"plr-40"},{default:p(()=>[c(o,{class:"h1_tit"},{default:p(()=>[_(g(e.$t("找回密码")),1)]),_:1}),1===a.value?(d(),r(O,{key:0,step:a.value,"onUpdate:step":t[0]||(t[0]=e=>a.value=e),"mobile-key":l.value,"onUpdate:mobileKey":t[1]||(t[1]=e=>l.value=e)},null,8,["step","mobile-key"])):m("",!0),c(s,{show:2===a.value,mode:"fade-left"},{default:p(()=>[c(V,{step:a.value,"onUpdate:step":t[2]||(t[2]=e=>a.value=e),"mobile-key":l.value,"onUpdate:mobileKey":t[3]||(t[3]=e=>l.value=e)},null,8,["step","mobile-key"])]),_:1},8,["show"])]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-bd2698a4"]]);export{E as default};

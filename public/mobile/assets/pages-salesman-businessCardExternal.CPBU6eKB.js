import{d as a,a7 as e,K as s,b7 as l,aM as t,r as n,ac as o,G as c,aI as u,c as i,o as r,i as d,X as m,w as f,g as v,a as g,b as p,N as b,f as _,t as y,b9 as h,aa as x,aY as I,ab as w,b8 as k,Q as C,_ as V,j,L as q,k as S,bd as $,y as F,z as T,B as z,E as B,I as E,J as L,O as P,n as J}from"./index-DDAlCzEE.js";import{_ as N}from"./tig-image.CxOKkXKh.js";import{_ as O}from"./tig-layout.Dp_86RM-.js";import{_ as Q}from"./tig-qrcode.hb4-sGgt.js";import{g as R}from"./guide.CEAm7MKL.js";import"./uni-transition.Cy6kt9Pa.js";const U=V(a({__name:"businessCardPoster",props:{modelValue:{type:Boolean},userInfo:{},qrcodeImg:{}},emits:["update:modelValue"],setup(a,{emit:V}){e(a=>({"15edaa66":B.height+"px"}));const{t:j}=s(),q=t();let S=l("myCanvas",q);const $=a,F=V,T=n(!1),z=$.userInfo.avatar?o($.userInfo.avatar):c("user/defaultAvatar.jpg"),B={height:525,width:345},E=n(""),L=()=>{k({fileType:"jpg",canvasId:"myCanvas",quality:1,destHeight:2*B.height,destWidth:2*B.width,success:function(a){E.value=a.tempFilePath},fail:a=>{C({title:JSON.stringify(a),icon:"none",duration:3e3}),console.log(a)}},q)},P=()=>{},J=()=>{F("update:modelValue",!1)};return u(async()=>{(()=>{x({title:j("生成中"),mask:!0});const a=$.userInfo.nickname??j("普通会员");S.draw(),S.setFillStyle("#ffffff"),S.fillRect(0,0,345,600);try{S.draw(!0,async()=>{const e=await I(z);S.drawImage(e.path,0,0,345,345),S.draw(!0,async()=>{const e=await I($.qrcodeImg);S.drawImage(e.path,175,360,150,150),S.setFontSize(13),S.setFillStyle("#969799"),S.fillText(a,20,B.height-50),S.setFillStyle("#000"),S.setFontSize(22),S.fillText($.userInfo.mobile,20,425),setTimeout(()=>{S.draw(!0),setTimeout(()=>{L()},50),T.value=$.modelValue},50)})})}catch(e){console.error(e)}finally{w()}})()}),(a,e)=>{const s=p,l=d,t=h;return r(),i(l,{class:m(["my-canvas-box",{show:T.value}]),onClick:J},{default:f(()=>[v(l,{class:"canvas-content-box"},{default:f(()=>[v(l,{class:"img-box"},{default:f(()=>[E.value?(r(),i(s,{key:0,src:E.value,onLongpress:b(P,["stop"])},null,8,["src"])):g("",!0)]),_:1}),v(l,{class:"canvas-tip"},{default:f(()=>[_(y(a.$t("长按保存图片")),1)]),_:1})]),_:1}),v(t,{id:"myCanvas",class:"canvas-content","canvas-id":"myCanvas",onLongpress:b(P,["stop"])})]),_:1},8,["class"])}}}),[["__scopeId","data-v-f116c51d"]]),W=V(a({__name:"businessCardExternal",setup(a){const e=j(),s=n(q("userInfo")),l=S(()=>{var a,l;let t=e.baseInfo.h5Domain;return t=t||`${window.location.origin}/mobile`,`${t}/pages/salesman/salesmanCard?&salesmanId=${null==(l=null==(a=s.value)?void 0:a.salesman)?void 0:l.salesmanId}`}),t=n(),o=n(""),u=n(!1),m=n(!1),b=[{name:"编辑名片",icon:c("salesman/businessCardEdit.png")},{name:"发送给朋友",icon:c("salesman/businessCardWechat.png")},{name:"保存到相册",icon:c("salesman/businessCardPic.png")}];$(()=>{var a;null==(a=t.value)||a.drawQrcode()});const h=a=>{o.value=a};return F(()=>({title:`${s.value.nickname}的名片`})),T(()=>({title:`${s.value.nickname}的名片`})),(a,e)=>{const n=z(B("tig-image"),N),c=d,x=p,I=z(B("tig-layout"),O),w=z(B("tig-qrcode"),Q);return r(),i(c,null,{default:f(()=>[v(I,{"need-safe-top":!0,"safe-top-bg-color":"#f5f5f5"},{default:f(()=>[v(c,{class:"businessCard-box"},{default:f(()=>[v(c,{class:"card-box"},{default:f(()=>[v(c,{class:"card-img"},{default:f(()=>[v(n,{src:s.value.avatar},null,8,["src"])]),_:1}),v(c,{class:"card-box-content"},{default:f(()=>[v(c,{class:"card-box-content-text"},{default:f(()=>[v(c,{class:"card-box-content-text-mobile"},{default:f(()=>[_(y(s.value.mobile),1)]),_:1}),v(c,{class:"card-box-content-text-name"},{default:f(()=>[_(y(s.value.nickname),1)]),_:1})]),_:1}),v(c,{class:"card-box-content-qrcode"},{default:f(()=>[v(x,{style:{height:"100%",width:"100%"},src:o.value},null,8,["src"])]),_:1})]),_:1})]),_:1}),v(c,{class:"card-menu"},{default:f(()=>[(r(),E(L,null,P(b,(e,s)=>v(c,{key:s,class:"card-menu-item",onClick:a=>(a=>{switch(a){case 0:J({url:"/pages/salesman/personalInfo"});break;case 1:u.value=!0;break;case 2:m.value=!0}})(s)},{default:f(()=>[v(x,{class:"card-menu-item-icon",src:e.icon},null,8,["src"]),v(c,{class:"card-menu-item-text"},{default:f(()=>[_(y(a.$t(e.name)),1)]),_:2},1024)]),_:2},1032,["onClick"])),64))]),_:1})]),_:1})]),_:1}),v(R,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=a=>u.value=a)},null,8,["modelValue"]),m.value?(r(),i(U,{key:0,modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=a=>m.value=a),"qrcode-img":o.value,"user-info":s.value},null,8,["modelValue","qrcode-img","user-info"])):g("",!0),v(w,{ref_key:"qrcodeRef",ref:t,"immediately-create":!0,value:l.value,margin:10,show:!1,onSuccess:h},null,8,["value"])]),_:1})}}}),[["__scopeId","data-v-4c0a56b0"]]);export{W as default};

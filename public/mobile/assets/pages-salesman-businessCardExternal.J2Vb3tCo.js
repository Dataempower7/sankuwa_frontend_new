import{d as a,a9 as e,L as s,b8 as l,aQ as t,r as n,ae as o,H as c,aM as u,c as i,b as r,i as d,Z as m,w as f,e as v,a as g,f as p,O as b,h as _,t as h,ba as y,ac as x,aD as w,ad as I,b9 as C,R as k,_ as V,l as j,M as q,m as F,be as S,z as $,A as T,C as P,F as z,J as A,K as L,P as R,X as D}from"./index-BZxHr1FI.js";import{_ as E}from"./tig-image.CzXKqALH.js";import{T as H}from"./tig-layout.DTz8E-sj.js";import{_ as J}from"./tig-qrcode.yuxkYAxV.js";import{g as K}from"./guide.oto9fLtM.js";import"./uni-transition.COpRW9Ft.js";const M=V(a({__name:"businessCardPoster",props:{modelValue:{type:Boolean},userInfo:{},qrcodeImg:{}},emits:["update:modelValue"],setup(a,{emit:V}){e(a=>({"15edaa66":z.height+"px"}));const{t:j}=s(),q=t();let F=l("myCanvas",q);const S=a,$=V,T=n(!1),P=S.userInfo.avatar?o(S.userInfo.avatar):c("user/defaultAvatar.jpg"),z={height:525,width:345},A=n(""),L=()=>{C({fileType:"jpg",canvasId:"myCanvas",quality:1,destHeight:2*z.height,destWidth:2*z.width,success:function(a){A.value=a.tempFilePath},fail:a=>{k({title:JSON.stringify(a),icon:"none",duration:3e3}),console.log(a)}},q)},R=()=>{},D=()=>{$("update:modelValue",!1)};return u(async()=>{(()=>{x({title:j("生成中"),mask:!0});const a=S.userInfo.nickname??j("普通会员");F.draw(),F.setFillStyle("#ffffff"),F.fillRect(0,0,345,600);try{F.draw(!0,async()=>{const e=await w(P);F.drawImage(e.path,0,0,345,345),F.draw(!0,async()=>{const e=await w(S.qrcodeImg);F.drawImage(e.path,175,360,150,150),F.setFontSize(13),F.setFillStyle("#969799"),F.fillText(a,20,z.height-50),F.setFillStyle("#000"),F.setFontSize(22),F.fillText(S.userInfo.mobile,20,425),setTimeout(()=>{F.draw(!0),setTimeout(()=>{L()},50),T.value=S.modelValue},50)})})}catch(e){console.error(e)}finally{I()}})()}),(a,e)=>{const s=p,l=d,t=y;return r(),i(l,{class:m(["my-canvas-box",{show:T.value}]),onClick:D},{default:f(()=>[v(l,{class:"canvas-content-box"},{default:f(()=>[v(l,{class:"img-box"},{default:f(()=>[A.value?(r(),i(s,{key:0,src:A.value,onLongpress:b(R,["stop"])},null,8,["src"])):g("",!0)]),_:1}),v(l,{class:"canvas-tip"},{default:f(()=>[_(h(a.$t("长按保存图片")),1)]),_:1})]),_:1}),v(t,{id:"myCanvas",class:"canvas-content","canvas-id":"myCanvas",onLongpress:b(R,["stop"])})]),_:1},8,["class"])}}}),[["__scopeId","data-v-f116c51d"]]),O=V(a({__name:"businessCardExternal",setup(a){const e=j(),s=n(q("userInfo")),l=F(()=>{var a,l;let t=e.baseInfo.h5Domain;return t=t||`${window.location.origin}/mobile`,`${t}/pages/salesman/salesmanCard?&salesmanId=${null==(l=null==(a=s.value)?void 0:a.salesman)?void 0:l.salesmanId}`}),t=n(),o=n(""),u=n(!1),m=n(!1),b=[{name:"编辑名片",icon:c("salesman/businessCardEdit.png")},{name:"发送给朋友",icon:c("salesman/businessCardWechat.png")},{name:"保存到相册",icon:c("salesman/businessCardPic.png")}];S(()=>{var a;null==(a=t.value)||a.drawQrcode()});const y=a=>{o.value=a};return $(()=>({title:`${s.value.nickname}的名片`})),T(()=>({title:`${s.value.nickname}的名片`})),(a,e)=>{const n=P(z("tig-image"),E),c=d,x=p,w=P(z("tig-layout"),H),I=P(z("tig-qrcode"),J);return r(),i(c,null,{default:f(()=>[v(w,{"need-safe-top":!0,"safe-top-bg-color":"#f5f5f5"},{default:f(()=>[v(c,{class:"businessCard-box"},{default:f(()=>[v(c,{class:"card-box"},{default:f(()=>[v(c,{class:"card-img"},{default:f(()=>[v(n,{src:s.value.avatar},null,8,["src"])]),_:1}),v(c,{class:"card-box-content"},{default:f(()=>[v(c,{class:"card-box-content-text"},{default:f(()=>[v(c,{class:"card-box-content-text-mobile"},{default:f(()=>[_(h(s.value.mobile),1)]),_:1}),v(c,{class:"card-box-content-text-name"},{default:f(()=>[_(h(s.value.nickname),1)]),_:1})]),_:1}),v(c,{class:"card-box-content-qrcode"},{default:f(()=>[v(x,{style:{height:"100%",width:"100%"},src:o.value},null,8,["src"])]),_:1})]),_:1})]),_:1}),v(c,{class:"card-menu"},{default:f(()=>[(r(),A(L,null,R(b,(e,s)=>v(c,{key:s,class:"card-menu-item",onClick:a=>(a=>{switch(a){case 0:D({url:"/pages/salesman/personalInfo"});break;case 1:u.value=!0;break;case 2:m.value=!0}})(s)},{default:f(()=>[v(x,{class:"card-menu-item-icon",src:e.icon},null,8,["src"]),v(c,{class:"card-menu-item-text"},{default:f(()=>[_(h(a.$t(e.name)),1)]),_:2},1024)]),_:2},1032,["onClick"])),64))]),_:1})]),_:1})]),_:1}),v(K,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=a=>u.value=a)},null,8,["modelValue"]),m.value?(r(),i(M,{key:0,modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=a=>m.value=a),"qrcode-img":o.value,"user-info":s.value},null,8,["modelValue","qrcode-img","user-info"])):g("",!0),v(I,{ref_key:"qrcodeRef",ref:t,"immediately-create":!0,value:l.value,margin:10,show:!1,onSuccess:y},null,8,["value"])]),_:1})}}}),[["__scopeId","data-v-4c0a56b0"]]);export{O as default};

import{d as a,L as s,l as e,r as t,M as l,b8 as n,aQ as o,m as i,c as r,w as c,b6 as d,C as u,F as m,ac as v,ae as f,H as p,aD as y,ad as g,b9 as h,R as w,a9 as b,b as I,e as _,ba as x,O as C,i as F,a as S,f as T,h as j,t as $,_ as k}from"./index-BZxHr1FI.js";import{T as L}from"./tig-layout.DTz8E-sj.js";const P=k(a({__name:"portalPoster",setup(a){b(a=>({a902c09c:q.height+"px"}));const{t:k}=s(),P=e(),R=t(l("userInfo")),z=o();let D=n("myCanvas",z);const H=t(""),O=i(()=>{var a,s;let e=P.baseInfo.h5Domain;return e=e||`${window.location.origin}/mobile`,`${e}/pages/salesman/salesmanCard?&salesmanId=${null==(s=null==(a=R.value)?void 0:a.salesman)?void 0:s.salesmanId}`}),q={height:525,width:345},A=t(""),G=()=>{h({fileType:"jpg",canvasId:"myCanvas",quality:1,destHeight:2*q.height,destWidth:2*q.width,success:function(a){A.value=a.tempFilePath},fail:a=>{w({title:JSON.stringify(a),icon:"none",duration:3e3}),console.log(a)}},z)},J=()=>{};return(async()=>{try{const a=await d(encodeURIComponent(O.value));H.value=a,(()=>{v({title:k("生成中"),mask:!0});const a=R.value.avatar?f(R.value.avatar):p("user/defaultAvatar.jpg"),s=R.value.nickname??k("普通会员");D.draw(),D.setFillStyle("#ffffff"),D.fillRect(0,0,345,600);try{D.draw(!0,async()=>{const e=await y(a);D.drawImage(e.path,0,0,345,345),D.draw(!0,async()=>{D.drawImage(H.value,175,360,150,150),D.setFontSize(13),D.setFillStyle("#969799"),D.fillText(s,20,q.height-50),D.setFillStyle("#000"),D.setFontSize(22),D.fillText(R.value.mobile,20,425),setTimeout(()=>{D.draw(!0),setTimeout(()=>{G()},50)},50)})})}catch(e){console.error(e)}finally{g()}})()}catch(a){console.error("获取二维码失败",a)}})(),(a,s)=>{const e=x,t=T,l=F,n=u(m("tig-layout"),L);return I(),r(n,{title:"名片海报"},{default:c(()=>[_(e,{id:"myCanvas",class:"canvas-content","canvas-id":"myCanvas",onLongpress:C(J,["stop"])}),_(l,{class:"portalPoster-box"},{default:c(()=>[_(l,{class:"img-box"},{default:c(()=>[A.value?(I(),r(t,{key:0,src:A.value,onLongpress:C(J,["stop"])},null,8,["src"])):S("",!0)]),_:1}),_(l,{class:"canvas-tip"},{default:c(()=>[j($(a.$t("长按保存图片")),1)]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-7840855d"]]);export{P as default};

import{d as e,r as a,V as l,C as t,F as s,c as o,a as u,b as r,i as c,w as i,e as n,h as d,t as p,k as f,W as y,J as m,P as v,K as _,X as b,_ as h,l as k,L as g,Y as x,m as I,n as w,R as C,O as j,Z as z,$,a0 as N,G as V,a1 as S,a2 as L,N as U,a3 as O}from"./index-BZxHr1FI.js";import{_ as P}from"./uni-icons.DMMn2oBg.js";import{_ as T}from"./empty-box.vue_vue_type_script_setup_true_lang.DDT9sx90.js";import{_ as W}from"./loading-box.D3Y7A2lC.js";import{a as J,b as K,T as M,_ as R}from"./tig-layout.DTz8E-sj.js";import{m as F}from"./masonry.B_l69Lra.js";import{g as G,a as X,b as Y,c as Z,d as A}from"./search.DqVGFqMH.js";import{_ as B}from"./tig-image.CzXKqALH.js";import{_ as Q}from"./format-price.BrXrBVy6.js";import{g as q}from"./shop.CnQQ4qvJ.js";import{u as D}from"./useList.cF42RyDa.js";import"./specification.C71VpZ8P.js";import"./uni-number-box.DKxM8QIH.js";import"./product.BH5dMQls.js";import"./tig-lazy-image.BPOhG_XX.js";import"./activityCard.DE1HAQr9.js";import"./dayjs.min.BETqfnlQ.js";import"./currency.Dn5A4d7X.js";const E=h(e({__name:"shopInfo",props:{keyword:{type:String,default:""},shopId:{type:Number,default:null}},setup(e){const h=e,k=a({});l(()=>h.keyword,e=>{e&&(async()=>{try{const e={keyword:h.keyword,size:1};null!==h.shopId&&(e.shopId=h.shopId);const a=await q(e);k.value=a.records[0]}catch(e){console.error(e)}})()},{immediate:!0});const g=e=>{e&&b({url:e})};return(e,a)=>{const l=t(s("tig-image"),B),b=c,h=t(s("tig-button"),J),x=f,I=t(s("format-price"),Q),w=y;return k.value&&Object.keys(k.value).length>0?(r(),o(b,{key:0,class:"shop-info-box"},{default:i(()=>[n(b,{class:"shop-info"},{default:i(()=>[n(b,{class:"shop-title",onClick:a[1]||(a[1]=e=>g(`/pages/shop/index?shopId=${k.value.shopId}`))},{default:i(()=>[n(b,{class:"shop-logo"},{default:i(()=>[n(l,{src:k.value.shopLogo},null,8,["src"])]),_:1}),n(b,{class:"shop-title-text line1"},{default:i(()=>[d(p(k.value.shopTitle),1)]),_:1}),n(b,{class:"shop-btn"},{default:i(()=>[n(h,{class:"btn",plain:!0,"plain-main-color":!0,onClick:a[0]||(a[0]=e=>g(`/pages/shop/index?shopId=${k.value.shopId}`))},{default:i(()=>[d(p(e.$t("进店")),1)]),_:1})]),_:1})]),_:1}),n(b,{class:"shop-desc"},{default:i(()=>[n(x,{class:"shop-info-text"},{default:i(()=>[d(p(e.$t("上架商品："))+p(k.value.listingCount),1)]),_:1}),n(x,{class:"shop-info-text"},{default:i(()=>[d(p(e.$t("店铺收藏："))+p(k.value.collectCount),1)]),_:1})]),_:1}),n(b,{class:"shop-product"},{default:i(()=>[n(w,{"scroll-x":"true"},{default:i(()=>[n(b,{class:"shop-product-scroll"},{default:i(()=>[(r(!0),m(_,null,v(k.value.listingProduct,e=>(r(),o(b,{key:e.productId,class:"shop-product-image",onClick:a=>g(`/pages/product/index?id=${e.productId}`)},{default:i(()=>[n(l,{src:e.picUrl},null,8,["src"]),n(b,{class:"product-price"},{default:i(()=>[n(I,{"font-style":{fontSize:"24rpx"},"currency-style":{fontSize:"20rpx"},"decimals-style":{fontSize:"22rpx"},"price-data":e.productPrice},null,8,["price-data"])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):u("",!0)}}}),[["__scopeId","data-v-58282531"]]),H=h(e({__name:"result",setup(e){const l=k(),{t:b}=g(),h=a("商品搜索"),{safeBottom:J}=K(),B=x({page:1,size:10,sort:"",order:"asc",keyword:"",max:"",min:"",cat:0,couponId:0,brand:[],attrs:[],intro:"",pageType:"search"}),Q=a([]),q=a([]),H=a(""),ee=a([]),ae=a([]),le={new:b("新品"),hot:b("热销"),best:b("精品")},te=a([]),se=I(()=>ee.value.length>3&&!ge.value?ee.value.slice(0,3):ee.value),oe=I(()=>ae.value.length>3&&!ge.value?ae.value.slice(0,3):ae.value),ue=I(()=>B.cat?te.value:B.shopCategoryId?ae.value:[]),{getList:re,total:ce,data:ie,promotionList:ne,isLoadMore:de,isLoading:pe}=D(G,{params:B,path:{dataKey:"records"},needPromotionList:!0}),fe=async()=>{try{B.brand=q.value.join(",");const e=await Y({...B});if(Q.value=e.filter.brand,ee.value=e.filter.category,ae.value=e.filter.shopCategory,H.value=e.filterSelected.brand,B.attrs=e.filterSelected.attrs,B.cat){const e=await Z(B.cat);te.value=e}if(B.shopCategoryId){const e=await A(B.shopCategoryId);ae.value=e}}catch(e){C({title:e.message,icon:"none"})}},ye=a("default"),me=a([{label:"默认",value:"default"},{label:"销量",value:"sale"},{label:"价格",value:"price",order:"desc"}]),ve=e=>{switch(e){case"brand":q.value=[],H.value="";break;case"price":B.min="",B.max="";break;case"keyword":B.keyword="";break;case"intro":B.intro="";break;case"couponInfo":ke.value={},B.couponId=0}Ce(),fe(),Ve(),re(()=>({brand:q.value.join(",")}))},_e=a(!1),be=()=>{_e.value=!0},he=()=>{O({url:"/pages/search/index?shopId="+B.shopId})},ke=a({});w(e=>{e&&(e.keyWords&&(B.keyword=e.keyWords),e.intro&&(B.intro=e.intro),e.categoryId&&(B.cat=e.categoryId),e.brandId&&q.value.push(e.brandId),e.shopId&&(B.shopId=e.shopId,h.value="店铺商品搜索"),e.shopCategoryId&&(B.shopCategoryId=e.shopCategoryId),e.couponInfo&&(ke.value=JSON.parse(decodeURIComponent(e.couponInfo)),B.couponId=ke.value.couponId)),Ce(),fe(),re(()=>({brand:q.value.join(",")}))});const ge=a(!1),xe=a(!1),Ie=a(!1),we=a([]),Ce=async()=>{if(l.enableAttributeFilter)try{const e=await X({keyword:B.keyword});we.value=e.attributes}catch(e){console.error(e)}},je=a([]),ze=(e,a)=>{const l=je.value.find(a=>a.attrName===e);return!!l&&l.attrValue.includes(a)},$e=()=>{Number(B.min)>Number(B.max)?C({title:b("最低价不能大于最高价"),icon:"none"}):(je.value.length>0&&(B.attrs=je.value),fe(),_e.value=!1,Ve(),re(()=>({brand:q.value.join(","),attrs:je.value})))},Ne=()=>{B.min="",B.max="",q.value=[],je.value=[],B.attrs=[],B.cat=0},Ve=()=>{ce.value=0,B.page=1,B.intro="",ie.value=[],ne.value={}};return(e,a)=>{const l=t(s("uni-icons"),P),b=c,k=f,g=t(s("empty-box"),T),x=t(s("loading-box"),W),I=U,w=y,C=t(s("tig-popup"),R),O=t(s("tig-layout"),M);return r(),o(O,{title:h.value,"shop-id":B.shopId,"shop-category-id":B.shopCategoryId},{default:i(()=>[n(b,{class:"pageMain productSort"},{default:i(()=>[n(b,{class:"header acea-row row-center-wrapper"},{default:i(()=>[n(b,{class:"acea-row row-between-wrapper input",onClick:j(he,["stop"])},{default:i(()=>[n(l,{type:"search",size:"18",class:"sousuo"}),n(b,{class:"txt"},{default:i(()=>[d(p(e.$t("请输入搜索内容")),1)]),_:1})]),_:1})]),_:1}),n(b,{class:"tab-box flex align-center justify-between"},{default:i(()=>[(r(!0),m(_,null,v(me.value,a=>(r(),o(b,{key:a.value,class:z(["item flex align-center",{active:ye.value===a.value}]),onClick:e=>(e=>{"price"==e.value?e.order="desc"===e.order?"asc":"desc":e.order="",ye.value=e.value,B.sort=e.value,B.order=e.order,fe(),Ve(),re(()=>B.brand=q.value.join(","))})(a)},{default:i(()=>[n(k,null,{default:i(()=>[d(p(e.$t(a.label)),1)]),_:2},1024),$(n(b,{class:"price-ico-box flex flex-column"},{default:i(()=>[n(l,{type:"up",size:"8",class:z({order:"price"===ye.value&&"asc"===a.order})},null,8,["class"]),n(l,{type:"down",size:"8",class:z({order:"price"===ye.value&&"desc"===a.order})},null,8,["class"])]),_:2},1536),[[N,"price"===a.value]])]),_:2},1032,["class","onClick"]))),128)),n(b,{class:"item flex",onClick:be},{default:i(()=>[n(k,null,{default:i(()=>[d(p(e.$t("筛选")),1)]),_:1}),n(l,{type:"right",size:"12",class:"sanjiaoright"})]),_:1})]),_:1}),n(b,{class:"tag-row"},{default:i(()=>[n(b,{class:"tag-list flex-wrap align-center"},{default:i(()=>[B.keyword?(r(),o(b,{key:0,class:"tag-item mr10 line1",onClick:a[0]||(a[0]=e=>ve("keyword"))},{default:i(()=>[n(k,{class:"line1"},{default:i(()=>[d(p(e.$t("搜索关键词"))+'"'+p(B.keyword)+'"',1)]),_:1}),n(l,{type:"closeempty",size:"10"})]),_:1})):u("",!0),B.intro?(r(),o(b,{key:1,class:"tag-item mr10",onClick:a[1]||(a[1]=e=>ve("intro"))},{default:i(()=>[n(k,null,{default:i(()=>[d(p(le[B.intro]),1)]),_:1}),n(l,{type:"closeempty",size:"10"})]),_:1})):u("",!0),ke.value&&ke.value.couponName?(r(),o(b,{key:2,class:"tag-item mr10",onClick:a[2]||(a[2]=e=>ve("coupon_info"))},{default:i(()=>[n(k,null,{default:i(()=>[d(p(e.$t("优惠券"))+': "'+p(ke.value.couponName)+'"',1)]),_:1}),n(l,{type:"closeempty",size:"10"})]),_:1})):u("",!0),H.value?(r(),o(b,{key:3,class:"tag-item mr10 brand",onClick:a[3]||(a[3]=e=>ve("brand"))},{default:i(()=>[n(k,null,{default:i(()=>[d(p(H.value),1)]),_:1}),n(l,{type:"closeempty",size:"10"})]),_:1})):u("",!0),B.attrs.length>0?(r(!0),m(_,{key:4},v(B.attrs,(e,a)=>(r(),o(b,{key:e.attrName,class:"tag-item mr10 brand",onClick:e=>(e=>{B.attrs.splice(e,1),je.value=B.attrs,Ce(),fe(),Ve(),re(()=>({brand:q.value.join(","),attrs:je.value}))})(a)},{default:i(()=>[n(k,null,{default:i(()=>[d(p(e.attrName)+": ",1),(r(!0),m(_,null,v(e.attrValue,e=>(r(),o(k,{key:e},{default:i(()=>[d(p(e),1)]),_:2},1024))),128))]),_:2},1024),n(l,{type:"closeempty",size:"10"})]),_:2},1032,["onClick"]))),128)):u("",!0),B.max||B.min?(r(),o(b,{key:5,class:"tag-item mr10",onClick:a[4]||(a[4]=e=>ve("price"))},{default:i(()=>[n(k,null,{default:i(()=>[d(p(B.min||0)+" - "+p(B.max||0),1)]),_:1}),n(l,{type:"closeempty",size:"10"})]),_:1})):u("",!0),ue.value.length>0?(r(!0),m(_,{key:6},v(ue.value,(e,a)=>(r(),o(b,{key:a,class:"flex align-center",onClick:e=>(e=>{e>0?B.shopCategoryId?B.shopCategoryId=ae.value[e-1].categoryId:B.cat=te.value[e-1].categoryId:B.shopCategoryId?B.shopCategoryId=0:B.cat=0,Ce(),fe(),Ve(),re(()=>({brand:q.value.join(",")}))})(a)},{default:i(()=>[n(b,{class:"tag-item"},{default:i(()=>[n(k,null,{default:i(()=>[d(p(e.categoryName),1)]),_:2},1024),n(l,{type:"closeempty",size:"10"})]),_:2},1024),a<ue.value.length-1?(r(),o(b,{key:0,class:"tag-interval"},{default:i(()=>[n(l,{type:"right",size:"10"})]),_:1})):u("",!0)]),_:2},1032,["onClick"]))),128)):u("",!0)]),_:1})]),_:1}),V(S)()&&B.keyword?(r(),o(E,{key:0,keyword:B.keyword,"shop-id":B.shopId},null,8,["keyword","shop-id"])):u("",!0),!V(pe)&&V(ce)>0?(r(),o(b,{key:1,class:"goods-container"},{default:i(()=>[n(F,{"commodity-list":V(ie),"promotion-list":V(ne)},null,8,["commodity-list","promotion-list"])]),_:1})):u("",!0),V(pe)||0!==V(ce)?u("",!0):(r(),o(g,{key:2,mode:"search",background:"#f5f5f5"})),n(x,{modelValue:V(de),"onUpdate:modelValue":a[5]||(a[5]=e=>L(de)?de.value=e:null),page:B.page,length:V(ie).length},null,8,["modelValue","page","length"]),n(C,{show:_e.value,"onUpdate:show":a[11]||(a[11]=e=>_e.value=e),position:"right","z-index":900,"show-close":!1},{default:i(()=>[n(w,{"scroll-y":"true",class:"search_condition"},{default:i(()=>[n(b,{class:"search_condition-box"},{default:i(()=>[ee.value.length>0?(r(),o(b,{key:0,class:"tab_box"},{default:i(()=>[n(b,{class:"title-box flex justify-between"},{default:i(()=>[n(b,{class:"txt"},{default:i(()=>[d(p(e.$t("分类")),1)]),_:1}),n(b,{class:"more",onClick:a[6]||(a[6]=e=>ge.value=!ge.value)},{default:i(()=>[ge.value?(r(),o(l,{key:0,type:"up",size:"16",color:"#bfbfbf"})):(r(),o(l,{key:1,type:"down",size:"16",color:"#bfbfbf"}))]),_:1})]),_:1}),B.shopId?(r(),o(b,{key:0,class:"tabs flex-wrap"},{default:i(()=>[(r(!0),m(_,null,v(oe.value,(e,a)=>(r(),o(b,{key:a,class:z(["item",{active:B.shopCategoryId==e.categoryId}]),onClick:a=>B.shopCategoryId=e.categoryId},{default:i(()=>[B.shopCategoryId==e.categoryId?(r(),o(l,{key:0,type:"checkmarkempty",size:"12"})):u("",!0),d(" "+p(e.categoryName),1)]),_:2},1032,["class","onClick"]))),128))]),_:1})):(r(),o(b,{key:1,class:"tabs flex-wrap"},{default:i(()=>[(r(!0),m(_,null,v(se.value,(e,a)=>(r(),o(b,{key:a,class:z(["item",{active:B.cat==e.categoryId}]),onClick:a=>B.cat=e.categoryId},{default:i(()=>[B.cat==e.categoryId?(r(),o(l,{key:0,type:"checkmarkempty",size:"12"})):u("",!0),d(" "+p(e.categoryName),1)]),_:2},1032,["class","onClick"]))),128))]),_:1}))]),_:1})):u("",!0),Q.value.length>0?(r(),o(b,{key:1,class:"tab_box"},{default:i(()=>[n(b,{class:"title-box flex justify-between"},{default:i(()=>[n(b,{class:"txt"},{default:i(()=>[d(p(e.$t("品牌")),1)]),_:1}),n(b,{class:"more",onClick:a[7]||(a[7]=e=>xe.value=!xe.value)},{default:i(()=>[xe.value?(r(),o(l,{key:0,type:"up",size:"16",color:"#bfbfbf"})):(r(),o(l,{key:1,type:"down",size:"16",color:"#bfbfbf"}))]),_:1})]),_:1}),n(b,{class:"tabs flex-wrap"},{default:i(()=>[(r(!0),m(_,null,v(xe.value?Q.value:Q.value.slice(0,3),(e,a)=>(r(),o(b,{key:a,class:z(["item",{active:q.value.includes(e.brandId)}]),onClick:a=>(e=>{let a=q.value.indexOf(e.brandId);-1!==a?q.value.splice(a,1):q.value.push(e.brandId)})(e)},{default:i(()=>[q.value.includes(e.brandId)?(r(),o(l,{key:0,type:"checkmarkempty",size:"12"})):u("",!0),d(" "+p(e.brandName),1)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1})):u("",!0),we.value.length>0?(r(!0),m(_,{key:2},v(Ie.value?we.value:we.value.slice(0,1),(e,t)=>(r(),o(b,{key:t,class:"tab_box"},{default:i(()=>[n(b,{class:"title-box flex justify-between"},{default:i(()=>[n(b,{class:"txt"},{default:i(()=>[d(p(e.name),1)]),_:2},1024),0==t?(r(),o(b,{key:0,class:"more",onClick:a[8]||(a[8]=e=>Ie.value=!Ie.value)},{default:i(()=>[Ie.value?(r(),o(l,{key:0,type:"up",size:"16",color:"#bfbfbf"})):(r(),o(l,{key:1,type:"down",size:"16",color:"#bfbfbf"}))]),_:1})):u("",!0)]),_:2},1024),n(b,{class:"tabs flex-wrap"},{default:i(()=>[(r(!0),m(_,null,v(Ie.value?e.values:e.values.slice(0,3),(a,t)=>(r(),o(b,{key:t,class:z(["item",{active:ze(e.name,a.value)}]),onClick:l=>((e,a)=>{let l=je.value.find(a=>a.attrName===e);l||(l={attrName:e,attrValue:[]},je.value.push(l));const t=l.attrValue.indexOf(a);t>-1?l.attrValue.splice(t,1):l.attrValue.push(a)})(e.name,a.value)},{default:i(()=>[ze(e.name,a.value)?(r(),o(l,{key:0,type:"checkmarkempty",size:"12"})):u("",!0),n(k,null,{default:i(()=>[d(p(a.value),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:2},1024)]),_:2},1024))),128)):u("",!0),n(b,{class:"tab_box"},{default:i(()=>[n(b,{class:"title-box flex justify-between"},{default:i(()=>[n(b,{class:"txt"},{default:i(()=>[d(p(e.$t("价格")),1)]),_:1})]),_:1}),n(b,{class:"tabs flex justify-between align-center"},{default:i(()=>[n(I,{modelValue:B.min,"onUpdate:modelValue":a[9]||(a[9]=e=>B.min=e),class:"uni-input",type:"number",placeholder:e.$t("最低价")},null,8,["modelValue","placeholder"]),n(b,{class:"xian"}),n(I,{modelValue:B.max,"onUpdate:modelValue":a[10]||(a[10]=e=>B.max=e),class:"uni-input",type:"number",placeholder:e.$t("最高价")},null,8,["modelValue","placeholder"])]),_:1})]),_:1})]),_:1}),n(b,{class:z(["btn-box",{"safe-btn":V(J)>0}])},{default:i(()=>[n(b,{class:"flex btn-flex"},{default:i(()=>[n(b,{class:"btn",onClick:Ne},{default:i(()=>[d(p(e.$t("重置")),1)]),_:1}),n(b,{class:"btn submit",onClick:$e},{default:i(()=>[d(p(e.$t("确定")),1)]),_:1})]),_:1})]),_:1},8,["class"])]),_:1})]),_:1},8,["show"])]),_:1})]),_:1},8,["title","shop-id","shop-category-id"])}}}),[["__scopeId","data-v-ef0f9d0c"]]);export{H as default};

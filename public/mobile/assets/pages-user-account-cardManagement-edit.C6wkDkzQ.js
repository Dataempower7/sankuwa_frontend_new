import{d as e,L as a,r as l,m as t,a8 as u,v as o,ai as r,n as c,c as n,w as s,ac as d,ad as i,C as m,F as p,b as v,e as f,i as y,a as b,c6 as h,h as _,t as g,R as $,as as T,au as N,_ as V}from"./index-BZxHr1FI.js";import{_ as k,a as j}from"./uni-forms.QWcIXEX3.js";import{_ as q}from"./uni-easyinput.DHFPvsdC.js";import{T as x,a as w}from"./tig-layout.DTz8E-sj.js";import{T as R}from"./tig-fixed-placeholder.BDsbIjoZ.js";import{f as U,h as C}from"./account.DIoGmjqt.js";import"./uni-icons.DMMn2oBg.js";const F=V(e({__name:"edit",setup(e){const{t:V}=a(),F=l("添加账号"),M=l(),A=l(0),D=l([V("银行卡"),V("支付宝"),V("微信")]),I=e=>{A.value=e.detail.value,G.value.accountType=e.detail.value+1,O()},O=()=>{G.value={accountName:"",identity:"",accountNo:"",accountType:A.value+1,bankName:""}},G=l({accountType:1}),H=t(()=>{switch(G.value.accountType){case 1:return"银行卡";case 2:return"支付宝";case 3:return"微信";default:return""}}),L={accountName:{rules:[{required:!0,errorMessage:V("请输入真实姓名")}]},identity:{rules:[{required:!0,errorMessage:V("请输入身份证号码")},{validateFunction:function(e,a,l,t){return/^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/.test(a)||t(V("请输入正确的身份证号码")),!0}}]},accountNo:{rules:[{required:!0,errorMessage:`${V("请输入正确的"+H.value+"账号")}`},{validateFunction:function(e,a,l,t){return/^\d{6,}$/.test(a)||1!==G.value.accountType||t(`${V("请输入正确的"+H.value+"账号")}`),!0}}]}},X=u(),z=e=>{X.value.validate().then(()=>{M.value?E():B()}).catch(e=>{console.error("表单错误信息：",e)})},B=async()=>{try{await C({...G.value},"createAccount");$({title:V("添加成功"),icon:"success",duration:1e3}),setTimeout(()=>{T({success:function(e){N("refreshData",{type:G.value.accountType})}})},1e3)}catch(e){$({title:e.message,icon:"none",duration:1e3})}},E=async()=>{try{const e=await C({...G.value},"updateAccount");e.message&&$({title:e.message,icon:"success",duration:1e3}),setTimeout(()=>{T({success:function(e){N("refreshData",{type:G.value.accountType})}})},1e3)}catch(e){$({title:e.message,icon:"none",duration:1e3})}};return o(()=>{r(()=>{X.value.setRules(L)})}),c(e=>{e.id&&(M.value=e.id,F.value="编辑账号",(async()=>{d({title:V("加载中")});try{const e=await U({accountId:M.value});A.value=e.accountType-1,Object.assign(G.value,e)}catch(e){console.error(e.message)}finally{i()}})())}),(e,a)=>{const l=y,t=h,u=m(p("uni-forms-item"),k),o=m(p("uni-easyinput"),q),r=m(p("uni-forms"),j),c=m(p("tig-button"),w),d=m(p("tig-fixed-placeholder"),R),i=m(p("tig-layout"),x);return v(),n(i,{title:F.value},{default:s(()=>[f(l,{class:"card-edit-main"},{default:s(()=>[f(r,{ref_key:"formRef",ref:X,"model-value":G.value,"label-width":"170rpx"},{default:s(()=>[f(l,{class:"card-edit-content"},{default:s(()=>[M.value?(v(),n(u,{key:1,label:e.$t("卡片类型"),name:"accountType",required:""},{default:s(()=>[f(o,{"input-border":!1,placeholder:H.value,disabled:""},null,8,["placeholder"])]),_:1},8,["label"])):(v(),n(u,{key:0,label:e.$t("卡片类型"),name:"accountType",required:""},{default:s(()=>[f(t,{range:D.value,value:A.value,mode:"selector",onChange:I},{default:s(()=>[f(l,{class:"card-idx"},{default:s(()=>[_(g(D.value[A.value]),1)]),_:1})]),_:1},8,["range","value"])]),_:1},8,["label"])),f(u,{label:e.$t("真实姓名"),name:"accountName",required:""},{default:s(()=>[f(o,{modelValue:G.value.accountName,"onUpdate:modelValue":a[0]||(a[0]=e=>G.value.accountName=e),"input-border":!1,placeholder:e.$t("请输入真实姓名"),"primary-color":"rgb(192, 196, 204)"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),f(u,{label:e.$t("身份证号"),name:"identity",required:""},{default:s(()=>[f(o,{modelValue:G.value.identity,"onUpdate:modelValue":a[1]||(a[1]=e=>G.value.identity=e),"input-border":!1,placeholder:e.$t("请输入身份证号码"),"primary-color":"rgb(192, 196, 204)"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),f(u,{label:`${e.$t(H.value+"号")}`,name:"accountNo",required:""},{default:s(()=>[f(o,{modelValue:G.value.accountNo,"onUpdate:modelValue":a[2]||(a[2]=e=>G.value.accountNo=e),"input-border":!1,placeholder:`${e.$t("请输入"+H.value+"账号")}`,"primary-color":"rgb(192, 196, 204)"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),1===G.value.accountType?(v(),n(u,{key:2,label:e.$t("银行卡详情"),name:"bankName"},{default:s(()=>[f(o,{modelValue:G.value.bankName,"onUpdate:modelValue":a[3]||(a[3]=e=>G.value.bankName=e),"input-border":!1,placeholder:e.$t("请输入银行卡详情"),"primary-color":"rgb(192, 196, 204)"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):b("",!0)]),_:1})]),_:1},8,["model-value"])]),_:1}),f(d,{"background-color":"#fff"},{default:s(()=>[f(l,{class:"btn-box"},{default:s(()=>[f(c,{class:"btn",onClick:z},{default:s(()=>[_(g(M.value?e.$t("保存修改"):e.$t("新增账号")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["title"])}}}),[["__scopeId","data-v-823a497d"]]);export{F as default};

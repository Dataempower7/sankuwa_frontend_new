import{d as e,L as a,r as l,n as t,ac as s,ad as r,Y as o,c as u,w as i,C as n,F as d,b as c,a as f,i as m,e as p,J as v,K as y,P as _,h as b,t as g,k as h,c6 as x,R as I,a3 as j,_ as T}from"./index-BZxHr1FI.js";import{_ as w}from"./tig-image.CzXKqALH.js";import{_ as R}from"./format-price.BrXrBVy6.js";import{_ as k}from"./uni-number-box.DKxM8QIH.js";import{_ as V}from"./uni-icons.DMMn2oBg.js";import{_ as $,a as S}from"./uni-forms.QWcIXEX3.js";import{_ as z}from"./uni-easyinput.DHFPvsdC.js";import{T as C,a as N}from"./tig-layout.DTz8E-sj.js";import{T as E}from"./tig-fixed-placeholder.BDsbIjoZ.js";import{g as U,a as A,b as O,u as Q,c as q}from"./afterSale.Bc08-95K.js";import{_ as K}from"./index.vue_vue_type_script_setup_true_lang.DcvN28sX.js";import"./currency.Dn5A4d7X.js";const W=T(e({__name:"edit",setup(e){const{t:T}=a(),W=l(),D=l(),F=l();t(async e=>{e&&(e.orderId&&(W.value=e.orderId,D.value=e.itemId,await L()),e.aftersaleId&&(F.value=e.aftersaleId,await Y()),await P())});const G=l({list:[],order:{}}),J=l([]),L=async()=>{s({title:T("加载中")});try{if(W.value){const e=await U({itemId:D.value,orderId:W.value});G.value.list=e.list,G.value.order=e.order,G.value.list.forEach(e=>{e.number=e.canApplyQuantity})}}catch(e){console.error(e)}finally{r()}},M=l([]),P=async()=>{try{const e=await A();M.value=e.aftersaleReason,Object.keys(e.aftersaleType).forEach((a,l)=>{var t,s;1===Number(null==(s=null==(t=G.value)?void 0:t.order)?void 0:s.orderStatus)&&1===Number(a)||J.value.push({value:Number(a),label:e.aftersaleType[a]})}),F.value&&(X.value=J.value.findIndex(e=>e.value===B.aftersaleType),ee.value=M.value.findIndex(e=>e===B.aftersaleReason))}catch(e){console.error(e)}},Y=async()=>{try{const e=await O(F.value);G.value.list=e.aftersalesItems,G.value.order=e.orders,B.aftersaleId=e.aftersaleId,B.description=e.description,H.value=e.pics,B.aftersaleReason=e.aftersaleReason,B.aftersaleType=e.aftersaleType}catch(e){console.error(e)}},B=o({items:[],pics:[],orderId:0,aftersaleType:0,aftersaleReason:"",description:""}),H=l([]),X=l(null),Z=e=>{X.value=e.detail.value,B.aftersaleType=J.value[X.value].value},ee=l(null),ae=e=>{ee.value=e.detail.value,B.aftersaleReason=M.value[ee.value]},le=l(!1),te=async()=>0===B.aftersaleType?I({title:T("请选择退款方式"),icon:"none"}):""===B.aftersaleReason?I({title:T("请选择退款原因"),icon:"none"}):""===B.description?I({title:T("请填写问题描述"),icon:"none"}):(B.pics=H.value,B.orderId=G.value.order.orderId,void(B.aftersaleId?(G.value.list.forEach(e=>{B.items.push({orderItemId:e.orderItemId,number:e.number})}),re()):(G.value.list.forEach(e=>{B.items.push({orderItemId:e.itemId,number:e.number})}),se()))),se=async()=>{le.value=!0;try{await Q(B);I({title:T("提交成功")}),setTimeout(()=>{j({url:"/pages/user/afterSale/list"})},1500)}catch(e){console.error(e),I({title:e.message,icon:"none"})}finally{le.value=!1}},re=async()=>{le.value=!0;try{await q(B);I({title:T("修改成功")}),setTimeout(()=>{j({url:"/pages/user/afterSale/list"})},1500)}catch(e){console.error(e),I({title:e.message,icon:"none"})}finally{le.value=!1}};return(e,a)=>{const l=n(d("tig-image"),w),t=m,s=n(d("format-price"),R),r=h,o=n(d("uni-number-box"),k),I=n(d("uni-icons"),V),j=x,T=n(d("uni-forms-item"),$),U=n(d("uni-easyinput"),z),A=n(d("uni-forms"),S),O=n(d("tig-button"),N),Q=n(d("tig-fixed-placeholder"),E),q=n(d("tig-layout"),C);return c(),u(q,{"need-safe-top":!0},{default:i(()=>[Object.keys(G.value).length?(c(),u(t,{key:0,class:"after-sale"},{default:i(()=>[p(t,{class:"after-sale-product"},{default:i(()=>[(c(!0),v(y,null,_(G.value.list,a=>(c(),u(t,{key:a.itemId,class:"product-card-item"},{default:i(()=>[p(t,{class:"product-card-item-left"},{default:i(()=>[p(t,{class:"left-img"},{default:i(()=>[p(l,{src:a.picThumb},null,8,["src"])]),_:2},1024)]),_:2},1024),p(t,{class:"product-card-item-right"},{default:i(()=>[p(t,{class:"right-title line2"},{default:i(()=>[b(g(a.productName),1)]),_:2},1024),p(t,{class:"right-price"},{default:i(()=>[p(s,{"show-text":!1,"decimals-style":{fontSize:"24rpx",fontWeight:"bold"},"currency-style":{fontSize:"22rpx",fontWeight:"bold"},class:"right-price-pricenum","price-data":a.price},null,8,["price-data"]),p(t,{class:"right-price-quantity"},{default:i(()=>[b("x "+g(a.quantity),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),p(t,{class:"btn-box"},{default:i(()=>[p(t,{class:"btn-box-content"},{default:i(()=>[p(r,{class:"btn-box-content-text"},{default:i(()=>[b(g(e.$t("可退换数量"))+g(a.canApplyQuantity),1)]),_:2},1024),p(o,{modelValue:a.number,"onUpdate:modelValue":e=>a.number=e,max:a.canApplyQuantity},null,8,["modelValue","onUpdate:modelValue","max"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),p(t,{class:"after-sale-form"},{default:i(()=>[p(A,{ref:"formRef","model-value":B,"label-width":"170rpx"},{default:i(()=>[p(T,{label:e.$t("退款方式"),name:"aftersaleType"},{default:i(()=>[p(j,{style:{height:"100%"},value:X.value,"range-key":"label",range:J.value,onChange:Z},{default:i(()=>[p(t,{class:"form-item-content"},{default:i(()=>[p(t,null,{default:i(()=>[null!==X.value?(c(),u(r,{key:0,class:"form-item-value"},{default:i(()=>[b(g(J.value[X.value].label),1)]),_:1})):(c(),u(r,{key:1,class:"form-item-text"},{default:i(()=>[b(g(e.$t("请选择")),1)]),_:1}))]),_:1}),p(t,{class:"form-item-icon"},{default:i(()=>[p(I,{type:"arrowright",size:"16",color:"#999"})]),_:1})]),_:1})]),_:1},8,["value","range"])]),_:1},8,["label"]),p(T,{label:e.$t("退款原因"),name:"aftersaleReason"},{default:i(()=>[p(j,{value:ee.value,range:M.value,onChange:ae},{default:i(()=>[p(t,{class:"form-item-content"},{default:i(()=>[p(t,null,{default:i(()=>[B.aftersaleReason?(c(),u(r,{key:0,class:"form-item-value"},{default:i(()=>[b(g(B.aftersaleReason),1)]),_:1})):(c(),u(r,{key:1,class:"form-item-text"},{default:i(()=>[b(g(e.$t("请选择")),1)]),_:1}))]),_:1}),p(t,{class:"form-item-icon"},{default:i(()=>[p(I,{type:"arrowright",size:"16",color:"#999"})]),_:1})]),_:1})]),_:1},8,["value","range"])]),_:1},8,["label"]),p(T,{label:e.$t("问题描述"),name:"description"},{default:i(()=>[p(U,{modelValue:B.description,"onUpdate:modelValue":a[0]||(a[0]=e=>B.description=e),type:"textarea","primary-color":"rgb(192, 196, 204)",maxlength:"100","input-border":!1,"auto-height":"",placeholder:e.$t("最多100字"),"placeholder-style":"font-size: 26rpx;text-align: end;"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),p(T,{label:e.$t("上传凭证"),name:"description"},{default:i(()=>[p(t,{class:"upload-box"},{default:i(()=>[p(t,{class:"upload-text"},{default:i(()=>[b(g(e.$t("最多上传5张图片")),1)]),_:1}),p(K,{modelValue:H.value,"onUpdate:modelValue":a[1]||(a[1]=e=>H.value=e),limit:5,"is-value-array":!0},null,8,["modelValue"])]),_:1})]),_:1},8,["label"])]),_:1},8,["model-value"])]),_:1}),p(Q,{"background-color":"#fff"},{default:i(()=>[p(t,{class:"after-sale-btn-box"},{default:i(()=>[p(O,{onClick:te,loading:le.value},{default:i(()=>[b(g(e.$t("提交")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})):f("",!0)]),_:1})}}}),[["__scopeId","data-v-a4fc17fa"]]);export{W as default};

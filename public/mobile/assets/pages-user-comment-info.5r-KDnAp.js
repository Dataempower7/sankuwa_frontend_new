import{d as e,K as a,r as t,l,m as s,be as c,c as o,w as n,aa as i,at as u,Q as d,ab as m,B as r,E as f,o as p,g as _,i as g,I as k,J as y,O as b,a as v,f as h,t as x,h as C,X as w,M as V,by as I,F as T,ac as j,b4 as $,_ as O}from"./index-DDAlCzEE.js";import{_ as P}from"./tig-image.CxOKkXKh.js";import{_ as R}from"./format-price.9n-LYbxy.js";import{_ as S}from"./uni-rate.BQoRzpW4.js";import{_ as A,a as J}from"./tig-layout.Dp_86RM-.js";import{_ as N}from"./uni-icons.piUs7f0e.js";import{_ as U}from"./tig-upload.vue_vue_type_script_setup_true_lang.BOzdOCmK.js";import{c as D,u as z}from"./comment.B-G6XlXq.js";const F=O(e({__name:"info",setup(e){const{t:O}=a(),F=t(""),B=t([O("送货快"),O("质量很好"),O("服务周到"),O("正品"),O("很划算"),O("包装仔细"),O("价格实惠"),O("还可以"),O("相当好")]),q=t([]),E=async e=>{i({title:O("加载中")});try{const a=await D({id:e});a.items.map(e=>{e.allCommentTag=JSON.parse(JSON.stringify(B.value)),Object.assign(e,{commentRank:0,content:"",showPics:[],commentTag:[],isAdd:!1,rankVerification:!0,contentVerification:!0,isCommentInfo:!!e.commentInfo},e.commentInfo)}),Object.assign(q.value,a.items);q.value.every(e=>1===e.isShowed)&&(history.back(),u("commentFinished",!0))}catch(a){d({title:a.message,icon:"none",duration:1e3})}finally{m()}},H=t(""),K=(e,a)=>{let t=q.value[e].commentTag;t.includes(a)?q.value[e].commentTag=t.filter(e=>e!==a):t.push(a)};return l(e=>{if(e){const{id:a}=e;a&&(F.value=a,E(a))}}),s(()=>{c()}),(e,a)=>{const t=r(f("tig-image"),P),l=g,s=r(f("format-price"),R),c=r(f("uni-rate"),S),i=C,u=V,m=r(f("tig-button"),J),D=I,B=r(f("uni-icons"),N),M=r(f("tig-upload"),U),Q=r(f("tig-layout"),A);return p(),o(Q,{title:"订单评价"},{default:n(()=>[_(l,{class:"comment-info"},{default:n(()=>[(p(!0),k(y,null,b(q.value,(r,f)=>(p(),o(l,{key:f,class:"comment-item"},{default:n(()=>[r.isShowed?v("",!0):(p(),o(l,{key:0,class:"white-card"},{default:n(()=>[_(l,{class:"product flex"},{default:n(()=>[_(l,{class:"product-img"},{default:n(()=>[_(t,{src:r.picThumb,mode:"aspectFit"},null,8,["src"])]),_:2},1024),_(l,{class:"product-info"},{default:n(()=>[_(l,{class:"product-name"},{default:n(()=>[h(x(r.productName),1)]),_:2},1024),_(l,{class:"product-price"},{default:n(()=>[_(s,{"show-text":!1,"is-bottom":!1,"price-data":r.price},null,8,["price-data"])]),_:2},1024),r.skuData&&r.skuData.length>0?(p(),o(l,{key:0,class:"sku-card"},{default:n(()=>[(p(!0),k(y,null,b(r.skuData,(e,a)=>(p(),o(l,{key:a,class:"sku-item line1"},{default:n(()=>[h(x(e.value),1)]),_:2},1024))),128))]),_:2},1024)):v("",!0)]),_:2},1024)]),_:2},1024),_(l,{class:"comment"},{default:n(()=>[_(l,{class:"flex comment-cell"},{default:n(()=>[_(l,{class:"lable-text"},{default:n(()=>[h(x(e.$t("商品评分"))+"：",1)]),_:1}),_(l,{class:"flex"},{default:n(()=>[_(c,{readonly:r.isCommentInfo,value:r.commentRank,color:"#bfbfbf","active-color":"#ffa800",size:"18",onChange:e=>((e,a)=>{q.value[e].commentRank=a.value})(f,e)},null,8,["readonly","value","onChange"]),_(i,{style:{"margin-left":"10rpx"}},{default:n(()=>[h(x(r.commentRank)+x(e.$t("分")),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),r.rankVerification?v("",!0):(p(),o(l,{key:0,class:"flex comment-cell"},{default:n(()=>[_(l,{class:"lable-text"}),_(l,{class:"tips"},{default:n(()=>[h(x(e.$t("请先评分商品")),1)]),_:1})]),_:1})),_(l,{class:"comment-cell"},{default:n(()=>[r.isCommentInfo?(p(),o(l,{key:1,class:"label-list"},{default:n(()=>[(p(!0),k(y,null,b(r.commentTag,(e,a)=>(p(),o(l,{key:a,class:"label-item-txt"},{default:n(()=>[_(i,null,{default:n(()=>[h(x(e),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)):(p(),o(l,{key:0,class:"label-list flex-wrap"},{default:n(()=>[(p(!0),k(y,null,b(r.allCommentTag,(e,a)=>(p(),o(l,{key:a,class:w([{active:r.commentTag.includes(e)},"label-item"]),onClick:a=>K(f,e)},{default:n(()=>[_(i,null,{default:n(()=>[h(x(e),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128)),r.isAdd?(p(),o(l,{key:1,class:"label-edit-input flex align-center justify-between"},{default:n(()=>[_(l,null,{default:n(()=>[_(u,{modelValue:H.value,"onUpdate:modelValue":a[0]||(a[0]=e=>H.value=e),type:"text","auto-focus":"",placeholder:e.$t("请输入自定义标签")},null,8,["modelValue","placeholder"])]),_:1}),_(m,{class:"btn",onClick:e=>(e=>{if(""!==H.value){const a=JSON.parse(JSON.stringify(q.value[e].allCommentTag));if(a.includes(H.value))return void d({title:O("您已添加相同标签"),icon:"none",duration:1e3});a.push(H.value),q.value[e].allCommentTag=a,K(e,H.value)}H.value="",q.value[e].isAdd=!1})(f)},{default:n(()=>[h(x(e.$t("确定")),1)]),_:2},1032,["onClick"])]),_:2},1024)):(p(),o(l,{key:0,class:"label-edit",onClick:e=>(e=>{q.value[e].isAdd=!q.value[e].isAdd})(f)},{default:n(()=>[_(l),_(l,null,{default:n(()=>[h(x(e.$t("自定义")),1)]),_:1})]),_:2},1032,["onClick"]))]),_:2},1024))]),_:2},1024),_(l,{class:"comment-cell"},{default:n(()=>[_(l,{class:"textarea-box"},{default:n(()=>[_(D,{modelValue:r.content,"onUpdate:modelValue":e=>r.content=e,cols:"50",name:"content",placeholder:e.$t("商品是否给力？快分享你的购买心得吧~"),rows:"5",maxlength:500,style:{border:"1px solid #d9d9d9",padding:"4px"},disabled:r.isCommentInfo},null,8,["modelValue","onUpdate:modelValue","placeholder","disabled"]),_(l,{class:"strlangth"},{default:n(()=>[h(x(e.$t("1-500字")),1)]),_:1})]),_:2},1024)]),_:2},1024),_(l,{class:"comment-cell flex align-center justify-between"},{default:n(()=>[_(l,{class:"tips"},{default:n(()=>[r.contentVerification?v("",!0):(p(),o(i,{key:0},{default:n(()=>[h(x(e.$t("请填写购买心得")),1)]),_:1}))]),_:2},1024)]),_:2},1024),_(l,{class:"comment-cell"},{default:n(()=>[_(l,{class:"lable-text"},{default:n(()=>[h(x(e.$t("添加图片")),1)]),_:1}),_(l,{class:"pic-box flex-wrap"},{default:n(()=>[(p(!0),k(y,null,b(r.showPics,(e,a)=>(p(),o(l,{key:a,class:"pic-img",style:{transition:"opacity 0.2s linear","margin-right":"10px"}},{default:n(()=>[_(t,{src:e.picThumb,onClick:a=>{return t=T(j)(e.picThumb),void $({urls:[t]});var t}},null,8,["src","onClick"]),_(l,{class:"close-icon",onClick:e=>((e,a)=>{e.showPics.splice(a,1)})(r,a)},{default:n(()=>[_(B,{type:"clear",size:"25",color:"#cccccc"})]),_:2},1032,["onClick"])]),_:2},1024))),128)),_(M,{modelValue:r.showPics,"onUpdate:modelValue":e=>r.showPics=e,count:9},{default:n(()=>[_(l,{class:"add-img"},{default:n(()=>[_(B,{type:"plusempty",size:"30",color:"#cccccc"})]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),_(l,{class:"comment-cell"},{default:n(()=>[_(m,{class:"tig-button",onClick:e=>(async e=>{if(e.commentRank<1)e.rankVerification=!1;else if(""!=e.content)try{const a={productId:e.productId,orderId:e.orderId,orderItemId:e.itemId,shopId:e.shopId,commentRank:e.commentRank,commentTag:e.commentTag,content:e.content,showPics:e.showPics};await z(a),e.rankVerification=!0,e.contentVerification=!0,d({title:O("提交成功"),icon:"none",duration:1e3}),setTimeout(()=>{E(F.value)},500)}catch(a){d({title:a.message,icon:"none",duration:1e3})}else e.contentVerification=!1})(r)},{default:n(()=>[h(x(e.$t("提交评论")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))]),_:2},1024))),128))]),_:1})]),_:1})}}}),[["__scopeId","data-v-b176935a"]]);export{F as default};

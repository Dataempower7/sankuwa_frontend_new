import{d as e,L as a,r as t,n as l,p as s,bf as n,c,w as o,ac as i,au as u,R as d,ad as m,C as r,F as f,b as p,e as _,i as g,J as k,K as y,P as b,a as h,h as v,t as x,k as C,Z as w,N as V,bB as I,G as T,ae as j,b5 as $,_ as R}from"./index-BZxHr1FI.js";import{_ as P}from"./tig-image.CzXKqALH.js";import{_ as N}from"./format-price.BrXrBVy6.js";import{_ as O}from"./uni-rate.DTPubwzy.js";import{T as S,a as A}from"./tig-layout.DTz8E-sj.js";import{_ as J}from"./uni-icons.DMMn2oBg.js";import{_ as U}from"./tig-upload.vue_vue_type_script_setup_true_lang.CWT6vvZi.js";import{c as F,u as z}from"./comment.CY2bKQa9.js";import"./currency.Dn5A4d7X.js";const D=R(e({__name:"info",setup(e){const{t:R}=a(),D=t(""),G=t([R("送货快"),R("质量很好"),R("服务周到"),R("正品"),R("很划算"),R("包装仔细"),R("价格实惠"),R("还可以"),R("相当好")]),K=t([]),B=async e=>{i({title:R("加载中")});try{const a=await F({id:e});a.items.map(e=>{e.allCommentTag=JSON.parse(JSON.stringify(G.value)),Object.assign(e,{commentRank:0,content:"",showPics:[],commentTag:[],isAdd:!1,rankVerification:!0,contentVerification:!0,isCommentInfo:!!e.commentInfo},e.commentInfo)}),Object.assign(K.value,a.items);K.value.every(e=>1===e.isShowed)&&(history.back(),u("commentFinished",!0))}catch(a){d({title:a.message,icon:"none",duration:1e3})}finally{m()}},L=t(""),M=(e,a)=>{let t=K.value[e].commentTag;t.includes(a)?K.value[e].commentTag=t.filter(e=>e!==a):t.push(a)};return l(e=>{if(e){const{id:a}=e;a&&(D.value=a,B(a))}}),s(()=>{n()}),(e,a)=>{const t=r(f("tig-image"),P),l=g,s=r(f("format-price"),N),n=r(f("uni-rate"),O),i=C,u=V,m=r(f("tig-button"),A),F=I,G=r(f("uni-icons"),J),Z=r(f("tig-upload"),U),q=r(f("tig-layout"),S);return p(),c(q,{title:"订单评价"},{default:o(()=>[_(l,{class:"comment-info"},{default:o(()=>[(p(!0),k(y,null,b(K.value,(r,f)=>(p(),c(l,{key:f,class:"comment-item"},{default:o(()=>[r.isShowed?h("",!0):(p(),c(l,{key:0,class:"white-card"},{default:o(()=>[_(l,{class:"product flex"},{default:o(()=>[_(l,{class:"product-img"},{default:o(()=>[_(t,{src:r.picThumb,mode:"aspectFit"},null,8,["src"])]),_:2},1024),_(l,{class:"product-info"},{default:o(()=>[_(l,{class:"product-name"},{default:o(()=>[v(x(r.productName),1)]),_:2},1024),_(l,{class:"product-price"},{default:o(()=>[_(s,{"show-text":!1,"is-bottom":!1,"price-data":r.price},null,8,["price-data"])]),_:2},1024),r.skuData&&r.skuData.length>0?(p(),c(l,{key:0,class:"sku-card"},{default:o(()=>[(p(!0),k(y,null,b(r.skuData,(e,a)=>(p(),c(l,{key:a,class:"sku-item line1"},{default:o(()=>[v(x(e.value),1)]),_:2},1024))),128))]),_:2},1024)):h("",!0)]),_:2},1024)]),_:2},1024),_(l,{class:"comment"},{default:o(()=>[_(l,{class:"flex comment-cell"},{default:o(()=>[_(l,{class:"lable-text"},{default:o(()=>[v(x(e.$t("商品评分"))+"：",1)]),_:1}),_(l,{class:"flex"},{default:o(()=>[_(n,{readonly:r.isCommentInfo,value:r.commentRank,color:"#bfbfbf","active-color":"#ffa800",size:"18",onChange:e=>((e,a)=>{K.value[e].commentRank=a.value})(f,e)},null,8,["readonly","value","onChange"]),_(i,{style:{"margin-left":"10rpx"}},{default:o(()=>[v(x(r.commentRank)+x(e.$t("分")),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),r.rankVerification?h("",!0):(p(),c(l,{key:0,class:"flex comment-cell"},{default:o(()=>[_(l,{class:"lable-text"}),_(l,{class:"tips"},{default:o(()=>[v(x(e.$t("请先评分商品")),1)]),_:1})]),_:1})),_(l,{class:"comment-cell"},{default:o(()=>[r.isCommentInfo?(p(),c(l,{key:1,class:"label-list"},{default:o(()=>[(p(!0),k(y,null,b(r.commentTag,(e,a)=>(p(),c(l,{key:a,class:"label-item-txt"},{default:o(()=>[_(i,null,{default:o(()=>[v(x(e),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)):(p(),c(l,{key:0,class:"label-list flex-wrap"},{default:o(()=>[(p(!0),k(y,null,b(r.allCommentTag,(e,a)=>(p(),c(l,{key:a,class:w([{active:r.commentTag.includes(e)},"label-item"]),onClick:a=>M(f,e)},{default:o(()=>[_(i,null,{default:o(()=>[v(x(e),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128)),r.isAdd?(p(),c(l,{key:1,class:"label-edit-input flex align-center justify-between"},{default:o(()=>[_(l,null,{default:o(()=>[_(u,{modelValue:L.value,"onUpdate:modelValue":a[0]||(a[0]=e=>L.value=e),type:"text","auto-focus":"",placeholder:e.$t("请输入自定义标签")},null,8,["modelValue","placeholder"])]),_:1}),_(m,{class:"btn",onClick:e=>(e=>{if(""!==L.value){const a=JSON.parse(JSON.stringify(K.value[e].allCommentTag));if(a.includes(L.value))return void d({title:R("您已添加相同标签"),icon:"none",duration:1e3});a.push(L.value),K.value[e].allCommentTag=a,M(e,L.value)}L.value="",K.value[e].isAdd=!1})(f)},{default:o(()=>[v(x(e.$t("确定")),1)]),_:2},1032,["onClick"])]),_:2},1024)):(p(),c(l,{key:0,class:"label-edit",onClick:e=>(e=>{K.value[e].isAdd=!K.value[e].isAdd})(f)},{default:o(()=>[_(l),_(l,null,{default:o(()=>[v(x(e.$t("自定义")),1)]),_:1})]),_:2},1032,["onClick"]))]),_:2},1024))]),_:2},1024),_(l,{class:"comment-cell"},{default:o(()=>[_(l,{class:"textarea-box"},{default:o(()=>[_(F,{modelValue:r.content,"onUpdate:modelValue":e=>r.content=e,cols:"50",name:"content",placeholder:e.$t("商品是否给力？快分享你的购买心得吧~"),rows:"5",maxlength:500,style:{border:"1px solid #d9d9d9",padding:"4px"},disabled:r.isCommentInfo},null,8,["modelValue","onUpdate:modelValue","placeholder","disabled"]),_(l,{class:"strlangth"},{default:o(()=>[v(x(e.$t("10-500字")),1)]),_:1})]),_:2},1024)]),_:2},1024),_(l,{class:"comment-cell flex align-center justify-between"},{default:o(()=>[_(l,{class:"tips"},{default:o(()=>[r.contentVerification?h("",!0):(p(),c(i,{key:0},{default:o(()=>[v(x(e.$t("请填写购买心得")),1)]),_:1}))]),_:2},1024)]),_:2},1024),_(l,{class:"comment-cell"},{default:o(()=>[_(l,{class:"lable-text"},{default:o(()=>[v(x(e.$t("添加图片")),1)]),_:1}),_(l,{class:"pic-box flex-wrap"},{default:o(()=>[(p(!0),k(y,null,b(r.showPics,(e,a)=>(p(),c(l,{key:a,class:"pic-img",style:{transition:"opacity 0.2s linear","margin-right":"10px"}},{default:o(()=>[_(t,{src:e.picThumb,onClick:a=>{return t=T(j)(e.picThumb),void $({urls:[t]});var t}},null,8,["src","onClick"]),_(l,{class:"close-icon",onClick:e=>((e,a)=>{e.showPics.splice(a,1)})(r,a)},{default:o(()=>[_(G,{type:"clear",size:"25",color:"#cccccc"})]),_:2},1032,["onClick"])]),_:2},1024))),128)),_(Z,{modelValue:r.showPics,"onUpdate:modelValue":e=>r.showPics=e,count:9},{default:o(()=>[_(l,{class:"add-img"},{default:o(()=>[_(G,{type:"plusempty",size:"30",color:"#cccccc"})]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),_(l,{class:"comment-cell"},{default:o(()=>[_(m,{class:"tig-button",onClick:e=>(async e=>{if(e.commentRank<1)e.rankVerification=!1;else if(""!=e.content)if(e.content.length<10||e.content.length>500)d({title:R("购买心得在10-500字之间"),icon:"none",duration:1e3});else try{const a={productId:e.productId,orderId:e.orderId,orderItemId:e.itemId,shopId:e.shopId,commentRank:e.commentRank,commentTag:e.commentTag,content:e.content,showPics:e.showPics};await z(a),e.rankVerification=!0,e.contentVerification=!0,d({title:R("提交成功"),icon:"none",duration:1e3}),setTimeout(()=>{B(D.value)},1e3)}catch(a){d({title:a.message,icon:"none",duration:1e3})}else e.contentVerification=!1})(r)},{default:o(()=>[v(x(e.$t("提交评论")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))]),_:2},1024))),128))]),_:1})]),_:1})}}}),[["__scopeId","data-v-b5bf5e8e"]]);export{D as default};

import{a4 as a,d as e,L as s,Y as t,c as l,w as i,C as n,F as o,b as d,e as u,i as c,a as r,Z as m,h as f,t as g,k as _,G as p,J as y,K as h,P as v,f as k,H as x,ag as b,R as w,j,u as C,_ as R}from"./index-BZxHr1FI.js";import{_ as $}from"./uni-icons.DMMn2oBg.js";import{_ as L,a as I}from"./uni-swipe-action.B_W9HPBU.js";import{_ as T}from"./loading-box.D3Y7A2lC.js";import{T as z}from"./tig-layout.DTz8E-sj.js";import{u as G}from"./useList.cF42RyDa.js";import"./product.BH5dMQls.js";const K=e=>a({url:"user/message/list",method:"get",params:e}),M=R(e({__name:"index",setup(e){const{t:R}=s(),M=t({page:1,size:10,unread:0}),{data:Y,isLoading:A,isLoadMore:F,total:H,resetState:J,getList:P}=G(K,{params:M,path:{dataKey:"records"},immediate:!0}),S=async(e,s)=>{try{await(t={id:e},a({url:"user/message/del",method:"post",data:t})),J(),await P(),w({title:R("删除成功"),icon:"none"})}catch(l){w({title:l.message,icon:"none",duration:1e3})}var t},Z=async e=>{try{1!==e.isRead&&(await(s=e.messageId,a({url:"user/message/updateMessageRead",method:"post",data:{id:s}})),e.isRead=1),j({url:C(e.link)})}catch(t){w({title:t.message,icon:"none",duration:1e3})}var s},q=async()=>{if(!A.value&&!F.value)try{await a({url:"user/message/updateAllRead",method:"post"}),M.unread=0,J(),await P()}catch(e){w({title:e.message,icon:"none",duration:1e3})}},B=async a=>{if(!A.value&&!F.value){M.unread=a;try{J(),await P()}catch(e){w({title:e.message,icon:"none",duration:1e3})}}};return(a,e)=>{const s=c,t=_,w=n(o("uni-icons"),$),j=n(o("uni-swipe-action-item"),L),C=n(o("uni-swipe-action"),I),G=k,K=n(o("loading-box"),T),F=n(o("tig-layout"),z);return d(),l(F,{title:"站内信"},{default:i(()=>[u(s,{class:"message-main"},{default:i(()=>[u(s,{class:"head-tabs-box"},{default:i(()=>[u(s,{class:"tabs flex align-center justify-between"},{default:i(()=>[u(s,{class:"flex align-end"},{default:i(()=>[u(s,{class:m(["tab",{active:0===M.unread}]),onClick:e[0]||(e[0]=a=>B(0))},{default:i(()=>[f(g(a.$t("全部消息")),1)]),_:1},8,["class"]),u(s,{class:m(["tab",{active:1===M.unread}]),onClick:e[1]||(e[1]=a=>B(1))},{default:i(()=>[f(g(a.$t("只看未读")),1)]),_:1},8,["class"])]),_:1}),u(s,{class:"clear-unread flex align-end",onClick:q},{default:i(()=>[u(t,null,{default:i(()=>[f(g(a.$t("一键已读")),1)]),_:1}),u(w,{type:"auth",size:"20",color:"#999"})]),_:1})]),_:1})]),_:1}),p(Y).length>0?(d(),l(s,{key:0,class:"messages-list"},{default:i(()=>[u(C,null,{default:i(()=>[(d(!0),y(h,null,v(p(Y),(e,n)=>(d(),l(s,{key:e.messageId,class:"move-item"},{default:i(()=>[u(j,{threshold:0,"auto-close":""},{right:i(()=>[u(s,{class:"message-move-box"},{default:i(()=>[u(s,{class:"btn-del",onClick:a=>{return s=e.messageId,void b({title:R("提示"),content:R("确定删除此条站内信吗？"),success:async a=>{a.confirm&&S(s)}});var s}},{default:i(()=>[u(t,null,{default:i(()=>[f(g(a.$t("删除")),1)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),default:i(()=>[u(s,{class:"mitem",onClick:a=>Z(e)},{default:i(()=>[u(s,{class:"message"},{default:i(()=>[u(s,{class:"title"},{default:i(()=>[0===e.isRead?(d(),l(t,{key:0,class:"dot"})):r("",!0),u(t,null,{default:i(()=>[f(g(e.title),1)]),_:2},1024)]),_:2},1024),u(s,{class:"txt"},{default:i(()=>[f(g(e.content),1)]),_:2},1024),u(s,{class:"time"},{default:i(()=>[f(g(e.addTime),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):r("",!0),p(A)||0!==p(H)?r("",!0):(d(),l(s,{key:1,class:"empty-box"},{default:i(()=>[u(s,{class:"pictrue"},{default:i(()=>[u(G,{src:p(x)("common/data_empty.png")},null,8,["src"])]),_:1}),u(s,{class:"txt"},{default:i(()=>[f(g(a.$t("暂无站内消息！")),1)]),_:1})]),_:1})),u(K,{"model-value":!p(A),page:M.page,length:p(Y).length},null,8,["model-value","page","length"])]),_:1})]),_:1})}}}),[["__scopeId","data-v-e6962416"]]);export{M as default};

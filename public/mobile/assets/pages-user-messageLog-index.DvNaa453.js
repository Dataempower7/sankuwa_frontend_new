import{a2 as a,d as e,K as s,W as t,c as l,w as i,B as n,E as o,o as d,g as u,i as c,a as r,X as m,f,t as g,h as _,F as p,I as y,J as h,O as v,b as x,G as b,ae as k,Q as w,S as j,u as C,_ as I}from"./index-DDAlCzEE.js";import{_ as R}from"./uni-icons.piUs7f0e.js";import{_ as $,a as L}from"./uni-swipe-action.tMichUr_.js";import{_ as M}from"./loading-box.wxL4cJqH.js";import{_ as z}from"./tig-layout.Dp_86RM-.js";import{u as J}from"./useList.Bq9WraBG.js";import"./product.CwGVjSIm.js";const K=e=>a({url:"user/message/list",method:"get",params:e}),Q=I(e({__name:"index",setup(e){const{t:I}=s(),Q=t({page:1,size:10,unread:0}),{data:S,isLoading:A,isLoadMore:B,total:E,resetState:F,getList:G}=J(K,{params:Q,path:{dataKey:"records"},immediate:!0}),H=async(e,s)=>{try{await(t={id:e},a({url:"user/message/del",method:"post",data:t})),F(),await G(),w({title:I("删除成功"),icon:"none"})}catch(l){w({title:l.message,icon:"none",duration:1e3})}var t},O=async e=>{try{1!==e.isRead&&(await(s=e.messageId,a({url:"user/message/updateMessageRead",method:"post",data:{id:s}})),e.isRead=1),j({url:C(e.link)})}catch(t){w({title:t.message,icon:"none",duration:1e3})}var s},P=async()=>{if(!A.value&&!B.value)try{await a({url:"user/message/updateAllRead",method:"post"}),Q.unread=0,F(),await G()}catch(e){w({title:e.message,icon:"none",duration:1e3})}},T=async a=>{if(!A.value&&!B.value){Q.unread=a;try{F(),await G()}catch(e){w({title:e.message,icon:"none",duration:1e3})}}};return(a,e)=>{const s=c,t=_,w=n(o("uni-icons"),R),j=n(o("uni-swipe-action-item"),$),C=n(o("uni-swipe-action"),L),J=x,K=n(o("loading-box"),M),B=n(o("tig-layout"),z);return d(),l(B,{title:"站内信"},{default:i(()=>[u(s,{class:"message-main"},{default:i(()=>[u(s,{class:"head-tabs-box"},{default:i(()=>[u(s,{class:"tabs flex align-center justify-between"},{default:i(()=>[u(s,{class:"flex align-end"},{default:i(()=>[u(s,{class:m(["tab",{active:0===Q.unread}]),onClick:e[0]||(e[0]=a=>T(0))},{default:i(()=>[f(g(a.$t("全部消息")),1)]),_:1},8,["class"]),u(s,{class:m(["tab",{active:1===Q.unread}]),onClick:e[1]||(e[1]=a=>T(1))},{default:i(()=>[f(g(a.$t("只看未读")),1)]),_:1},8,["class"])]),_:1}),u(s,{class:"clear-unread flex align-end",onClick:P},{default:i(()=>[u(t,null,{default:i(()=>[f(g(a.$t("一键已读")),1)]),_:1}),u(w,{type:"auth",size:"20",color:"#999"})]),_:1})]),_:1})]),_:1}),p(S).length>0?(d(),l(s,{key:0,class:"messages-list"},{default:i(()=>[u(C,null,{default:i(()=>[(d(!0),y(h,null,v(p(S),(e,n)=>(d(),l(s,{key:e.messageId,class:"move-item"},{default:i(()=>[u(j,{threshold:0,"auto-close":""},{right:i(()=>[u(s,{class:"message-move-box"},{default:i(()=>[u(s,{class:"btn-del",onClick:a=>{return s=e.messageId,void k({title:I("提示"),content:I("确定删除此条站内信吗？"),success:async a=>{a.confirm&&H(s)}});var s}},{default:i(()=>[u(t,null,{default:i(()=>[f(g(a.$t("删除")),1)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),default:i(()=>[u(s,{class:"mitem",onClick:a=>O(e)},{default:i(()=>[u(s,{class:"message"},{default:i(()=>[u(s,{class:"title"},{default:i(()=>[0===e.isRead?(d(),l(t,{key:0,class:"dot"})):r("",!0),u(t,null,{default:i(()=>[f(g(e.title),1)]),_:2},1024)]),_:2},1024),u(s,{class:"txt"},{default:i(()=>[f(g(e.content),1)]),_:2},1024),u(s,{class:"time"},{default:i(()=>[f(g(e.addTime),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):r("",!0),p(A)||0!==p(E)?r("",!0):(d(),l(s,{key:1,class:"empty-box"},{default:i(()=>[u(s,{class:"pictrue"},{default:i(()=>[u(J,{src:p(b)("common/data_empty.png")},null,8,["src"])]),_:1}),u(s,{class:"txt"},{default:i(()=>[f(g(a.$t("暂无站内消息！")),1)]),_:1})]),_:1})),u(K,{"model-value":!p(A),page:Q.page,length:p(S).length},null,8,["model-value","page","length"])]),_:1})]),_:1})}}}),[["__scopeId","data-v-e6962416"]]);export{Q as default};

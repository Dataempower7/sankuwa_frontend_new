import{a4 as e,d as a,L as t,az as l,l as o,Y as i,r as n,v as s,ai as c,M as r,ac as u,ca as d,R as m,j as f,S as p,ad as b,n as y,bp as g,c as h,w as _,C as $,F as k,cb as w,b as x,e as v,i as C,h as T,t as j,a as M,G as R,O as V,X as D,as as F,au as Y,ag as U,cc as W,_ as I}from"./index-BZxHr1FI.js";import{_ as O}from"./uni-easyinput.DHFPvsdC.js";import{_ as X,a as B}from"./uni-forms.QWcIXEX3.js";import{_ as E}from"./tig-copyright.CZlnto9f.js";import{T as G,a as q}from"./tig-layout.DTz8E-sj.js";import{T as z}from"./tig-fixed-placeholder.BDsbIjoZ.js";import"./uni-icons.DMMn2oBg.js";const L=I(a({__name:"index",setup(a){const{t:I}=t(),L=l(),P=o(),S=i({nickname:"",birthday:"",mobile:""}),A=(e,a)=>{"password"!=a||""!=S.mobile?D({url:e}):m({title:I("未绑定手机号，请先绑定手机号再修改密码"),icon:"none"})},H={nickname:{rules:[{required:!0,errorMessage:I("请您填写用户昵称")}]}},J=n(),K=()=>{J.value.validate().then(()=>{Q()}).catch(e=>{console.log("表单错误信息：",e)})},N=()=>{L.logout()},Q=async()=>{try{await(a={...S},e({url:"user/user/updateInformation",method:"post",data:a})),m({title:I("修改成功"),icon:"none",duration:1e3}),setTimeout(()=>{F({success:function(){Y("refreshData")}})},1e3)}catch(t){console.error(t),m({title:t.message,icon:"none",duration:1e3})}var a};s(()=>{if(c(()=>{J.value.setRules(H),ie.value.setFormatter(oe)}),"wechat"===P.XClientType&&r("token")){const e=ae(location.href);e.code&&e.code.length>12&&Z(e.code)}});const Z=async e=>{u({title:I("授权中")+"..."});try{await d({code:e}),m({title:I("授权成功"),icon:"none",duration:1e3});let a="/pages/user/profile/index";te.value&&(a=`/pages/order/check?flowType=${te.value}`),setTimeout(()=>{f({url:a,mode:"redirectTo",success:()=>{te.value&&p("bindWechatFlowType")}})},1e3)}catch(a){m({title:a.message,icon:"none",duration:1e3})}finally{b()}},ee=async()=>{U({title:I("提示"),content:I("确定取消绑定吗？"),success:async e=>{if(e.confirm){u({title:I("正在解绑...")});try{await W(),b(),m({title:I("解绑成功"),icon:"none",duration:1e3}),setTimeout(()=>{le()},500)}catch(a){console.error(a),m({title:a.message,icon:"none",duration:1e3})}finally{b()}}}})},ae=e=>{const a={},t=e.split("?")[1];return t&&t.split("&").forEach(e=>{const[t,l]=e.split("=");a[t]=l}),a},te=n(r("bindWechatFlowType")||null);y(async e=>{e&&e.bindWechat&&await re(),le()});const le=async()=>{u({title:I("加载中")});try{const a=await e({url:"user/user/detail",method:"get"});let t=a.mobile;a.showMobile=t.replace(/(\d{2})\d*(\d{4})$/,"$1*****$2"),Object.assign(S,a)}catch(a){console.error(a)}finally{b()}},oe=(e,a)=>"year"===e?`${a}${I("年")}`:"month"===e?`${a}${I("月")}`:"day"===e?`${a}${I("日")}`:a,ie=n(),ne=n(!1),se=()=>{ne.value=!0},ce=e=>{e&&e.value&&(S.birthday=uni.$u.timeFormat(e.value,"yyyy-mm-dd")),ne.value=!1},re=async()=>{const e=await g({url:location.origin+location.pathname});window.location.href=e.url};return(e,a)=>{const t=$(k("uni-easyinput"),O),l=$(k("uni-forms-item"),X),o=C,i=$(k("uni-forms"),B),n=$(k("tig-copyright"),E),s=$(k("tig-button"),q),c=$(k("tig-fixed-placeholder"),z),r=$(k("up-datetime-picker"),w),u=$(k("tig-layout"),G);return x(),h(u,{title:"个人资料","border-bottom":!0},{default:_(()=>[v(o,{class:"profile-edit-main"},{default:_(()=>[v(i,{ref_key:"formRef",ref:J,"model-value":S,"label-width":"300rpx"},{default:_(()=>[v(o,{class:"profile-edit-content"},{default:_(()=>[v(l,{label:e.$t("用户ID"),name:"username"},{default:_(()=>[v(t,{modelValue:S.dimUsername,"onUpdate:modelValue":a[0]||(a[0]=e=>S.dimUsername=e),"input-border":!1,disabled:"","primary-color":"rgb(192, 196, 204)"},null,8,["modelValue"])]),_:1},8,["label"]),v(l,{label:e.$t("昵称"),name:"nickname"},{default:_(()=>[v(t,{modelValue:S.nickname,"onUpdate:modelValue":a[1]||(a[1]=e=>S.nickname=e),"input-border":!1,placeholder:e.$t("请输入昵称"),"primary-color":"rgb(192, 196, 204)",type:"nickname"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),v(l,{label:e.$t("出生日期"),name:"birthday"},{default:_(()=>[v(o,{class:"el-input-id",onClick:se},{default:_(()=>[T(j("0000-00-00"===S.birthday?e.$t("请选择出生日期"):S.birthday)+" ",1),v(o,{class:"iconfont icon-xiangyou"})]),_:1})]),_:1},8,["label"])]),_:1}),v(o,{class:"profile-edit-content"},{default:_(()=>[v(l,{label:e.$t("登录密码"),onClick:a[2]||(a[2]=e=>A("/pages/user/security/password?mobile="+S.mobile,"password"))},{default:_(()=>[v(o,{class:"el-input-id"},{default:_(()=>[T(j(e.$t("修改"))+" ",1),v(o,{class:"iconfont icon-xiangyou"})]),_:1})]),_:1},8,["label"]),v(l,{label:e.$t("手机号码"),onClick:a[3]||(a[3]=e=>A("/pages/user/security/phone?mobile="+S.mobile))},{default:_(()=>[v(o,{class:"el-input-id"},{default:_(()=>[T(j(S.showMobile||e.$t("去绑定"))+" ",1),v(o,{class:"iconfont icon-xiangyou"})]),_:1})]),_:1},8,["label"]),1===R(P).openEmailRegister?(x(),h(l,{key:0,label:e.$t("邮箱")},{default:_(()=>[v(o,{class:"el-input-id",onClick:a[4]||(a[4]=e=>A("/pages/user/security/email?email="+S.email))},{default:_(()=>[T(j(S.email?S.email:e.$t("去绑定"))+" ",1),v(o,{class:"iconfont icon-xiangyou"})]),_:1})]),_:1},8,["label"])):M("",!0),"wechat"==R(P).XClientType?(x(),h(l,{key:1,label:e.$t("公众号绑定")},{default:_(()=>[S.isBindWechat?(x(),h(o,{key:0,class:"el-input-id",onClick:V(ee,["stop"])},{default:_(()=>[T(j(e.$t("解绑"))+" ",1),v(o,{class:"iconfont icon-xiangyou"})]),_:1})):(x(),h(o,{key:1,class:"el-input-id",onClick:V(re,["stop"])},{default:_(()=>[T(j(e.$t("绑定"))+" ",1),v(o,{class:"iconfont icon-xiangyou"})]),_:1}))]),_:1},8,["label"])):M("",!0),v(l,{label:e.$t("意见建议"),onClick:a[5]||(a[5]=e=>A("/pages/user/suggest/index?mobile="+S.mobile))},{default:_(()=>[v(o,{class:"el-input-id"},{default:_(()=>[v(o,{class:"iconfont icon-xiangyou"})]),_:1})]),_:1},8,["label"]),v(l,{label:e.$t("关于"),onClick:a[6]||(a[6]=e=>A("/pages/user/about/index?mobile="+S.mobile))},{default:_(()=>[v(o,{class:"el-input-id"},{default:_(()=>[v(o,{class:"iconfont icon-xiangyou"})]),_:1})]),_:1},8,["label"])]),_:1})]),_:1},8,["model-value"])]),_:1}),v(n),v(c,{"background-color":"#fff"},{default:_(()=>[v(o,{class:"btn-box"},{default:_(()=>[v(s,{class:"btn",plain:"",onClick:N},{default:_(()=>[T(j(e.$t("退出登录")),1)]),_:1}),v(s,{class:"btn",onClick:K},{default:_(()=>[T(j(e.$t("保存修改")),1)]),_:1})]),_:1})]),_:1}),v(r,{ref_key:"datetimePickerRef",ref:ie,"cancel-text":e.$t("取消"),"confirm-text":e.$t("确定"),show:ne.value,"model-value":Date.now(),mode:"date",formatter:oe,format:"YYYY-MM-DD","confirm-color":"var(--general)","min-date":1,onCancel:a[7]||(a[7]=e=>ne.value=!1),onConfirm:ce},null,8,["cancel-text","confirm-text","show","model-value"])]),_:1})}}}),[["__scopeId","data-v-a5579b06"]]);export{L as default};

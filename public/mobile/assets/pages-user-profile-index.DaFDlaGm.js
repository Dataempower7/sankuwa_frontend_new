import{a2 as e,d as a,K as t,ay as l,j as o,W as i,r as n,s,ah as c,L as r,aa as u,c9 as d,Q as m,S as f,R as p,ab as y,l as b,br as h,c as g,w as _,B as $,E as k,ca as w,o as v,g as x,i as C,f as j,t as T,a as V,F as W,N as D,n as F,ar as M,at as R,ae as E,cb as U,_ as Y}from"./index-DDAlCzEE.js";import{_ as I}from"./uni-easyinput.naLj-1jX.js";import{_ as B,a as X}from"./uni-forms.MUFzpXZ0.js";import{_ as q}from"./tig-copyright.CXAAKmRe.js";import{_ as H,a as K}from"./tig-layout.Dp_86RM-.js";import{_ as L}from"./tig-fixed-placeholder.BwC6eLvS.js";import"./uni-icons.piUs7f0e.js";const N=Y(a({__name:"index",setup(a){const{t:Y}=t(),N=l(),O=o(),P=i({nickname:"",birthday:"",mobile:""}),Q=(e,a)=>{"password"!=a||""!=P.mobile?F({url:e}):m({title:Y("未绑定手机号，请先绑定手机号再修改密码"),icon:"none"})},S={nickname:{rules:[{required:!0,errorMessage:Y("请您填写用户昵称")}]}},z=n(),A=()=>{z.value.validate().then(()=>{J()}).catch(e=>{console.log("表单错误信息：",e)})},G=()=>{N.logout()},J=async()=>{try{await(a={...P},e({url:"user/user/updateInformation",method:"post",data:a})),m({title:Y("修改成功"),icon:"none",duration:1e3}),setTimeout(()=>{M({success:function(){R("refreshData")}})},1e3)}catch(t){console.error(t),m({title:t.message,icon:"none",duration:1e3})}var a};s(()=>{if(c(()=>{z.value.setRules(S),ie.value.setFormatter(oe)}),"wechat"===O.XClientType&&r("token")){const e=ae(location.href);e.code&&e.code.length>12&&Z(e.code)}});const Z=async e=>{u({title:Y("授权中")+"..."});try{await d({code:e}),m({title:Y("授权成功"),icon:"none",duration:1e3});let a="/pages/user/profile/index";te.value&&(a=`/pages/order/check?flowType=${te.value}`),setTimeout(()=>{f({url:a,mode:"redirectTo",success:()=>{te.value&&p("bindWechatFlowType")}})},1e3)}catch(a){m({title:a.message,icon:"none",duration:1e3})}finally{y()}},ee=async()=>{E({title:Y("提示"),content:Y("确定取消绑定吗？"),success:async e=>{if(e.confirm){u({title:Y("正在解绑...")});try{await U(),y(),m({title:Y("解绑成功"),icon:"none",duration:1e3}),setTimeout(()=>{le()},500)}catch(a){console.error(a),m({title:a.message,icon:"none",duration:1e3})}finally{y()}}}})},ae=e=>{const a={},t=e.split("?")[1];return t&&t.split("&").forEach(e=>{const[t,l]=e.split("=");a[t]=l}),a},te=n(r("bindWechatFlowType")||null);b(async e=>{e&&e.bindWechat&&await re(),le()});const le=async()=>{u({title:Y("加载中")});try{const a=await e({url:"user/user/detail",method:"get"});let t=a.mobile;a.showMobile=t.replace(/(\d{2})\d*(\d{4})$/,"$1*****$2"),Object.assign(P,a)}catch(a){console.error(a)}finally{y()}},oe=(e,a)=>"year"===e?`${a}${Y("年")}`:"month"===e?`${a}${Y("月")}`:"day"===e?`${a}${Y("日")}`:a,ie=n(),ne=n(!1),se=()=>{ne.value=!0},ce=e=>{e&&e.value&&(P.birthday=uni.$u.timeFormat(e.value,"yyyy-mm-dd")),ne.value=!1},re=async()=>{const e=await h({url:location.origin+location.pathname});window.location.href=e.url};return(e,a)=>{const t=$(k("uni-easyinput"),I),l=$(k("uni-forms-item"),B),o=C,i=$(k("uni-forms"),X),n=$(k("tig-copyright"),q),s=$(k("tig-button"),K),c=$(k("tig-fixed-placeholder"),L),r=$(k("up-datetime-picker"),w),u=$(k("tig-layout"),H);return v(),g(u,{title:"个人资料","border-bottom":!0},{default:_(()=>[x(o,{class:"profile-edit-main"},{default:_(()=>[x(i,{ref_key:"formRef",ref:z,"model-value":P,"label-width":"300rpx"},{default:_(()=>[x(o,{class:"profile-edit-content"},{default:_(()=>[x(l,{label:e.$t("用户ID"),name:"username"},{default:_(()=>[x(t,{modelValue:P.dimUsername,"onUpdate:modelValue":a[0]||(a[0]=e=>P.dimUsername=e),"input-border":!1,disabled:"","primary-color":"rgb(192, 196, 204)"},null,8,["modelValue"])]),_:1},8,["label"]),x(l,{label:e.$t("昵称"),name:"nickname"},{default:_(()=>[x(t,{modelValue:P.nickname,"onUpdate:modelValue":a[1]||(a[1]=e=>P.nickname=e),"input-border":!1,placeholder:e.$t("请输入昵称"),"primary-color":"rgb(192, 196, 204)",type:"nickname"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),x(l,{label:e.$t("出生日期"),name:"birthday"},{default:_(()=>[x(o,{class:"el-input-id",onClick:se},{default:_(()=>[j(T("0000-00-00"===P.birthday?e.$t("请选择出生日期"):P.birthday)+" ",1),x(o,{class:"iconfont icon-xiangyou"})]),_:1})]),_:1},8,["label"])]),_:1}),x(o,{class:"profile-edit-content"},{default:_(()=>[x(l,{label:e.$t("登录密码"),onClick:a[2]||(a[2]=e=>Q("/pages/user/security/password?mobile="+P.mobile,"password"))},{default:_(()=>[x(o,{class:"el-input-id"},{default:_(()=>[j(T(e.$t("修改"))+" ",1),x(o,{class:"iconfont icon-xiangyou"})]),_:1})]),_:1},8,["label"]),x(l,{label:e.$t("手机号码"),onClick:a[3]||(a[3]=e=>Q("/pages/user/security/phone?mobile="+P.mobile))},{default:_(()=>[x(o,{class:"el-input-id"},{default:_(()=>[j(T(P.showMobile||e.$t("去绑定"))+" ",1),x(o,{class:"iconfont icon-xiangyou"})]),_:1})]),_:1},8,["label"]),1===W(O).openEmailRegister?(v(),g(l,{key:0,label:e.$t("邮箱")},{default:_(()=>[x(o,{class:"el-input-id",onClick:a[4]||(a[4]=e=>Q("/pages/user/security/email?email="+P.email))},{default:_(()=>[j(T(P.email?P.email:e.$t("去绑定"))+" ",1),x(o,{class:"iconfont icon-xiangyou"})]),_:1})]),_:1},8,["label"])):V("",!0),"wechat"==W(O).XClientType?(v(),g(l,{key:1,label:e.$t("公众号绑定")},{default:_(()=>[P.isBindWechat?(v(),g(o,{key:0,class:"el-input-id",onClick:D(ee,["stop"])},{default:_(()=>[j(T(e.$t("解绑"))+" ",1),x(o,{class:"iconfont icon-xiangyou"})]),_:1})):(v(),g(o,{key:1,class:"el-input-id",onClick:D(re,["stop"])},{default:_(()=>[j(T(e.$t("绑定"))+" ",1),x(o,{class:"iconfont icon-xiangyou"})]),_:1}))]),_:1},8,["label"])):V("",!0)]),_:1})]),_:1},8,["model-value"])]),_:1}),x(n),x(c,{"background-color":"#fff"},{default:_(()=>[x(o,{class:"btn-box"},{default:_(()=>[x(s,{class:"btn",plain:"",onClick:G},{default:_(()=>[j(T(e.$t("退出登录")),1)]),_:1}),x(s,{class:"btn",onClick:A},{default:_(()=>[j(T(e.$t("保存修改")),1)]),_:1})]),_:1})]),_:1}),x(r,{ref_key:"datetimePickerRef",ref:ie,"cancel-text":e.$t("取消"),"confirm-text":e.$t("确定"),show:ne.value,"model-value":Date.now(),mode:"date",formatter:oe,format:"YYYY-MM-DD","confirm-color":"var(--general)","min-date":1,onCancel:a[5]||(a[5]=e=>ne.value=!1),onConfirm:ce},null,8,["cancel-text","confirm-text","show","model-value"])]),_:1})}}}),[["__scopeId","data-v-c199895e"]]);export{N as default};

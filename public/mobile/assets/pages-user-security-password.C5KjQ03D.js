import{d as e,K as a,ay as l,r as t,k as s,l as o,s as r,ah as i,c as u,w as n,B as d,E as c,o as p,g as m,i as f,f as v,t as b,F as _,Q as g,_ as w}from"./index-DDAlCzEE.js";import{_ as h}from"./uni-easyinput.naLj-1jX.js";import{_ as $,a as y}from"./uni-forms.MUFzpXZ0.js";import{_ as k,a as C}from"./tig-layout.Dp_86RM-.js";import{V as j}from"./index.Bw-iif0R.js";import{g as q,h as x}from"./security.D_PLo4-R.js";import{u as P}from"./useResetState.rJCv1k8t.js";import"./uni-icons.piUs7f0e.js";const I=w(e({__name:"password",setup(e){const{t:w}=a(),I=l(),F=t(""),[M,R]=P({mobileCode:"",password:"",confirmPassword:""}),U=e=>{M.value.mobileCode=e},Z=e=>{M.value.password=e},z=e=>{M.value.confirmPassword=e},A=s(()=>!(F.value&&M.value.mobileCode&&M.value.password&&M.value.confirmPassword&&T.value)),E={mobileCode:{rules:[{required:!0,message:w("请输入验证码"),trigger:"change"}]},password:{rules:[{required:!0,errorMessage:w("请输入新密码")},{validateFunction:function(e,a,l,t){return a?a.length>20||a.length<6?t(w("密码应为6-20位字符")):/\s/.test(a)?t(w("密码中不允许有空格")):/^\d+$/.test(a)?t(w("密码不能全为数字")):/^(?=.*[\d\W]).+$/.test(a)?/^(?=.*[a-zA-Z0-9]).+$/.test(a)?!!/^(?!([a-zA-Z0-9])\1*$).+$/.test(a)||t(w("密码不能全为相同字符或数字")):t(w("密码不能全为符号")):t(w("密码不能全为字母")):t(w("密码不能为空"))}}]},confirmPassword:{rules:[{required:!0,errorMessage:w("请输入确认密码")},{validateFunction:function(e,a,l,t){return a?a==M.value.password||t(w("两次密码不一致")):t(w("请再次输入密码"))}}]}},T=t(""),V=t(!0);o(e=>{F.value=e.mobile});const W=e=>{g({title:e,duration:1500,icon:"none"})},B=t();return r(()=>{i(()=>{B.value.setRules(E)})}),(e,a)=>{const l=f,t=d(c("uni-easyinput"),h),s=d(c("uni-forms-item"),$),o=d(c("uni-forms"),y),r=d(c("tig-button"),C),i=d(c("tig-layout"),k);return p(),u(i,{title:"账户安全"},{default:n(()=>[m(l,{class:"profile-edit-main"},{default:n(()=>[m(l,{class:"profile-edit-content"},{default:n(()=>[m(l,{class:"item"},{default:n(()=>[m(l,{class:"title"},{default:n(()=>[m(l,null,{default:n(()=>[v(b(e.$t("请输入")),1)]),_:1}),m(l,{class:"info"},{default:n(()=>[v(b(F.value.replace(/(\d{2})\d*(\d{4})$/,"$1*****$2")),1)]),_:1}),m(l,null,{default:n(()=>[v(b(e.$t("收到的短信验证码")),1)]),_:1})]),_:1})]),_:1}),m(o,{ref_key:"formRef",ref:B,"label-width":80,"model-value":_(M),rules:E},{default:n(()=>[m(s,{label:e.$t("验证码"),name:"mobileCode",required:""},{default:n(()=>[m(l,{class:"flex align-center"},{default:n(()=>[m(l,{class:"item-one input"},{default:n(()=>[m(t,{"input-border":!1,value:_(M).mobileCode,class:"uni-input item-input",focus:"",placeholder:e.$t("手机短信验证码"),"primary-color":"rgb(192, 196, 204)",onInput:U},null,8,["value","placeholder"])]),_:1}),m(j,{"is-checked":V.value,"onUpdate:isChecked":a[0]||(a[0]=e=>V.value=e),mobile:F.value,"onUpdate:mobile":a[1]||(a[1]=e=>F.value=e),"verify-token-data":T.value,"onUpdate:verifyTokenData":a[2]||(a[2]=e=>T.value=e),style:{height:"65rpx"},"request-api":_(q),onMobileErrorCallback:W},null,8,["is-checked","mobile","verify-token-data","request-api"])]),_:1})]),_:1},8,["label"]),m(s,{label:e.$t("新密码"),name:"password",required:""},{default:n(()=>[m(l,{class:"input"},{default:n(()=>[m(t,{clearable:!1,trim:!0,type:"password","input-border":!1,value:_(M).password,class:"uni-input item-input",placeholder:e.$t("请输入新密码"),"primary-color":"rgb(192, 196, 204)",onInput:Z},null,8,["value","placeholder"])]),_:1})]),_:1},8,["label"]),m(s,{label:e.$t("确认密码"),name:"confirmPassword",required:""},{default:n(()=>[m(l,{class:"input"},{default:n(()=>[m(t,{clearable:!1,trim:!0,type:"password","input-border":!1,value:_(M).confirmPassword,class:"uni-input item-input",placeholder:e.$t("请再次输入新密码"),"primary-color":"rgb(192, 196, 204)",onInput:z},null,8,["value","placeholder"])]),_:1})]),_:1},8,["label"])]),_:1},8,["model-value"]),m(l,{class:"item"},{default:n(()=>[m(r,{disabled:A.value,class:"next",onClick:a[3]||(a[3]=e=>(async()=>{B.value.validate().then(async()=>{try{await x({password:M.value.password,code:M.value.mobileCode}),g({title:w("修改成功"),icon:"none",duration:1e3}),setTimeout(()=>{I.logout()},1e3)}catch(e){R(),e.message&&g({title:e.message,icon:"none"})}}).catch(e=>{console.log("表单错误信息：",e)})})())},{default:n(()=>[v(b(e.$t("提交")),1)]),_:1},8,["disabled"])]),_:1})]),_:1}),m(l,{class:"profile-edit-content"},{default:n(()=>[m(l,{class:"btn-item"},{default:n(()=>[m(l,{class:"title"},{default:n(()=>[m(l,{class:"big-title"},{default:n(()=>[v(b(e.$t("为什么要进行身份验证"))+"？",1)]),_:1})]),_:1}),m(l,{class:"info"},{default:n(()=>[v("1. "+b(e.$t("为保障您的账户信息安全，在变更账户中的重要信息时需要进行身份验证，感谢您的理解和支持"))+"。",1)]),_:1}),m(l,{class:"info"},{default:n(()=>[v("2. "+b(e.$t("验证身份遇到问题？您可以通知我们的客服，我们将尽快联系您"))+"。",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-9d493391"]]);export{I as default};

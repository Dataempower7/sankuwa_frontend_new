import{d as e,a7 as a,k as l,B as t,E as u,bv as s,c as i,o as d,_ as c,a2 as r,K as n,j as o,r as v,i as m,N as f,w as p,aF as k,bg as b,n as y,Q as g,L as _,U as h,W as x,I,J as S,g as V,a as N,V as $,Y as w,h as C,f as E,b as P,F as T,G as z,t as L,X as j,Z as A,H as U,O as B}from"./index-DDAlCzEE.js";import{_ as O}from"./tig-image.CxOKkXKh.js";import{_ as Q}from"./format-price.9n-LYbxy.js";import{_ as W}from"./uni-icons.piUs7f0e.js";import{_ as q}from"./uni-number-box.D352QONN.js";import{c as D}from"./tig-layout.Dp_86RM-.js";import{j as F,k as H,l as J,h as G,m as K}from"./product.CwGVjSIm.js";const X=c(e({__name:"tig-number-box",props:{modelValue:{type:Number,default:1},max:{type:Number,default:99},min:{type:Number,default:1},inputWidth:{type:[String,Number],default:35},buttonSize:{type:[String,Number],default:30},buttonWidth:{type:[String,Number],default:35},iconStyle:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","overlimit","change"],setup(e,{emit:c}){a(e=>({"280613e4":m.value}));const r=e,n=c,o=l({get:()=>r.modelValue,set(e){n("update:modelValue",e),n("change",e)}}),v=e=>{n("overlimit",e)},m=l(()=>r.buttonWidth+"px");return(a,l)=>{const c=t(u("up-number-box"),s);return d(),i(c,{modelValue:o.value,"onUpdate:modelValue":l[0]||(l[0]=e=>o.value=e),"icon-style":e.iconStyle,"button-size":e.buttonSize,min:e.min,max:e.max,"input-width":e.inputWidth,disabled:e.disabled,onOverlimit:v,onChange:l[1]||(l[1]=()=>{})},null,8,["modelValue","icon-style","button-size","min","max","input-width","disabled"])}}}),[["__scopeId","data-v-77dd584a"]]),Y=e=>r({url:"product/exchange/list",method:"get",params:e}),Z=e=>r({url:"product/exchange/detail",method:"get",params:{id:e}}),M=e({__name:"buy",props:{id:Number,number:{type:Number},skuId:{type:Number},extraAttrIds:{type:String,default:""},disabled:{type:Boolean,default:!1},isQuick:{type:Boolean,default:!1},type:{type:String},skuItem:{type:Array}},emits:["callback"],setup(e,{emit:a}){const{t:l}=n(),t=o(),u=e,s=a,c=v(!1),h=async()=>{var e;if(!u.disabled)try{if(c.value)return;c.value=!0;const a=x(u.id);let i={};const d={id:u.id??0,number:u.number,skuId:u.skuId,isQuick:u.isQuick?1:0};if(u.extraAttrIds&&(d.extraAttrIds=u.extraAttrIds),b(),"exchange"===u.type)i=await(e=d,r({url:"product/exchange/addToCart",method:"post",data:e}));else d.salesmanId=a>0?a:void 0,i=await F(d);if(s("callback"),1==u.isQuick){if(1===t.closeOrder)return uni.$u.toast(l("商城已关闭下单"));y({url:`/pages/order/check?flowType=${i.flowType}`})}else g({title:l("加入购物车成功"),duration:1500})}catch(a){g({title:a.message,icon:"none",duration:1500})}finally{c.value=!1}},x=e=>{const a=_("salesmanProducts")||[];if(!a.length)return 0;const l=a.find(a=>a.productId==e);return Number(null==l?void 0:l.salesmanId)||0};return(e,a)=>{const l=m;return d(),i(l,{class:"buy",onClick:f(h,["stop"])},{default:p(()=>[k(e.$slots,"default")]),_:3})}}}),R=c(e({__name:"specification",props:{modelValue:{type:[Number],default:0},skuId:{type:[Number],default:0},type:{type:[String],default:""}},emits:["sendValue","addCardSucceed","update:skuId","loadEnd","close"],setup(e,{expose:s,emit:c}){a(e=>({"8cb0084a":Be.value,f4aed730:Oe.value}));const r=e,o=c,{t:y}=n(),_=v(!1),F=()=>{o("close"),$e(),_.value=!1},K=()=>{_.value=!0},Y=v([]),R=v([]),ee=v([]),ae=v({}),le=v("0"),te=v("0"),ue=v(""),se=v(0),ie=v(""),de=v(1),ce=v(0),re=v([]),ne=v({}),oe=v(1),ve=v(0),me=v([]),fe=v([]),pe=v(!1);h(()=>r.modelValue,e=>{e&&e>0&&(de.value=1,re.value=[],ae.value={},fe.value=[],Te.value=0,pe.value=!0,(async()=>{try{let e={};"exchange"===r.type?(e=await Z(r.modelValue),ne.value=e.exchangeInfo,se.value=e.exchangeInfo.productStock,le.value=ne.value.discountsPrice||"0",ue.value=ne.value.picUrl||""):(e=await G(r.modelValue),se.value=e.item.productStock,le.value=e.item.productPrice||"0",ue.value=e.item.picUrl||""),oe.value=e.item.productType,ve.value=e.item.isBuy,ie.value=e.item.productName||"",Y.value=e.attrList.spe,me.value=e.attrList.extra,R.value=e.skuList,b()&&R.value.length,ke()}catch(e){g({title:e.message,icon:"none"}),o("loadEnd")}})())},{immediate:!0});const ke=()=>{if(Y.value.length>0){if(r.skuId>0){const e=R.value.find(e=>e.skuId===r.skuId);if(e){e.skuValue.split("|").forEach((e,a)=>{re.value[a]=e})}}0===re.value.length&&(Y.value.forEach((e,a)=>{e.attrList.forEach(e=>{e.checked=!1}),re.value[a]=e.attrList[0].attrName+":"+e.attrList[0].attrValue,e.attrList[0].checked=!0}),ue.value=Y.value[0].attrList[0].attrPic),be()}Ie()},be=()=>{Y.value.forEach((e,a)=>{const l=re.value[a];e.attrList.forEach(e=>{const t=`${e.attrName}:${e.attrValue}`;e.checked=l===t;const u=[...re.value];u[a]=t;const s=R.value.find(e=>e.skuValue===u.join("|"));e.skuStock=s?s.skuStock:0})});const e=R.value.find(e=>e.skuValue==re.value.join("|"));e&&(ae.value=e)},ye=x({id:0}),ge=v(""),_e=v(0),he=v([]),xe=v(0),Ie=async()=>{if(r.type)return pe.value=!1,void o("loadEnd");if(r.modelValue){ye.id=r.modelValue,ye.skuId=ae.value.skuId||null,ye.extraAttrIds=fe.value.length>0?fe.value.filter(e=>!!e).join(","):"";try{const e=await H(ye);le.value=e.price,e.originPrice&&(te.value=e.originPrice),se.value=e.stock,re.value.length>0&&(ge.value=re.value.map(e=>e.split(":")[1]).join(" ")),e.promotion.length>0&&Ne(e.promotion),_e.value&&ce.value>0?de.value=de.value>ce.value?ce.value:de.value:0===se.value?de.value=1:de.value=de.value>se.value?se.value:de.value,pe.value&&$e()}catch(e){g({title:e.message,icon:"none"})}finally{pe.value=!1,o("loadEnd")}}},Se=v({seckillEndTime:"",seckillSales:0,seckillStock:0}),Ve=v({discountEndTime:"",discountPrice:0}),Ne=e=>{he.value=e.filter(e=>1!==e.type&&6!==e.type);const a=e.find(e=>1===e.type),l=e.find(e=>6===e.type);l?(xe.value=1,Ve.value.discountEndTime=l.data.item.endTime,Ve.value.discountPrice=l.data.item.discountPrice):(xe.value=0,Ve.value={discountEndTime:"",discountPrice:0}),a?(_e.value=1,Se.value.seckillEndTime=a.data.seckillEndTime,Se.value.seckillSales=a.data.item.seckillSales,Se.value.seckillStock=a.data.item.seckillStock,ce.value=a.data.seckillLimitNum,se.value=a.data.item.seckillStock):(_e.value=0,Se.value={seckillEndTime:"",seckillSales:0,seckillStock:0})},$e=()=>{o("sendValue",{productOriginPrice:te.value,productPrice:le.value,productStock:se.value,productNumber:de.value,productSkuId:ae.value.skuId,skuStr:ge.value,isSeckill:_e.value,seckillValue:Se.value,promotionList:he.value,isDiscount:xe.value,discountValue:Ve.value})},we=()=>{F()},Ce=()=>{F(),setTimeout(()=>{o("addCardSucceed",!0)},500)},Ee=e=>{"minus"===e&&uni.$u.toast(y("商品数量不能小于1")),"plus"===e&&uni.$u.toast(y("库存不足"))},Pe=l(()=>b()),Te=v(0),ze=e=>{Te.value=e},Le=v([]);let je=null;const Ae=v({count:0,total:"0"}),Ue=async()=>{try{const e=await J({id:r.modelValue,skuItem:Le.value});Ae.value=e}catch(e){console.error(e)}},Be=l(()=>"65vh"),Oe=l(()=>"calc(100rpx + 15px + var(--safe-bottom))");return s({handleShowPopup:K}),(a,l)=>{const s=m,c=t(u("tig-image"),O),r=t(u("format-price"),Q),n=C,o=P,v=t(u("uni-icons"),W),y=t(u("uni-number-box"),q),g=t(u("tig-number-box"),X),h=$,x=t(u("tig-popup"),D);return d(),I(S,null,[V(s,{onClick:K},{default:p(()=>[k(a.$slots,"default",{},void 0,!0)]),_:3}),V(x,{show:_.value,"onUpdate:show":l[5]||(l[5]=e=>_.value=e),"z-index":999,"show-close":!1,onClose:we},{default:p(()=>[V(h,{"scroll-y":"true",class:"specification"},{default:p(()=>[V(s,{class:"product-sku-box flex justify-between"},{default:p(()=>[V(s,{class:"product-info"},{default:p(()=>[V(s,{class:"product-info-img"},{default:p(()=>[V(c,{src:ue.value},null,8,["src"])]),_:1}),V(s,{class:"info"},{default:p(()=>[V(s,{class:"price"},{default:p(()=>["exchange"===e.type?(d(),i(s,{key:0,class:"exchange-box"},{default:p(()=>[V(r,{"font-style":{fontSize:"32rpx"},"currency-style":{fontSize:"22rpx"},"decimals-style":{fontSize:"25rpx"},"price-data":le.value},null,8,["price-data"]),V(n,{class:"exchange-icon"},{default:p(()=>[E("+")]),_:1}),V(o,{class:"exchange-img",src:T(z)("exchange/exchange.png")},null,8,["src"]),V(n,{class:"exchange-text"},{default:p(()=>[E(L(ne.value.exchangeIntegral),1)]),_:1})]),_:1})):(d(),i(r,{key:1,"font-style":{fontSize:"32rpx"},"currency-style":{fontSize:"22rpx"},"decimals-style":{fontSize:"24rpx"},"price-data":le.value},null,8,["price-data"]))]),_:1}),xe.value||_e.value?(d(),i(s,{key:0,class:"ticket"},{default:p(()=>[V(s,{class:"ticket-content"},{default:p(()=>[E(L(_e.value?a.$t("秒杀价"):a.$t("限时折扣")),1)]),_:1})]),_:1})):N("",!0),te.value&&Number(te.value)>Number(le.value)?(d(),i(s,{key:1,class:"del-box"},{default:p(()=>[V(r,{"is-bottom":!1,"price-data":te.value,"font-style":{"text-decoration":"line-through"}},null,8,["price-data"])]),_:1})):N("",!0),V(s,{class:"name line2"},{default:p(()=>[E(L(ie.value),1)]),_:1})]),_:1})]),_:1}),V(s,{class:"popup-close",onClick:F},{default:p(()=>[V(v,{type:"closeempty",size:"24",style:{color:"#c8c9cc"}})]),_:1})]),_:1}),T(b)()&&R.value.length>1?(d(),I(S,{key:0},[V(s,{class:"placeholder"}),V(s,{class:"tab"},{default:p(()=>[V(s,{class:j(["tab-item",{active:0===Te.value}]),onClick:l[0]||(l[0]=e=>ze(0))},{default:p(()=>[E(L(a.$t("单品采购"))+" ",1),w(V(o,{class:"image",style:{right:"0"},src:T(z)("product/shadow-right.png")},null,8,["src"]),[[A,1===Te.value]])]),_:1},8,["class"]),V(s,{class:j(["tab-item",{active:1===Te.value}]),onClick:l[1]||(l[1]=e=>ze(1))},{default:p(()=>[E(L(a.$t("批量采购"))+" ",1),w(V(o,{class:"image",style:{left:"0"},src:T(z)("product/shadow-left.png")},null,8,["src"]),[[A,0===Te.value]])]),_:1},8,["class"]),V(s,{class:"line",style:U(""+(0===Te.value?"left: 0":"right: 0"))},null,8,["style"]),V(s,{class:"subline",style:U(""+(0===Te.value?"right: 0":"left: 0"))},null,8,["style"])]),_:1})],64)):N("",!0),w(V(s,null,{default:p(()=>[Y.value.length>0?(d(),i(s,{key:0,class:"product-sku-info"},{default:p(()=>[(d(!0),I(S,null,B(Y.value,(e,a)=>(d(),i(s,{key:a,class:"sku-item"},{default:p(()=>[V(s,{class:"tit"},{default:p(()=>[E(L(e.attrName),1)]),_:2},1024),V(s,{class:"sku-tag flex"},{default:p(()=>[(d(!0),I(S,null,B(e.attrList,(e,l)=>(d(),i(s,{key:l,class:j("tag "+(e.checked?"checked ":0==e.skuStock?"disabled":"")),onClick:e=>((e,a)=>{const l=Y.value[e].attrList[a];0===e&&(ue.value=l.attrPic),re.value[e]=l.attrName+":"+l.attrValue,be(),Ie()})(a,l)},{default:p(()=>[e.attrPicThumb&&0===a?(d(),i(s,{key:0,class:"tag-img"},{default:p(()=>[V(c,{src:e.attrPicThumb},null,8,["src"])]),_:2},1024)):N("",!0),V(s,{class:"tag-text"},{default:p(()=>[E(L(e.attrValue),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1})):N("",!0),V(s,{class:"product-sku-info"},{default:p(()=>[V(s,{class:"num-item"},{default:p(()=>[V(s,{class:"tit"},{default:p(()=>[E(L(a.$t("购买数量")),1)]),_:1}),V(s,{class:"sku-num flex align-center"},{default:p(()=>[_e.value&&ce.value>0?(d(),I(S,{key:0},[V(y,{modelValue:de.value,"onUpdate:modelValue":l[2]||(l[2]=e=>de.value=e),min:1,max:ce.value,width:60},null,8,["modelValue","max"]),V(s,{class:"stock"},{default:p(()=>[E(L(a.$t("限购"))+"：",1),V(n,{style:{color:"var(--general)"}},{default:p(()=>[E(L(ce.value)+L(a.$t("件")),1)]),_:1})]),_:1})],64)):(d(),I(S,{key:1},[V(g,{modelValue:de.value,"onUpdate:modelValue":l[3]||(l[3]=e=>de.value=e),min:1,max:se.value,onOverlimit:Ee},null,8,["modelValue","max"]),V(s,{class:"stock"},{default:p(()=>[E(L(a.$t("库存"))+"：",1),se.value>50?(d(),i(n,{key:0,style:{color:"var(--general)"}},{default:p(()=>[E(L(a.$t("充足")),1)]),_:1})):0===se.value?(d(),i(n,{key:1,style:{color:"var(--general)"}},{default:p(()=>[E(L(a.$t("缺货")),1)]),_:1})):(d(),i(n,{key:2,style:{color:"var(--general)"}},{default:p(()=>[E(L(a.$t("仅剩"))+L(se.value)+"件",1)]),_:1}))]),_:1})],64))]),_:1})]),_:1})]),_:1})]),_:1},512),[[A,1!==Te.value]]),w(V(s,null,{default:p(()=>[R.value.length>1?(d(),i(s,{key:0,class:"allskulist"},{default:p(()=>[(d(!0),I(S,null,B(ee.value,(e,a)=>(d(),i(s,{key:e.skuId,class:"allskulist-item"},{default:p(()=>[V(s,{class:"left"},{default:p(()=>[V(s,{class:"title line2"},{default:p(()=>[E(L(e.title),1)]),_:2},1024),V(s,{class:"desc"},{default:p(()=>[V(s,{class:"price"},{default:p(()=>[V(r,{"price-data":e.price},null,8,["price-data"])]),_:2},1024),V(s,{class:"line"}),V(s,{class:"stock"},{default:p(()=>[E("库存："+L(e.stock),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),V(s,{class:"right"},{default:p(()=>[V(g,{modelValue:e.num,"onUpdate:modelValue":a=>e.num=a,"button-width":30,min:0,max:e.skuStock,onChange:l[4]||(l[4]=e=>(je&&clearTimeout(je),void(je=setTimeout(()=>{const e=ee.value.filter(e=>e.num);Le.value=e.map(e=>({skuId:e.skuId,num:e.num})),Ue()},300))))},null,8,["modelValue","onUpdate:modelValue","max"])]),_:2},1024)]),_:2},1024))),128))]),_:1})):N("",!0)]),_:1},512),[[A,Pe.value]]),me.value.length>0?(d(),i(s,{key:1,class:"product-sku-info attribute"},{default:p(()=>[(d(!0),I(S,null,B(me.value,(e,a)=>(d(),i(s,{key:a,class:"attribute-item"},{default:p(()=>[V(s,{class:"item-title"},{default:p(()=>[E(L(e.attrName),1)]),_:2},1024),V(s,{class:"item-content"},{default:p(()=>[(d(!0),I(S,null,B(e.attrList,e=>(d(),i(s,{key:e.attributesId,class:j(["item-attr",{checked:fe.value[a]===e.attributesId}]),onClick:f(l=>((e,a)=>{fe.value[e]&&fe.value[e]===a?fe.value[e]=null:fe.value[e]=a,Ie()})(a,e.attributesId),["stop"])},{default:p(()=>[V(s,{class:"label"},{default:p(()=>[E(L(e.attrValue),1)]),_:2},1024),V(r,{class:"value","price-data":e.attrPrice},null,8,["price-data"])]),_:2},1032,["class","onClick"]))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1})):N("",!0)]),_:1}),4!==oe.value||1!==ve.value?(d(),i(s,{key:0,class:j(["footer",{shadow:Pe.value}])},{default:p(()=>[Pe.value?(d(),i(s,{key:0,class:"b2b-btn"},{default:p(()=>[V(s,{class:"desc"},{default:p(()=>[V(s,null,{default:p(()=>[E("已选"),V(n,{class:"num"},{default:p(()=>[E(L(Ae.value.count),1)]),_:1}),E("件")]),_:1}),V(s,{class:"price"},{default:p(()=>[V(s,null,{default:p(()=>[E("商品金额：")]),_:1}),V(r,{"font-style":{fontSize:"32rpx",color:"var(--general)"},"currency-style":{fontSize:"22rpx",color:"var(--general)"},"decimals-style":{fontSize:"25rpx",color:"var(--general)"},"price-data":Ae.value.total},null,8,["font-style","currency-style","decimals-style","price-data"])]),_:1})]),_:1}),V(s,{class:"add_cart"},{default:p(()=>[V(M,{id:Number(e.modelValue),disabled:0===Le.value.length,"sku-item":Le.value,"extra-attr-ids":ye.extraAttrIds,onCallback:Ce},{default:p(()=>[V(s,{class:j(["btn cart",0===Le.value.length?"disabled-div":""])},{default:p(()=>[E(L(a.$t("批量加入购物车")),1)]),_:1},8,["class"])]),_:1},8,["id","disabled","sku-item","extra-attr-ids"]),V(M,{id:Number(e.modelValue),"sku-item":Le.value,disabled:0===Le.value.length,"extra-attr-ids":ye.extraAttrIds,"is-quick":!0,onCallback:F},{default:p(()=>[V(s,{class:j(["btn buy-right",0===Le.value.length?"disabled-div":""])},{default:p(()=>[E(L(a.$t("立即购买")),1)]),_:1},8,["class"])]),_:1},8,["id","sku-item","disabled","extra-attr-ids"])]),_:1})]),_:1})):(d(),I(S,{key:1},["exchange"===e.type?(d(),i(s,{key:0,class:"exchange-btn"},{default:p(()=>[V(M,{id:ne.value.id,"sku-id":ae.value.skuId,disabled:0==se.value,"extra-attr-ids":ye.extraAttrIds,number:de.value,"is-quick":!0,type:e.type,onCallback:F},{default:p(()=>[V(s,{class:j(["btn",0===se.value?"disabled-div":""])},{default:p(()=>[E(L(a.$t("立即兑换")),1)]),_:1},8,["class"])]),_:1},8,["id","sku-id","disabled","extra-attr-ids","number","type"])]),_:1})):(d(),I(S,{key:1},[1===oe.value?(d(),i(s,{key:0,class:"add_cart"},{default:p(()=>[V(M,{id:Number(e.modelValue),"sku-id":ae.value.skuId,disabled:0==se.value,"extra-attr-ids":ye.extraAttrIds,number:de.value,onCallback:Ce},{default:p(()=>[V(s,{class:j(["btn cart",0===se.value?"disabled-div":""])},{default:p(()=>[E(L(a.$t("加入购物车")),1)]),_:1},8,["class"])]),_:1},8,["id","sku-id","disabled","extra-attr-ids","number"]),V(M,{id:Number(e.modelValue),"sku-id":ae.value.skuId,disabled:0==se.value,"extra-attr-ids":ye.extraAttrIds,number:de.value,"is-quick":!0,onCallback:F},{default:p(()=>[V(s,{class:j(["btn buy-right",0===se.value?"disabled-div":""])},{default:p(()=>[E(L(a.$t("立即购买")),1)]),_:1},8,["class"])]),_:1},8,["id","sku-id","disabled","extra-attr-ids","number"])]),_:1})):(d(),i(s,{key:1,class:"exchange-btn"},{default:p(()=>[V(M,{id:e.modelValue,"sku-id":ae.value.skuId,disabled:0==se.value,"extra-attr-ids":ye.extraAttrIds,number:de.value,"is-quick":!0,type:e.type,onCallback:F},{default:p(()=>[V(s,{class:j(["btn",0===se.value?"disabled-div":""])},{default:p(()=>[E(L(a.$t("立即购买")),1)]),_:1},8,["class"])]),_:1},8,["id","sku-id","disabled","extra-attr-ids","number","type"])]),_:1}))],64))],64))]),_:1},8,["class"])):N("",!0)]),_:1},8,["show"])],64)}}}),[["__scopeId","data-v-a2f80a7a"]]);export{X as _,Z as a,Y as g,R as s};

import{r as a,s as e}from"./index-BZxHr1FI.js";import{n as t}from"./product.BH5dMQls.js";function o(o,r){const l=a([]),u=a({}),n=a(0),s=a(!0),c=a(!1),i=a(null),v=a({}),{immediate:d=!1,needReachBottom:p=!0,needPromotionList:m=!1,params:f={},path:h={}}=r,{dataKey:y="list",totalKey:g="total",pageKey:w="page",sizeKey:L="size"}=h;f[w]||(f[w]=1),f[L]||(f[L]=10);const I=async a=>{try{if(void 0!==a){const e="function"==typeof a?a():a;v.value={...v.value,...e}}const d={...f,...v.value};d[w]>1?c.value=!0:(s.value=!0,l.value=[]);const p=await o(d),h=""===y?p:p[y]??[];if(l.value=1===d[w]?h:[...l.value,...h],n.value=p[g]??0,m&&h.length)try{const a=h.map(a=>({productId:a.productId})),e=await(async a=>{try{return await t({products:a.products,shopId:a.shopId,from:a.from})}catch(i){throw console.error(i),i}})({products:a,from:"list"});u.value={...u.value,...e}}catch(e){console.error("获取促销信息失败:",e)}return r.manageData&&r.manageData(l.value),p}catch(e){i.value=e instanceof Error?e:new Error(String(e)),console.error("获取列表数据失败:",e)}finally{s.value=!1,c.value=!1}},K=()=>{!s.value&&!c.value&&f[w]<Math.ceil(n.value/f[L])&&(f[w]++,I())};return p&&e(K),d&&I(),{data:l,promotionList:u,total:n,isLoading:s,isLoadMore:c,error:i,getList:I,reachBottom:K,resetState:()=>{l.value=[],n.value=0,i.value=null,f[w]=1,v.value={}}}}export{o as u};

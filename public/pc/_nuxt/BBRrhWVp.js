import{b as ve}from"./5VTus1_X.js";import{_ as pe}from"./Drr4mNEN.js";import{_ as me}from"./C35Ty7Vx.js";import{T as fe}from"./XdJ5ILcf.js";import{g as ge,u as ye,a as _e,C as ke}from"./DtCgnYKu.js";import{e as K,ax as W,r as _,ay as Y,H as G,c as o,o as r,a as e,i as y,F as I,m as L,t as n,x as h,d as M,df as be,_ as Q,f as he,z as $e,v as D,b as U,w as te,j as d,n as ae,k as Ce,ad as Z,as as ee,p as Se,G as Pe,h as we,bY as Ie,al as Fe,aA as z,ah as qe}from"./BjkHNVA8.js";import{_ as xe}from"./B85mN9rA.js";import Me from"./BeO6aEVH.js";import"./CM_M6Xgj.js";import"./BipSnJcb.js";import"./CBcH1uzJ.js";import"./n1vI1_Nv.js";import"./B_vjKAZC.js";import"./CXwPJP5h.js";import"./BIqqf5dq.js";import"./CH9-T1LE.js";import"./ClRMjIOJ.js";import"./BKu6lkEW.js";import"./d3UjsK-T.js";import"./FYm-MTMW.js";import"./cfDoaBtk.js";import"./C1B8-dXF.js";import"./Bnvi_g-K.js";import"./yB3A8U-z.js";import"./UVx7YjW9.js";import"./BzIkMksr.js";/* empty css        */import"./Csy7st1x.js";import"./BhwkTUtM.js";import"./Ibc-iJtI.js";/* empty css        */import"./CWzVxcs9.js";import"./CQ93QHlZ.js";/* empty css        */import"./BmiGu4wZ.js";import"./D5AuvtSp.js";import"./BNVM5YSV.js";import"./BJETu8kJ.js";const Ne={class:"filter__box"},Oe={class:"filter"},Le={key:0,class:"list"},Te={class:"attr-name"},Be={class:"attr-box"},Ue={class:"category-link"},Ve=["onClick"],Ae={class:"attr-name"},je={class:"attr-box"},Ee={class:"category-link"},Re=["onClick"],Ge={class:"attr-multiple-text"},He={key:4,class:"fc-btn-box"},ze=K({__name:"EsFilter",props:W({queryParams:{type:Object,default:()=>({})},pageType:{type:String,default:"search"}},{filter:{},filterModifiers:{},filterSeleted:{},filterSeletedModifiers:{}}),emits:W(["change"],["update:filter","update:filterSeleted"]),setup(q,{emit:j}){const P=_(!1),v=_(!1),g=_([]),t=_({attributes:[]}),k=q,$=j,b=Y(q,"filter"),x=Y(q,"filterSeleted"),a=()=>!t.value.attributes||t.value.attributes.length===0?[]:t.value.attributes.filter(m=>!p(m.name)),E=()=>{const m=a();return m.length>0?[m[0]]:[]},S=()=>{const m=a().length;return P.value?!0:m>1},i=()=>{v.value=!0,P.value=!0},p=m=>x.value.attrs&&x.value.attrs.length>0?x.value.attrs.some(c=>c.attrName===m):!1,N=(m,c)=>{if(!g.value||g.value.length===0)return!1;const u=g.value.find(C=>C.attrName===m);return u?u.attrValue.includes(c):!1},O=async()=>{try{const m=await ge({keyword:k.queryParams.keyword});t.value.attributes=m.attributes||[]}catch(m){console.error("获取筛选项失败:",m)}};G(()=>b.value,()=>{O()},{deep:!0,immediate:!0}),G(()=>x.value,()=>{g.value=be(x.value.attrs)||[]},{deep:!0,immediate:!0});const T=(m,c)=>{g.value||(g.value=[]);let u=g.value.find(w=>w.attrName===m);u||(u={attrName:m,attrValue:[]},g.value.push(u));const C=u.attrValue.indexOf(c);C>-1?u.attrValue.splice(C,1):u.attrValue.push(c),v.value||$("change",g.value)},B=()=>{g.value.length>0&&$("change",g.value)},R=()=>{g.value=[],v.value=!1};return(m,c)=>(r(),o("div",Ne,[e("div",Oe,[t.value.attributes.length>0?(r(),o(I,{key:0},[a().length>0?(r(),o("div",Le,[P.value?(r(!0),o(I,{key:1},L(a(),(u,C)=>(r(),o("div",{key:u.name,class:"attr-list"},[e("div",Ae,n(u.name)+"：",1),e("div",je,[e("div",Ee,[(r(!0),o(I,null,L(u.values,(w,F)=>(r(),o("div",{class:h(["item",{selected:N(u.name,w.value)}]),key:F,onClick:J=>T(u.name,w.value)},n(w.value),11,Re))),128))])])]))),128)):(r(!0),o(I,{key:0},L(E(),(u,C)=>(r(),o("div",{key:u.name,class:"attr-list"},[e("div",Te,n(u.name)+"：",1),e("div",Be,[e("div",Ue,[(r(!0),o(I,null,L(u.values,(w,F)=>(r(),o("div",{class:h(["item",{selected:N(u.name,w.value)}]),key:F,onClick:J=>T(u.name,w.value)},n(w.value),11,Ve))),128))])])]))),128)),S()?(r(),o("span",{key:2,class:h(["attrMore",{attrMoreUp:P.value}]),onClick:c[0]||(c[0]=u=>P.value=!P.value)},[M(n(P.value?m.$t("收起筛选"):m.$t("展开筛选"))+" ",1),c[1]||(c[1]=e("i",{class:"iconfont-pc icon-xiajiantou"},null,-1))],2)):y("",!0),!v.value&&a().length>0?(r(),o("div",{key:3,class:"attr-multiple",onClick:i},[c[2]||(c[2]=e("i",null,"＋",-1)),e("div",Ge,n(m.$t("多选")),1)])):y("",!0),P.value&&v.value?(r(),o("div",He,[e("a",{class:h(["fc-btn-ok",{"fc-disable":g.value.length===0}]),onClick:B},n(m.$t("确定")),3),e("a",{class:"fc-btn-cancel",onClick:R},n(m.$t("取消")),1)])):y("",!0)])):y("",!0)],64)):y("",!0)])]))}}),De=Q(ze,[["__scopeId","data-v-fba633d6"]]),We={class:"filter__box"},Ye={class:"sear-title"},Je={key:0},Ke={class:"st-ext"},Qe={class:"filter"},Xe={key:0,class:"list"},Ze={class:"attr-name"},et={class:"attr-box"},tt=["onClick"],at={key:1,class:"list brand_fitlter"},lt={class:"attr-name"},rt={class:"attr-box"},st={key:0,class:"category-brand-f-letter"},nt=["onClick"],ot=["onClick"],it={class:"pic_box"},ut=["src"],dt={class:"brand_name"},ct={class:"attr-multiple-text"},vt={key:0,class:"fc-btn-box"},pt={class:"cat-sort-warp"},mt={class:"cat-sort"},ft={class:"flex"},gt={class:"lefter"},yt=["title"],_t=["title"],kt=["title"],bt=["title"],ht={key:0,class:"iconfont-pc icon-xiajiantou1"},$t={key:1,class:"iconfont-pc icon-shangjiantou1"},Ct={class:"priceform"},St={class:"form-bg"},Pt={class:"righter"},wt={class:"productsNO"},It={class:"pageInfo"},Ft={class:"page_number"},qt=K({__name:"Filter",props:W({isSearchPage:{type:Boolean,default:!1},total:{type:Number,default:0},queryParams:{type:Object,default:{}},pageType:{type:String,default:"search"},attrList:{type:Array,default:()=>[]}},{filter:{},filterModifiers:{},filterSeleted:{},filterSeletedModifiers:{}}),emits:W(["change","changeAttr"],["update:filter","update:filterSeleted"]),setup(q,{expose:j,emit:P}){const v=ye(),g=he(),t=_("");_(),_();const{t:k}=$e(),$=q,b=P,x=_($.attrList),a=Y(q,"filter"),E=Y(q,"filterSeleted"),S=_({category:"",brand:"",attrs:[]}),i=_({brand:[],category:[]}),p=_(!1),N=_(a.value.minPrice),O=_(a.value.maxPrice),T=async(s="")=>{try{const l=await _e({...$.queryParams,page_type:$.pageType,attrs:x.value});i.value.brand=l.filter.brand,i.value.category=l.filter.category,S.value=l.filterSelected,t.value="",S.value.category&&(t.value+=S.value.category+" - "),a.value.keyword&&(t.value+=a.value.keyword+" -  "),S.value.brand&&(t.value+=S.value.brand+" -  "),t.value+=k("商品搜索")+g.pageTitle,E.value=l.filterSelected}catch{}finally{}},B=D(()=>v.total?Math.ceil(Number(v.total)/25):1);G(()=>a.value,()=>{T()},{deep:!0,immediate:!0}),G(()=>$.attrList,()=>{x.value=$.attrList,T()},{deep:!0,immediate:!0});const R=s=>{a.value.page=1,x.value=s,T(),b("changeAttr",s)},m=s=>{a.value.categoryId=s,a.value.page=1,b("change")},c=D(()=>V.value?i.value.brand.filter(s=>s.firstWord===V.value):i.value.brand),u=_(!1),C=_(!1),w=D(()=>{const s=[...new Set(i.value.brand.map(l=>l.firstWord))];return s.sort(),s}),F=_([]),J=s=>{if(C.value===!0){const l=F.value.indexOf(s);l>-1?F.value.splice(l,1):F.value.push(s)}else a.value.brandIds=[s],a.value.page=1,b("change")},le=s=>F.value.indexOf(s)>-1,re=()=>{u.value=!1,C.value=!1,F.value=a.value.brandIds},se=()=>{a.value.brandIds=F.value,a.value.page=1,u.value=!1,C.value=!1,b("change")},V=_(""),ne=s=>{V.value=s},H=s=>{s===""?(a.value.sortField="",a.value.sortOrder=""):s==="sale"?(a.value.sortField="sale",a.value.sortOrder=""):s==="time"?(a.value.sortField="time",a.value.sortOrder=""):s==="price"&&(a.value.sortField="price",a.value.sortOrder=a.value.sortOrder==="asc"?"desc":"asc"),a.value.page=1,b("change")},oe=()=>{a.value.page>1&&(a.value.page--,b("change",a.value.page))},ie=()=>{a.value.page<B.value&&(a.value.page++,b("change",a.value.page))},ue=()=>{if(N.value>O.value||O.value===0)return Se.error(k("请输入正确的价格范围"));a.value.minPrice=N.value??0,a.value.maxPrice=O.value??0,b("change")};return j({clearMultipleBrandIds:()=>{F.value.length=0}}),(s,l)=>{const de=fe,ce=De;return r(),o(I,null,[U(de,null,{default:te(()=>[M(n(t.value),1)]),_:1}),e("div",We,[e("div",Ye,[e("h3",null,[S.value&&S.value.category?(r(),o("b",Je,n(S.value.category),1)):y("",!0),e("em",null,n(s.$t("商品筛选")),1)]),e("div",Ke,[M(n(s.$t("共"))+" ",1),e("span",null,n(d(v).total),1),M(" "+n(s.$t("个商品")),1)])]),e("div",Qe,[i.value.category.length>0?(r(),o("div",Xe,[e("div",Ze,n(s.$t("分类：")),1),e("div",et,[e("div",{class:h(["category-link",{"category-link-more":p.value}])},[(r(!0),o(I,null,L(i.value.category,(f,A)=>(r(),o("div",{class:"item",key:A,onClick:X=>m(f.categoryId)},n(f.categoryName),9,tt))),128))],2),i.value.category.length>10?(r(),o("span",{key:0,class:h(["attrMore",{attrMoreUp:p.value}]),onClick:l[0]||(l[0]=f=>p.value=!p.value)},[M(n(p.value?s.$t("收起"):s.$t("更多")),1),l[12]||(l[12]=e("i",{class:"iconfont-pc icon-xiajiantou"},null,-1))],2)):y("",!0)])])):y("",!0),i.value.brand.length>0&&a.value.brandIds.length===0?(r(),o("div",at,[e("div",lt,n(s.$t("品牌：")),1),e("div",rt,[u.value?(r(),o("div",st,[e("div",{class:h(["leter",{cur:V.value===""}]),"data-word":"all",onClick:l[1]||(l[1]=f=>V.value="")},n(s.$t("所有品牌")),3),(r(!0),o(I,null,L(d(w),(f,A)=>(r(),o("div",{class:h(["leter",{cur:V.value==f}]),key:A,onClick:X=>ne(f)},n(f),11,nt))),128))])):y("",!0),e("div",{class:h({"category-brand-wrap":!u.value,"category-brand-f-wrap":u.value})},[(r(!0),o(I,null,L(d(c),(f,A)=>(r(),o(I,{key:A},[u.value||!u.value&&A<8?(r(),o("div",{key:0,class:h(["item",{selected:le(f.brandId)}]),onClick:X=>J(f.brandId)},[e("span",it,[e("img",{src:d(Ce)(f.brandLogo)},null,8,ut)]),e("span",dt,n(f.brandName),1),l[13]||(l[13]=e("i",null,null,-1))],10,ot)):y("",!0)],64))),128))],2),e("span",{class:h(["attrMore",{attrMoreUp:u.value}]),onClick:l[2]||(l[2]=f=>u.value=!u.value)},[M(n(u.value?s.$t("收起"):s.$t("更多")),1),l[14]||(l[14]=e("i",{class:"iconfont-pc icon-xiajiantou"},null,-1))],2),C.value?y("",!0):(r(),o("div",{key:1,class:"attr-multiple",onClick:l[3]||(l[3]=f=>{C.value=!0,u.value=!0})},[l[15]||(l[15]=e("i",null,"＋",-1)),e("div",ct,n(s.$t("多选")),1)]))]),u.value&&C.value?(r(),o("div",vt,[e("a",{class:h(["fc-btn-ok",{"fc-disable":F.value.length===0}]),onClick:se},n(s.$t("确定")),3),e("a",{class:"fc-btn-cancel",onClick:re},n(s.$t("取消")),1)])):y("",!0)])):y("",!0),d(g).enableAttributeFilter?(r(),ae(ce,{key:2,ref:"esFilterRef",filter:a.value,"onUpdate:filter":l[4]||(l[4]=f=>a.value=f),filterSeleted:S.value,"onUpdate:filterSeleted":l[5]||(l[5]=f=>S.value=f),queryParams:q.queryParams,onChange:R},null,8,["filter","filterSeleted","queryParams"])):y("",!0)]),e("div",pt,[e("div",mt,[e("div",ft,[e("div",gt,[e("span",{class:h(["sort-link",{cur_sort:a.value.sortField==""}]),title:d(k)("默认排序（根据相关性排序）"),onClick:l[6]||(l[6]=f=>H(""))},n(s.$t("默认排序")),11,yt),e("span",{class:h(["sort-link",{cur_sort:a.value.sortField=="sale"}]),title:d(k)("销量（销量从高到低）"),onClick:l[7]||(l[7]=f=>H("sale"))},n(s.$t("销量")),11,_t),e("span",{class:h(["sort-link",{cur_sort:a.value.sortField=="time"}]),title:d(k)("上架时间（最新发布排序）"),onClick:l[8]||(l[8]=f=>H("time"))},n(s.$t("新品")),11,kt),e("span",{class:h(["sort-link",{cur_sort:a.value.sortField=="price"}]),title:a.value.sortOrder=="desc"?d(k)("价格（价格从高到低）"):d(k)("价格（价格从低到高）"),onClick:l[9]||(l[9]=f=>H("price"))},[M(n(s.$t("价格"))+" ",1),a.value.sortOrder=="desc"?(r(),o("span",ht)):(r(),o("span",$t))],10,bt)]),e("div",Ct,[e("div",St,[Z(e("input",{type:"text",name:"pricemin","onUpdate:modelValue":l[10]||(l[10]=f=>N.value=f)},null,512),[[ee,N.value,void 0,{number:!0}]]),l[16]||(l[16]=e("em",null," - ",-1)),Z(e("input",{type:"text",name:"pricemax","onUpdate:modelValue":l[11]||(l[11]=f=>O.value=f)},null,512),[[ee,O.value,void 0,{number:!0}]]),e("a",{class:"btn-default",draggable:"false",onClick:ue,rel:"nofollow",href:"javascript:;"},n(s.$t("确定")),1)])])]),e("div",Pt,[e("div",wt,[e("div",null,[M(n(s.$t("共")),1),e("em",null,n(d(v).total),1),M(n(s.$t("个商品")),1)])]),e("div",It,[e("span",Ft,n(a.value.page)+"/"+n(d(B)),1),e("span",{onClick:oe,class:h(["noPage",{disabled:a.value.page==1}])},"<",2),e("span",{onClick:ie,class:h(["noPage",{disabled:a.value.page===d(B)}])},">",2)])])])])])],64)}}}),xt=Q(qt,[["__scopeId","data-v-dd11397b"]]),Mt={style:{"background-color":"#fff"}},Nt={class:"container"},Ot={key:0,class:"nav-selected"},Lt={key:1,class:"nav-selected"},Tt={key:2,class:"nav-selected"},Bt=["onClick"],Ut={key:0},Vt={key:1,class:"nav-selected"},At=K({__name:"search",props:{pageType:{type:String,default:"search"}},setup(q){const j=q,P=_(),v=Pe(),g=_([]),t=we({page:1,categoryId:0,brandIds:[],sortField:"",sortOrder:"",maxPrice:0,minPrice:"",couponId:"",keyword:""});Ie(()=>{t.page=v.query.page?Number(v.query.page):1,t.categoryId=v.query.cat?Number(v.query.cat):0,t.brandIds=v.query.brand?String(v.query.brand).split(",").map(Number):[],t.sortField=v.query.sort?String(v.query.sort):"",t.sortOrder=v.query.order?String(v.query.order):"",t.maxPrice=v.query.max?Number(v.query.max):"",t.minPrice=v.query.min?Number(v.query.min):"",t.keyword=v.query.keyword?String(v.query.keyword):"",t.couponId=v.query.couponId?Number(v.query.couponId):0});const k=_();G(()=>k.value,i=>{i?.brand==null&&P.value?.clearMultipleBrandIds()});const $=D(()=>{let i={};return t.page>1&&(i.page=t.page),t.categoryId>0&&(i.cat=t.categoryId),t.couponId>0&&(i.couponId=t.couponId),t.brandIds.length>0&&(i.brand=t.brandIds.join(",")),t.sortField!=""&&["sale","price","time"].includes(t.sortField)&&(i.sort=t.sortField),t.sortOrder!=""&&["desc","asc"].includes(t.sortOrder)&&(i.order=t.sortOrder),t.maxPrice>0&&(i.max=t.maxPrice),t.minPrice>0&&(i.min=t.minPrice),t.keyword!=""&&(i.keyword=t.keyword),i}),b=(i=1)=>{t.page=i,qe({path:"/"+j.pageType+"/",query:$.value})},x=i=>{g.value=i},a=_(null),E=()=>{const i=a.value;i&&i.scrollIntoView()},S=i=>{g.value=g.value.filter(p=>p.attrName!==i),b()};return(i,p)=>{const N=ve,O=pe,T=me,B=xt,R=ke,m=xe;return r(),o("div",Mt,[U(N),U(O,{title:d(t).keyword?`${d(t).keyword} - 商品搜索`:"商品搜索"},null,8,["title"]),e("div",Nt,[d(Fe)()&&d(t).keyword?(r(),ae(Me,{key:0,keyword:d(t).keyword,style:{"flex-shrink":"0"}},null,8,["keyword"])):y("",!0),U(T,{id:d(t).categoryId,"onUpdate:id":p[3]||(p[3]=c=>d(t).categoryId=c),isSearchPage:"",onChange:b,style:{"flex-shrink":"0"}},{default:te(()=>[k.value?(r(),o(I,{key:0},[d(t).brandIds.length>0&&k.value.brand?(r(),o("div",Ot,[e("div",{class:"item",onClick:p[0]||(p[0]=c=>{d(t).brandIds=[],b()})},[e("span",null,n(i.$t("品牌"))+"：",1),e("span",null,n(k.value.brand),1)])])):y("",!0),d(t).minPrice>0||d(t).maxPrice>0?(r(),o("div",Lt,[e("div",{class:"item",onClick:p[1]||(p[1]=c=>{d(t).maxPrice=0,d(t).minPrice=0,b()})},[e("span",null,n(i.$t("价格"))+"：",1),e("span",null,n(d(t).minPrice??0)+" "+n(d(t).maxPrice>0?" - "+d(t).maxPrice:i.$t("以上")),1)])])):y("",!0),g.value.length>0&&k.value.attrs?(r(),o("div",Tt,[(r(!0),o(I,null,L(k.value.attrs,(c,u)=>(r(),o("div",{key:u,class:"item",onClick:C=>S(c.attrName)},[e("span",null,n(c.attrName)+"：",1),(r(!0),o(I,null,L(c.attrValue,(C,w)=>(r(),o("span",null,[M(n(C),1),w<c.attrValue.length-1?(r(),o("span",Ut,"，")):y("",!0)]))),256))],8,Bt))),128))])):y("",!0)],64)):y("",!0),d(t).keyword?(r(),o("div",Vt,[d(t).keyword?(r(),o("div",{key:0,class:"item",onClick:p[2]||(p[2]=c=>{d(t).keyword="",b()})},[e("span",null,n(i.$t("搜索"))+"：",1),e("span",null,'"'+n(d(t).keyword)+'"',1)])):y("",!0)])):y("",!0)]),_:1},8,["id"]),e("div",{ref_key:"FilterRef",ref:a},[U(B,{ref_key:"filterRef",ref:P,filter:d(t),"onUpdate:filter":p[4]||(p[4]=c=>z(t)?t.value=c:null),filterSeleted:k.value,"onUpdate:filterSeleted":p[5]||(p[5]=c=>k.value=c),queryParams:d($),"onUpdate:queryParams":p[6]||(p[6]=c=>z($)?$.value=c:null),pageType:q.pageType,attrList:g.value,isSearchPage:"",onChange:b,onChangeAttr:x},null,8,["filter","filterSeleted","queryParams","pageType","attrList"])],512),U(R,{queryParams:d($),"onUpdate:queryParams":p[7]||(p[7]=c=>z($)?$.value=c:null),filter:d(t),"onUpdate:filter":p[8]||(p[8]=c=>z(t)?t.value=c:null),attrs:g.value,onChange:b,onPageChange:E},null,8,["queryParams","filter","attrs"])]),U(m)])}}}),Pa=Q(At,[["__scopeId","data-v-aa33ad74"]]);export{Pa as default};

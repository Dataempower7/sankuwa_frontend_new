import{e as T,ax as N,aB as V,z as $,r as c,ay as k,c as F,o as M,F as B,b as i,x as C,j as m,aD as D,av as w,w as f,Z as z,a7 as A,a as P,E as S,cA as v,k as j,_ as q}from"./BjkHNVA8.js";import{E as H}from"./DoNaAjK4.js";import{E as R}from"./BsZFmHoh.js";import"./Ibc-iJtI.js";const Z={class:"image"},G=T({__name:"UploadImage",props:N({limit:{type:Number,default:1},fileTypes:{type:Array,default:[]}},{uploadList:{default:[]},uploadListModifiers:{}}),emits:["update:uploadList"],setup(o){const h=V(),{t:s}=$(),u=c(),r=o,_=e=>{if(t.value.length>=r.limit)return v.error(s("已经达到上传数量限制")),!1;const l=e.type.replace(/.*\//,"");return r.fileTypes.includes(l)?e.size/1024/1024>2?(v.error(s("只能上传2M以内的图片")),!1):!0:(v.error(`${s("无法上传")} ${l} ${s("文件!")}${s("只能上传")} ${r.fileTypes.join(", ")} ${s("文件!")}`),!1)},a=k(o,"uploadList"),t=c([]);(()=>{if(a.value==null){a.value=[];return}a.value.length>0&&(a.value.forEach(e=>{e.url=j(e.picUrl)}),t.value=a.value)})();const g=c(""),d=c(!1),b=(e,l)=>{e&&a.value?a.value=a.value.filter(n=>n.picThumb!==e.picThumb):a.value=[]},y=(e=[],l)=>{r.limit===1&&t.value.length>0&&(t.value.pop(),a.value.pop(),u.value.clearFiles(),u.value.handleStart(e[0]),u.value.submit())},E=e=>{g.value=e.url,d.value=!0},U=(e,l)=>{try{a.value.push({picThumb:e.data.picThumb,picUrl:e.data.picUrl,picId:e.data.picId,picName:e.data.picName})}catch{}};return(e,l)=>{const n=z,I=H,x=S,L=R;return M(),F(B,null,[i(I,{ref_key:"upload",ref:u,"file-list":t.value,"onUpdate:fileList":l[0]||(l[0]=p=>t.value=p),action:m(D)+"/user/user/uploadImg",headers:m(h),"before-upload":_,"on-exceed":y,"on-preview":E,"on-remove":b,"on-success":U,limit:o.limit,multiple:o.limit>1,"list-type":"picture-card",class:C({"hide-upload-button":o.limit==1&&t.value.length>0})},w({_:2},[t.value.length===0?{name:"trigger",fn:f(()=>[i(n,null,{default:f(()=>[i(m(A))]),_:1})]),key:"0"}:void 0]),1032,["file-list","action","headers","limit","multiple","class"]),i(L,{modelValue:d.value,"onUpdate:modelValue":l[1]||(l[1]=p=>d.value=p)},{default:f(()=>[P("div",Z,[i(x,{src:g.value,alt:"",fit:"cover"},null,8,["src"])])]),_:1},8,["modelValue"])],64)}}}),X=q(G,[["__scopeId","data-v-e6bcd535"]]);export{X as U};

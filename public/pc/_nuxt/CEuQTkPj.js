import{_ as s}from"./IO9hpqeh.js";import{_ as a}from"./Dw0vWOz4.js";import{_ as t}from"./BR_yKGQj.js";import{e as o,G as e,r,z as i,y as l,p as c,ad as n,R as m,c as d,o as p,b as u,a as v,t as j,j as f,d as w,E as y,_ as h}from"./r4GZdGYg.js";import{_ as g}from"./DkwXwj3h.js";import{E as $}from"./Oz6DVX0g.js";import"./5EY5iYNX.js";import"./YKVlRHu9.js";import"./bHTXMzV5.js";import{a as _,o as b,c as k}from"./74RQ6hvW.js";import{Q as C}from"./xSPxQ0UB.js";import{s as I}from"./DSXY0Md2.js";import"./70QeHNk8.js";import"./BPBPggU1.js";import"./CDFFSI_k.js";import"./DgAv7tgp.js";import"./g8XVjk5f.js";import"./BNGL4P8m.js";import"./Bd103Yf7.js";import"./CIKxL71l.js";import"./DL5ZnEaR.js";import"./VWWcEZs1.js";const x={class:"wechat-com"},S={class:"wechat container"},L={class:"message"},U={class:"message"},V={class:"payment"},z={class:"title"},A={class:"image-div"},B={class:"left-image"},E={key:0,class:"ewm"},Q={key:1,class:"ewm-empty"},R={class:"pw-box-ft"},q=h(o({__name:"wechat",setup(o){const h=e(),q=r(h.query.id),D=r(!0);r({});const G=r(""),M=r({});(async()=>{try{const s=await b({id:q.value});M.value=s.order}catch(s){c.error(s.message),n("/member/order/list/")}})();const{t:O}=i(),P=r(0);let T=null;l(()=>{(async()=>{D.value=!0;try{const s=await k({id:q.value,type:"wechat"});Z(null==s?void 0:s.payInfo.codeUrl)}catch(s){c.error(s.message)}finally{D.value=!1}})(),T=I(()=>{X(),P.value++,50===P.value&&(clearInterval(T),c.error(O("支付已超时，您可以刷新页面重新支付")))},2e3)});const X=()=>{_({id:q.value}).then(s=>{1==s&&(clearInterval(T),$.confirm(O("订单支付成功"),O("提示"),{confirmButtonText:O("查看订单"),showClose:!1,showCancelButton:!1,closeOnClickModal:!1,type:"success"}).then(()=>{n("/member/order/list")}).catch(()=>{}))})},Z=async s=>{const a=s;G.value=await C.toDataURL(a,{margin:1,width:500,height:500})},F=()=>{window.close()},H=()=>{window.location.reload()};return m(()=>{clearInterval(T)}),(o,e)=>{const r=s,i=a,l=t,c=y,n=g;return p(),d("div",null,[u(r,{title:"微信支付"}),u(i,{showLogin:!1}),v("div",x,[v("div",S,[v("div",L,j(o.$t("订单提交成功，请尽快付款"))+"！"+j(o.$t("订单号"))+"："+j(f(M).orderSn),1),v("div",U,[w(j(o.$t("应付金额"))+"： ",1),u(l,{modelValue:f(M).unpaidAmount,"onUpdate:modelValue":e[0]||(e[0]=s=>f(M).unpaidAmount=s),fontStyle:{color:"var(--price)",fontSize:"18px"}},null,8,["modelValue"])]),v("div",V,[v("div",z,j(o.$t("微信支付")),1),v("div",A,[v("div",B,[v("div",null,[w(j(o.$t("如果二维码已过期"))+"，",1),v("span",{onClick:H,class:"font-color",style:{cursor:"pointer"}},j(o.$t("刷新")),1),w(j(o.$t("重新获取二维码"))+"。 ",1)]),f(P)<=50?(p(),d("div",E,[u(c,{class:"image",src:f(G)},null,8,["src"])])):(p(),d("div",Q,[w(j(o.$t("已超时"))+"，",1),v("a",{class:"font-color",onClick:H},j(o.$t("点击刷新")),1)])),v("div",R,[v("div",null,j(o.$t("请使用微信扫一扫")),1),v("div",null,j(o.$t("扫描二维码支付")),1)])]),e[1]||(e[1]=v("div",{class:"right-image"},[v("div",{class:"image"})],-1))]),v("div",{onClick:F,class:"button-title"},"< "+j(o.$t("选择其他支付方式")),1)])])]),u(n,{bg:"white",mt30:!1,type:1})])}}}),[["__scopeId","data-v-97b5e9d7"]]);export{q as default};

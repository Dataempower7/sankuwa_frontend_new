import{b as e}from"./BAtlsuzY.js";import{_ as l}from"./IO9hpqeh.js";import{_ as a}from"./CfxJu6rg.js";import{_ as t}from"./DmNVh8rB.js";import{e as r,z as s,r as u,v as o,an as d,y as i,p as n,H as m,I as p,h as c,c as v,o as f,b,a as y,a9 as h,t as j,F as _,m as g,w as $,i as V,E as x,j as w,k as I,s as k,n as A,d as R,ad as U,_ as E}from"./r4GZdGYg.js";import{_ as q}from"./BPBPggU1.js";import{_ as N}from"./BR_yKGQj.js";import{E as S}from"./DBRalCUy.js";import{a as T,E as F}from"./po9zIj7I.js";import{E as L,a as z}from"./Ceu3XlbY.js";import{E as M,a as Q}from"./CBKhgGlL.js";import{E as D}from"./YKVlRHu9.js";import{E as G}from"./5EY5iYNX.js";import{_ as C}from"./DkwXwj3h.js";import{v as H}from"./D-C0HBq9.js";/* empty css        */import"./DXQ6s2L8.js";import{g as O,a as P,u as X}from"./DlbtYQQR.js";import{U as Y}from"./audGqujR.js";import"./CdHUvLv6.js";import"./CDFFSI_k.js";import"./B0FaLosy.js";import"./Oz6DVX0g.js";import"./bHTXMzV5.js";import"./VWWcEZs1.js";import"./CIKxL71l.js";import"./g8XVjk5f.js";import"./70QeHNk8.js";import"./Bd103Yf7.js";import"./DHuX-Ei4.js";import"./BNGL4P8m.js";import"./DONyGZrs.js";import"./DL5ZnEaR.js";import"./DgAv7tgp.js";import"./DzkGXNvy.js";import"./C4N9DVAQ.js";const Z={class:"container flex"},B={class:"menu"},J={class:"info-row"},K={class:"title-or-tabs"},W={class:"tag-and-input"},ee={class:"tig-tabs"},le={key:0,class:"log-return-content"},ae={class:"info-card"},te={class:"table-header"},re={class:"header-cell"},se={class:"header-cell",style:{width:"90px"}},ue={class:"header-cell",style:{width:"90px"}},oe={class:"header-cell",style:{width:"90px"}},de={class:"header-cell",style:{width:"90px"}},ie={class:"header-cell",style:{width:"90px"}},ne={key:0,class:"gift-tag"},me={class:"pro_pic-box"},pe={class:"text-ellipsis"},ce={class:"name"},ve={class:"value"},fe={key:0},be={class:"file-card"},ye={key:1,class:"log-return-content"},he=E(r({__name:"Info",setup(r){const{t:E}=s(),he=u([]),je=u([]),_e=u([]),ge=u({items:[],pics:[],refundAmount:0,refundAmountMax:0});o(()=>{let e=Re.currentRoute.value.query.itemId,l=Re.currentRoute.value.query.orderId;return l&&e?"one":!e&&l?"all":void 0});const $e=u(!0);i(async()=>{await Ve(),await xe()});const Ve=async()=>{var e,l;try{let a={itemId:Re.currentRoute.value.query.itemId?Re.currentRoute.value.query.itemId:void 0,orderId:Re.currentRoute.value.query.orderId?Re.currentRoute.value.query.orderId:void 0};ge.value.orderId=Number(a.orderId);const t=await O({...a});ge.value.orderStatus=t.order.orderStatus,he.value=t.list,he.value.forEach(e=>{e.number=0});let r=0;t.list.forEach((e,l)=>{r+=Number(e.canApplyQuantity*e.price)}),we.value=null==(e=null==t?void 0:t.order)?void 0:e.productAmount,Ie.value=null==(l=null==t?void 0:t.order)?void 0:l.totalAmount,r=r/Number(we.value)*Number(Ie.value),ge.value.refundAmountMax=r.toFixed(2)}catch(a){n.error(a.message)}finally{$e.value=!1}},xe=async()=>{try{const e=await P();if(je.value=e.aftersaleReason,_e.value=e.aftersaleType,1==ge.value.orderStatus)for(let l in _e.value)_e.value[l]===E("退货/退款")&&delete _e.value[l]}catch(e){n.error(e.message)}finally{$e.value=!1}},we=u(),Ie=u();m(()=>he.value,e=>{let l=0;e.forEach((e,a)=>{l+=Number(e.number*e.price)}),ge.value.refundAmount=l},{deep:!0,immediate:!0});const ke=p(),Ae=async()=>{try{await ke.value.validate(),ge.value.orderItemId=ge.value.itemId,ge.value.items=[],he.value.forEach(e=>{ge.value.items.push({orderItemId:e.itemId,number:e.number})});await X({...ge.value});n.success("提交成功"),await ke.value.resetFields(),U("/member/return/log")}catch(e){e.message&&n.error(e.message)}finally{$e.value=!1}},Re=d(),Ue=c([{value:"退/换货申请",url:"/member/return/list",size:0},{value:"申请记录",url:"/member/return/log",size:0}]);return(r,s)=>{const u=e,o=l,d=a,i=t,n=x,m=q,p=N,c=S,U=F,E=T,O=L,P=Q,X=M,Ve=D,xe=G,we=z,Ie=C,Re=H;return f(),v(_,null,[b(u),b(o,{title:"退/换货申请"}),y("div",Z,[y("div",B,[b(d)]),y("div",J,[y("div",K,[y("div",W,[y("div",ee,[b(i,{menuList:Ue},null,8,["menuList"])])])]),$e.value?h((f(),v("div",ye,null,512)),[[Re,$e.value]]):(f(),v("div",le,[y("div",ae,[y("table",null,[y("thead",te,[y("tr",null,[y("th",re,j(r.$t("商品名称")),1),y("th",se,j(r.$t("商品价格")),1),y("th",ue,j(r.$t("购买数量")),1),y("th",oe,j(r.$t("小计")),1),y("th",de,j(r.$t("可退换数量")),1),y("th",ie,j(r.$t("退/换数量")),1)])]),y("tbody",null,[(f(!0),v(_,null,g(he.value,e=>(f(),v("tr",null,[y("td",null,[b(m,{title:e.productName,to:w(k)({path:"product",id:e.itemId,sn:e.productSn}),class:"nuxt",target:"_blank"},{default:$(()=>[1===e.isGift?(f(),v("div",ne,j(r.$t("赠品")),1)):V("",!0),y("div",me,[b(n,{src:("imageFormat"in r?r.imageFormat:w(I))(e.picThumb),class:"pro_pic",loading:"lazy",style:{transition:"opacity 0.2s linear"}},null,8,["src"])]),y("div",pe,[y("ul",null,[y("li",null,j(r.$t("货号"))+"："+j(e.productSn),1),y("li",null,j(e.productName),1),y("li",null,[(f(!0),v(_,null,g(e.skuData,(l,a)=>{var t;return f(),v(_,null,[y("span",ce,j(l.name)+"：",1),y("span",ve,j(l.value),1),a<(null==(t=e.skuData)?void 0:t.length)-1?(f(),v("span",fe,"；")):V("",!0)],64)}),256))])])])]),_:2},1032,["title","to"])]),y("td",null,[b(p,{modelValue:e.price,"onUpdate:modelValue":l=>e.price=l,fontStyle:{color:"var(--price)"},showText:!1},null,8,["modelValue","onUpdate:modelValue"])]),y("td",null,j(e.quantity),1),y("td",null,[b(p,{modelValue:e.subtotal,"onUpdate:modelValue":l=>e.subtotal=l,fontStyle:{color:"var(--price)"},showText:!1},null,8,["modelValue","onUpdate:modelValue"])]),y("td",null,j(e.canApplyQuantity),1),y("td",null,[b(c,{modelValue:e.number,"onUpdate:modelValue":l=>e.number=l,modelModifiers:{number:!0},max:e.canApplyQuantity,min:0,clearable:"",disabled:1===e.isGift,placeholder:r.$t("请输入数量")},null,8,["modelValue","onUpdate:modelValue","max","disabled","placeholder"])])]))),256))])])]),y("div",be,[b(we,{ref_key:"formRef",ref:ke,"label-width":"auto",model:ge.value,class:"form-body","label-suffix":"："},{default:$(()=>[b(O,{rules:[{required:!0,message:r.$t("请选择服务类型")}],label:r.$t("服务类型"),prop:"aftersaleType"},{default:$(()=>[b(E,{modelValue:ge.value.aftersaleType,"onUpdate:modelValue":s[0]||(s[0]=e=>ge.value.aftersaleType=e)},{default:$(()=>{return[(f(!0),v(_,null,g((e=_e.value?_e.value:{},e?Object.entries(e).map(([e,l])=>({id:Number(e),name:String(l)})):[]),e=>(f(),A(U,{value:e.id},{default:$(()=>[R(j(r.$t(e.name)),1)]),_:2},1032,["value"]))),256))];var e}),_:1},8,["modelValue"])]),_:1},8,["rules","label"]),b(O,{rules:[{required:!0,message:r.$t("请选择售后原因")}],label:r.$t("售后原因"),prop:"aftersaleReason"},{default:$(()=>[b(X,{modelValue:ge.value.aftersaleReason,"onUpdate:modelValue":s[1]||(s[1]=e=>ge.value.aftersaleReason=e),placeholder:r.$t("请选择"),style:{width:"500px"}},{default:$(()=>[(f(!0),v(_,null,g(je.value,(e,l)=>(f(),A(P,{key:e,label:r.$t(e),value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["rules","label"]),b(O,{label:r.$t("预计退款金额"),prop:"refundAmount"},{default:$(()=>[b(Ve,{disabled:"",modelValue:ge.value.refundAmount,"onUpdate:modelValue":s[2]||(s[2]=e=>ge.value.refundAmount=e),clearable:"",placeholder:r.$t("请输入申请金额")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),b(O,{rules:[{required:!0,message:r.$t("问题描述不能为空")}],label:r.$t("问题描述"),prop:"description"},{default:$(()=>[b(Ve,{modelValue:ge.value.description,"onUpdate:modelValue":s[3]||(s[3]=e=>ge.value.description=e),row:4,clearable:"",placeholder:r.$t("请输入问题描述"),type:"textarea"},null,8,["modelValue","placeholder"])]),_:1},8,["rules","label"]),b(O,{label:r.$t("上传文件")},{default:$(()=>[b(Y,{uploadList:ge.value.pics,"onUpdate:uploadList":s[4]||(s[4]=e=>ge.value.pics=e),fileTypes:["gif","jpeg","png","word","excel","txt","zip","ppt","pdf"],limit:5},null,8,["uploadList"])]),_:1},8,["label"]),b(O,{label:""},{default:$(()=>[b(xe,{type:"primary",onClick:Ae},{default:$(()=>[R(j(r.$t("提交")),1)]),_:1})]),_:1})]),_:1},8,["model"])])]))])]),b(Ie)],64)}}}),[["__scopeId","data-v-e122dd3a"]]);export{he as default};

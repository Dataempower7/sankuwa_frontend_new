import{dh as ge,di as me,dj as pe,_ as se,bR as ae,a8 as ye,z as ce,r as t,h as be,v as ue,H as Se,y as ke,aQ as we,c as S,o as b,i as E,a as k,q as W,b as U,ad as xe,w as ee,ae as ze,x as te,t as P,bE as Ce,V as Be,aL as le,dk as oe,e as de,n as _e,j as y,an as Ie,f as Te,B as We,F as Ee,aj as He,p as re}from"./BjkHNVA8.js";import{s as Ne}from"./x_rD_Ya3.js";function Me(i,n,l){n=ge(n,i);var e=-1,o=n.length;for(o||(o=1,i=void 0);++e<o;){var s=i?.[me(n[e])];s===void 0&&(e=o,s=l),i=pe(s)?s.call(i):s}return i}function Oe(i){let n,l,e,o;const s=i.$el.parentNode.offsetWidth||window.innerWidth,u=i.$el.parentNode.offsetHeight||window.innerHeight;return i.imgSize.width.includes("%")?n=`${parseInt(i.imgSize.width,10)/100*s}px`:n=i.imgSize.width,i.imgSize.height.includes("%")?l=`${parseInt(i.imgSize.height,10)/100*u}px`:l=i.imgSize.height,i.barSize.width.includes("%")?e=`${parseInt(i.barSize.width,10)/100*s}px`:e=i.barSize.width,i.barSize.height.includes("%")?o=`${parseInt(i.barSize.height,10)/100*u}px`:o=i.barSize.height,{imgWidth:n,imgHeight:l,barWidth:e,barHeight:o}}const Le={name:"VerifySlide",props:{captchaType:{type:String},type:{type:String,default:"1"},mode:{type:String,default:"fixed"},vSpace:{type:Number,default:5},explain:{type:String,default:"向右拖动滑块填充拼图"},imgSize:{type:Object,default(){return{width:"310px",height:"155px"}}},blockSize:{type:Object,default(){return{width:"50px",height:"50px"}}},barSize:{type:Object,default(){return{width:"310px",height:"40px"}}}},setup(i,n){const{mode:l,captchaType:e,vSpace:o,imgSize:s,barSize:u,type:h,blockSize:v,explain:B}=ae(i),{proxy:r}=ye(),{t:w}=ce();let g=t(""),_=t(""),x=t(""),H=t(""),d=t(""),I=t(""),T=t(""),f=t(""),m=t(""),z=t(""),M=t(""),C=be({imgHeight:0,imgWidth:0,barHeight:0,barWidth:0}),fe=t(0),he=t(0),O=t(void 0),Q=t(void 0),L=t(void 0),V=t("#ddd"),A=t("#d1e0f1"),F=t(void 0),j=t("icon-right"),R=t(!1),N=t(!1),G=t(!0),Y=t(""),D=t(""),X=t(0);const q=ue(()=>r.$el.querySelector(".verify-bar-area"));function ie(){z.value=B.value,ne(),Be(()=>{let{imgHeight:a,imgWidth:c,barHeight:J,barWidth:p}=Oe(r);C.imgHeight=a,C.imgWidth=c,C.barHeight=J,C.barWidth=p,r.$emit("ready",r)}),window.removeEventListener("touchmove",function(a){K(a)}),window.removeEventListener("mousemove",function(a){K(a)}),window.removeEventListener("touchend",function(){Z()}),window.removeEventListener("mouseup",function(){Z()}),window.addEventListener("touchmove",function(a){K(a)}),window.addEventListener("mousemove",function(a){K(a)}),window.addEventListener("touchend",function(){Z()}),window.addEventListener("mouseup",function(){Z()})}Se(h,()=>{ie()}),ke(()=>{ie(),r.$el.onselectstart=function(){return!1}});function ve(a){if(a=a||window.event,a.touches)var c=a.touches[0].pageX;else var c=a.clientX;X.value=Math.floor(c-q.value.getBoundingClientRect().left),I.value=+new Date,N.value==!1&&(z.value="",L.value="#1991fa",V.value="#1991fa",A.value="#d1e0f1",F.value="#fff",a.stopPropagation(),R.value=!0)}function K(a){if(a=a||window.event,R.value&&N.value==!1){let c=a.touches?a.touches[0].pageX:a.clientX,J=q.value.getBoundingClientRect().left,p=c-J;p>=q.value.offsetWidth-parseInt(parseInt(v.value.width)/2)-2&&(p=q.value.offsetWidth-parseInt(parseInt(v.value.width)/2)-2),p<=0&&(p=parseInt(parseInt(v.value.width)/2)),O.value=p-X.value+"px",p-X.value<0&&(O.value="0px"),Q.value=p-X.value+40+"px"}}function Z(){if(T.value=+new Date,R.value&&N.value==!1){var a=parseInt((O.value||"").replace("px",""));a=a*310/parseInt(C.imgWidth);let c={captchaType:e.value,pointJson:g.value?oe(JSON.stringify({x:a,y:5}),g.value):JSON.stringify({x:a,y:5}),token:d.value};le({url:"common/verification/check",method:"post",data:c}).then(J=>{L.value="#52ccba",V.value="#52ccba",A.value="#d2f4ef",F.value="#fff",j.value="icon-check",G.value=!1,N.value=!0,l.value=="pop"&&setTimeout(()=>{r.$parent.clickShow=!1,$()},1500),_.value=!0,m.value=`${((T.value-I.value)/1e3).toFixed(2)}s${w("验证成功")}`;var p=g.value?oe(d.value+"---"+JSON.stringify({x:a,y:5}),g.value):d.value+"---"+JSON.stringify({x:a,y:5});setTimeout(()=>{m.value="",r.$emit("close"),r.$emit("success",{verifyToken:p})},1e3)}).catch(J=>{L.value="#d9534f",V.value="#d9534f",A.value="#fce1e1",F.value="#fff",j.value="icon-close",_.value=!1,setTimeout(function(){$()},1e3),r.$emit("error",r),m.value=$t("验证失败"),setTimeout(()=>{m.value=""},1e3)}),R.value=!1}}const $=()=>{G.value=!0,M.value="",Y.value="left .3s",O.value=0,Q.value=void 0,D.value="width .3s",V.value="#ddd",A.value="#d1e0f1",L.value="#fff",F.value="#666",j.value="icon-right",N.value=!1,ne(),setTimeout(()=>{D.value="",Y.value="",z.value=B.value},300)};function ne(){let a={captchaType:e.value};le({url:"common/verification/captcha",method:"post",data:a}).then(c=>{x.value=c.originalImageBase64,H.value=c.jigsawImageBase64,d.value=c.token,g.value=c.secretKey}).catch(c=>{m.value=c.message})}return{secretKey:g,passFlag:_,backImgBase:x,blockBackImgBase:H,backToken:d,startMoveTime:I,endMovetime:T,tipsBackColor:f,tipWords:m,text:z,finishText:M,setSize:C,top:fe,left:he,moveBlockLeft:O,leftBarWidth:Q,moveBlockBackgroundColor:L,leftBarBorderColor:V,leftBarBackgroundColor:A,iconColor:F,iconClass:j,status:R,isEnd:N,showRefresh:G,transitionLeft:Y,transitionWidth:D,barArea:q,refresh:$,start:ve}}},Ve={style:{position:"relative"}},Ae=["src"],Fe=["textContent"],Re=["textContent"],qe=["src"];function Je(i,n,l,e,o,s){const u=we("a-spin");return b(),S("div",Ve,[l.type==="2"?(b(),S("div",{key:0,class:"verify-img-out",style:W({height:parseInt(e.setSize.imgHeight)+l.vSpace+"px"})},[k("div",{class:"verify-img-panel",style:W({width:e.setSize.imgWidth,height:e.setSize.imgHeight})},[U(u,{spinning:!e.backImgBase,style:"width:100%;padding-top:39px"},{default:ee(()=>[e.backImgBase?(b(),S("img",{key:0,src:"data:image/png;base64,"+e.backImgBase,alt:"",style:{width:"100%",height:"100%",display:"block"}},null,8,Ae)):E("",!0)]),_:1},8,["spinning"]),e.backImgBase?xe((b(),S("div",{key:0,class:"verify-refresh",onClick:n[0]||(n[0]=(...h)=>e.refresh&&e.refresh(...h))},n[3]||(n[3]=[k("i",{class:"iconfont-pc icon-refresh"},null,-1)]),512)),[[ze,e.showRefresh]]):E("",!0),U(Ce,{name:"tips"},{default:ee(()=>[(b(),S("span",{key:0,class:te("verify-tips "+(e.tipWords?"show ":"")+(e.passFlag?"suc-bg":"err-bg"))},P(e.tipWords),3))]),_:1})],4)],4)):E("",!0),k("div",{class:"verify-bar-area",style:W({width:e.setSize.imgWidth,height:l.barSize.height,"line-height":l.barSize.height})},[k("span",{class:"verify-msg",textContent:P(i.$t(e.text))},null,8,Fe),k("div",{class:"verify-left-bar",style:W({width:e.leftBarWidth!==void 0?e.leftBarWidth:l.barSize.height,height:l.barSize.height,"border-color":e.leftBarBorderColor,"background-color":e.leftBarBackgroundColor,transaction:e.transitionWidth})},[k("span",{class:"verify-msg",textContent:P(e.finishText)},null,8,Re),k("div",{class:"verify-move-block",onTouchstart:n[1]||(n[1]=(...h)=>e.start&&e.start(...h)),onMousedown:n[2]||(n[2]=(...h)=>e.start&&e.start(...h)),style:W({width:l.barSize.height,height:l.barSize.height,"background-color":e.moveBlockBackgroundColor,left:e.moveBlockLeft,transition:e.transitionLeft})},[k("i",{class:te(["verify-icon iconfont-pc",e.iconClass]),style:W({color:e.iconColor})},null,6),l.type==="2"?(b(),S("div",{key:0,class:"verify-sub-block",style:W({width:Math.floor(parseInt(e.setSize.imgWidth)*47/310)+"px",height:e.setSize.imgHeight,top:"-"+(parseInt(e.setSize.imgHeight)+l.vSpace)+"px","background-size":e.setSize.imgWidth+" "+e.setSize.imgHeight})},[e.blockBackImgBase?(b(),S("img",{key:0,src:"data:image/png;base64,"+e.blockBackImgBase,alt:"",style:{width:"100%",height:"100%",display:"block","-webkit-user-drag":"none"}},null,8,qe)):E("",!0)],4)):E("",!0)],36)],4)],4)])}const Pe=se(Le,[["render",Je]]),je=de({__name:"Verify",props:{captchaType:{type:String,required:!0},figure:{type:Number},arith:{type:Number},mode:{type:String,default:"pop"},vSpace:{type:Number},explain:{type:String},imgSize:{type:Object,default(){return{width:"310px",height:"155px"}}},blockSize:{type:Object},barSize:{type:Object},close:{type:Function}},emits:["okCallback"],setup(i,{expose:n,emit:l}){const e=i,{captchaType:o,figure:s,arith:u,mode:h,vSpace:v,explain:B,imgSize:r,blockSize:w,barSize:g}=ae(e);t(!1),t(void 0);const _=t(void 0),x=t({}),H=l,d=t(!1),I=()=>{x.value.refresh&&x.value.refresh()},T=()=>{d.value=!1,I()},f=()=>{document.body.style.overflow="hidden",d.value=!0},m=z=>{H("okCallback",z)};return n({show:f}),(z,M)=>(b(),_e(y(Ie),{class:"verifybox",open:d.value,"onUpdate:open":M[0]||(M[0]=C=>d.value=C),centered:"",width:parseInt(y(r).width)+30+"px",title:z.$t("请完成安全验证"),destroyOnClose:!1,footer:null},{default:ee(()=>[U(Pe,{is:_.value,captchaType:y(o),type:"2",figure:y(s),arith:y(u),mode:y(h),vSpace:y(v),explain:y(B),imgSize:y(r),blockSize:y(w),barSize:y(g),ref_key:"instance",ref:x,onClose:T,onSuccess:m},null,8,["is","captchaType","figure","arith","mode","vSpace","explain","imgSize","blockSize","barSize"])]),_:1},8,["open","width","title"]))}}),Xe={key:1,class:"code-text"},Ke=de({__name:"MobileCode",props:{class:String,email:{type:String,default:""},mobileCodeSended:{type:Boolean,default:!1},showMessage:{type:Boolean,default:!1},mobile:{type:String,default:""},requestApi:{type:Function,default:Me},event:{type:String,default:"login"}},emits:["mobileErrorCallback","update:mobileCodeSended"],setup(i,{emit:n}){const l=Te(),{t:e}=ce(),o=i,{mobile:s}=ae(o),u=n,h=t("获取验证码"),v=t(!0),B=t(),r=t(null),w=t(60),g=async()=>{if(o.email){if(o.email==""){u("mobileErrorCallback",e("邮箱不能为空！"));return}if(!x(o.email)){u("mobileErrorCallback",e("邮箱格式错误"));return}}else{if(s.value==""){u("mobileErrorCallback",e("手机号不能为空！"));return}if(!_(s.value)){u("mobileErrorCallback",e("手机号格式错误"));return}}if(!r.value){B.value.show();return}try{await o.requestApi({mobile:s.value,email:o.email,verifyToken:r.value,event:o.event}),re.success(e("验证码已发送")),v.value=!1,u("update:mobileCodeSended",!0),I()}catch(f){v.value=!0,o.showMessage&&re.error(f.message),u("mobileErrorCallback",f.message)}finally{r.value=null}},_=f=>!!(l.isOpenMobileAreaCode?/^(\+?[1-9]\d{1,14})$/:/^(?:\+?86)?1[3-9]\d{9}$/).test(f),x=f=>/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(f),H=ue(()=>`${w.value}秒后重发`),d=t(),I=()=>{d.value=Ne(()=>{w.value--,w.value<=0&&(clearInterval(d.value),v.value=!0,w.value=60)},1e3)},T=f=>{r.value=f.verifyToken,g()};return We(()=>{clearInterval(d.value)}),(f,m)=>(b(),S(Ee,null,[k("div",{class:te(o.class)},[v.value?(b(),S("div",{key:0,class:"code-btn",onClick:He(g,["stop"])},P(f.$t(h.value)),1)):E("",!0),v.value?E("",!0):(b(),S("div",Xe,P(H.value),1))],2),U(je,{ref_key:"verify",ref:B,mode:"pop",captchaType:"blockPuzzle",imgSize:{width:"310px",height:"155px"},onOkCallback:T},null,512)],64))}}),Qe=se(Ke,[["__scopeId","data-v-aeeb28b8"]]);export{Qe as M,je as _};

import{b8 as x,aL as Z,aw as tt,r as v,e as et,ax as N,f as ot,ar as at,ay as $,H as z,c as u,o as a,F as B,a as o,i as m,m as F,b as p,j as n,s as f,w as i,E as st,k as rt,d as _,t as s,al as nt,n as k,ad as ct,as as dt,x as ut,_ as lt}from"./BjkHNVA8.js";import{_ as it}from"./BipSnJcb.js";import{_ as pt}from"./CBcH1uzJ.js";import{E as ht}from"./B_vjKAZC.js";import{B as mt}from"./CWzVxcs9.js";import{u as _t}from"./CQ93QHlZ.js";import{P as gt}from"./BmiGu4wZ.js";import{g as M}from"./D5AuvtSp.js";const Wt=d=>x({url:"search/search/getFilter",method:"post",data:d}),Xt=d=>x({url:"search/search/getAttributeSuggestions",method:"get",params:d}),vt=d=>Z({url:"search/search/getProduct",method:"post",data:d}),yt=tt("search",()=>({total:v(0)})),ft={class:"goods-list-c"},kt={class:"wrap"},bt={class:"g-item-warp"},St={class:"pic"},It={class:"info"},Pt={class:"name"},Ct={key:0,class:"shop-info"},$t={key:1,class:"shop-name"},Bt={class:"promotion-box"},Vt={key:0,class:"activity"},qt={key:1,class:"promotion"},Tt={class:"ticket-type"},wt={class:"ticket-content"},Lt={class:"item_cart_num"},Nt={class:"shopping_num"},zt=["onUpdate:modelValue","onInput"],Ft=["onClick"],Mt=["onClick"],xt={class:"shopping_act"},Et={key:0,class:"search-empty"},Ut={class:"bd"},jt={class:"pagination"},At=et({__name:"CatGoodsList",props:N({queryParams:{type:Object,default:{}},attrs:{type:Array,default:()=>[]}},{filter:{},filterModifiers:{},queryParams:{},queryParamsModifiers:{},loadingProduct:{},loadingProductModifiers:{}}),emits:N(["change","pageChange"],["update:filter","update:queryParams","update:loadingProduct"]),setup(d,{emit:E}){const V=ot(),b=d,S=yt(),q=at(),T=v(25),w=E,I=$(d,"filter"),U=$(d,"queryParams"),P=$(d,"loadingProduct"),g=v([]),h=v({}),L=async()=>{try{P.value=!0,g.value=[];const t=await vt({...b.queryParams,size:T.value,attrs:b.attrs});g.value=t.records,S.total=t.total??0,g.value.forEach(l=>{l.number=1});const c=t.records.map(l=>({productId:l.productId}));j({products:c,from:"list"})}catch{}finally{P.value=!1}},j=async t=>{try{const c=await _t({products:t.products,shopId:t.shopId,from:t.from});h.value=c}catch(c){console.error(c)}},A={1:"秒杀价",2:"券",3:"满减",4:"折扣",5:"满赠",6:"限时折扣",7:"拼团"},D=t=>A[t];z(()=>U.value,()=>{L()},{deep:!0,immediate:!0}),z(()=>b.attrs,()=>{L()},{deep:!0,immediate:!0});const R=v(null),G=()=>{w("change",I.value.page),w("pageChange")},Q=(t,c)=>{const l=t?.target.value.replace(/[^0-9]/g,"");c.number=l?Math.max(1,Number(l)):void 0},H=t=>{t.number&&t.number++},O=t=>{t.number&&t.number>1&&t.number--},J=()=>{q.replace({path:q.currentRoute.value.path,query:{}})},K=t=>h.value[`${t.productId}`]?.activityInfo[0]?.type===7?{path:"joining",id:t.productId,productSn:t.productSn}:{path:"product",id:t.productId,sn:t.productSn};return(t,c)=>{const l=st,y=it,W=pt,C=ht,X=mt;return a(),u(B,null,[o("div",{class:"goods-list__box",ref_key:"productBox",ref:R},[o("div",ft,[o("div",kt,[(a(!0),u(B,null,F(g.value,(e,Y)=>(a(),u("div",{class:"item",key:Y},[o("div",bt,[o("div",St,[p(y,{to:n(f)(K(e)),target:"_blank"},{default:i(()=>[p(l,{class:"ease",lazy:"",src:n(rt)(e.picUrl)},null,8,["src"])]),_:2},1032,["to"])]),o("div",It,[p(W,{class:"",modelValue:e.price,"onUpdate:modelValue":r=>e.price=r},null,8,["modelValue","onUpdate:modelValue"]),o("div",Pt,[p(y,{to:n(f)({path:"product",id:e.productId,sn:e.productSn}),target:"_blank"},{default:i(()=>[_(s(e.productName),1)]),_:2},1032,["to"])]),n(nt)()?(a(),u("div",Ct,[e.shop?(a(),k(y,{key:0,class:"shop-name",to:n(f)({path:"shop",id:e.shopId}),target:"_blank"},{default:i(()=>[_(s(t.$t(e.shop.shopTitle)),1)]),_:2},1032,["to"])):(a(),u("div",$t,s(n(V).defaultShopName?t.$t(n(V).defaultShopName):t.$t("官方自营")),1))])):m("",!0),o("div",Bt,[h.value[e.productId]&&h.value[e.productId].activityInfo&&h.value[e.productId].activityInfo.length>0?(a(!0),u(B,{key:0},F(h.value[e.productId].activityInfo,r=>(a(),u("div",{class:"promotion-box-item",key:r.productId},[r.type!=2?(a(),u("div",Vt,s(t.$t(D(r.type))),1)):m("",!0),r.type==2?(a(),u("div",qt,[o("div",Tt,[_(s(t.$t("券"))+" ",1),c[1]||(c[1]=o("span",{class:"ticket-line"},null,-1))]),o("div",wt,s(r.data.promotionDesc),1)])):m("",!0)]))),128)):m("",!0)]),o("div",Lt,[o("div",Nt,[ct(o("input",{"onUpdate:modelValue":r=>e.number=r,type:"text",onInput:r=>Q(r,e)},null,40,zt),[[dt,e.number,void 0,{number:!0}]]),o("span",null,[o("a",{class:"add",href:"javascript:;",onClick:r=>H(e)},null,8,Ft),o("a",{class:ut(["decrease",e.number&&e.number<=1?"disabled":""]),href:"javascript:;",onClick:r=>O(e)},null,10,Mt)])]),o("div",xt,[e.productSku&&e.productSku.length>0?(a(),k(y,{key:0,to:n(f)({path:"product",id:e.productId,sn:e.productSn})},{default:i(()=>[p(C,{size:"small",type:"primary"},{default:i(()=>[_(s(t.$t(n(M)(e.productType))),1)]),_:2},1024)]),_:2},1032,["to"])):(a(),k(X,{key:1,isQuick:e.productType!==1,id:e.productId,disabled:e.productStock==0||e.seckillStock==0,number:e.number},{default:i(()=>[p(C,{disabled:e.productStock==0||e.seckillStock==0,size:"small",type:"primary"},{default:i(()=>[_(s(t.$t(n(M)(e.productType))),1)]),_:2},1032,["disabled"])]),_:2},1032,["isQuick","id","disabled","number"]))])])])])]))),128)),g.value.length===0&&!P.value?(a(),u("div",Et,[o("div",Ut,[o("h4",null,s(t.$t("好狠的筛选条件啊，把相关的商品都埋没了！")),1),o("p",null,s(t.$t("建议您")),1),o("p",null,s(t.$t("1、适当减少筛选条件")),1),o("p",null,s(t.$t("2、调整价格区间")),1),o("p",null,s(t.$t("3、尝试其他关键字")),1),p(C,{class:"graybtn mt10",onClick:J},{default:i(()=>[_(s(t.$t("返回上一步")),1)]),_:1})])])):m("",!0)])])],512),o("div",jt,[n(S).total>0?(a(),k(n(gt),{key:0,page:I.value.page,"onUpdate:page":c[0]||(c[0]=e=>I.value.page=e),size:T.value,total:n(S).total,onCallback:G},null,8,["page","size","total"])):m("",!0)])],64)}}}),Yt=lt(At,[["__scopeId","data-v-5119ffc1"]]);export{Yt as C,Wt as a,Xt as g,yt as u};
